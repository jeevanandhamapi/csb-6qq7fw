parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"mkVv":[function(require,module,exports) {
"use strict";function e(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(e){return"'"+e+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function t(e){return!!e&&!!e[Q]}function r(e){var t;return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===Z}(e)||Array.isArray(e)||!!e[L]||!!(null===(t=e.constructor)||void 0===t?void 0:t[L])||s(e)||l(e))}function n(r){return t(r)||e(23,r),r[Q].t}function o(e,t,r){void 0===r&&(r=!1),0===i(e)?(r?Object.keys:ee)(e).forEach(function(n){r&&"symbol"==typeof n||t(n,e[n],e)}):e.forEach(function(r,n){return t(n,r,e)})}function i(e){var t=e[Q];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:s(e)?2:l(e)?3:0}function a(e,t){return 2===i(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function u(e,t){return 2===i(e)?e.get(t):e[t]}function c(e,t,r){var n=i(e);2===n?e.set(t,r):3===n?e.add(r):e[t]=r}function f(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function s(e){return X&&e instanceof Map}function l(e){return q&&e instanceof Set}function p(e){return e.o||e.t}function h(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=te(e);delete t[Q];for(var r=ee(t),n=0;n<r.length;n++){var o=r[n],i=t[o];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[o]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[o]})}return Object.create(Object.getPrototypeOf(e),t)}function v(e,n){return void 0===n&&(n=!1),y(e)||t(e)||!r(e)||(i(e)>1&&(e.set=e.add=e.clear=e.delete=d),Object.freeze(e),n&&o(e,function(e,t){return v(t,!0)},!0)),e}function d(){e(2)}function y(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function b(t){var r=re[t];return r||e(18,t),r}function g(e,t){re[e]||(re[e]=t)}function m(){return J}function P(e,t){t&&(b("Patches"),e.u=[],e.s=[],e.v=t)}function O(e){x(e),e.p.forEach(j),e.p=null}function x(e){e===J&&(J=e.l)}function w(e){return J={p:[],l:J,h:e,m:!0,_:0}}function j(e){var t=e[Q];0===t.i||1===t.i?t.j():t.O=!0}function A(t,n){n._=n.p.length;var o=n.p[0],i=void 0!==t&&t!==o;return n.h.g||b("ES5").S(n,t,i),i?(o[Q].P&&(O(n),e(4)),r(t)&&(t=S(n,t),n.l||D(n,t)),n.u&&b("Patches").M(o[Q].t,t,n.u,n.s)):t=S(n,o,[]),O(n),n.u&&n.v(n.u,n.s),t!==H?t:void 0}function S(e,t,r){if(y(t))return t;var n=t[Q];if(!n)return o(t,function(o,i){return _(e,n,t,o,i,r)},!0),t;if(n.A!==e)return t;if(!n.P)return D(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var i=4===n.i||5===n.i?n.o=h(n.k):n.o,a=i,u=!1;3===n.i&&(a=new Set(i),i.clear(),u=!0),o(a,function(t,o){return _(e,n,i,t,o,r,u)}),D(e,i,!1),r&&e.u&&b("Patches").N(n,r,e.u,e.s)}return n.o}function _(e,n,o,i,u,f,s){if(t(u)){var l=S(e,u,f&&n&&3!==n.i&&!a(n.R,i)?f.concat(i):void 0);if(c(o,i,l),!t(l))return;e.m=!1}else s&&o.add(u);if(r(u)&&!y(u)){if(!e.h.D&&e._<1)return;S(e,u),n&&n.A.l||D(e,u)}}function D(e,t,r){void 0===r&&(r=!1),!e.l&&e.h.D&&e.m&&v(t,r)}function R(e,t){var r=e[Q];return(r?p(r):e)[t]}function k(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function I(e){e.P||(e.P=!0,e.l&&I(e.l))}function z(e){e.o||(e.o=h(e.t))}function E(e,t,r){var n=s(t)?b("MapSet").F(t,r):l(t)?b("MapSet").T(t,r):e.g?function(e,t){var r=Array.isArray(e),n={i:r?1:0,A:t?t.A:m(),P:!1,I:!1,R:{},l:t,t:e,k:null,o:null,j:null,C:!1},o=n,i=ne;r&&(o=[n],i=oe);var a=Proxy.revocable(o,i),u=a.revoke,c=a.proxy;return n.k=c,n.j=u,c}(t,r):b("ES5").J(t,r);return(r?r.A:m()).p.push(n),n}function M(n){return t(n)||e(22,n),function e(t){if(!r(t))return t;var n,a=t[Q],f=i(t);if(a){if(!a.P&&(a.i<4||!b("ES5").K(a)))return a.t;a.I=!0,n=F(t,f),a.I=!1}else n=F(t,f);return o(n,function(t,r){a&&u(a.t,t)===r||c(n,t,e(r))}),3===f?new Set(n):n}(n)}function F(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return h(e)}function N(){function e(e,t){var r=u[e];return r?r.enumerable=t:u[e]=r={configurable:!0,enumerable:t,get:function(){var t=this[Q];return ne.get(t,e)},set:function(t){var r=this[Q];ne.set(r,e,t)}},r}function r(e){for(var t=e.length-1;t>=0;t--){var r=e[t][Q];if(!r.P)switch(r.i){case 5:i(r)&&I(r);break;case 4:n(r)&&I(r)}}}function n(e){for(var t=e.t,r=e.k,n=ee(r),o=n.length-1;o>=0;o--){var i=n[o];if(i!==Q){var u=t[i];if(void 0===u&&!a(t,i))return!0;var c=r[i],s=c&&c[Q];if(s?s.t!==u:!f(c,u))return!0}}var l=!!t[Q];return n.length!==ee(t).length+(l?0:1)}function i(e){var t=e.k;if(t.length!==e.t.length)return!0;var r=Object.getOwnPropertyDescriptor(t,t.length-1);if(r&&!r.get)return!0;for(var n=0;n<t.length;n++)if(!t.hasOwnProperty(n))return!0;return!1}var u={};g("ES5",{J:function(t,r){var n=Array.isArray(t),o=function(t,r){if(t){for(var n=Array(r.length),o=0;o<r.length;o++)Object.defineProperty(n,""+o,e(o,!0));return n}var i=te(r);delete i[Q];for(var a=ee(i),u=0;u<a.length;u++){var c=a[u];i[c]=e(c,t||!!i[c].enumerable)}return Object.create(Object.getPrototypeOf(r),i)}(n,t),i={i:n?5:4,A:r?r.A:m(),P:!1,I:!1,R:{},l:r,t:t,k:o,o:null,O:!1,C:!1};return Object.defineProperty(o,Q,{value:i,writable:!0}),o},S:function(e,n,u){u?t(n)&&n[Q].A===e&&r(e.p):(e.u&&function e(t){if(t&&"object"==typeof t){var r=t[Q];if(r){var n=r.t,u=r.k,c=r.R,f=r.i;if(4===f)o(u,function(t){t!==Q&&(void 0!==n[t]||a(n,t)?c[t]||e(u[t]):(c[t]=!0,I(r)))}),o(n,function(e){void 0!==u[e]||a(u,e)||(c[e]=!1,I(r))});else if(5===f){if(i(r)&&(I(r),c.length=!0),u.length<n.length)for(var s=u.length;s<n.length;s++)c[s]=!1;else for(var l=n.length;l<u.length;l++)c[l]=!0;for(var p=Math.min(u.length,n.length),h=0;h<p;h++)u.hasOwnProperty(h)||(c[h]=!0),void 0===c[h]&&e(u[h])}}}}(e.p[0]),r(e.p))},K:function(e){return 4===e.i?n(e):i(e)}})}function C(){function n(e){if(!r(e))return e;if(Array.isArray(e))return e.map(n);if(s(e))return new Map(Array.from(e.entries()).map(function(e){return[e[0],n(e[1])]}));if(l(e))return new Set(Array.from(e).map(n));var t=Object.create(Object.getPrototypeOf(e));for(var o in e)t[o]=n(e[o]);return a(e,L)&&(t[L]=e[L]),t}function c(e){return t(e)?n(e):e}var f="add";g("Patches",{$:function(t,r){return r.forEach(function(r){for(var o=r.path,a=r.op,c=t,s=0;s<o.length-1;s++){var l=i(c),p=""+o[s];0!==l&&1!==l||"__proto__"!==p&&"constructor"!==p||e(24),"function"==typeof c&&"prototype"===p&&e(24),"object"!=typeof(c=u(c,p))&&e(15,o.join("/"))}var h=i(c),v=n(r.value),d=o[o.length-1];switch(a){case"replace":switch(h){case 2:return c.set(d,v);case 3:e(16);default:return c[d]=v}case f:switch(h){case 1:return"-"===d?c.push(v):c.splice(d,0,v);case 2:return c.set(d,v);case 3:return c.add(v);default:return c[d]=v}case"remove":switch(h){case 1:return c.splice(d,1);case 2:return c.delete(d);case 3:return c.delete(r.value);default:return delete c[d]}default:e(17,a)}}),t},N:function(e,t,r,n){switch(e.i){case 0:case 4:case 2:return function(e,t,r,n){var i=e.t,s=e.o;o(e.R,function(e,o){var l=u(i,e),p=u(s,e),h=o?a(i,e)?"replace":f:"remove";if(l!==p||"replace"!==h){var v=t.concat(e);r.push("remove"===h?{op:h,path:v}:{op:h,path:v,value:p}),n.push(h===f?{op:"remove",path:v}:"remove"===h?{op:f,path:v,value:c(l)}:{op:"replace",path:v,value:c(l)})}})}(e,t,r,n);case 5:case 1:return function(e,t,r,n){var o=e.t,i=e.R,a=e.o;if(a.length<o.length){var u=[a,o];o=u[0],a=u[1];var s=[n,r];r=s[0],n=s[1]}for(var l=0;l<o.length;l++)if(i[l]&&a[l]!==o[l]){var p=t.concat([l]);r.push({op:"replace",path:p,value:c(a[l])}),n.push({op:"replace",path:p,value:c(o[l])})}for(var h=o.length;h<a.length;h++){var v=t.concat([h]);r.push({op:f,path:v,value:c(a[h])})}o.length<a.length&&n.push({op:"replace",path:t.concat(["length"]),value:o.length})}(e,t,r,n);case 3:return function(e,t,r,n){var o=e.t,i=e.o,a=0;o.forEach(function(e){if(!i.has(e)){var o=t.concat([a]);r.push({op:"remove",path:o,value:e}),n.unshift({op:f,path:o,value:e})}a++}),a=0,i.forEach(function(e){if(!o.has(e)){var i=t.concat([a]);r.push({op:f,path:i,value:e}),n.unshift({op:"remove",path:i,value:e})}a++})}(e,t,r,n)}},M:function(e,t,r,n){r.push({op:"replace",path:[],value:t===H?void 0:t}),n.push({op:"replace",path:[],value:e})}})}function T(){function t(e,t){function r(){this.constructor=e}u(e,t),e.prototype=(r.prototype=t.prototype,new r)}function n(e){e.o||(e.R=new Map,e.o=new Map(e.t))}function i(e){e.o||(e.o=new Set,e.t.forEach(function(t){if(r(t)){var n=E(e.A.h,t,e);e.p.set(t,n),e.o.add(n)}else e.o.add(t)}))}function a(t){t.O&&e(3,JSON.stringify(p(t)))}var u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},c=function(){function e(e,t){return this[Q]={i:2,l:t,A:t?t.A:m(),P:!1,I:!1,o:void 0,R:void 0,t:e,k:this,C:!1,O:!1},this}t(e,Map);var i=e.prototype;return Object.defineProperty(i,"size",{get:function(){return p(this[Q]).size}}),i.has=function(e){return p(this[Q]).has(e)},i.set=function(e,t){var r=this[Q];return a(r),p(r).has(e)&&p(r).get(e)===t||(n(r),I(r),r.R.set(e,!0),r.o.set(e,t),r.R.set(e,!0)),this},i.delete=function(e){if(!this.has(e))return!1;var t=this[Q];return a(t),n(t),I(t),t.t.has(e)?t.R.set(e,!1):t.R.delete(e),t.o.delete(e),!0},i.clear=function(){var e=this[Q];a(e),p(e).size&&(n(e),I(e),e.R=new Map,o(e.t,function(t){e.R.set(t,!1)}),e.o.clear())},i.forEach=function(e,t){var r=this;p(this[Q]).forEach(function(n,o){e.call(t,r.get(o),o,r)})},i.get=function(e){var t=this[Q];a(t);var o=p(t).get(e);if(t.I||!r(o))return o;if(o!==t.t.get(e))return o;var i=E(t.A.h,o,t);return n(t),t.o.set(e,i),i},i.keys=function(){return p(this[Q]).keys()},i.values=function(){var e,t=this,r=this.keys();return(e={})[V]=function(){return t.values()},e.next=function(){var e=r.next();return e.done?e:{done:!1,value:t.get(e.value)}},e},i.entries=function(){var e,t=this,r=this.keys();return(e={})[V]=function(){return t.entries()},e.next=function(){var e=r.next();if(e.done)return e;var n=t.get(e.value);return{done:!1,value:[e.value,n]}},e},i[V]=function(){return this.entries()},e}(),f=function(){function e(e,t){return this[Q]={i:3,l:t,A:t?t.A:m(),P:!1,I:!1,o:void 0,t:e,k:this,p:new Map,O:!1,C:!1},this}t(e,Set);var r=e.prototype;return Object.defineProperty(r,"size",{get:function(){return p(this[Q]).size}}),r.has=function(e){var t=this[Q];return a(t),t.o?!!t.o.has(e)||!(!t.p.has(e)||!t.o.has(t.p.get(e))):t.t.has(e)},r.add=function(e){var t=this[Q];return a(t),this.has(e)||(i(t),I(t),t.o.add(e)),this},r.delete=function(e){if(!this.has(e))return!1;var t=this[Q];return a(t),i(t),I(t),t.o.delete(e)||!!t.p.has(e)&&t.o.delete(t.p.get(e))},r.clear=function(){var e=this[Q];a(e),p(e).size&&(i(e),I(e),e.o.clear())},r.values=function(){var e=this[Q];return a(e),i(e),e.o.values()},r.entries=function(){var e=this[Q];return a(e),i(e),e.o.entries()},r.keys=function(){return this.values()},r[V]=function(){return this.values()},r.forEach=function(e,t){for(var r=this.values(),n=r.next();!n.done;)e.call(t,n.value,n.value,this),n=r.next()},e}();g("MapSet",{F:function(e,t){return new c(e,t)},T:function(e,t){return new f(e,t)}})}function K(){N(),T(),C()}function U(e){return e}function W(e){return e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.applyPatches=exports.Immer=void 0,exports.castDraft=U,exports.castImmutable=W,exports.createDraft=void 0,exports.current=M,exports.default=void 0,exports.enableAllPlugins=K,exports.enableES5=N,exports.enableMapSet=T,exports.enablePatches=C,exports.finishDraft=void 0,exports.freeze=v,exports.immerable=void 0,exports.isDraft=t,exports.isDraftable=r,exports.nothing=void 0,exports.original=n,exports.setUseProxies=exports.setAutoFreeze=exports.produceWithPatches=exports.produce=void 0;var $,J,G="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),X="undefined"!=typeof Map,q="undefined"!=typeof Set,B="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,H=G?Symbol.for("immer-nothing"):(($={})["immer-nothing"]=!0,$),L=G?Symbol.for("immer-draftable"):"__$immer_draftable",Q=G?Symbol.for("immer-state"):"__$immer_state",V="undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator",Y={0:"Illegal state",1:"Immer drafts cannot have computed properties",2:"This object has been frozen and should not be mutated",3:function(e){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+e},4:"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.",5:"Immer forbids circular references",6:"The first or second argument to `produce` must be a function",7:"The third argument to `produce` must be a function or undefined",8:"First argument to `createDraft` must be a plain object, an array, or an immerable object",9:"First argument to `finishDraft` must be a draft returned by `createDraft`",10:"The given draft is already finalized",11:"Object.defineProperty() cannot be used on an Immer draft",12:"Object.setPrototypeOf() cannot be used on an Immer draft",13:"Immer only supports deleting array indices",14:"Immer only supports setting array indices and the 'length' property",15:function(e){return"Cannot apply patch, path doesn't resolve: "+e},16:'Sets cannot have "replace" patches.',17:function(e){return"Unsupported patch operation: "+e},18:function(e){return"The plugin for '"+e+"' has not been loaded into Immer. To enable the plugin, import and call `enable"+e+"()` when initializing your application."},20:"Cannot use proxies if Proxy, Proxy.revocable or Reflect are not available",21:function(e){return"produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '"+e+"'"},22:function(e){return"'current' expects a draft, got: "+e},23:function(e){return"'original' expects a draft, got: "+e},24:"Patching reserved attributes like __proto__, prototype and constructor is not allowed"},Z=""+Object.prototype.constructor,ee="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,te=Object.getOwnPropertyDescriptors||function(e){var t={};return ee(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},re={},ne={get:function(e,t){if(t===Q)return e;var n=p(e);if(!a(n,t))return function(e,t,r){var n,o=k(t,r);return o?"value"in o?o.value:null===(n=o.get)||void 0===n?void 0:n.call(e.k):void 0}(e,n,t);var o=n[t];return e.I||!r(o)?o:o===R(e.t,t)?(z(e),e.o[t]=E(e.A.h,o,e)):o},has:function(e,t){return t in p(e)},ownKeys:function(e){return Reflect.ownKeys(p(e))},set:function(e,t,r){var n=k(p(e),t);if(null==n?void 0:n.set)return n.set.call(e.k,r),!0;if(!e.P){var o=R(p(e),t),i=null==o?void 0:o[Q];if(i&&i.t===r)return e.o[t]=r,e.R[t]=!1,!0;if(f(r,o)&&(void 0!==r||a(e.t,t)))return!0;z(e),I(e)}return e.o[t]===r&&(void 0!==r||t in e.o)||Number.isNaN(r)&&Number.isNaN(e.o[t])||(e.o[t]=r,e.R[t]=!0),!0},deleteProperty:function(e,t){return void 0!==R(e.t,t)||t in e.t?(e.R[t]=!1,z(e),I(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=p(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:n.enumerable,value:r[t]}:n},defineProperty:function(){e(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){e(12)}},oe={};exports.immerable=L,exports.nothing=H,o(ne,function(e,t){oe[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),oe.deleteProperty=function(e,t){return oe.set.call(this,e,t,void 0)},oe.set=function(e,t,r){return ne.set.call(this,e[0],t,r,e[0])};var ie=function(){function n(t){var n=this;this.g=B,this.D=!0,this.produce=function(t,o,i){if("function"==typeof t&&"function"!=typeof o){var a=o;o=t;var u=n;return function(e){var t=this;void 0===e&&(e=a);for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return u.produce(e,function(e){var r;return(r=o).call.apply(r,[t,e].concat(n))})}}var c;if("function"!=typeof o&&e(6),void 0!==i&&"function"!=typeof i&&e(7),r(t)){var f=w(n),s=E(n,t,void 0),l=!0;try{c=o(s),l=!1}finally{l?O(f):x(f)}return"undefined"!=typeof Promise&&c instanceof Promise?c.then(function(e){return P(f,i),A(e,f)},function(e){throw O(f),e}):(P(f,i),A(c,f))}if(!t||"object"!=typeof t){if(void 0===(c=o(t))&&(c=t),c===H&&(c=void 0),n.D&&v(c,!0),i){var p=[],h=[];b("Patches").M(t,c,p,h),i(p,h)}return c}e(21,t)},this.produceWithPatches=function(e,t){if("function"==typeof e)return function(t){for(var r=arguments.length,o=Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return n.produceWithPatches(t,function(t){return e.apply(void 0,[t].concat(o))})};var r,o,i=n.produce(e,t,function(e,t){r=e,o=t});return"undefined"!=typeof Promise&&i instanceof Promise?i.then(function(e){return[e,r,o]}):[i,r,o]},"boolean"==typeof(null==t?void 0:t.useProxies)&&this.setUseProxies(t.useProxies),"boolean"==typeof(null==t?void 0:t.autoFreeze)&&this.setAutoFreeze(t.autoFreeze)}var o=n.prototype;return o.createDraft=function(n){r(n)||e(8),t(n)&&(n=M(n));var o=w(this),i=E(this,n,void 0);return i[Q].C=!0,x(o),i},o.finishDraft=function(e,t){var r=e&&e[Q],n=r.A;return P(n,t),A(void 0,n)},o.setAutoFreeze=function(e){this.D=e},o.setUseProxies=function(t){t&&!B&&e(20),this.g=t},o.applyPatches=function(e,r){var n;for(n=r.length-1;n>=0;n--){var o=r[n];if(0===o.path.length&&"replace"===o.op){e=o.value;break}}n>-1&&(r=r.slice(n+1));var i=b("Patches").$;return t(e)?i(e,r):this.produce(e,function(e){return i(e,r)})},n}(),ae=new ie,ue=ae.produce,ce=ae.produceWithPatches.bind(ae),fe=ae.setAutoFreeze.bind(ae),se=ae.setUseProxies.bind(ae),le=ae.applyPatches.bind(ae),pe=ae.createDraft.bind(ae),he=ae.finishDraft.bind(ae);exports.finishDraft=he,exports.createDraft=pe,exports.applyPatches=le,exports.setUseProxies=se,exports.setAutoFreeze=fe,exports.produceWithPatches=ce,exports.produce=ue,exports.Immer=ie;var ve=ue;exports.default=ve;
},{}],"UWKb":[function(require,module,exports) {
"use strict";function t(t){var e,n=new Set,r=function(t,r){var u="function"==typeof t?t(e):t;if(u!==e){var i=e;e=r?u:Object.assign({},e,u),n.forEach(function(t){return t(e,i)})}},u=function(){return e},i={setState:r,getState:u,subscribe:function(t,r,i){return r||i?function(t,r,i){void 0===r&&(r=u),void 0===i&&(i=Object.is);var o=r(e);function c(){var n=r(e);if(!i(o,n)){var u=o;t(o=n,u)}}return n.add(c),function(){return n.delete(c)}}(t,r,i):(n.add(t),function(){return n.delete(t)})},destroy:function(){return n.clear()}};return e=t(r,u,i),i}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t;
},{}],"J5wV":[function(require,module,exports) {
"use strict";function e(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(var n=0;n<r.length;n++)if(!Object.prototype.hasOwnProperty.call(t,r[n])||!Object.is(e[r[n]],t[r[n]]))return!1;return!0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"RsyN":[function(require,module,exports) {
"use strict";function e(e,n,r){return(n=t(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function t(e){var t=n(e,"string");return"symbol"===r(t)?t:String(t)}function n(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.compactObject=v,exports.deprecated=f,exports.detectBrowser=l,exports.disableLog=u,exports.disableWarnings=p,exports.extractVersion=s,exports.filterStats=h,exports.log=c,exports.walkStats=b,exports.wrapPeerConnectionEvent=a;var o=!0,i=!0;function s(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function a(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return o.apply(this,arguments);var i=function(e){var t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,i),o.apply(this,[e,i])};var i=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return i.apply(this,arguments);if(!this._eventMap[t].has(n))return i.apply(this,arguments);var r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,i.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function u(e){return"boolean"!=typeof e?new Error("Argument type: "+r(e)+". Please use a boolean."):(o=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function p(e){return"boolean"!=typeof e?new Error("Argument type: "+r(e)+". Please use a boolean."):(i=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function c(){if("object"===("undefined"==typeof window?"undefined":r(window))){if(o)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function f(e,t){i&&console.warn(e+" is deprecated, please use "+t+" instead.")}function l(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=s(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=s(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=s(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function d(e){return"[object Object]"===Object.prototype.toString.call(e)}function v(t){return d(t)?Object.keys(t).reduce(function(n,r){var o=d(t[r]),i=o?v(t[r]):t[r],s=o&&!Object.keys(i).length;return void 0===i||s?n:Object.assign(n,e({},r,i))},{}):t}function b(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(function(r){r.endsWith("Id")?b(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(function(t){b(e,e.get(t),n)})}))}function h(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;var i=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&i.push(e)}),i.forEach(function(t){e.forEach(function(n){n.type===r&&n.trackId===t.id&&b(e,n,o)})}),o}
},{}],"RmTL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetUserMedia=i;var e=t(require("../utils.js"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(r=function(e){return e?o:t})(e)}function t(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var o=r(t);if(o&&o.has(e))return o.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var c=i?Object.getOwnPropertyDescriptor(e,a):null;c&&(c.get||c.set)?Object.defineProperty(n,a,c):n[a]=e[a]}return n.default=e,o&&o.set(e,n),n}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=e.log;function i(e,r){var t=e&&e.navigator;if(t.mediaDevices){var i=function(e){if("object"!==o(e)||e.mandatory||e.optional)return e;var r={};return Object.keys(e).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var n="object"===o(e[t])?e[t]:{ideal:e[t]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,r){return e?e+r.charAt(0).toUpperCase()+r.slice(1):"deviceId"===r?"sourceId":r};if(void 0!==n.ideal){r.optional=r.optional||[];var a={};"number"==typeof n.ideal?(a[i("min",t)]=n.ideal,r.optional.push(a),(a={})[i("max",t)]=n.ideal,r.optional.push(a)):(a[i("",t)]=n.ideal,r.optional.push(a))}void 0!==n.exact&&"number"!=typeof n.exact?(r.mandatory=r.mandatory||{},r.mandatory[i("",t)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(r.mandatory=r.mandatory||{},r.mandatory[i(e,t)]=n[e])})}}),e.advanced&&(r.optional=(r.optional||[]).concat(e.advanced)),r},a=function(e,a){if(r.version>=61)return a(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===o(e.audio)){var c=function(e,r,t){r in e&&!(t in e)&&(e[t]=e[r],delete e[r])};c((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),c(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"===o(e.video)){var d=e.video.facingMode;d=d&&("object"===o(d)?d:{ideal:d});var u,s=r.version<66;if(d&&("user"===d.exact||"environment"===d.exact||"user"===d.ideal||"environment"===d.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||s))if(delete e.video.facingMode,"environment"===d.exact||"environment"===d.ideal?u=["back","rear"]:"user"!==d.exact&&"user"!==d.ideal||(u=["front"]),u)return t.mediaDevices.enumerateDevices().then(function(r){var t=(r=r.filter(function(e){return"videoinput"===e.kind})).find(function(e){return u.some(function(r){return e.label.toLowerCase().includes(r)})});return!t&&r.length&&u.includes("back")&&(t=r[r.length-1]),t&&(e.video.deviceId=d.exact?{exact:t.deviceId}:{ideal:t.deviceId}),e.video=i(e.video),n("chrome: "+JSON.stringify(e)),a(e)});e.video=i(e.video)}return n("chrome: "+JSON.stringify(e)),a(e)},c=function(e){return r.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,r,o){a(e,function(e){t.webkitGetUserMedia(e,r,function(e){o&&o(c(e))})})}.bind(t),t.mediaDevices.getUserMedia){var d=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return a(e,function(e){return d(e).then(function(r){if(e.audio&&!r.getAudioTracks().length||e.video&&!r.getVideoTracks().length)throw r.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return r},function(e){return Promise.reject(c(e))})})}}}}
},{"../utils.js":"RsyN"}],"yjjI":[function(require,module,exports) {
"use strict";function e(e,i){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof i?e.navigator.mediaDevices.getDisplayMedia=function(a){return i(a).then(function(i){var t=a.video&&a.video.width,o=a.video&&a.video.height,d=a.video&&a.video.frameRate;return a.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:d||3}},t&&(a.video.mandatory.maxWidth=t),o&&(a.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(a)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=e;
},{}],"RNlo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fixNegotiationNeeded=C,exports.shimAddTrackRemoveTrack=l,exports.shimAddTrackRemoveTrackWithNative=m,Object.defineProperty(exports,"shimGetDisplayMedia",{enumerable:!0,get:function(){return r.shimGetDisplayMedia}}),exports.shimGetSendersWithDtmf=h,exports.shimGetStats=f,Object.defineProperty(exports,"shimGetUserMedia",{enumerable:!0,get:function(){return t.shimGetUserMedia}}),exports.shimMediaStream=p,exports.shimOnTrack=d,exports.shimPeerConnection=v,exports.shimSenderReceiverGetStats=u;var e=i(require("../utils.js")),t=require("./getusermedia"),r=require("./getdisplaymedia");function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=o?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(i,s,a):i[s]=e[s]}return i.default=e,r&&r.set(e,i),i}function o(e,t,r){return(t=s(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e){var t=a(e,"string");return"symbol"===c(t)?t:String(t)}function a(e,t){if("object"!==c(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function d(t){if("object"!==c(t)||!t.RTCPeerConnection||"ontrack"in t.RTCPeerConnection.prototype)e.wrapPeerConnectionEvent(t,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._ontrackpoly||(this._ontrackpoly=function(r){r.stream.addEventListener("addtrack",function(n){var i;i=t.RTCPeerConnection.prototype.getReceivers?e.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],e.dispatchEvent(o)}),r.stream.getTracks().forEach(function(n){var i;i=t.RTCPeerConnection.prototype.getReceivers?e.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],e.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}}function h(e){if("object"===c(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"===c(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function f(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,[r,n,i]=arguments;if(arguments.length>0&&"function"==typeof r)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof r))return t.apply(this,[]);var o=function(e){var t={};return e.result().forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return t.apply(this,[function(e){n(s(o(e)))},r])}return new Promise(function(r,n){t.apply(e,[function(e){r(s(o(e)))},n])}).then(n,i)}}}function u(t){if("object"===c(t)&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver){if(!("getStats"in t.RTCRtpSender.prototype)){var r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=r.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t});var n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),t.RTCRtpSender.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(r){return e.filterStats(r,t.track,!0)})}}if(!("getStats"in t.RTCRtpReceiver.prototype)){var i=t.RTCPeerConnection.prototype.getReceivers;i&&(t.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t}),e.wrapPeerConnectionEvent(t,"track",function(e){return e.receiver._pc=e.srcElement,e}),t.RTCRtpReceiver.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(r){return e.filterStats(r,t.track,!1)})}}if("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype){var o=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){var e,r,n,i=arguments[0];return this.getSenders().forEach(function(t){t.track===i&&(e?n=!0:e=t)}),this.getReceivers().forEach(function(e){return e.track===i&&(r?n=!0:r=e),e.track===i}),n||e&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):e?e.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}}}}function m(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var n=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter(function(e){return-1===n.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),i.apply(this,arguments)}}function l(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return m(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(function(e){if(r.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var o=this._streams[r.id];if(o)o.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var s=new e.MediaStream([t]);this._streams[r.id]=s,this._reverseStreams[s.id]=r,this.addStream(s)}return this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=o({},t,function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[function(r){var n=c(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then(function(t){return c(e,t)})});e.RTCPeerConnection.prototype[t]=n[t]});var s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(e=this,t=arguments[0],r=t.sdp,Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})),s.apply(this,arguments)):s.apply(this,arguments);var e,t,r};var a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:c(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(function(n){r._streams[n].getTracks().find(function(t){return e.track===t})&&(t=r._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function c(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}}function v(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=o({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=n[t]})}function C(t,r){e.wrapPeerConnectionEvent(t,"negotiationneeded",function(e){var t=e.target;if(!(r.version<72||t.getConfiguration&&"plan-b"===t.getConfiguration().sdpSemantics)||"stable"===t.signalingState)return e})}
},{"../utils.js":"RsyN","./getusermedia":"RmTL","./getdisplaymedia":"yjjI"}],"OQLX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetUserMedia=n;var e=o(require("../utils"));function t(e){if("function"!=typeof WeakMap)return null;var o=new WeakMap,r=new WeakMap;return(t=function(e){return e?r:o})(e)}function o(e,o){if(!o&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=t(o);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(t,o){var n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(t,o,r){e.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(t).then(o,r)},!(o.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var a=function(e,t,o){t in e&&!(o in e)&&(e[o]=e[t],delete e[t])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"===r(e)&&"object"===r(e.audio)&&(e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","mozAutoGainControl"),a(e.audio,"noiseSuppression","mozNoiseSuppression")),s(e)},i&&i.prototype.getSettings){var p=i.prototype.getSettings;i.prototype.getSettings=function(){var e=p.apply(this,arguments);return a(e,"mozAutoGainControl","autoGainControl"),a(e,"mozNoiseSuppression","noiseSuppression"),e}}if(i&&i.prototype.applyConstraints){var u=i.prototype.applyConstraints;i.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===r(e)&&(e=JSON.parse(JSON.stringify(e)),a(e,"autoGainControl","mozAutoGainControl"),a(e,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[e])}}}}
},{"../utils":"RsyN"}],"Hsc4":[function(require,module,exports) {
"use strict";function e(e,i){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(a){if(!a||!a.video){var t=new DOMException("getDisplayMedia without video constraints is undefined");return t.name="NotFoundError",t.code=8,Promise.reject(t)}return!0===a.video?a.video={mediaSource:i}:a.video.mediaSource=i,e.navigator.mediaDevices.getUserMedia(a)})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=e;
},{}],"vPl0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimAddTransceiver=T,exports.shimCreateAnswer=S,exports.shimCreateOffer=b,Object.defineProperty(exports,"shimGetDisplayMedia",{enumerable:!0,get:function(){return r.shimGetDisplayMedia}}),exports.shimGetParameters=g,Object.defineProperty(exports,"shimGetUserMedia",{enumerable:!0,get:function(){return t.shimGetUserMedia}}),exports.shimOnTrack=m,exports.shimPeerConnection=C,exports.shimRTCDataChannel=P,exports.shimReceiverGetStats=v,exports.shimRemoveStream=R,exports.shimSenderGetStats=h;var e=o(require("../utils")),t=require("./getusermedia"),r=require("./getdisplaymedia");function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var c=i?Object.getOwnPropertyDescriptor(e,a):null;c&&(c.get||c.set)?Object.defineProperty(o,a,c):o[a]=e[a]}return o.default=e,r&&r.set(e,o),o}function i(e){return p(e)||s(e)||c(e)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}function s(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function p(e){if(Array.isArray(e))return u(e)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function f(e,t,r){return(t=l(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e){var t=d(e,"string");return"symbol"===y(t)?t:String(t)}function d(e,t){if("object"!==y(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e){"object"===y(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function C(e,t){if("object"===y(e)&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=f({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=n[t]});var r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var[e,o,i]=arguments;return n.apply(this,[e||null]).then(function(e){if(t.version<53&&!o)try{e.forEach(function(e){e.type=r[e.type]||e.type})}catch(n){if("TypeError"!==n.name)throw n;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:r[t.type]||t.type}))})}return e}).then(o,i)}}}function h(e){if("object"===y(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function v(t){if("object"===y(t)&&t.RTCPeerConnection&&t.RTCRtpSender&&!(t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)){var r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=r.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t}),e.wrapPeerConnectionEvent(t,"track",function(e){return e.receiver._pc=e.srcElement,e}),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function R(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(t){var r=this;e.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(e){e.track&&t.getTracks().includes(e.track)&&r.removeTrack(e)})})}function P(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function T(e){if("object"===y(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);var r=(e=i(e)).length>0;r&&e.forEach(function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var n=t.apply(this,arguments);if(r){var{sender:o}=n,a=o.getParameters();"encodings"in a&&(1!==a.encodings.length||0!==Object.keys(a.encodings[0]).length)||(a.encodings=e,o.sendEncodings=e,this.setParametersPromises.push(o.setParameters(a).then(function(){delete o.sendEncodings}).catch(function(){delete o.sendEncodings})))}return n})}}function g(e){if("object"===y(e)&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}}function b(e){if("object"===y(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(r,e)}).finally(function(){r.setParametersPromises=[]}):t.apply(this,arguments)}}}function S(e){if("object"===y(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(r,e)}).finally(function(){r.setParametersPromises=[]}):t.apply(this,arguments)}}}
},{"../utils":"RsyN","./getusermedia":"OQLX","./getdisplaymedia":"Hsc4"}],"aXmZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimAudioContext=p,exports.shimCallbacksAPI=a,exports.shimConstraints=s,exports.shimCreateOfferLegacy=u,exports.shimGetUserMedia=c,exports.shimLocalStreamsAPI=n,exports.shimRTCIceServerUrls=d,exports.shimRemoteStreamsAPI=i,exports.shimTrackEventTransceiver=f;var e=r(require("../utils"));function t(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,o=new WeakMap;return(t=function(e){return e?o:r})(e)}function r(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var o=t(r);if(o&&o.has(e))return o.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var c=i?Object.getOwnPropertyDescriptor(e,a):null;c&&(c.get||c.set)?Object.defineProperty(n,a,c):n[a]=e[a]}return n.default=e,o&&o.set(e,n),n}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){if("object"===o(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(function(o){return t.call(r,o,e)}),e.getVideoTracks().forEach(function(o){return t.call(r,o,e)})},e.RTCPeerConnection.prototype.addTrack=function(e){for(var r=this,o=arguments.length,n=new Array(o>1?o-1:0),i=1;i<o;i++)n[i-1]=arguments[i];return n&&n.forEach(function(e){r._localStreams?r._localStreams.includes(e)||r._localStreams.push(e):r._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var o=e.getTracks();this.getSenders().forEach(function(e){o.includes(e.track)&&t.removeTrack(e)})}})}}function i(e){if("object"===o(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}})}),t.apply(e,arguments)}}}function a(e){if("object"===o(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(e,t){var o=arguments.length>=2?arguments[2]:arguments[0],n=r.apply(this,[o]);return t?(n.then(e,t),Promise.resolve()):n},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o};var s=function(e,t,r){var o=i.apply(this,[e]);return r?(o.then(t,r),Promise.resolve()):o};t.setLocalDescription=s,s=function(e,t,r){var o=a.apply(this,[e]);return r?(o.then(t,r),Promise.resolve()):o},t.setRemoteDescription=s,s=function(e,t,r){var o=c.apply(this,[e]);return r?(o.then(t,r),Promise.resolve()):o},t.addIceCandidate=s}}function c(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,o=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return o(s(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,o){t.mediaDevices.getUserMedia(e).then(r,o)}.bind(t))}function s(t){return t&&void 0!==t.video?Object.assign({},t,{video:e.compactObject(t.video)}):t}function d(t){if(t.RTCPeerConnection){var r=t.RTCPeerConnection;t.RTCPeerConnection=function(t,o){if(t&&t.iceServers){for(var n=[],i=0;i<t.iceServers.length;i++){var a=t.iceServers[i];void 0===a.urls&&a.url?(e.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,n.push(a)):n.push(t.iceServers[i])}t.iceServers=n}return new r(t,o)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:function(){return r.generateCertificate}})}}function f(e){"object"===o(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function u(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var o=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind});!1===e.offerToReceiveVideo&&o?"sendrecv"===o.direction?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":"recvonly"===o.direction&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):!0!==e.offerToReceiveVideo||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function p(e){"object"!==o(e)||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}
},{"../utils":"RsyN"}],"jIWI":[function(require,module,exports) {
"use strict";const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},e.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},e.getDescription=function(t){const r=e.splitSections(t);return r&&r[0]},e.getMediaSections=function(t){const r=e.splitSections(t);return r.shift(),r},e.matchPrefix=function(t,r){return e.splitLines(t).filter(e=>0===e.indexOf(r))},e.parseCandidate=function(e){let t;const r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:void 0===r[t[n]]&&(r[t[n]]=t[n+1])}return r},e.writeCandidate=function(e){const t=[];t.push(e.foundation);const r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},e.parseIceOptions=function(e){return e.substring(14).split(" ")},e.parseRtpMap=function(e){let t=e.substring(9).split(" ");const r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},e.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},e.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},e.parseFmtp=function(e){const t={};let r;const n=e.substring(e.indexOf(" ")+1).split(";");for(let s=0;s<n.length;s++)t[(r=n[s].trim().split("="))[0].trim()]=r[1];return t},e.writeFmtp=function(e){let t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const n=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},e.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},e.writeRtcpFb=function(e){let t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},e.parseSsrcMedia=function(e){const t=e.indexOf(" "),r={ssrc:parseInt(e.substring(7,t),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substring(t+1,n),r.value=e.substring(n+1)):r.attribute=e.substring(t+1),r},e.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},e.getMid=function(t){const r=e.matchPrefix(t,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},e.getDtlsParameters=function(t,r){return{role:"auto",fingerprints:e.matchPrefix(t+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(e,t){let r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},e.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+("object"==typeof t.keyParams?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+"\r\n"},e.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},e.getCryptoParameters=function(t,r){return e.matchPrefix(t+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,r){const n=e.matchPrefix(t+r,"a=ice-ufrag:")[0],s=e.matchPrefix(t+r,"a=ice-pwd:")[0];return n&&s?{usernameFragment:n.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},e.parseRtpParameters=function(t){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=e.splitLines(t)[0].split(" ");r.profile=n[2];for(let a=3;a<n.length;a++){const s=n[a],i=e.matchPrefix(t,"a=rtpmap:"+s+" ")[0];if(i){const n=e.parseRtpMap(i),a=e.matchPrefix(t,"a=fmtp:"+s+" ");switch(n.parameters=a.length?e.parseFmtp(a[0]):{},n.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+s+" ").map(e.parseRtcpFb),r.codecs.push(n),n.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(n.name.toUpperCase())}}}e.matchPrefix(t,"a=extmap:").forEach(t=>{r.headerExtensions.push(e.parseExtmap(t))});const s=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(e=>{s.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),r},e.writeRtpDescription=function(t,r){let n="";n+="m="+t+" ",n+=r.codecs.length>0?"9":"0",n+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=r.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach(t=>{n+=e.writeRtpMap(t),n+=e.writeFmtp(t),n+=e.writeRtcpFb(t)});let s=0;return r.codecs.forEach(e=>{e.maxptime>s&&(s=e.maxptime)}),s>0&&(n+="a=maxptime:"+s+"\r\n"),r.headerExtensions&&r.headerExtensions.forEach(t=>{n+=e.writeExtmap(t)}),n},e.parseRtpEncodingParameters=function(t){const r=[],n=e.parseRtpParameters(t),s=-1!==n.fecMechanisms.indexOf("RED"),a=-1!==n.fecMechanisms.indexOf("ULPFEC"),i=e.matchPrefix(t,"a=ssrc:").map(t=>e.parseSsrcMedia(t)).filter(e=>"cname"===e.attribute),p=i.length>0&&i[0].ssrc;let c;const o=e.matchPrefix(t,"a=ssrc-group:FID").map(e=>{return e.substring(17).split(" ").map(e=>parseInt(e,10))});o.length>0&&o[0].length>1&&o[0][0]===p&&(c=o[0][1]),n.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:p,codecPayloadType:parseInt(e.parameters.apt,10)};p&&c&&(t.rtx={ssrc:c}),r.push(t),s&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:p,mechanism:a?"red+ulpfec":"red"},r.push(t))}}),0===r.length&&p&&r.push({ssrc:p});let u=e.matchPrefix(t,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,r.forEach(e=>{e.maxBitrate=u})),r},e.parseRtcpParameters=function(t){const r={},n=e.matchPrefix(t,"a=ssrc:").map(t=>e.parseSsrcMedia(t)).filter(e=>"cname"===e.attribute)[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);const s=e.matchPrefix(t,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=0===s.length;const a=e.matchPrefix(t,"a=rtcp-mux");return r.mux=a.length>0,r},e.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},e.parseMsid=function(t){let r;const n=e.matchPrefix(t,"a=msid:");if(1===n.length)return{stream:(r=n[0].substring(7).split(" "))[0],track:r[1]};const s=e.matchPrefix(t,"a=ssrc:").map(t=>e.parseSsrcMedia(t)).filter(e=>"msid"===e.attribute);return s.length>0?{stream:(r=s[0].value.split(" "))[0],track:r[1]}:void 0},e.parseSctpDescription=function(t){const r=e.parseMLine(t),n=e.matchPrefix(t,"a=max-message-size:");let s;n.length>0&&(s=parseInt(n[0].substring(19),10)),isNaN(s)&&(s=65536);const a=e.matchPrefix(t,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const i=e.matchPrefix(t,"a=sctpmap:");if(i.length>0){const e=i[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:s}}},e.writeSctpDescription=function(e,t){let r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,r,n){let s;const a=void 0!==r?r:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(s=t||e.generateSessionId())+" "+a+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},e.getDirection=function(t,r){const n=e.splitLines(t);for(let e=0;e<n.length;e++)switch(n[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[e].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(e){return"0"===e.split(" ",2)[1]},e.parseMLine=function(t){const r=e.splitLines(t)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(t){const r=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(t){if("string"!=typeof t||0===t.length)return!1;const r=e.splitLines(t);for(let e=0;e<r.length;e++)if(r[e].length<2||"="!==r[e].charAt(1))return!1;return!0},"object"==typeof module&&(module.exports=e);
},{}],"WlzA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.removeExtmapAllowMixed=f,exports.shimAddIceCandidateNullOrEmpty=u,exports.shimConnectionState=d,exports.shimMaxMessageSize=s,exports.shimParameterlessSetLocalDescription=l,exports.shimRTCIceCandidate=a,exports.shimRTCIceCandidateRelayProtocol=c,exports.shimSendThrowTypeError=p;var e=r(require("sdp")),t=o(require("./utils"));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(n=function(e){return e?o:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var o=n(t);if(o&&o.has(e))return o.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var c=i?Object.getOwnPropertyDescriptor(e,a):null;c&&(c.get||c.set)?Object.defineProperty(r,a,c):r[a]=e[a]}return r.default=e,o&&o.set(e,r),r}function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(n){if(n.RTCIceCandidate&&!(n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)){var o=n.RTCIceCandidate;n.RTCIceCandidate=function(t){if("object"===i(t)&&t.candidate&&0===t.candidate.indexOf("a=")&&((t=JSON.parse(JSON.stringify(t))).candidate=t.candidate.substring(2)),t.candidate&&t.candidate.length){var n=new o(t),r=e.default.parseCandidate(t.candidate),a=Object.assign(n,r);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new o(t)},n.RTCIceCandidate.prototype=o.prototype,t.wrapPeerConnectionEvent(n,"icecandidate",function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new n.RTCIceCandidate(e.candidate),writable:"false"}),e})}}function c(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||t.wrapPeerConnectionEvent(n,"icecandidate",function(t){if(t.candidate){var n=e.default.parseCandidate(t.candidate.candidate);"relay"===n.type&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function s(t,n){if(t.RTCPeerConnection){"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===n.browser&&n.version>=76){var{sdpSemantics:t}=this.getConfiguration();"plan-b"===t&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(t){if(!t||!t.sdp)return!1;var n=e.default.splitSections(t.sdp);return n.shift(),n.some(function(t){var n=e.default.parseMLine(t);return n&&"application"===n.kind&&-1!==n.protocol.indexOf("SCTP")})}(arguments[0])){var r,i=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),a=(p=i,d=65536,"firefox"===n.browser&&(d=n.version<57?-1===p?16384:2147483637:n.version<60?57===n.version?65535:65536:2147483637),d),c=function(t,o){var r=65536;"firefox"===n.browser&&57===n.version&&(r=65535);var i=e.default.matchPrefix(t.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substring(19),10):"firefox"===n.browser&&-1!==o&&(r=2147483637),r}(arguments[0],i);r=0===a&&0===c?Number.POSITIVE_INFINITY:0===a||0===c?Math.max(a,c):Math.min(a,c);var s={};Object.defineProperty(s,"maxMessageSize",{get:function(){return r}}),this._sctp=s}var p,d;return o.apply(this,arguments)}}}function p(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=n.apply(this,arguments);return o(e,this),e},t.wrapPeerConnectionEvent(e,"datachannel",function(e){return o(e.channel,e.target),e})}function o(e,t){var n=e.send;e.send=function(){var o=arguments[0],r=o.length||o.size||o.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}}function d(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}}function f(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var o=t.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:o}):t.sdp=o}return n.apply(this,arguments)}}}function u(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}function l(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this,t=arguments[0]||{};if("object"!==i(t)||t.type&&t.sdp)return n.apply(this,arguments);if(!(t={type:t.type,sdp:t.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}return t.sdp||"offer"!==t.type&&"answer"!==t.type?n.apply(this,[t]):("offer"===t.type?this.createOffer:this.createAnswer).apply(this).then(function(t){return n.apply(e,[t])})})}}
},{"sdp":"jIWI","./utils":"RsyN"}],"elb5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.adapterFactory=m;var e=o(require("./utils")),r=o(require("./chrome/chrome_shim")),i=o(require("./firefox/firefox_shim")),s=o(require("./safari/safari_shim")),t=o(require("./common_shim")),a=o(require("sdp"));function n(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,i=new WeakMap;return(n=function(e){return e?i:r})(e)}function o(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var i=n(r);if(i&&i.has(e))return i.get(e);var s={},t=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=t?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(s,a,o):s[a]=e[a]}return s.default=e,i&&i.set(e,s),s}function m(){var{window:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},m=e.log,h=e.detectBrowser(n),d={browserDetails:h,commonShim:t,extractVersion:e.extractVersion,disableLog:e.disableLog,disableWarnings:e.disableWarnings,sdp:a};switch(h.browser){case"chrome":if(!r||!r.shimPeerConnection||!o.shimChrome)return m("Chrome shim is not included in this adapter release."),d;if(null===h.version)return m("Chrome shim can not determine version, not shimming."),d;m("adapter.js shimming chrome."),d.browserShim=r,t.shimAddIceCandidateNullOrEmpty(n,h),t.shimParameterlessSetLocalDescription(n,h),r.shimGetUserMedia(n,h),r.shimMediaStream(n,h),r.shimPeerConnection(n,h),r.shimOnTrack(n,h),r.shimAddTrackRemoveTrack(n,h),r.shimGetSendersWithDtmf(n,h),r.shimGetStats(n,h),r.shimSenderReceiverGetStats(n,h),r.fixNegotiationNeeded(n,h),t.shimRTCIceCandidate(n,h),t.shimRTCIceCandidateRelayProtocol(n,h),t.shimConnectionState(n,h),t.shimMaxMessageSize(n,h),t.shimSendThrowTypeError(n,h),t.removeExtmapAllowMixed(n,h);break;case"firefox":if(!i||!i.shimPeerConnection||!o.shimFirefox)return m("Firefox shim is not included in this adapter release."),d;m("adapter.js shimming firefox."),d.browserShim=i,t.shimAddIceCandidateNullOrEmpty(n,h),t.shimParameterlessSetLocalDescription(n,h),i.shimGetUserMedia(n,h),i.shimPeerConnection(n,h),i.shimOnTrack(n,h),i.shimRemoveStream(n,h),i.shimSenderGetStats(n,h),i.shimReceiverGetStats(n,h),i.shimRTCDataChannel(n,h),i.shimAddTransceiver(n,h),i.shimGetParameters(n,h),i.shimCreateOffer(n,h),i.shimCreateAnswer(n,h),t.shimRTCIceCandidate(n,h),t.shimConnectionState(n,h),t.shimMaxMessageSize(n,h),t.shimSendThrowTypeError(n,h);break;case"safari":if(!s||!o.shimSafari)return m("Safari shim is not included in this adapter release."),d;m("adapter.js shimming safari."),d.browserShim=s,t.shimAddIceCandidateNullOrEmpty(n,h),t.shimParameterlessSetLocalDescription(n,h),s.shimRTCIceServerUrls(n,h),s.shimCreateOfferLegacy(n,h),s.shimCallbacksAPI(n,h),s.shimLocalStreamsAPI(n,h),s.shimRemoteStreamsAPI(n,h),s.shimTrackEventTransceiver(n,h),s.shimGetUserMedia(n,h),s.shimAudioContext(n,h),t.shimRTCIceCandidate(n,h),t.shimRTCIceCandidateRelayProtocol(n,h),t.shimMaxMessageSize(n,h),t.shimSendThrowTypeError(n,h),t.removeExtmapAllowMixed(n,h);break;default:m("Unsupported browser!")}return d}
},{"./utils":"RsyN","./chrome/chrome_shim":"RNlo","./firefox/firefox_shim":"vPl0","./safari/safari_shim":"aXmZ","./common_shim":"WlzA","sdp":"jIWI"}],"WzOL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("./adapter_factory.js"),t=(0,e.adapterFactory)({window:"undefined"==typeof window?void 0:window}),d=t;exports.default=d;
},{"./adapter_factory.js":"elb5"}],"Godu":[function(require,module,exports) {
var define;
var i;!function(e,o){"use strict";var r="model",a="name",t="type",n="vendor",s="version",b="mobile",w="tablet",d="smarttv",l=function(i){for(var e={},o=0;o<i.length;o++)e[i[o].toUpperCase()]=i[o];return e},c=function(i,e){return"string"==typeof i&&-1!==u(e).indexOf(u(i))},u=function(i){return i.toLowerCase()},m=function(i,e){if("string"==typeof i)return i=i.replace(/^\s\s*/,""),void 0===e?i:i.substring(0,350)},p=function(i,e){for(var o,r,a,t,n,s,b=0;b<e.length&&!n;){var w=e[b],d=e[b+1];for(o=r=0;o<w.length&&!n;)if(n=w[o++].exec(i))for(a=0;a<d.length;a++)s=n[++r],"object"==typeof(t=d[a])&&t.length>0?2===t.length?"function"==typeof t[1]?this[t[0]]=t[1].call(this,s):this[t[0]]=t[1]:3===t.length?"function"!=typeof t[1]||t[1].exec&&t[1].test?this[t[0]]=s?s.replace(t[1],t[2]):void 0:this[t[0]]=s?t[1].call(this,s,t[2]):void 0:4===t.length&&(this[t[0]]=s?t[3].call(this,s.replace(t[1],t[2])):void 0):this[t]=s||void 0;b+=2}},h=function(i,e){for(var o in e)if("object"==typeof e[o]&&e[o].length>0){for(var r=0;r<e[o].length;r++)if(c(e[o][r],i))return"?"===o?void 0:o}else if(c(e[o],i))return"?"===o?void 0:o;return i},v={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},f={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[s,[a,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[s,[a,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[a,s],[/opios[\/ ]+([\w\.]+)/i],[s,[a,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[s,[a,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[a,s],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[s,[a,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[s,[a,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[s,[a,"WeChat"]],[/konqueror\/([\w\.]+)/i],[s,[a,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[s,[a,"IE"]],[/yabrowser\/([\w\.]+)/i],[s,[a,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[a,/(.+)/,"$1 Secure Browser"],s],[/\bfocus\/([\w\.]+)/i],[s,[a,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[s,[a,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[s,[a,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[s,[a,"Dolphin"]],[/coast\/([\w\.]+)/i],[s,[a,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[s,[a,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[s,[a,"Firefox"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[a,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[a,/(.+)/,"$1 Browser"],s],[/(comodo_dragon)\/([\w\.]+)/i],[[a,/_/g," "],s],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[a,s],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[a],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[a,"Facebook"],s],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[a,s],[/\bgsa\/([\w\.]+) .*safari\//i],[s,[a,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[s,[a,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[a,"Chrome WebView"],s],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[s,[a,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[a,s],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[s,[a,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[s,a],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[a,[s,h,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[a,s],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[a,"Netscape"],s],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[s,[a,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[a,s],[/(cobalt)\/([\w\.]+)/i],[a,[s,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",u]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[["architecture","arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[["architecture","armhf"]],[/windows (ce|mobile); ppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[["architecture",/ower/,"",u]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[["architecture",u]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[r,[n,"Samsung"],[t,w]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[r,[n,"Samsung"],[t,b]],[/\((ip(?:hone|od)[\w ]*);/i],[r,[n,"Apple"],[t,b]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[r,[n,"Apple"],[t,w]],[/(macintosh);/i],[r,[n,"Apple"]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[r,[n,"Huawei"],[t,w]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[r,[n,"Huawei"],[t,b]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[r,/_/g," "],[n,"Xiaomi"],[t,b]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[r,/_/g," "],[n,"Xiaomi"],[t,w]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[r,[n,"OPPO"],[t,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[r,[n,"Vivo"],[t,b]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[r,[n,"Realme"],[t,b]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[r,[n,"Motorola"],[t,b]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[r,[n,"Motorola"],[t,w]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[r,[n,"LG"],[t,w]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[r,[n,"LG"],[t,b]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[r,[n,"Lenovo"],[t,w]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[r,/_/g," "],[n,"Nokia"],[t,b]],[/(pixel c)\b/i],[r,[n,"Google"],[t,w]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[r,[n,"Google"],[t,b]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[r,[n,"Sony"],[t,b]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[r,"Xperia Tablet"],[n,"Sony"],[t,w]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[r,[n,"OnePlus"],[t,b]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[r,[n,"Amazon"],[t,w]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[r,/(.+)/g,"Fire Phone $1"],[n,"Amazon"],[t,b]],[/(playbook);[-\w\),; ]+(rim)/i],[r,n,[t,w]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[r,[n,"BlackBerry"],[t,b]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[r,[n,"ASUS"],[t,w]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[r,[n,"ASUS"],[t,b]],[/(nexus 9)/i],[r,[n,"HTC"],[t,w]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony(?!-bra))[-_ ]?([-\w]*)/i],[n,[r,/_/g," "],[t,b]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[r,[n,"Acer"],[t,w]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[r,[n,"Meizu"],[t,b]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[r,[n,"Sharp"],[t,b]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[n,r,[t,b]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[n,r,[t,w]],[/(surface duo)/i],[r,[n,"Microsoft"],[t,w]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[r,[n,"Fairphone"],[t,b]],[/(u304aa)/i],[r,[n,"AT&T"],[t,b]],[/\bsie-(\w*)/i],[r,[n,"Siemens"],[t,b]],[/\b(rct\w+) b/i],[r,[n,"RCA"],[t,w]],[/\b(venue[\d ]{2,7}) b/i],[r,[n,"Dell"],[t,w]],[/\b(q(?:mv|ta)\w+) b/i],[r,[n,"Verizon"],[t,w]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[r,[n,"Barnes & Noble"],[t,w]],[/\b(tm\d{3}\w+) b/i],[r,[n,"NuVision"],[t,w]],[/\b(k88) b/i],[r,[n,"ZTE"],[t,w]],[/\b(nx\d{3}j) b/i],[r,[n,"ZTE"],[t,b]],[/\b(gen\d{3}) b.+49h/i],[r,[n,"Swiss"],[t,b]],[/\b(zur\d{3}) b/i],[r,[n,"Swiss"],[t,w]],[/\b((zeki)?tb.*\b) b/i],[r,[n,"Zeki"],[t,w]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[n,"Dragon Touch"],r,[t,w]],[/\b(ns-?\w{0,9}) b/i],[r,[n,"Insignia"],[t,w]],[/\b((nxa|next)-?\w{0,9}) b/i],[r,[n,"NextBook"],[t,w]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[n,"Voice"],r,[t,b]],[/\b(lvtel\-)?(v1[12]) b/i],[[n,"LvTel"],r,[t,b]],[/\b(ph-1) /i],[r,[n,"Essential"],[t,b]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[r,[n,"Envizen"],[t,w]],[/\b(trio[-\w\. ]+) b/i],[r,[n,"MachSpeed"],[t,w]],[/\btu_(1491) b/i],[r,[n,"Rotor"],[t,w]],[/(shield[\w ]+) b/i],[r,[n,"Nvidia"],[t,w]],[/(sprint) (\w+)/i],[n,r,[t,b]],[/(kin\.[onetw]{3})/i],[[r,/\./g," "],[n,"Microsoft"],[t,b]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[r,[n,"Zebra"],[t,w]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[r,[n,"Zebra"],[t,b]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[n,r,[t,"console"]],[/droid.+; (shield) bui/i],[r,[n,"Nvidia"],[t,"console"]],[/(playstation [345portablevi]+)/i],[r,[n,"Sony"],[t,"console"]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[r,[n,"Microsoft"],[t,"console"]],[/smart-tv.+(samsung)/i],[n,[t,d]],[/hbbtv.+maple;(\d+)/i],[[r,/^/,"SmartTV"],[n,"Samsung"],[t,d]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[n,"LG"],[t,d]],[/(apple) ?tv/i],[n,[r,"Apple TV"],[t,d]],[/crkey/i],[[r,"Chromecast"],[n,"Google"],[t,d]],[/droid.+aft(\w)( bui|\))/i],[r,[n,"Amazon"],[t,d]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[r,[n,"Sharp"],[t,d]],[/(bravia[\w ]+)( bui|\))/i],[r,[n,"Sony"],[t,d]],[/(mitv-\w{5}) bui/i],[r,[n,"Xiaomi"],[t,d]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[n,m],[r,m],[t,d]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[t,d]],[/((pebble))app/i],[n,r,[t,"wearable"]],[/droid.+; (glass) \d/i],[r,[n,"Google"],[t,"wearable"]],[/droid.+; (wt63?0{2,3})\)/i],[r,[n,"Zebra"],[t,"wearable"]],[/(quest( 2)?)/i],[r,[n,"Facebook"],[t,"wearable"]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[n,[t,"embedded"]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[r,[t,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[r,[t,w]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[t,w]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[t,b]],[/(android[-\w\. ]{0,9});.+buil/i],[r,[n,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[s,[a,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[s,[a,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[a,s],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[s,a]],os:[[/microsoft (windows) (vista|xp)/i],[a,s],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[a,[s,h,v]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[a,"Windows"],[s,h,v]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[s,/_/g,"."],[a,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[a,"Mac OS"],[s,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[s,a],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[a,s],[/\(bb(10);/i],[s,[a,"BlackBerry"]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[s,[a,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[s,[a,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[s,[a,"webOS"]],[/crkey\/([\d\.]+)/i],[s,[a,"Chromecast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[a,"Chromium OS"],s],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[a,s],[/(sunos) ?([\w\.\d]*)/i],[[a,"Solaris"],s],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[a,s]]},g=function(i,o){if("object"==typeof i&&(o=i,i=void 0),!(this instanceof g))return new g(i,o).getResult();var r=i||(void 0!==e&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:""),a=o?function(i,e){var o={};for(var r in i)e[r]&&e[r].length%2==0?o[r]=e[r].concat(i[r]):o[r]=i[r];return o}(f,o):f;return this.getBrowser=function(){var i,e={};return e.name=void 0,e.version=void 0,p.call(e,r,a.browser),e.major="string"==typeof(i=e.version)?i.replace(/[^\d\.]/g,"").split(".")[0]:void 0,e},this.getCPU=function(){var i={architecture:void 0};return p.call(i,r,a.cpu),i},this.getDevice=function(){var i={vendor:void 0,model:void 0,type:void 0};return p.call(i,r,a.device),i},this.getEngine=function(){var i={name:void 0,version:void 0};return p.call(i,r,a.engine),i},this.getOS=function(){var i={name:void 0,version:void 0};return p.call(i,r,a.os),i},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(i){return r="string"==typeof i&&i.length>350?m(i,350):i,this},this.setUA(r),this};g.VERSION="1.0.33",g.BROWSER=l([a,s,"major"]),g.CPU=l(["architecture"]),g.DEVICE=l([r,n,t,"console",b,d,w,"wearable","embedded"]),g.ENGINE=g.OS=l([a,s]),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=g),exports.UAParser=g):"function"==typeof i&&i.amd?i(function(){return g}):void 0!==e&&(e.UAParser=g);var x=void 0!==e&&(e.jQuery||e.Zepto);if(x&&!x.ua){var k=new g;x.ua=k.getResult(),x.ua.get=function(){return k.getUA()},x.ua.set=function(i){k.setUA(i);var e=k.getResult();for(var o in e)x.ua[o]=e[o]}}}("object"==typeof window?window:this);
},{}],"gKk3":[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=o;var t=new Uint8Array(16);function o(){if(!e&&!(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(t)}
},{}],"Wq06":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;exports.default=e;
},{}],"p9l8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./regex.js"));function t(e){return e&&e.__esModule?e:{default:e}}function r(t){return"string"==typeof t&&e.default.test(t)}var u=r;exports.default=u;
},{"./regex.js":"Wq06"}],"vDjk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("./validate.js"));function r(e){return e&&e.__esModule?e:{default:e}}for(var t=[],i=0;i<256;++i)t.push((i+256).toString(16).substr(1));function o(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=(t[r[i+0]]+t[r[i+1]]+t[r[i+2]]+t[r[i+3]]+"-"+t[r[i+4]]+t[r[i+5]]+"-"+t[r[i+6]]+t[r[i+7]]+"-"+t[r[i+8]]+t[r[i+9]]+"-"+t[r[i+10]]+t[r[i+11]]+t[r[i+12]]+t[r[i+13]]+t[r[i+14]]+t[r[i+15]]).toLowerCase();if(!(0,e.default)(o))throw TypeError("Stringified UUID is invalid");return o}var u=o;exports.default=u;
},{"./validate.js":"p9l8"}],"qgnI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e,r,s=o(require("./rng.js")),n=o(require("./stringify.js"));function o(e){return e&&e.__esModule?e:{default:e}}var u=0,t=0;function a(o,a,l){var d=a&&l||0,i=a||new Array(16),c=(o=o||{}).node||e,v=void 0!==o.clockseq?o.clockseq:r;if(null==c||null==v){var f=o.random||(o.rng||s.default)();null==c&&(c=e=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==v&&(v=r=16383&(f[6]<<8|f[7]))}var q=void 0!==o.msecs?o.msecs:Date.now(),m=void 0!==o.nsecs?o.nsecs:t+1,p=q-u+(m-t)/1e4;if(p<0&&void 0===o.clockseq&&(v=v+1&16383),(p<0||q>u)&&void 0===o.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=q,t=m,r=v;var w=(1e4*(268435455&(q+=122192928e5))+m)%4294967296;i[d++]=w>>>24&255,i[d++]=w>>>16&255,i[d++]=w>>>8&255,i[d++]=255&w;var _=q/4294967296*1e4&268435455;i[d++]=_>>>8&255,i[d++]=255&_,i[d++]=_>>>24&15|16,i[d++]=_>>>16&255,i[d++]=v>>>8|128,i[d++]=255&v;for(var g=0;g<6;++g)i[d+g]=c[g];return a||(0,n.default)(i)}var l=a;exports.default=l;
},{"./rng.js":"gKk3","./stringify.js":"vDjk"}],"rtKa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("./validate.js"));function r(e){return e&&e.__esModule?e:{default:e}}function t(r){if(!(0,e.default)(r))throw TypeError("Invalid UUID");var t,s=new Uint8Array(16);return s[0]=(t=parseInt(r.slice(0,8),16))>>>24,s[1]=t>>>16&255,s[2]=t>>>8&255,s[3]=255&t,s[4]=(t=parseInt(r.slice(9,13),16))>>>8,s[5]=255&t,s[6]=(t=parseInt(r.slice(14,18),16))>>>8,s[7]=255&t,s[8]=(t=parseInt(r.slice(19,23),16))>>>8,s[9]=255&t,s[10]=(t=parseInt(r.slice(24,36),16))/1099511627776&255,s[11]=t/4294967296&255,s[12]=t>>>24&255,s[13]=t>>>16&255,s[14]=t>>>8&255,s[15]=255&t,s}var s=t;exports.default=s;
},{"./validate.js":"p9l8"}],"Y6ie":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.URL=exports.DNS=void 0,exports.default=s;var e=t(require("./stringify.js")),r=t(require("./parse.js"));function t(e){return e&&e.__esModule?e:{default:e}}function n(e){e=unescape(encodeURIComponent(e));for(var r=[],t=0;t<e.length;++t)r.push(e.charCodeAt(t));return r}var a="6ba7b810-9dad-11d1-80b4-00c04fd430c8";exports.DNS=a;var o="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function s(t,s,u){function i(t,a,o,i){if("string"==typeof t&&(t=n(t)),"string"==typeof a&&(a=(0,r.default)(a)),16!==a.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var d=new Uint8Array(16+t.length);if(d.set(a),d.set(t,a.length),(d=u(d))[6]=15&d[6]|s,d[8]=63&d[8]|128,o){i=i||0;for(var f=0;f<16;++f)o[i+f]=d[f];return o}return(0,e.default)(d)}try{i.name=t}catch(d){}return i.DNS=a,i.URL=o,i}exports.URL=o;
},{"./stringify.js":"vDjk","./parse.js":"rtKa"}],"bGV3":[function(require,module,exports) {
"use strict";function n(n){if("string"==typeof n){var t=unescape(encodeURIComponent(n));n=new Uint8Array(t.length);for(var o=0;o<t.length;++o)n[o]=t.charCodeAt(o)}return r(e(u(n),8*n.length))}function r(n){for(var r=[],t=32*n.length,e=0;e<t;e+=8){var u=n[e>>5]>>>e%32&255,o=parseInt("0123456789abcdef".charAt(u>>>4&15)+"0123456789abcdef".charAt(15&u),16);r.push(o)}return r}function t(n){return 14+(n+64>>>9<<4)+1}function e(n,r){n[r>>5]|=128<<r%32,n[t(r)-1]=r;for(var e=1732584193,u=-271733879,f=-1732584194,a=271733878,v=0;v<n.length;v+=16){var s=e,d=u,p=f,g=a;e=c(e,u,f,a,n[v],7,-680876936),a=c(a,e,u,f,n[v+1],12,-389564586),f=c(f,a,e,u,n[v+2],17,606105819),u=c(u,f,a,e,n[v+3],22,-1044525330),e=c(e,u,f,a,n[v+4],7,-176418897),a=c(a,e,u,f,n[v+5],12,1200080426),f=c(f,a,e,u,n[v+6],17,-1473231341),u=c(u,f,a,e,n[v+7],22,-45705983),e=c(e,u,f,a,n[v+8],7,1770035416),a=c(a,e,u,f,n[v+9],12,-1958414417),f=c(f,a,e,u,n[v+10],17,-42063),u=c(u,f,a,e,n[v+11],22,-1990404162),e=c(e,u,f,a,n[v+12],7,1804603682),a=c(a,e,u,f,n[v+13],12,-40341101),f=c(f,a,e,u,n[v+14],17,-1502002290),e=i(e,u=c(u,f,a,e,n[v+15],22,1236535329),f,a,n[v+1],5,-165796510),a=i(a,e,u,f,n[v+6],9,-1069501632),f=i(f,a,e,u,n[v+11],14,643717713),u=i(u,f,a,e,n[v],20,-373897302),e=i(e,u,f,a,n[v+5],5,-701558691),a=i(a,e,u,f,n[v+10],9,38016083),f=i(f,a,e,u,n[v+15],14,-660478335),u=i(u,f,a,e,n[v+4],20,-405537848),e=i(e,u,f,a,n[v+9],5,568446438),a=i(a,e,u,f,n[v+14],9,-1019803690),f=i(f,a,e,u,n[v+3],14,-187363961),u=i(u,f,a,e,n[v+8],20,1163531501),e=i(e,u,f,a,n[v+13],5,-1444681467),a=i(a,e,u,f,n[v+2],9,-51403784),f=i(f,a,e,u,n[v+7],14,1735328473),e=h(e,u=i(u,f,a,e,n[v+12],20,-1926607734),f,a,n[v+5],4,-378558),a=h(a,e,u,f,n[v+8],11,-2022574463),f=h(f,a,e,u,n[v+11],16,1839030562),u=h(u,f,a,e,n[v+14],23,-35309556),e=h(e,u,f,a,n[v+1],4,-1530992060),a=h(a,e,u,f,n[v+4],11,1272893353),f=h(f,a,e,u,n[v+7],16,-155497632),u=h(u,f,a,e,n[v+10],23,-1094730640),e=h(e,u,f,a,n[v+13],4,681279174),a=h(a,e,u,f,n[v],11,-358537222),f=h(f,a,e,u,n[v+3],16,-722521979),u=h(u,f,a,e,n[v+6],23,76029189),e=h(e,u,f,a,n[v+9],4,-640364487),a=h(a,e,u,f,n[v+12],11,-421815835),f=h(f,a,e,u,n[v+15],16,530742520),e=l(e,u=h(u,f,a,e,n[v+2],23,-995338651),f,a,n[v],6,-198630844),a=l(a,e,u,f,n[v+7],10,1126891415),f=l(f,a,e,u,n[v+14],15,-1416354905),u=l(u,f,a,e,n[v+5],21,-57434055),e=l(e,u,f,a,n[v+12],6,1700485571),a=l(a,e,u,f,n[v+3],10,-1894986606),f=l(f,a,e,u,n[v+10],15,-1051523),u=l(u,f,a,e,n[v+1],21,-2054922799),e=l(e,u,f,a,n[v+8],6,1873313359),a=l(a,e,u,f,n[v+15],10,-30611744),f=l(f,a,e,u,n[v+6],15,-1560198380),u=l(u,f,a,e,n[v+13],21,1309151649),e=l(e,u,f,a,n[v+4],6,-145523070),a=l(a,e,u,f,n[v+11],10,-1120210379),f=l(f,a,e,u,n[v+2],15,718787259),u=l(u,f,a,e,n[v+9],21,-343485551),e=o(e,s),u=o(u,d),f=o(f,p),a=o(a,g)}return[e,u,f,a]}function u(n){if(0===n.length)return[];for(var r=8*n.length,e=new Uint32Array(t(r)),u=0;u<r;u+=8)e[u>>5]|=(255&n[u/8])<<u%32;return e}function o(n,r){var t=(65535&n)+(65535&r);return(n>>16)+(r>>16)+(t>>16)<<16|65535&t}function f(n,r){return n<<r|n>>>32-r}function a(n,r,t,e,u,a){return o(f(o(o(r,n),o(e,a)),u),t)}function c(n,r,t,e,u,o,f){return a(r&t|~r&e,n,r,u,o,f)}function i(n,r,t,e,u,o,f){return a(r&e|t&~e,n,r,u,o,f)}function h(n,r,t,e,u,o,f){return a(r^t^e,n,r,u,o,f)}function l(n,r,t,e,u,o,f){return a(t^(r|~e),n,r,u,o,f)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var v=n;exports.default=v;
},{}],"vJdu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./v35.js")),r=t(require("./md5.js"));function t(e){return e&&e.__esModule?e:{default:e}}var u=(0,e.default)("v3",48,r.default),d=u;exports.default=d;
},{"./v35.js":"Y6ie","./md5.js":"bGV3"}],"K7Zs":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./rng.js")),r=t(require("./stringify.js"));function t(e){return e&&e.__esModule?e:{default:e}}function u(t,u,n){var a=(t=t||{}).random||(t.rng||e.default)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,u){n=n||0;for(var f=0;f<16;++f)u[n+f]=a[f];return u}return(0,r.default)(a)}var n=u;exports.default=n;
},{"./rng.js":"gKk3","./stringify.js":"vDjk"}],"MvYZ":[function(require,module,exports) {
"use strict";function r(r,e,t,a){switch(r){case 0:return e&t^~e&a;case 1:return e^t^a;case 2:return e&t^e&a^t&a;case 3:return e^t^a}}function e(r,e){return r<<e|r>>>32-e}function t(t){var a=[1518500249,1859775393,2400959708,3395469782],o=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){var n=unescape(encodeURIComponent(t));t=[];for(var s=0;s<n.length;++s)t.push(n.charCodeAt(s))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var f=t.length/4+2,u=Math.ceil(f/16),c=new Array(u),l=0;l<u;++l){for(var i=new Uint32Array(16),v=0;v<16;++v)i[v]=t[64*l+4*v]<<24|t[64*l+4*v+1]<<16|t[64*l+4*v+2]<<8|t[64*l+4*v+3];c[l]=i}c[u-1][14]=8*(t.length-1)/Math.pow(2,32),c[u-1][14]=Math.floor(c[u-1][14]),c[u-1][15]=8*(t.length-1)&4294967295;for(var h=0;h<u;++h){for(var p=new Uint32Array(80),y=0;y<16;++y)p[y]=c[h][y];for(var d=16;d<80;++d)p[d]=e(p[d-3]^p[d-8]^p[d-14]^p[d-16],1);for(var A=o[0],g=o[1],w=o[2],M=o[3],x=o[4],U=0;U<80;++U){var C=Math.floor(U/20),_=e(A,5)+r(C,g,w,M)+x+a[C]+p[U]>>>0;x=M,M=w,w=e(g,30)>>>0,g=A,A=_}o[0]=o[0]+A>>>0,o[1]=o[1]+g>>>0,o[2]=o[2]+w>>>0,o[3]=o[3]+M>>>0,o[4]=o[4]+x>>>0}return[o[0]>>24&255,o[0]>>16&255,o[0]>>8&255,255&o[0],o[1]>>24&255,o[1]>>16&255,o[1]>>8&255,255&o[1],o[2]>>24&255,o[2]>>16&255,o[2]>>8&255,255&o[2],o[3]>>24&255,o[3]>>16&255,o[3]>>8&255,255&o[3],o[4]>>24&255,o[4]>>16&255,o[4]>>8&255,255&o[4]]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var a=t;exports.default=a;
},{}],"K2oB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./v35.js")),r=t(require("./sha1.js"));function t(e){return e&&e.__esModule?e:{default:e}}var u=(0,e.default)("v5",80,r.default),s=u;exports.default=s;
},{"./v35.js":"Y6ie","./sha1.js":"MvYZ"}],"loGb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e="00000000-0000-0000-0000-000000000000";exports.default=e;
},{}],"GRom":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("./validate.js"));function r(e){return e&&e.__esModule?e:{default:e}}function t(r){if(!(0,e.default)(r))throw TypeError("Invalid UUID");return parseInt(r.substr(14,1),16)}var u=t;exports.default=u;
},{"./validate.js":"p9l8"}],"UeUD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"NIL",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(exports,"parse",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(exports,"stringify",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(exports,"v1",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(exports,"v3",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(exports,"v4",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(exports,"v5",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(exports,"validate",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(exports,"version",{enumerable:!0,get:function(){return i.default}});var e=a(require("./v1.js")),r=a(require("./v3.js")),t=a(require("./v4.js")),n=a(require("./v5.js")),u=a(require("./nil.js")),i=a(require("./version.js")),o=a(require("./validate.js")),f=a(require("./stringify.js")),s=a(require("./parse.js"));function a(e){return e&&e.__esModule?e:{default:e}}
},{"./v1.js":"qgnI","./v3.js":"vJdu","./v4.js":"K7Zs","./v5.js":"K2oB","./nil.js":"loGb","./version.js":"GRom","./validate.js":"p9l8","./stringify.js":"vDjk","./parse.js":"rtKa"}],"VF80":[function(require,module,exports) {
var e=module.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var r="candidate:%s %d %s %d %s %d typ %s";return r+=null!=e.raddr?" raddr %s rport %d":"%v%v",r+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(r+=" generation %d"),r+=null!=e["network-id"]?" network-id %d":"%v",r+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var r="ssrc:%d";return null!=e.attribute&&(r+=" %s",null!=e.value&&(r+=":%s")),r}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var r="mediaclk:";return r+=null!=e.id?"id=%s %s":"%v%s",r+=null!=e.mediaClockValue?"=%s":"",r+=null!=e.rateNumerator?" rate=%s":"",r+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(e).forEach(function(r){e[r].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})});
},{}],"pJ4u":[function(require,module,exports) {
var r=function(r){return String(Number(r))===r?Number(r):r},t=function(t,e,n,s){if(s&&!n)e[s]=r(t[1]);else for(var a=0;a<n.length;a+=1)null!=t[a+1]&&(e[n[a]]=r(t[a+1]))},e=function(r,e,n){var s=r.name&&r.names;r.push&&!e[r.push]?e[r.push]=[]:s&&!e[r.name]&&(e[r.name]={});var a=r.push?{}:s?e[r.name]:e;t(n.match(r.reg),a,r.names,r.name),r.push&&e[r.push].push(a)},n=require("./grammar"),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);exports.parse=function(r){var t={},a=[],p=t;return r.split(/(\r\n|\r|\n)/).filter(s).forEach(function(r){var t=r[0],s=r.slice(2);"m"===t&&(a.push({rtp:[],fmtp:[]}),p=a[a.length-1]);for(var u=0;u<(n[t]||[]).length;u+=1){var i=n[t][u];if(i.reg.test(s))return e(i,p,s)}}),t.media=a,t};var a=function(t,e){var n=e.split(/=(.+)/,2);return 2===n.length?t[n[0]]=r(n[1]):1===n.length&&e.length>1&&(t[n[0]]=void 0),t};exports.parseParams=function(r){return r.split(/;\s?/).reduce(a,{})},exports.parseFmtpConfig=exports.parseParams,exports.parsePayloads=function(r){return r.toString().split(" ").map(Number)},exports.parseRemoteCandidates=function(t){for(var e=[],n=t.split(" ").map(r),s=0;s<n.length;s+=3)e.push({component:n[s],ip:n[s+1],port:n[s+2]});return e},exports.parseImageAttributes=function(r){return r.split(" ").map(function(r){return r.substring(1,r.length-1).split(",").reduce(a,{})})},exports.parseSimulcastStreamList=function(t){return t.split(";").map(function(t){return t.split(",").map(function(t){var e,n=!1;return"~"!==t[0]?e=r(t):(e=r(t.substring(1,t.length)),n=!0),{scid:e,paused:n}})})};
},{"./grammar":"VF80"}],"dFSN":[function(require,module,exports) {
var n=require("./grammar"),r=/%[sdv%]/g,a=function(n){var a=1,u=arguments,e=u.length;return n.replace(r,function(n){if(a>=e)return n;var r=u[a];switch(a+=1,n){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}})},u=function(n,r,u){var e=[n+"="+(r.format instanceof Function?r.format(r.push?u:u[r.name]):r.format)];if(r.names)for(var o=0;o<r.names.length;o+=1){var s=r.names[o];r.name?e.push(u[r.name][s]):e.push(u[r.names[o]])}else e.push(u[r.name]);return a.apply(null,e)},e=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];module.exports=function(r,a){a=a||{},null==r.version&&(r.version=0),null==r.name&&(r.name=" "),r.media.forEach(function(n){null==n.payloads&&(n.payloads="")});var s=a.outerOrder||e,t=a.innerOrder||o,i=[];return s.forEach(function(a){n[a].forEach(function(n){n.name in r&&null!=r[n.name]?i.push(u(a,n,r)):n.push in r&&null!=r[n.push]&&r[n.push].forEach(function(r){i.push(u(a,n,r))})})}),r.media.forEach(function(r){i.push(u("m",n.m[0],r)),t.forEach(function(a){n[a].forEach(function(n){n.name in r&&null!=r[n.name]?i.push(u(a,n,r)):n.push in r&&null!=r[n.push]&&r[n.push].forEach(function(r){i.push(u(a,n,r))})})})}),i.join("\r\n")+"\r\n"};
},{"./grammar":"VF80"}],"CfIM":[function(require,module,exports) {
var e=require("./parser"),r=require("./writer");exports.write=r,exports.parse=e.parse,exports.parseParams=e.parseParams,exports.parseFmtpConfig=e.parseFmtpConfig,exports.parsePayloads=e.parsePayloads,exports.parseRemoteCandidates=e.parseRemoteCandidates,exports.parseImageAttributes=e.parseImageAttributes,exports.parseSimulcastStreamList=e.parseSimulcastStreamList;
},{"./parser":"pJ4u","./writer":"dFSN"}],"g5IB":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"x3aR":[function(require,module,exports) {
var process = require("process");
var define;
var e,t=require("process");!function(r){var n=Object.hasOwnProperty,i=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},s="object"==typeof t&&"function"==typeof t.nextTick,o="function"==typeof Symbol,l="object"==typeof Reflect,a="function"==typeof setImmediate?setImmediate:setTimeout,f=o?l&&"function"==typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function h(){this._events={},this._conf&&c.call(this,this._conf)}function c(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners!==r&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function u(e,r){var n="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+r+"."),void 0!==t&&t.emitWarning){var i=new Error(n);i.name="MaxListenersExceededWarning",i.emitter=this,i.count=e,t.emitWarning(i)}else console.error(n),console.trace&&console.trace()}var p=function(e,t,r){var n=arguments.length;switch(n){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,r];default:for(var i=new Array(n);n--;)i[n]=arguments[n];return i}};function v(e,t){for(var n={},i=e.length,s=t?t.length:0,o=0;o<i;o++)n[e[o]]=o<s?t[o]:r;return n}function y(e,t,r){var n,i;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(r.on||r.off)&&(n=r.on,i=r.off),t.addEventListener?(n=t.addEventListener,i=t.removeEventListener):t.addListener?(n=t.addListener,i=t.removeListener):t.on&&(n=t.on,i=t.off),!n&&!i)throw Error("target does not implement any known event API");if("function"!=typeof n)throw TypeError("on method must be a function");if("function"!=typeof i)throw TypeError("off method must be a function");this._on=n,this._off=i;var s=e._observers;s?s.push(this):e._observers=[this]}function _(e,t,i,s){var o=Object.assign({},t);if(!e)return o;if("object"!=typeof e)throw TypeError("options must be an object");var l,a,f,h=Object.keys(e),c=h.length;function u(e){throw Error('Invalid "'+l+'" option value'+(e?". Reason: "+e:""))}for(var p=0;p<c;p++){if(l=h[p],!s&&!n.call(t,l))throw Error('Unknown "'+l+'" option');(a=e[l])!==r&&(f=i[l],o[l]=f?f(a,u):a)}return o}function m(e,t){return"function"==typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function d(e){var t="value must be type of "+e.join("|"),r=e.length,n=e[0],i=e[1];return 1===r?function(e,r){if(typeof e===n)return e;r(t)}:2===r?function(e,r){var s=typeof e;if(s===n||s===i)return e;r(t)}:function(n,i){for(var s=typeof n,o=r;o-- >0;)if(s===e[o])return n;i(t)}}Object.assign(y.prototype,{subscribe:function(e,t,r){var n=this,i=this._target,s=this._emitter,o=this._listeners,l=function(){var n=p.apply(null,arguments),o={data:n,name:t,original:e};r?!1!==r.call(i,o)&&s.emit.apply(s,[o.name].concat(n)):s.emit.apply(s,[t].concat(n))};if(o[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,s._newListener&&s._removeListener&&!n._onNewListener?(this._onNewListener=function(r){r===t&&null===o[e]&&(o[e]=l,n._on.call(i,e,l))},s.on("newListener",this._onNewListener),this._onRemoveListener=function(r){r===t&&!s.hasListeners(r)&&o[e]&&(o[e]=null,n._off.call(i,e,l))},o[e]=null,s.on("removeListener",this._onRemoveListener)):(o[e]=l,n._on.call(i,e,l))},unsubscribe:function(e){var t,r,n,i=this,s=this._listeners,o=this._emitter,l=this._off,a=this._target;if(e&&"string"!=typeof e)throw TypeError("event must be a string");function h(){i._onNewListener&&(o.off("newListener",i._onNewListener),o.off("removeListener",i._onRemoveListener),i._onNewListener=null,i._onRemoveListener=null);var e=L.call(o,i);o._observers.splice(e,1)}if(e){if(!(t=s[e]))return;l.call(a,e,t),delete s[e],--this._listenersCount||h()}else{for(n=(r=f(s)).length;n-- >0;)e=r[n],l.call(a,e,s[e]);this._listeners={},this._listenersCount=0,h()}}});var b=d(["function"]),w=d(["object","function"]);function g(e,t,r){var n,i,s,o=0,l=new e(function(a,f,h){function c(){i&&(i=null),o&&(clearTimeout(o),o=0)}r=_(r,{timeout:0,overload:!1},{timeout:function(e,t){return("number"!=typeof(e*=1)||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),n=!r.overload&&"function"==typeof e.prototype.cancel&&"function"==typeof h;var u=function(e){c(),a(e)},p=function(e){c(),f(e)};n?t(u,p,h):(i=[function(e){p(e||Error("canceled"))}],t(u,p,function(e){if(s)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!=typeof e)throw TypeError("onCancel callback must be a function");i.push(e)}),s=!0),r.timeout>0&&(o=setTimeout(function(){var e=Error("timeout");e.code="ETIMEDOUT",o=0,l.cancel(e),f(e)},r.timeout))});return n||(l.cancel=function(e){if(i){for(var t=i.length,r=1;r<t;r++)i[r](e);i[0](e),i=null}}),l}function L(e){var t=this._observers;if(!t)return-1;for(var r=t.length,n=0;n<r;n++)if(t[n]._target===e)return n;return-1}function E(e,t,r,n,i){if(!r)return null;if(0===n){var s=typeof t;if("string"===s){var o,l,a=0,h=0,c=this.delimiter,u=c.length;if(-1!==(l=t.indexOf(c))){o=new Array(5);do{o[a++]=t.slice(h,l),h=l+u}while(-1!==(l=t.indexOf(c,h)));o[a++]=t.slice(h),t=o,i=a}else t=[t],i=1}else"object"===s?i=t.length:(t=[t],i=1)}var p,v,y,_,m,d,b,w=null,g=t[n],L=t[n+1];if(n===i)r._listeners&&("function"==typeof r._listeners?(e&&e.push(r._listeners),w=[r]):(e&&e.push.apply(e,r._listeners),w=[r]));else{if("*"===g){for(l=(d=f(r)).length;l-- >0;)"_listeners"!==(p=d[l])&&(b=E(e,t,r[p],n+1,i))&&(w?w.push.apply(w,b):w=b);return w}if("**"===g){for((m=n+1===i||n+2===i&&"*"===L)&&r._listeners&&(w=E(e,t,r,i,i)),l=(d=f(r)).length;l-- >0;)"_listeners"!==(p=d[l])&&("*"===p||"**"===p?(r[p]._listeners&&!m&&(b=E(e,t,r[p],i,i))&&(w?w.push.apply(w,b):w=b),b=E(e,t,r[p],n,i)):b=E(e,t,r[p],p===L?n+2:n,i),b&&(w?w.push.apply(w,b):w=b));return w}r[g]&&(w=E(e,t,r[g],n+1,i))}if((v=r["*"])&&E(e,t,v,n+1,i),y=r["**"])if(n<i)for(y._listeners&&E(e,t,y,i,i),l=(d=f(y)).length;l-- >0;)"_listeners"!==(p=d[l])&&(p===L?E(e,t,y[p],n+2,i):p===g?E(e,t,y[p],n+1,i):((_={})[p]=y[p],E(e,t,{"**":_},n+1,i)));else y._listeners?E(e,t,y,i,i):y["*"]&&y["*"]._listeners&&E(e,t,y["*"],i,i);return w}function k(e){for(var t,r,n,i=f(e),s=i.length;s-- >0;)(t=e[r=i[s]])&&(n=!0,"_listeners"===r||k(t)||delete e[r]);return n}function j(e,t,r){this.emitter=e,this.event=t,this.listener=r}function T(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,c.call(this,e)}j.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},T.EventEmitter2=T,T.prototype.listenTo=function(e,t,n){if("object"!=typeof e)throw TypeError("target musts be an object");var s=this;function o(t){if("object"!=typeof t)throw TypeError("events must be an object");var r,i=n.reducers,o=L.call(s,e);r=-1===o?new y(s,e,n):s._observers[o];for(var l,a=f(t),h=a.length,c="function"==typeof i,u=0;u<h;u++)l=a[u],r.subscribe(l,t[l]||l,c?i:i&&i[l])}return n=_(n,{on:r,off:r,reducers:r},{on:b,off:b,reducers:w}),i(t)?o(v(t)):o("string"==typeof t?v(t.split(/\s+/)):t),this},T.prototype.stopListeningTo=function(e,t){var r=this._observers;if(!r)return!1;var n,i=r.length,s=!1;if(e&&"object"!=typeof e)throw TypeError("target should be an object");for(;i-- >0;)n=r[i],e&&n._target!==e||(n.unsubscribe(t),s=!0);return s},T.prototype.delimiter=".",T.prototype.setMaxListeners=function(e){e!==r&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},T.prototype.getMaxListeners=function(){return this._maxListeners},T.prototype.event="",T.prototype.once=function(e,t,r){return this._once(e,t,!1,r)},T.prototype.prependOnceListener=function(e,t,r){return this._once(e,t,!0,r)},T.prototype._once=function(e,t,r,n){return this._many(e,1,t,r,n)},T.prototype.many=function(e,t,r,n){return this._many(e,t,r,!1,n)},T.prototype.prependMany=function(e,t,r,n){return this._many(e,t,r,!0,n)},T.prototype._many=function(e,t,r,n,i){var s=this;if("function"!=typeof r)throw new Error("many only accepts instances of Function");function o(){return 0==--t&&s.off(e,o),r.apply(this,arguments)}return o._origin=r,this._on(e,o,n,i)},T.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var e,t,r,n,i,s,l=arguments[0],a=this.wildcard;if("newListener"===l&&!this._newListener&&!this._events.newListener)return!1;if(a&&(e=l,"newListener"!==l&&"removeListener"!==l&&"object"==typeof l)){if(r=l.length,o)for(n=0;n<r;n++)if("symbol"==typeof l[n]){s=!0;break}s||(l=l.join(this.delimiter))}var f,c=arguments.length;if(this._all&&this._all.length)for(n=0,r=(f=this._all.slice()).length;n<r;n++)switch(this.event=l,c){case 1:f[n].call(this,l);break;case 2:f[n].call(this,l,arguments[1]);break;case 3:f[n].call(this,l,arguments[1],arguments[2]);break;default:f[n].apply(this,arguments)}if(a)f=[],E.call(this,f,e,this.listenerTree,0,r);else{if("function"==typeof(f=this._events[l])){switch(this.event=l,c){case 1:f.call(this);break;case 2:f.call(this,arguments[1]);break;case 3:f.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(c-1),i=1;i<c;i++)t[i-1]=arguments[i];f.apply(this,t)}return!0}f&&(f=f.slice())}if(f&&f.length){if(c>3)for(t=new Array(c-1),i=1;i<c;i++)t[i-1]=arguments[i];for(n=0,r=f.length;n<r;n++)switch(this.event=l,c){case 1:f[n].call(this);break;case 2:f[n].call(this,arguments[1]);break;case 3:f[n].call(this,arguments[1],arguments[2]);break;default:f[n].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===l)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},T.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var e,t,r,n,i,s,l=arguments[0],a=this.wildcard;if("newListener"===l&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(a&&(e=l,"newListener"!==l&&"removeListener"!==l&&"object"==typeof l)){if(n=l.length,o)for(i=0;i<n;i++)if("symbol"==typeof l[i]){t=!0;break}t||(l=l.join(this.delimiter))}var f,c=[],u=arguments.length;if(this._all)for(i=0,n=this._all.length;i<n;i++)switch(this.event=l,u){case 1:c.push(this._all[i].call(this,l));break;case 2:c.push(this._all[i].call(this,l,arguments[1]));break;case 3:c.push(this._all[i].call(this,l,arguments[1],arguments[2]));break;default:c.push(this._all[i].apply(this,arguments))}if(a?(f=[],E.call(this,f,e,this.listenerTree,0)):f=this._events[l],"function"==typeof f)switch(this.event=l,u){case 1:c.push(f.call(this));break;case 2:c.push(f.call(this,arguments[1]));break;case 3:c.push(f.call(this,arguments[1],arguments[2]));break;default:for(r=new Array(u-1),s=1;s<u;s++)r[s-1]=arguments[s];c.push(f.apply(this,r))}else if(f&&f.length){if(f=f.slice(),u>3)for(r=new Array(u-1),s=1;s<u;s++)r[s-1]=arguments[s];for(i=0,n=f.length;i<n;i++)switch(this.event=l,u){case 1:c.push(f[i].call(this));break;case 2:c.push(f[i].call(this,arguments[1]));break;case 3:c.push(f[i].call(this,arguments[1],arguments[2]));break;default:c.push(f[i].apply(this,r))}}else if(!this.ignoreErrors&&!this._all&&"error"===l)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(c)},T.prototype.on=function(e,t,r){return this._on(e,t,!1,r)},T.prototype.prependListener=function(e,t,r){return this._on(e,t,!0,r)},T.prototype.onAny=function(e){return this._onAny(e,!1)},T.prototype.prependAny=function(e){return this._onAny(e,!0)},T.prototype.addListener=T.prototype.on,T.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},T.prototype._on=function(e,n,i,o){if("function"==typeof e)return this._onAny(e,n),this;if("function"!=typeof n)throw new Error("on only accepts instances of Function");this._events||h.call(this);var l,f=this;return o!==r&&(l=function(e,n,i){if(!0===i)l=!0;else if(!1===i)o=!0;else{if(!i||"object"!=typeof i)throw TypeError("options should be an object or true");var o=i.async,l=i.promisify,f=i.nextTick,h=i.objectify}if(o||f||l){var c=n,u=n._origin||n;if(f&&!s)throw Error("process.nextTick is not supported");l===r&&(l="AsyncFunction"===n.constructor.name),(n=function(){var e=arguments,r=this,n=this.event;return l?f?Promise.resolve():new Promise(function(e){a(e)}).then(function(){return r.event=n,c.apply(r,e)}):(f?t.nextTick:a)(function(){r.event=n,c.apply(r,e)})})._async=!0,n._origin=u}return[n,h?new j(this,e,n):this]}.call(this,e,n,o),n=l[0],f=l[1]),this._newListener&&this.emit("newListener",e,n),this.wildcard?(function(e,t,r){var n,i,s=0,o=0,l=this.delimiter,a=l.length;if("string"==typeof e)if(-1!==(n=e.indexOf(l))){i=new Array(5);do{i[s++]=e.slice(o,n),o=n+a}while(-1!==(n=e.indexOf(l,o)));i[s++]=e.slice(o)}else i=[e],s=1;else i=e,s=e.length;if(s>1)for(n=0;n+1<s;n++)if("**"===i[n]&&"**"===i[n+1])return;var f,h=this.listenerTree;for(n=0;n<s;n++)if(h=h[f=i[n]]||(h[f]={}),n===s-1)return h._listeners?("function"==typeof h._listeners&&(h._listeners=[h._listeners]),r?h._listeners.unshift(t):h._listeners.push(t),!h._listeners.warned&&this._maxListeners>0&&h._listeners.length>this._maxListeners&&(h._listeners.warned=!0,u.call(this,h._listeners.length,f))):h._listeners=t,!0;return!0}.call(this,e,n,i),f):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),i?this._events[e].unshift(n):this._events[e].push(n),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,u.call(this,this._events[e].length,e))):this._events[e]=n,f)},T.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var r,n=[];if(this.wildcard){var s="string"==typeof e?e.split(this.delimiter):e.slice();if(!(n=E.call(this,null,s,this.listenerTree,0)))return this}else{if(!this._events[e])return this;r=this._events[e],n.push({_listeners:r})}for(var o=0;o<n.length;o++){var l=n[o];if(r=l._listeners,i(r)){for(var a=-1,f=0,h=r.length;f<h;f++)if(r[f]===t||r[f].listener&&r[f].listener===t||r[f]._origin&&r[f]._origin===t){a=f;break}if(a<0)continue;return this.wildcard?l._listeners.splice(a,1):this._events[e].splice(a,1),0===r.length&&(this.wildcard?delete l._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(r===t||r.listener&&r.listener===t||r._origin&&r._origin===t)&&(this.wildcard?delete l._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&k(this.listenerTree),this},T.prototype.offAny=function(e){var t,r=0,n=0;if(e&&this._all&&this._all.length>0){for(r=0,n=(t=this._all).length;r<n;r++)if(e===t[r])return t.splice(r,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(r=0,n=t.length;r<n;r++)this.emit("removeListenerAny",t[r]);this._all=[]}return this},T.prototype.removeListener=T.prototype.off,T.prototype.removeAllListeners=function(e){if(e===r)return!this._events||h.call(this),this;if(this.wildcard){var t,n=E.call(this,null,e,this.listenerTree,0);if(!n)return this;for(t=0;t<n.length;t++)n[t]._listeners=null;this.listenerTree&&k(this.listenerTree)}else this._events&&(this._events[e]=null);return this},T.prototype.listeners=function(e){var t,n,i,s,o,l=this._events;if(e===r){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!l)return[];for(s=(t=f(l)).length,i=[];s-- >0;)"function"==typeof(n=l[t[s]])?i.push(n):i.push.apply(i,n);return i}if(this.wildcard){if(!(o=this.listenerTree))return[];var a=[],h="string"==typeof e?e.split(this.delimiter):e.slice();return E.call(this,a,h,o,0),a}return l&&(n=l[e])?"function"==typeof n?[n]:n:[]},T.prototype.eventNames=function(e){var t=this._events;return this.wildcard?function e(t,r,n,i){for(var s,o,l,a,h=f(t),c=h.length,u=t._listeners;c-- >0;)s=t[o=h[c]],l="_listeners"===o?n:n?n.concat(o):[o],a=i||"symbol"==typeof o,u&&r.push(a?l:l.join(this.delimiter)),"object"==typeof s&&e.call(this,s,r,l,a);return r}.call(this,this.listenerTree,[],null,e):t?f(t):[]},T.prototype.listenerCount=function(e){return this.listeners(e).length},T.prototype.hasListeners=function(e){if(this.wildcard){var t=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return E.call(this,t,n,this.listenerTree,0),t.length>0}var i=this._events,s=this._all;return!!(s&&s.length||i&&(e===r?f(i).length:i[e]))},T.prototype.listenersAny=function(){return this._all?this._all:[]},T.prototype.waitFor=function(e,t){var n=this,i=typeof t;return"number"===i?t={timeout:t}:"function"===i&&(t={filter:t}),g((t=_(t,{timeout:0,filter:r,handleError:!1,Promise:Promise,overload:!1},{filter:b,Promise:m})).Promise,function(r,i,s){function o(){var s=t.filter;if(!s||s.apply(n,arguments))if(n.off(e,o),t.handleError){var l=arguments[0];l?i(l):r(p.apply(null,arguments).slice(1))}else r(p.apply(null,arguments))}s(function(){n.off(e,o)}),n._on(e,o,!1)},{timeout:t.timeout,overload:t.overload})};var x=T.prototype;if(Object.defineProperties(T,{defaultMaxListeners:{get:function(){return x._maxListeners},set:function(e){if("number"!=typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");x._maxListeners=e},enumerable:!0},once:{value:function(e,t,r){return g((r=_(r,{Promise:Promise,timeout:0,overload:!1},{Promise:m})).Promise,function(r,n,i){var s;if("function"==typeof e.addEventListener)return s=function(){r(p.apply(null,arguments))},i(function(){e.removeEventListener(t,s)}),void e.addEventListener(t,s,{once:!0});var o,l=function(){o&&e.removeListener("error",o),r(p.apply(null,arguments))};"error"!==t&&(o=function(r){e.removeListener(t,l),n(r)},e.once("error",o)),i(function(){o&&e.removeListener("error",o),e.removeListener(t,l)}),e.once(t,l)},{timeout:r.timeout,overload:r.overload})},writable:!0,configurable:!0}}),Object.defineProperties(x,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),"function"==typeof e&&e.amd)e(function(){return T});else if("object"==typeof exports)module.exports=T;else{new Function("","return this")().EventEmitter2=T}}();
},{"process":"g5IB"}],"ZYu2":[function(require,module,exports) {
var define;
var process = require("process");
var e,t=require("process");Object.defineProperty(exports,"__esModule",{value:!0}),exports.getAnalyticsDeviceId=exports.HMSWebrtcStats=exports.HMSWebrtcInternals=exports.HMSVideoTrack=exports.HMSVideoPluginsManager=exports.HMSVideoPluginType=exports.HMSVideoPluginCanvasContextType=exports.HMSVideoCodec=exports.HMSTrackUpdate=exports.HMSTrackType=exports.HMSTrack=exports.HMSSimulcastLayer=exports.HMSSdk=exports.HMSRoomUpdate=exports.HMSRoomType=exports.HMSRemoteVideoTrack=exports.HMSRemoteAudioTrack=exports.HMSPluginUnsupportedTypes=exports.HMSPlaylistType=exports.HMSPeerUpdate=exports.HMSLogLevel=exports.HMSLocalVideoTrack=exports.HMSLocalAudioTrack=exports.HMSException=exports.HMSAudioTrack=exports.HMSAudioPluginsManager=exports.HMSAudioPluginType=exports.HMSAudioContextHandler=exports.HMSAudioCodec=exports.ENV=void 0,exports.getLocalDevices=Fn,exports.getLocalScreen=Gn,exports.getLocalStream=Un,exports.parsedUserAgent=exports.isSupported=exports.isPageHidden=exports.isNode=exports.isMobile=exports.isBrowser=void 0,exports.validateDeviceAV=zr;var n,r=c(require("webrtc-adapter")),i=require("ua-parser-js"),a=require("uuid"),s=require("sdp-transform"),o=require("eventemitter2");function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){return v(e)||h(e,t)||G(e,t)||d()}function d(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,s,o=[],c=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(o.push(r.value),o.length!==t);c=!0);}catch(l){u=!0,i=l}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw i}}return o}}function v(e){if(Array.isArray(e))return e}function p(e,t,n){return(t=M(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return m(e)||g(e)||G(e)||k()}function k(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function m(e){if(Array.isArray(e))return F(e)}function y(){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=T(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}}).apply(this,arguments)}function T(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}function b(){"use strict";b=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(R){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var a=t&&t.prototype instanceof v?t:v,s=Object.create(a.prototype),o=new I(i||[]);return r(s,"_invoke",{value:S(e,n,o)}),s}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(R){return{type:"throw",arg:R}}}e.wrap=l;var h={};function v(){}function p(){}function f(){}var k={};c(k,a,function(){return this});var g=Object.getPrototypeOf,m=g&&g(g(P([])));m&&m!==t&&n.call(m,a)&&(k=m);var y=f.prototype=v.prototype=Object.create(k);function T(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function E(e,t){var i;r(this,"_invoke",{value:function(r,a){function s(){return new t(function(i,s){!function r(i,a,s,o){var c=d(e[i],e,a);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==u(h)&&n.call(h,"__await")?t.resolve(h.__await).then(function(e){r("next",e,s,o)},function(e){r("throw",e,s,o)}):t.resolve(h).then(function(e){l.value=e,s(l)},function(e){return r("throw",e,s,o)})}o(c.arg)}(r,a,i,s)})}return i=i?i.then(s,s):s()}})}function S(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return C()}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var o=w(s,n);if(o){if(o===h)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function w(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=d(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function P(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:C}}function C(){return{value:void 0,done:!0}}return p.prototype=f,r(y,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:p,configurable:!0}),p.displayName=c(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,o,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},T(E.prototype),c(E.prototype,s,function(){return this}),e.AsyncIterator=E,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var s=new E(l(t,n,r,i),a);return e.isGeneratorFunction(n)?s:s.next().then(function(e){return e.done?e.value:s.next()})},T(y),c(y,o,"Generator"),c(y,a,function(){return this}),c(y,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=P,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var o=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(o&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;x(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:P(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}function E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}function S(e){var t=P();return function(){var n,r=_(e);if(t){var i=_(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return w(this,n)}}function w(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return A(e)}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e){var t="function"==typeof Map?new Map:void 0;return(x=function(e){if(null===e||!C(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return I(e,arguments,_(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),R(n,e)})(e)}function I(e,t,n){return(I=P()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&R(i,n.prototype),i}).apply(null,arguments)}function P(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function C(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function R(e,t){return(R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,M(r.key),r)}}function O(e,t,n){return t&&N(e.prototype,t),n&&N(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function M(e){var t=L(e,"string");return"symbol"===u(t)?t:String(t)}function L(e,t){if("object"!==u(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function U(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=G(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw a}}}}function G(e,t){if(e){if("string"==typeof e)return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?F(e,t):void 0}}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var B,V,H=Object.defineProperty,W=Object.defineProperties,j=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertySymbols,J=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable,Y=function(e,t,n){return t in e?H(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Q=function(e,t){for(var n in t||(t={}))J.call(t,n)&&Y(e,n,t[n]);if(K){var r,i=U(K(t));try{for(i.s();!(r=i.n()).done;){n=r.value;q.call(t,n)&&Y(e,n,t[n])}}catch(a){i.e(a)}finally{i.f()}}return e},z=function(e,t){return W(e,j(t))},Z=function(e,t){var n={};for(var r in e)J.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&K){var i,a=U(K(e));try{for(a.s();!(i=a.n()).done;){r=i.value;t.indexOf(r)<0&&q.call(e,r)&&(n[r]=e[r])}}catch(s){a.e(s)}finally{a.f()}}return n},X=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},$=function(e,t,n){return new Promise(function(r,i){var a=function(e){try{o(n.next(e))}catch(t){i(t)}},s=function(e){try{o(n.throw(e))}catch(t){i(t)}},o=function(e){return e.done?r(e.value):Promise.resolve(e.value).then(a,s)};o((n=n.apply(e,t)).next())})},ee=X(function(e,t){t.exports={name:"@100mslive/hms-video",version:"0.5.4",license:"MIT",main:"dist/index.cjs.js",typings:"dist/index.d.ts",module:"dist/index.js",files:["dist","src"],engines:{node:">=10"},exports:{".":{require:"./dist/index.cjs.js",import:"./dist/index.js",default:"./dist/index.js"}},scripts:{prestart:"rm -rf dist && yarn types:build",start:'concurrently "yarn dev" "yarn types"',dev:"node ../../scripts/dev","build:only":"node ../../scripts/build",build:"yarn build:only && yarn types:build",types:"tsc -w","types:build":"tsc -p tsconfig.json",test:"jest --maxWorkers=1",lint:"eslint -c ../../.eslintrc .","lint:fix":"yarn lint --fix",prepare:"yarn build",size:"size-limit",analyze:"size-limit --why",format:"prettier --write src/**/*.ts"},author:"100ms <tech-common@100ms.live>",devDependencies:{"@types/sdp-transform":"^2.4.4","@types/ua-parser-js":"^0.7.36","@types/uuid":"^8.3.0","jest-canvas-mock":"^2.3.1",tslib:"^2.2.0"},dependencies:{eventemitter2:"^6.4.7","sdp-transform":"^2.14.1","ua-parser-js":"^1.0.1",uuid:"^8.3.2","webrtc-adapter":"^8.0.0"},gitHead:"fe00f2f7a62e19cb86e9d7bd8a80bc921909a2bb"}}),te=function(){function e(t){D(this,e),this.key=t,this.storage=null}return O(e,[{key:"getStorage",value:function(){return ie&&!this.storage&&(he(),this.storage=window.localStorage),this.storage}},{key:"get",value:function(){var e,t=null==(e=this.getStorage())?void 0:e.getItem(this.key);return t?JSON.parse(t):void 0}},{key:"set",value:function(e){var t,n=JSON.stringify(e);null==(t=this.getStorage())||t.setItem(this.key,n)}},{key:"clear",value:function(){var e;null==(e=this.getStorage())||e.removeItem(this.key)}}]),e}(),ne=new i.UAParser,re="undefined"==typeof window&&!(null==(B=ne.getBrowser().name)?void 0:B.toLowerCase().includes("electron")),ie="undefined"!=typeof window;exports.ENV=V,exports.isBrowser=ie,exports.isNode=re,exports.parsedUserAgent=ne,function(e){e.PROD="prod",e.QA="qa",e.DEV="dev"}(V||(exports.ENV=V={}));var ae=function(){return!re},se=ae(),oe=function(){return"mobile"===ne.getDevice().type},ce=function(){var e,t=new te("hms-analytics-deviceId"),n=t.get();return n?e=n:(e=(0,a.v4)(),t.set(e)),e},ue=function(){return"undefined"!=typeof document&&document.hidden};exports.isPageHidden=ue,exports.getAnalyticsDeviceId=ce,exports.isMobile=oe,exports.isSupported=se;var le,de=function(){function e(){D(this,e),this.valuesMap=new Map}return O(e,[{key:"getItem",value:function(e){return this.valuesMap.has(e)?String(this.valuesMap.get(e)):null}},{key:"setItem",value:function(e,t){this.valuesMap.set(e,t)}},{key:"removeItem",value:function(e){this.valuesMap.delete(e)}},{key:"clear",value:function(){this.valuesMap.clear()}},{key:"key",value:function(e){if(0===arguments.length)throw new TypeError("Failed to execute 'key' on 'Storage': 1 argument required, but only 0 present.");return Array.from(this.valuesMap.keys())[e]}},{key:"length",get:function(){return this.valuesMap.size}}]),e}(),he=function(){ie&&!localStorage&&(window.localStorage=new de)};exports.HMSLogLevel=le,function(e){e[e.VERBOSE=0]="VERBOSE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.TIME=4]="TIME",e[e.TIMEEND=5]="TIMEEND",e[e.ERROR=6]="ERROR",e[e.NONE=7]="NONE"}(le||(exports.HMSLogLevel=le={}));var ve,pe,fe,ke,ge,me="undefined"!=typeof window&&void 0!==window.expect,ye=function(){function e(){D(this,e)}return O(e,null,[{key:"v",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[0,e].concat(n))}},{key:"d",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[1,e].concat(n))}},{key:"i",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[2,e].concat(n))}},{key:"w",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[3,e].concat(n))}},{key:"e",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[6,e].concat(n))}},{key:"time",value:function(e){this.log(4,"[HMSPerformanceTiming]",e)}},{key:"timeEnd",value:function(e){this.log(5,"[HMSPerformanceTiming]",e,e)}},{key:"cleanUp",value:function(){performance.clearMarks(),performance.clearMeasures()}},{key:"log",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(!(this.level.valueOf()>e.valueOf()))switch(e){case 0:var a;(a=console).log.apply(a,[t].concat(r));break;case 1:var s;(s=console).debug.apply(s,[t].concat(r));break;case 2:var o;(o=console).info.apply(o,[t].concat(r));break;case 3:var c;(c=console).warn.apply(c,[t].concat(r));break;case 6:var u;(u=console).error.apply(u,[t].concat(r));break;case 4:performance.mark(r[0]);break;case 5:var l=r[0];try{var d=performance.measure(l,l);this.log(1,t,l,null==d?void 0:d.duration),performance.clearMarks(l),performance.clearMeasures(l)}catch(d){this.log(1,t,l,d)}}}}]),e}();ye.level=me?7:0,exports.HMSRoomUpdate=ve,function(e){e.RECORDING_STATE_UPDATED="RECORDING_STATE_UPDATED",e.BROWSER_RECORDING_STATE_UPDATED="BROWSER_RECORDING_STATE_UPDATED",e.SERVER_RECORDING_STATE_UPDATED="SERVER_RECORDING_STATE_UPDATED",e.RTMP_STREAMING_STATE_UPDATED="RTMP_STREAMING_STATE_UPDATED",e.HLS_STREAMING_STATE_UPDATED="HLS_STREAMING_STATE_UPDATED"}(ve||(exports.HMSRoomUpdate=ve={})),exports.HMSPeerUpdate=pe,function(e){e[e.PEER_JOINED=0]="PEER_JOINED",e[e.PEER_LEFT=1]="PEER_LEFT",e[e.AUDIO_TOGGLED=2]="AUDIO_TOGGLED",e[e.VIDEO_TOGGLED=3]="VIDEO_TOGGLED",e[e.BECAME_DOMINANT_SPEAKER=4]="BECAME_DOMINANT_SPEAKER",e[e.RESIGNED_DOMINANT_SPEAKER=5]="RESIGNED_DOMINANT_SPEAKER",e[e.STARTED_SPEAKING=6]="STARTED_SPEAKING",e[e.STOPPED_SPEAKING=7]="STOPPED_SPEAKING",e[e.ROLE_UPDATED=8]="ROLE_UPDATED",e[e.PEER_LIST=9]="PEER_LIST",e[e.NAME_UPDATED=10]="NAME_UPDATED",e[e.METADATA_UPDATED=11]="METADATA_UPDATED"}(pe||(exports.HMSPeerUpdate=pe={})),exports.HMSTrackUpdate=fe,function(e){e[e.TRACK_ADDED=0]="TRACK_ADDED",e[e.TRACK_REMOVED=1]="TRACK_REMOVED",e[e.TRACK_MUTED=2]="TRACK_MUTED",e[e.TRACK_UNMUTED=3]="TRACK_UNMUTED",e[e.TRACK_DESCRIPTION_CHANGED=4]="TRACK_DESCRIPTION_CHANGED",e[e.TRACK_DEGRADED=5]="TRACK_DEGRADED",e[e.TRACK_RESTORED=6]="TRACK_RESTORED"}(fe||(exports.HMSTrackUpdate=fe={})),exports.HMSRoomType=ke,function(e){e[e.DEFAULT=0]="DEFAULT"}(ke||(exports.HMSRoomType=ke={})),exports.HMSSimulcastLayer=ge,function(e){e.NONE="none",e.LOW="low",e.MEDIUM="medium",e.HIGH="high"}(ge||(exports.HMSSimulcastLayer=ge={}));var Te,be,Ee,Se,we={f:ge.HIGH,h:ge.MEDIUM,q:ge.LOW};exports.HMSVideoCodec=Te,function(e){e.VP8="vp8",e.VP9="vp9",e.H264="h264"}(Te||(exports.HMSVideoCodec=Te={})),exports.HMSAudioCodec=be,(be||(exports.HMSAudioCodec=be={})).OPUS="opus",exports.HMSPlaylistType=Ee,function(e){e.audio="audio",e.video="video"}(Ee||(exports.HMSPlaylistType=Ee={})),function(e){e[e.Publish=0]="Publish",e[e.Subscribe=1]="Subscribe"}(Se||(Se={}));var Ae,xe={WebSocketConnectionErrors:{FAILED_TO_CONNECT:1e3,WEBSOCKET_CONNECTION_LOST:1003,ABNORMAL_CLOSE:1006},InitAPIErrors:{SERVER_ERRORS:2e3,INIT_CONFIG_NOT_AVAILABLE:2002,ENDPOINT_UNREACHABLE:2003,INVALID_TOKEN_FORMAT:2004},TracksErrors:{GENERIC_TRACK:3e3,CANT_ACCESS_CAPTURE_DEVICE:3001,DEVICE_NOT_AVAILABLE:3002,DEVICE_IN_USE:3003,DEVICE_LOST_MIDWAY:3008,NOTHING_TO_RETURN:3005,INVALID_VIDEO_SETTINGS:3006,CODEC_CHANGE_NOT_PERMITTED:3007,AUTOPLAY_ERROR:3008,OVER_CONSTRAINED:3009,NO_AUDIO_DETECTED:3010,SYSTEM_DENIED_PERMISSION:3011},WebrtcErrors:{CREATE_OFFER_FAILED:4001,CREATE_ANSWER_FAILED:4002,SET_LOCAL_DESCRIPTION_FAILED:4003,SET_REMOTE_DESCRIPTION_FAILED:4004,ICE_FAILURE:4005},WebsocketMethodErrors:{SERVER_ERRORS:5e3,ALREADY_JOINED:5001,CANNOT_JOIN_PREVIEW_IN_PROGRESS:5002},GenericErrors:{NOT_CONNECTED:6e3,SIGNALLING:6001,UNKNOWN:6002,NOT_READY:6003,JSON_PARSING_FAILED:6004,TRACK_METADATA_MISSING:6005,RTC_TRACK_MISSING:6006,PEER_METADATA_MISSING:6007,INVALID_ROLE:6008,PREVIEW_IN_PROGRESS:6009,MISSING_MEDIADEVICES:6010,MISSING_RTCPEERCONNECTION:6011},PlaylistErrors:{NO_ENTRY_TO_PLAY:8001,NO_ENTRY_IS_PLAYING:8002}},Ie=function(e){E(n,x(Error));var t=S(n);function n(e,r,i,a,s){var o,c=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return D(this,n),(o=t.call(this,a)).code=e,o.name=r,o.message=a,o.description=s,o.isTerminal=c,Object.setPrototypeOf(A(o),n.prototype),o.action=i.toString(),o}return O(n,[{key:"toAnalyticsProperties",value:function(){return{error_name:this.name,error_code:this.code,error_message:this.message,error_description:this.description,action:this.action,is_terminal:this.isTerminal}}},{key:"addNativeError",value:function(e){this.nativeError=e}},{key:"toString",value:function(){var e;return"{\n      code: ".concat(this.code,";\n      name: ").concat(this.name,";\n      action: ").concat(this.action,";\n      message: ").concat(this.message,";\n      description: ").concat(this.description,";\n      isTerminal: ").concat(this.isTerminal,";\n      nativeError: ").concat(null==(e=this.nativeError)?void 0:e.message,";\n    }")}}]),n}();exports.HMSException=Ie,function(e){e.NONE="NONE",e.TRACK="TRACK",e.INIT="INIT",e.PUBLISH="PUBLISH",e.UNPUBLISH="UNPUBLISH",e.JOIN="JOIN",e.SUBSCRIBE="SUBSCRIBE",e.DATA_CHANNEL_SEND="DATA_CHANNEL_SEND",e.RESTART_ICE="RESTART_ICE",e.VIDEO_PLUGINS="VIDEO_PLUGINS",e.AUDIO_PLUGINS="AUDIO_PLUGINS",e.AUTOPLAY="AUTOPLAY",e.RECONNECT_SIGNAL="RECONNECT_SIGNAL",e.VALIDATION="VALIDATION",e.PLAYLIST="PLAYLIST",e.PREVIEW="PREVIEW"}(Ae||(Ae={}));var Pe={WebSocketConnectionErrors:{FailedToConnect:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.WebSocketConnectionErrors.FAILED_TO_CONNECT,"WebsocketFailedToConnect",e,"[WS]: ".concat(t),"[WS]: ".concat(t))},WebSocketConnectionLost:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,"WebSocketConnectionLost",e,"Network connection lost ",t)},AbnormalClose:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.WebSocketConnectionErrors.ABNORMAL_CLOSE,"WebSocketAbnormalClose",e,"Websocket closed abnormally",t)}},InitAPIErrors:{ServerErrors:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Ie(e,"ServerErrors",t,"[INIT]: Server error ".concat(n),n,!0)},EndpointUnreachable:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.InitAPIErrors.ENDPOINT_UNREACHABLE,"EndpointUnreachable",e,"Endpoint is not reachable - ".concat(t),t)},InvalidTokenFormat:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.InitAPIErrors.INVALID_TOKEN_FORMAT,"InvalidTokenFormat",e,"Token is not in proper JWT format - ".concat(t),t,!0)},InitConfigNotAvailable:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.InitAPIErrors.INIT_CONFIG_NOT_AVAILABLE,"InitError",e,"[INIT]: ".concat(t),"[INIT]: ".concat(t))}},TracksErrors:{GenericTrack:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.TracksErrors.GENERIC_TRACK,"GenericTrack",e,"[TRACK]: ".concat(t),"[TRACK]: ".concat(t))},CantAccessCaptureDevice:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Ie(xe.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,"CantAccessCaptureDevice",e,"User denied permission to access capture device - ".concat(t),n)},DeviceNotAvailable:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Ie(xe.TracksErrors.DEVICE_NOT_AVAILABLE,"DeviceNotAvailable",e,"[TRACK]: Capture device is no longer available - ".concat(t),n)},DeviceInUse:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Ie(xe.TracksErrors.DEVICE_IN_USE,"DeviceInUse",e,"[TRACK]: Capture device is in use by another application - ".concat(t),n)},DeviceLostMidway:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Ie(xe.TracksErrors.DEVICE_LOST_MIDWAY,"DeviceLostMidway",e,"Lost access to capture device midway - ".concat(t),n)},NothingToReturn:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.TracksErrors.NOTHING_TO_RETURN,"NothingToReturn",e,"There is no media to return. Please select either video or audio or both.",t)},InvalidVideoSettings:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.TracksErrors.INVALID_VIDEO_SETTINGS,"InvalidVideoSettings",e,"Cannot enable simulcast when no video settings are provided",t)},AutoplayBlocked:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.TracksErrors.AUTOPLAY_ERROR,"AutoplayBlocked",e,"Autoplay blocked because the user didn't interact with the document first",t)},CodecChangeNotPermitted:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.TracksErrors.CODEC_CHANGE_NOT_PERMITTED,"CodecChangeNotPermitted",e,"Codec can't be changed mid call.",t)},OverConstrained:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Ie(xe.TracksErrors.OVER_CONSTRAINED,"OverConstrained",e,"[TRACK]: Requested constraints cannot be satisfied with the device hardware - ".concat(t),n)},NoAudioDetected:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Please check the mic or use another audio input";return new Ie(xe.TracksErrors.NO_AUDIO_DETECTED,"NoAudioDetected",e,"No audio input detected from microphone",t)},SystemDeniedPermission:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Ie(xe.TracksErrors.SYSTEM_DENIED_PERMISSION,"SystemDeniedPermission",e,"Operating System denied permission to access capture device - ".concat(t),n)}},WebrtcErrors:{CreateOfferFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.WebrtcErrors.CREATE_OFFER_FAILED,"CreateOfferFailed",e,"[".concat(e.toString(),"]: Failed to create offer. "),t)},CreateAnswerFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.WebrtcErrors.CREATE_ANSWER_FAILED,"CreateAnswerFailed",e,"[".concat(e.toString(),"]: Failed to create answer. "),t)},SetLocalDescriptionFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.WebrtcErrors.SET_LOCAL_DESCRIPTION_FAILED,"SetLocalDescriptionFailed",e,"[".concat(e.toString(),"]: Failed to set offer. "),t)},SetRemoteDescriptionFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.WebrtcErrors.SET_REMOTE_DESCRIPTION_FAILED,"SetRemoteDescriptionFailed",e,"[".concat(e.toString(),"]: Failed to set answer. "),t)},ICEFailure:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.WebrtcErrors.ICE_FAILURE,"ICEFailure",e,"[".concat(e.toString(),"]: Ice connection state FAILED"),t)}},WebsocketMethodErrors:{ServerErrors:function(e,t,n){return new Ie(e,"ServerErrors",t,n,n,!0)},AlreadyJoined:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.WebsocketMethodErrors.ALREADY_JOINED,"AlreadyJoined",e,"[JOIN]: You have already joined this room.",t)},CannotJoinPreviewInProgress:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.WebsocketMethodErrors.CANNOT_JOIN_PREVIEW_IN_PROGRESS,"CannotJoinPreviewInProgress",e,"[JOIN]: Cannot join if preview is in progress",t)}},GenericErrors:{NotConnected:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.GenericErrors.NOT_CONNECTED,"NotConnected",e,"Client is not connected",t)},Signalling:function(e,t){return new Ie(xe.GenericErrors.SIGNALLING,"Signalling",e,"Unknown signalling error: ".concat(e.toString()," ").concat(t," "),t)},Unknown:function(e,t){return new Ie(xe.GenericErrors.UNKNOWN,"Unknown",e,"Unknown exception: ".concat(t),t)},NotReady:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.GenericErrors.NOT_READY,"NotReady",e,t,t)},JsonParsingFailed:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Ie(xe.GenericErrors.JSON_PARSING_FAILED,"JsonParsingFailed",e,"Failed to parse JSON message - ".concat(t),n)},TrackMetadataMissing:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.GenericErrors.TRACK_METADATA_MISSING,"TrackMetadataMissing",e,"Track Metadata Missing",t)},RTCTrackMissing:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.GenericErrors.RTC_TRACK_MISSING,"RTCTrackMissing",e,"RTC Track missing",t)},PeerMetadataMissing:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.GenericErrors.PEER_METADATA_MISSING,"PeerMetadataMissing",e,"Peer Metadata Missing",t)},ValidationFailed:function(e,t){return new Ie(xe.GenericErrors.INVALID_ROLE,"ValidationFailed",Ae.VALIDATION,e,t?JSON.stringify(t):"")},InvalidRole:function(e,t){return new Ie(xe.GenericErrors.INVALID_ROLE,"InvalidRole",e,"Invalid role. Join with valid role",t,!0)},PreviewAlreadyInProgress:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(xe.GenericErrors.PREVIEW_IN_PROGRESS,"PreviewAlreadyInProgress",e,"[Preview]: Cannot join if preview is in progress",t)},MissingMediaDevices:function(){return new Ie(xe.GenericErrors.MISSING_MEDIADEVICES,"MissingMediaDevices",Ae.JOIN,"navigator.mediaDevices is undefined. 100ms SDK won't work on this website as WebRTC is not supported on HTTP endpoints(missing navigator.mediaDevices). Please ensure you're using the SDK either on localhost or a valid HTTPS endpoint.","",!0)},MissingRTCPeerConnection:function(){return new Ie(xe.GenericErrors.MISSING_RTCPEERCONNECTION,"MissingRTCPeerConnection",Ae.JOIN,"RTCPeerConnection which is a core requirement for WebRTC call was not found, this could be due to an unsupported browser or browser extensions blocking WebRTC","",!0)}},MediaPluginErrors:{PlatformNotSupported:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(7001,"PlatformNotSupported",e,"Check HMS Docs to see the list of supported platforms",t)},InitFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(7002,"InitFailed",e,"Plugin init failed",t)},ProcessingFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(7003,"ProcessingFailed",e,"Plugin processing failed",t)},AddAlreadyInProgress:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(7004,"AddAlreadyInProgress",e,"Plugin add already in progress",t)},DeviceNotSupported:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Ie(7005,"DeviceNotSupported",e,"Check HMS Docs to see the list of supported devices",t)}},PlaylistErrors:{NoEntryToPlay:function(e,t){return new Ie(xe.PlaylistErrors.NO_ENTRY_TO_PLAY,"NoEntryToPlay",e,"Reached end of playlist",t)},NoEntryPlaying:function(e,t){return new Ie(xe.PlaylistErrors.NO_ENTRY_IS_PLAYING,"NoEntryIsPlaying",e,"No entry is playing at this time",t)}}},Ce="VALIDATIONS";function Re(e){return null!=e}var _e=function(){if(!Re(RTCPeerConnection)){var e=Pe.GenericErrors.MissingRTCPeerConnection();throw ye.e(Ce,e),e}},De=function(){if(!Re(navigator.mediaDevices)){var e=Pe.GenericErrors.MissingMediaDevices();throw ye.e(Ce,e),e}};function Ne(e,t){var n,r=(0,s.parse)(e.sdp);if(!(null==(n=r.origin)?void 0:n.username.startsWith("mozilla")))return e;var i=t?Array.from(t.values()):[];return r.media.forEach(function(e){var t,n,r,a=null==(t=e.msid)?void 0:t.split(" ")[0],s=null==(n=i.find(function(t){return t.type===e.type&&t.stream_id===a}))?void 0:n.track_id;s&&(e.msid=null==(r=e.msid)?void 0:r.replace(/\s(.+)/," ".concat(s)))}),{type:e.type,sdp:(0,s.write)(r)}}function Oe(e,t){var n;if((null==e?void 0:e.sdp)&&t){var r=(0,s.parse)(e.sdp).media.find(function(e){return Re(e.mid)&&parseInt(e.mid)===parseInt(t)});return null==(n=null==r?void 0:r.msid)?void 0:n.split(" ")[1]}}function Me(e){return e.sdp.includes("usedtx=1")?e:{type:e.type,sdp:e.sdp.replace("useinbandfec=1","useinbandfec=1;usedtx=1")}}var Le,Ue="HMSConnection",Ge=function(){function e(t,n){D(this,e),this.candidates=new Array,this.role=t,this.signal=n}return O(e,[{key:"iceConnectionState",get:function(){return this.nativeConnection.iceConnectionState}},{key:"connectionState",get:function(){return this.nativeConnection.connectionState}},{key:"action",get:function(){return this.role===Se.Publish?Ae.PUBLISH:Ae.SUBSCRIBE}},{key:"addTransceiver",value:function(e,t){return this.nativeConnection.addTransceiver(e,t)}},{key:"createOffer",value:function(e,t){return $(this,null,b().mark(function n(){var r;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.nativeConnection.createOffer(t);case 3:return r=n.sent,n.abrupt("return",(ye.d(Ue,"[role=".concat(this.role,"] createOffer offer=").concat(JSON.stringify(r,null,1))),Me(Ne(r,e))));case 7:throw n.prev=7,n.t0=n.catch(0),Pe.WebrtcErrors.CreateOfferFailed(this.action,n.t0.message);case 10:case"end":return n.stop()}},n,this,[[0,7]])}))}},{key:"createAnswer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.nativeConnection.createAnswer(e);case 3:return n=t.sent,t.abrupt("return",(ye.d(Ue,"[role=".concat(this.role,"] createAnswer answer=").concat(JSON.stringify(n,null,1))),n));case 7:throw t.prev=7,t.t0=t.catch(0),Pe.WebrtcErrors.CreateAnswerFailed(this.action,t.t0.message);case 10:case"end":return t.stop()}},t,this,[[0,7]])}))}},{key:"setLocalDescription",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,ye.d(Ue,"[role=".concat(this.role,"] setLocalDescription description=").concat(JSON.stringify(e,null,1))),t.next=4,this.nativeConnection.setLocalDescription(e);case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(0),Pe.WebrtcErrors.SetLocalDescriptionFailed(this.action,t.t0.message);case 9:case"end":return t.stop()}},t,this,[[0,6]])}))}},{key:"setRemoteDescription",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,ye.d(Ue,"[role=".concat(this.role,"] setRemoteDescription description=").concat(JSON.stringify(e,null,1))),t.next=4,this.nativeConnection.setRemoteDescription(e);case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(0),Pe.WebrtcErrors.SetRemoteDescriptionFailed(this.action,t.t0.message);case 9:case"end":return t.stop()}},t,this,[[0,6]])}))}},{key:"addIceCandidate",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return ye.d(Ue,"[role=".concat(this.role,"] addIceCandidate candidate=").concat(JSON.stringify(e,null,1))),t.next=3,this.nativeConnection.addIceCandidate(e);case 3:case"end":return t.stop()}},t,this)}))}},{key:"remoteDescription",get:function(){return this.nativeConnection.remoteDescription}},{key:"getSenders",value:function(){return this.nativeConnection.getSenders()}},{key:"logSelectedIceCandidatePairs",value:function(){var e=this;(this.role===Se.Publish?this.getSenders():this.getReceivers()).forEach(function(t){var n,r=null==(n=t.track)?void 0:n.kind;try{if(t.transport){var i=t.transport.iceTransport,a=function(){var t=i.getSelectedCandidatePair();ye.d(Ue,"".concat(Se[e.role]," connection"),"selected ".concat(r||"unknown"," candidate pair"),JSON.stringify(t,null,2))};"function"==typeof i.onselectedcandidatepairchange&&(i.onselectedcandidatepairchange=a),a()}}catch(i){ye.w(Ue,"Error in logging selected ice candidate pair for ".concat(Se[e.role]," connection"),i)}})}},{key:"removeTrack",value:function(e){this.nativeConnection.removeTrack(e)}},{key:"setMaxBitrate",value:function(e,t){return $(this,null,b().mark(function n(){var r,i;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=this.getSenders().find(function(e){var n;return(null==(n=null==e?void 0:e.track)?void 0:n.id)===t.getTrackIDBeingSent()}))){n.next=8;break}return(i=r.getParameters()).encodings.length>0&&(i.encodings[0].maxBitrate=1e3*e),n.next=6,r.setParameters(i);case 6:n.next=9;break;case 8:ye.w(Ue,"no sender found to setMaxBitrate for track - ".concat(t.trackId,", sentTrackId - ").concat(t.getTrackIDBeingSent()));case 9:case"end":return n.stop()}},n,this)}))}},{key:"getStats",value:function(){return $(this,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.nativeConnection.getStats();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"close",value:function(){return $(this,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.nativeConnection.close();case 1:case"end":return e.stop()}},e,this)}))}},{key:"getReceivers",value:function(){return this.nativeConnection.getReceivers()}}]),e}(),Fe="renegotiation-callback-id",Be="ion-sfu",Ve=100,He=5,We=60,je=12e3,Ke=1e3,Je=5,qe="SUBSCRIBE_ICE_CONNECTION_CALLBACK_ID",Ye=6e4,Qe=1e3,ze=!1,Ze="https://event.100ms.live/v2/client/report",Xe="https://event-nonprod.100ms.live/v2/client/report",$e=100,et={DEVICE_CHANGE:"device-change",LOCAL_AUDIO_ENABLED:"local-audio-enabled",LOCAL_VIDEO_ENABLED:"local-video-enabled",STATS_UPDATE:"stats-update",RTC_STATS_UPDATE:"rtc-stats-update",TRACK_DEGRADED:"track-degraded",TRACK_RESTORED:"track-restored",TRACK_AUDIO_LEVEL_UPDATE:"track-audio-level-update",LOCAL_AUDIO_SILENCE:"local-audio-silence",ANALYTICS:"analytics",AUDIO_PLUGIN_FAILED:"audio-plugin-failed",POLICY_CHANGE:"policy-change",LOCAL_ROLE_UPDATE:"local-role-update",AUDIO_TRACK_UPDATE:"audio-track-update",AUDIO_TRACK_ADDED:"audio-track-added",AUDIO_TRACK_REMOVED:"audio-track-removed",AUTOPLAY_ERROR:"autoplay-error"},tt="HMSPublishConnection",nt=function(e){E(n,Ge);var t=S(n);function n(e,r,i,a){var s;return D(this,n),(s=t.call(this,Se.Publish,e)).observer=i,s.transport=a,s.nativeConnection=new RTCPeerConnection(r),s.nativeConnection.createDataChannel(Be,{protocol:"SCTP"}),s.nativeConnection.onicecandidate=function(t){var n=t.candidate;n&&e.trickle(s.role,n)},s.nativeConnection.oniceconnectionstatechange=function(){s.observer.onIceConnectionChange(s.nativeConnection.iceConnectionState)},s.nativeConnection.onconnectionstatechange=function(){s.observer.onConnectionStateChange(s.nativeConnection.connectionState)},s}return O(n,[{key:"initAfterJoin",value:function(){var e=this;this.nativeConnection.onnegotiationneeded=function(){return $(e,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return ye.d(tt,"onnegotiationneeded"),e.next=3,this.observer.onRenegotiationNeeded();case 3:case"end":return e.stop()}},e,this)}))}}},{key:"trackUpdate",value:function(e){this.transport.trackUpdate(e)}}]),n}(),rt=O(function e(t){D(this,e),this.tracks=new Array,this.nativeStream=t,this.id=t.id}),it=function(e){E(n,rt);var t=S(n);function n(e,r){var i;return D(this,n),(i=t.call(this,e)).audio=!0,i.video=ge.NONE,i.connection=r,i}return O(n,[{key:"setAudio",value:function(e){this.audio!==e&&(this.audio=e,this.syncWithApiChannel(!1))}},{key:"setVideoLayerLocally",value:function(e,t){this.video=e,ye.d("[Remote stream] ".concat(t," - ").concat(this.id),"Setting layer field to - ".concat(e))}},{key:"setVideoLayer",value:function(e,t){this.setVideoLayerLocally(e,t),ye.d("[Remote stream] ".concat(t," - ").concat(this.id),"Switching to ".concat(e," layer")),this.syncWithApiChannel()}},{key:"getSimulcastLayer",value:function(){return this.video}},{key:"isAudioSubscribed",value:function(){return this.audio}},{key:"syncWithApiChannel",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t={streamId:this.id,audio:this.audio};e&&(t.video=this.video,t.framerate=this.video),this.connection.sendOverApiDataChannel(JSON.stringify(t))}}]),n}(),at=function(){function e(t,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";D(this,e),this.TAG="HMSDataChannel",this.nativeChannel=t,this.observer=n,this.metadata=i,t.onmessage=function(e){r.observer.onMessage(e.data)}}return O(e,[{key:"id",get:function(){return this.nativeChannel.id}},{key:"label",get:function(){return this.nativeChannel.label}},{key:"readyState",get:function(){return this.nativeChannel.readyState}},{key:"send",value:function(e){ye.d(this.TAG,"[".concat(this.metadata,"] Sending [size=").concat(e.length,"] message=").concat(e)),this.nativeChannel.send(e)}},{key:"close",value:function(){this.nativeChannel.close()}}]),e}(),st=function(e){return e?"{\n    trackId: ".concat(e.id,";\n    kind: ").concat(e.kind,";\n    enabled: ").concat(e.enabled,";\n    muted: ").concat(e.muted,";\n    readyState: ").concat(e.readyState,";\n  }"):""},ot=function(){function e(t,n,r){D(this,e),this.logIdentifier="",this.stream=t,this.nativeTrack=n,this.source=r}return O(e,[{key:"enabled",get:function(){return this.nativeTrack.enabled}},{key:"trackId",get:function(){return this.firstTrackId||this.sdpTrackId||this.nativeTrack.id}},{key:"getMediaTrackSettings",value:function(){return this.nativeTrack.getSettings()}},{key:"setEnabled",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.nativeTrack.enabled=e;case 1:case"end":return t.stop()}},t,this)}))}},{key:"setSdpTrackId",value:function(e){this.sdpTrackId=e}},{key:"setFirstTrackId",value:function(e){this.firstTrackId=e}},{key:"cleanup",value:function(){var e;null==(e=this.nativeTrack)||e.stop()}},{key:"toString",value:function(){return"{\n      streamId: ".concat(this.stream.id,";\n      peerId: ").concat(this.peerId,";\n      trackId: ").concat(this.trackId,";\n      logIdentifier: ").concat(this.logIdentifier,";\n      source: ").concat(this.source,";\n      enabled: ").concat(this.enabled,";\n      nativeTrack: ").concat(st(this.nativeTrack),";\n    }")}}]),e}();exports.HMSTrack=ot,exports.HMSTrackType=Le,function(e){e.AUDIO="audio",e.VIDEO="video"}(Le||(exports.HMSTrackType=Le={}));var ct=function(e){E(n,ot);var t=S(n);function n(e,r,i){var a;if(D(this,n),(a=t.call(this,e,r,i)).type=Le.AUDIO,a.audioElement=null,"audio"!==r.kind)throw new Error("Expected 'track' kind = 'audio'");return a}return O(n,[{key:"getVolume",value:function(){return this.audioElement?100*this.audioElement.volume:null}},{key:"setVolume",value:function(e){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");this.subscribeToAudio(0!==e&&this.enabled),this.audioElement&&(this.audioElement.volume=e/100)}},{key:"setAudioElement",value:function(e){this.audioElement=e}},{key:"getAudioElement",value:function(){return this.audioElement}},{key:"getOutputDevice",value:function(){return this.outputDevice}},{key:"cleanup",value:function(){y(_(n.prototype),"cleanup",this).call(this),this.audioElement&&(this.audioElement.srcObject=null,this.audioElement.remove(),this.audioElement=null)}},{key:"setOutputDevice",value:function(e){return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.audioElement){t.next=3;break}return ye.d("audio-track","no audio element to set output"),t.abrupt("return");case 3:if(t.prev=3,t.t0="function"==typeof this.audioElement.setSinkId,!t.t0){t.next=9;break}return t.next=8,null==(n=this.audioElement)?void 0:n.setSinkId(e.deviceId);case 8:this.outputDevice=e;case 9:t.next=14;break;case 11:t.prev=11,t.t1=t.catch(3),ye.d("audio-track",t.t1);case 14:case"end":return t.stop()}},t,this,[[3,11]])}))}},{key:"removeSink",value:function(){var e;this.audioElement&&(null==(e=window.HMS)?void 0:e.AUDIO_SINK)&&(this.audioElement.srcObject=null,this.subscribeToAudio(!1))}},{key:"addSink",value:function(){var e,t;if(this.nativeTrack&&this.audioElement&&(null==(e=window.HMS)?void 0:e.AUDIO_SINK)){var n=this.audioElement.srcObject;n instanceof MediaStream&&(null==(t=n.getAudioTracks()[0])?void 0:t.id)===this.nativeTrack.id||(this.audioElement.srcObject=new MediaStream([this.nativeTrack]),this.subscribeToAudio(!0))}}},{key:"subscribeToAudio",value:function(e){this.stream instanceof it&&this.stream.setAudio(e)}}]),n}();exports.HMSAudioTrack=ct;var ut=function(e){E(n,ct);var t=S(n);function n(){return D(this,n),t.apply(this,arguments)}return O(n,[{key:"setEnabled",value:function(e){var t=this;return $(this,null,b().mark(function r(){return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=e!==this.enabled,!r.t0){r.next=5;break}return r.next=4,(i="setEnabled",y(_(n.prototype),i,t)).call(this,e);case 4:this.subscribeToAudio(e);case 5:case"end":return r.stop()}var i},r,this)}))}}]),n}();exports.HMSRemoteAudioTrack=ut;var lt=function(e){E(n,ot);var t=S(n);function n(e,r,i){var a;if(D(this,n),(a=t.call(this,e,r,i)).type=Le.VIDEO,a.sinkCount=0,"video"!==r.kind)throw new Error("Expected 'track' kind = 'video'");return a}return O(n,[{key:"hasSinks",value:function(){return this.sinkCount>0}},{key:"addSink",value:function(e){this.addSinkInternal(e,this.nativeTrack)}},{key:"removeSink",value:function(e){null!==e.srcObject&&(e.srcObject=null,this.sinkCount>0&&this.sinkCount--)}},{key:"addSinkInternal",value:function(e,t){var n,r=e.srcObject;null!==r&&r instanceof MediaStream&&(null==(n=r.getVideoTracks()[0])?void 0:n.id)===t.id||(e.srcObject=new MediaStream([t]),this.sinkCount++)}}]),n}();exports.HMSVideoTrack=lt;var dt=function(e){E(n,lt);var t=S(n);function n(){var e;return D(this,n),(e=t.apply(this,arguments))._degraded=!1,e._degradedAt=null,e._layerDefinitions=[],e.history=new ht,e}return O(n,[{key:"degraded",get:function(){return this._degraded}},{key:"degradedAt",get:function(){return this._degradedAt}},{key:"setEnabled",value:function(e){var t=this;return $(this,null,b().mark(function r(){return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=e!==this.enabled,!r.t0){r.next=4;break}return r.next=4,(i="setEnabled",y(_(n.prototype),i,t)).call(this,e);case 4:case"end":return r.stop()}var i},r,this)}))}},{key:"preferLayer",value:function(e){!this.shouldSendVideoLayer(e,"preferLayer")||(this.stream.setVideoLayer(e,this.logIdentifier),this.pushInHistory("uiPreferLayer-".concat(e)))}},{key:"getSimulcastLayer",value:function(){return this.stream.getSimulcastLayer()}},{key:"addSink",value:function(e){y(_(n.prototype),"addSink",this).call(this,e),this.updateLayer("addSink"),this.pushInHistory("uiSetLayer-high")}},{key:"removeSink",value:function(e){y(_(n.prototype),"removeSink",this).call(this,e),this.updateLayer("removeSink"),this._degraded=!1,this.pushInHistory("uiSetLayer-none")}},{key:"getSimulcastDefinitions",value:function(){return f(this._layerDefinitions)}},{key:"setSimulcastDefinitons",value:function(e){this._layerDefinitions=e}},{key:"setLayerFromServer",value:function(e,t){this._degraded=t,this._degradedAt=t?new Date:this._degradedAt,this.stream.setVideoLayerLocally(e,this.logIdentifier),this.pushInHistory("sfuLayerUpdate-".concat(e))}},{key:"setDegradedFromSdk",value:function(e){this._degraded=e,this._degradedAt=e?new Date:this._degradedAt,this.updateLayer("sdkDegradation"),this.pushInHistory(e?"sdkDegraded-none":"sdkRecovered-high")}},{key:"updateLayer",value:function(e){var t=this.degraded||!this.hasSinks()?ge.NONE:ge.HIGH;!this.shouldSendVideoLayer(t,e)||this.stream.setVideoLayer(t,this.logIdentifier)}},{key:"pushInHistory",value:function(e){ze&&this.history.push({name:e,layer:this.getSimulcastLayer(),degraded:this.degraded})}},{key:"shouldSendVideoLayer",value:function(e,t){var n=this.getSimulcastLayer();return!(!this.degraded||e!==ge.NONE)||(n!==e||(ye.d("[Remote Track] ".concat(this.logIdentifier),"Not sending update, already on layer ".concat(e,", source=").concat(t)),!1))}}]),n}(),ht=function(){function e(){D(this,e),this.history=[]}return O(e,[{key:"push",value:function(e){e.time=(new Date).toISOString().split("T")[1],this.history.push(e)}}]),e}();exports.HMSRemoteVideoTrack=dt;var vt,pt=function(e){E(n,Ge);var t=S(n);function n(e,r,i){var a;return D(this,n),(a=t.call(this,Se.Subscribe,e)).TAG="[HMSSubscribeConnection]",a.remoteStreams=new Map,a.pendingMessageQueue=[],a.handlePendingApiMessages=function(){a.pendingMessageQueue.length>0&&(ye.d(a.TAG,"Found pending message queue, sending messages"),a.pendingMessageQueue.forEach(function(e){return a.sendOverApiDataChannel(e)}),a.pendingMessageQueue.length=0)},a.observer=i,a.nativeConnection=new RTCPeerConnection(r),a.initNativeConnectionCallbacks(),a}return O(n,[{key:"initNativeConnectionCallbacks",value:function(){var e=this;this.nativeConnection.oniceconnectionstatechange=function(){e.observer.onIceConnectionChange(e.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=function(){e.observer.onConnectionStateChange(e.nativeConnection.connectionState)},this.nativeConnection.ondatachannel=function(t){t.channel.label===Be&&(e.apiChannel=new at(t.channel,{onMessage:function(t){e.observer.onApiChannelMessage(t)}},"role=".concat(e.role)),t.channel.onopen=e.handlePendingApiMessages)},this.nativeConnection.onicecandidate=function(t){null!==t.candidate&&e.signal.trickle(e.role,t.candidate)},this.nativeConnection.ontrack=function(t){var n,r=t.streams[0],i=r.id;if(!e.remoteStreams.has(i)){var a=new it(r,e);e.remoteStreams.set(i,a),r.onremovetrack=function(t){var n=a.tracks.findIndex(function(e){return e.nativeTrack.id===t.track.id});if(n>=0){var r=a.tracks[n];e.observer.onTrackRemove(r),a.tracks.splice(n,1),0===a.tracks.length&&e.remoteStreams.delete(i)}}}var s=e.remoteStreams.get(i),o=new("audio"===t.track.kind?ut:dt)(s,t.track),c=Oe(e.remoteDescription,null==(n=t.transceiver)?void 0:n.mid);c&&o.setSdpTrackId(c),s.tracks.push(o),e.observer.onTrackAdd(o)}}},{key:"sendOverApiDataChannel",value:function(e){this.apiChannel&&"open"===this.apiChannel.readyState?this.apiChannel.send(e):(ye.w(this.TAG,"API Data channel not ".concat(this.apiChannel?"open":"present",", queueing"),e),this.pendingMessageQueue.push(e))}},{key:"close",value:function(){var e=this;return $(this,null,b().mark(function t(){var r;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(i="close",y(_(n.prototype),i,e)).call(this);case 2:null==(r=this.apiChannel)||r.close();case 3:case"end":return t.stop()}var i},t,this)}))}}]),n}(),ft="InitService",kt=function(){function e(){D(this,e)}return O(e,null,[{key:"handleError",value:function(e,t){switch(e.status){case 404:throw Pe.InitAPIErrors.EndpointUnreachable(Ae.INIT,t.message||e.statusText);case 200:break;default:throw Pe.InitAPIErrors.ServerErrors(t.code||e.status,Ae.INIT,t.message||(null==e?void 0:e.statusText))}}},{key:"fetchInitConfig",value:function(e){return $(this,arguments,function(e){var t=this,n=e.token,r=e.peerId,i=e.userAgent,a=e.initEndpoint,s=void 0===a?"https://prod-init.100ms.live":a,o=e.region,c=void 0===o?"":o;return b().mark(function e(){var a,o,u,l;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return ye.d(ft,"fetchInitConfig: initEndpoint=".concat(s," token=").concat(n," peerId=").concat(r," region=").concat(c," ")),a=gt(s,r,i,c),e.prev=2,e.next=5,fetch(a,{headers:{Authorization:"Bearer ".concat(n)}});case 5:return o=e.sent,e.next=8,o.json();case 8:return u=e.sent,e.abrupt("return",(t.handleError(o,u),ye.d(ft,"config is ".concat(JSON.stringify(u,null,2))),mt(u)));case 12:throw e.prev=12,e.t0=e.catch(2),l=e.t0,["Failed to fetch","NetworkError"].some(function(e){return l.message.includes(e)})?Pe.InitAPIErrors.EndpointUnreachable(Ae.INIT,l.message):l;case 16:case"end":return e.stop()}},e,null,[[2,12]])})()})}}]),e}();function gt(e,t,n,r){try{var i=new URL("/init",e);return r&&r.trim().length>0&&i.searchParams.set("region",r.trim()),i.searchParams.set("peer_id",t),i.searchParams.set("user_agent_v2",n),i.toString()}catch(i){var a=i;throw ye.e(ft,a.name,a.message),a}}function mt(e){var t;return z(Q({},e),{rtcConfiguration:z(Q({},e.rtcConfiguration),{iceServers:null==(t=e.rtcConfiguration)?void 0:t.ice_servers})})}function yt(e){switch(e){case vt.JOIN:return Ae.JOIN;case vt.OFFER:return Ae.PUBLISH;case vt.ANSWER:return Ae.SUBSCRIBE;case vt.TRACK_UPDATE:return Ae.TRACK;default:return Ae.NONE}}!function(e){e.JOIN="join",e.OFFER="offer",e.ANSWER="answer",e.TRICKLE="trickle",e.TRACK_UPDATE="track-update",e.BROADCAST="broadcast",e.ANALYTICS="analytics",e.SERVER_ERROR="on-error",e.SERVER_WARNING="on-warning",e.SDK_NOTIFICATION="sdk-notification",e.LEAVE="leave",e.END_ROOM="end-room",e.PING="ping",e.ROLE_CHANGE_REQUEST="role-change-request",e.ROLE_CHANGE="role-change",e.TRACK_UPDATE_REQUEST="track-update-request",e.PEER_LEAVE_REQUEST="peer-leave-request",e.CHANGE_TRACK_MUTE_STATE_REQUEST="change-track-mute-state-request",e.START_RTMP_OR_RECORDING_REQUEST="rtmp-start",e.STOP_RTMP_AND_RECORDING_REQUEST="rtmp-stop",e.UPDATE_PEER_METADATA="peer-update",e.START_HLS_STREAMING="hls-start",e.STOP_HLS_STREAMING="hls-stop",e.HLS_TIMED_METADATA="hls-timed-metadata",e.SET_METADATA="set-metadata",e.GET_METADATA="get-metadata"}(vt||(vt={}));var Tt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0;D(this,e),this.capacity=t,this.storage=[]}return O(e,[{key:"size",value:function(){return this.storage.length}},{key:"toList",value:function(){return this.storage.slice(0)}},{key:"enqueue",value:function(e){this.size()===this.capacity&&this.dequeue(),this.storage.push(e)}},{key:"dequeue",value:function(){return this.storage.shift()}},{key:"aggregate",value:function(e){return e(this.storage)}}]),e}();function bt(e){if(e<0)throw Error("`ms` should be a positive integer");return new Promise(function(t){return setTimeout(t,e)})}var Et,St=function(){function e(t){var n=this;D(this,e),this.TAG="[SIGNAL]: ",this.pongResponseTimes=new Tt(Je),this.isJoinCompleted=!1,this.pendingTrickle=[],this.socket=null,this.callbacks=new Map,this._isConnected=!1,this.id=0,this.onCloseHandler=function(){},this.offlineListener=function(){ye.d(n.TAG,"Window network offline"),n.setIsConnected(!1,"Window network offline")},this.onlineListener=function(){ye.d(n.TAG,"Window network online"),n.observer.onNetworkOnline()},this.observer=t,window.addEventListener("offline",this.offlineListener),window.addEventListener("online",this.onlineListener),this.onMessageHandler=this.onMessageHandler.bind(this)}return O(e,[{key:"isConnected",get:function(){return this._isConnected}},{key:"setIsConnected",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";ye.d(this.TAG,"isConnected set id: ".concat(this.id,", oldValue: ").concat(this._isConnected,", newValue: ").concat(e)),this._isConnected!==e&&(this._isConnected&&!e?(this._isConnected=e,this.observer.onOffline(t)):!this._isConnected&&e&&(this._isConnected=e,this.observer.onOnline()))}},{key:"getPongResponseTimes",value:function(){return this.pongResponseTimes.toList()}},{key:"internalCall",value:function(e,t){return $(this,null,b().mark(function n(){var r,i,s,o,c=this;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=(0,a.v4)(),s={method:e,params:t,id:i,jsonrpc:"2.0"},null==(r=this.socket)||r.send(JSON.stringify(s)),n.prev=2,n.next=5,new Promise(function(e,t){c.callbacks.set(i,{resolve:e,reject:t})});case 5:return n.abrupt("return",n.sent);case 8:throw n.prev=8,n.t0=n.catch(2),o=n.t0,Pe.WebsocketMethodErrors.ServerErrors(Number(o.code),yt(e),o.message);case 12:case"end":return n.stop()}},n,this,[[2,8]])}))}},{key:"notify",value:function(e,t){var n,r={method:e,params:t};null==(n=this.socket)||n.send(JSON.stringify(r))}},{key:"open",value:function(e){var t=this;return new Promise(function(n,r){var i=!1;t.socket&&(t.socket.close(),t.socket.removeEventListener("close",t.onCloseHandler),t.socket.removeEventListener("message",t.onMessageHandler)),t.socket=new WebSocket(e);var a=function(e){ye.e(t.TAG,"Error from websocket",e),i=!0,r(Pe.WebSocketConnectionErrors.FailedToConnect(Ae.JOIN,"Error opening websocket connection - ".concat(e)))};t.onCloseHandler=function(e){ye.e("Websocket closed code=".concat(e.code)),i?t.setIsConnected(!1,"code: ".concat(e.code).concat(1e3!==e.code?", unexpected websocket close":"")):(i=!0,r(Pe.WebSocketConnectionErrors.AbnormalClose(Ae.JOIN,"Error opening websocket connection - websocket closed unexpectedly with code=".concat(e.code))))},t.socket.addEventListener("error",a);t.socket.addEventListener("open",function e(){var r,s;i=!0,n(),t.setIsConnected(!0),t.id++,null==(r=t.socket)||r.removeEventListener("open",e),null==(s=t.socket)||s.removeEventListener("error",a),t.pingPongLoop(t.id)}),t.socket.addEventListener("close",t.onCloseHandler),t.socket.addEventListener("message",t.onMessageHandler)})}},{key:"close",value:function(){return $(this,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:window.removeEventListener("offline",this.offlineListener),window.removeEventListener("online",this.onlineListener),this.socket?(this.socket.close(1e3,"Normal Close"),this.setIsConnected(!1,"code: 1000, normal websocket close"),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)):this.setIsConnected(!1,"websocket not connected yet");case 1:case"end":return e.stop()}},e,this)}))}},{key:"join",value:function(e,t,n,r,i){return $(this,null,b().mark(function a(){var s,o,c=this;return b().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this.isConnected){a.next=2;break}throw Pe.WebSocketConnectionErrors.WebSocketConnectionLost(Ae.JOIN,"Failed to send join over WS connection");case 2:return s={name:e,disableVidAutoSub:n,data:t,offer:i,server_sub_degrade:r},a.next=5,this.internalCall(vt.JOIN,s);case 5:return o=a.sent,a.abrupt("return",(this.isJoinCompleted=!0,this.pendingTrickle.forEach(function(e){var t=e.target,n=e.candidate;return c.trickle(t,n)}),this.pendingTrickle.length=0,ye.d(this.TAG,"join: response=".concat(JSON.stringify(o,null,1))),o));case 7:case"end":return a.stop()}},a,this)}))}},{key:"trickle",value:function(e,t){this.isJoinCompleted?this.notify(vt.TRICKLE,{target:e,candidate:t}):this.pendingTrickle.push({target:e,candidate:t})}},{key:"offer",value:function(e,t){return $(this,null,b().mark(function n(){return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.call(vt.OFFER,{desc:e,tracks:Object.fromEntries(t)});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"answer",value:function(e){this.notify(vt.ANSWER,{desc:e})}},{key:"trackUpdate",value:function(e){this.notify(vt.TRACK_UPDATE,{version:"1.0",tracks:Object.fromEntries(e)})}},{key:"broadcast",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(vt.BROADCAST,Q({version:"1.0"},e.toSignalParams()));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"leave",value:function(){this.notify(vt.LEAVE,{version:"1.0"})}},{key:"endRoom",value:function(e,t){return $(this,null,b().mark(function n(){return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.call(vt.END_ROOM,{lock:e,reason:t});case 2:case"end":return n.stop()}},n,this)}))}},{key:"sendEvent",value:function(e){if(!this.isConnected)throw Error("".concat(this.TAG," not connected. Could not send event ").concat(e));this.notify(vt.ANALYTICS,e.toSignalParams())}},{key:"ping",value:function(e){var t=Date.now(),n=new Promise(function(n){setTimeout(function(){n(Date.now()-t)},e+1)}),r=this.internalCall(vt.PING,{timestamp:t}).then(function(){return Date.now()-t}).catch(function(){return Date.now()-t});return Promise.race([n,r])}},{key:"requestRoleChange",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(vt.ROLE_CHANGE_REQUEST,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"acceptRoleChangeRequest",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(vt.ROLE_CHANGE,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"requestTrackStateChange",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(vt.TRACK_UPDATE_REQUEST,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"requestMultiTrackStateChange",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(vt.CHANGE_TRACK_MUTE_STATE_REQUEST,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"removePeer",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(vt.PEER_LEAVE_REQUEST,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"startRTMPOrRecording",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(vt.START_RTMP_OR_RECORDING_REQUEST,Q({version:"1.0"},e));case 2:case"end":return t.stop()}},t,this)}))}},{key:"stopRTMPAndRecording",value:function(){return $(this,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.call(vt.STOP_RTMP_AND_RECORDING_REQUEST,{version:"1.0"});case 2:case"end":return e.stop()}},e,this)}))}},{key:"startHLSStreaming",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(vt.START_HLS_STREAMING,Q({version:"1.0"},e));case 2:case"end":return t.stop()}},t,this)}))}},{key:"stopHLSStreaming",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(vt.STOP_HLS_STREAMING,Q({version:"1.0"},e));case 2:case"end":return t.stop()}},t,this)}))}},{key:"sendHLSTimedMetadata",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(vt.HLS_TIMED_METADATA,Q({version:"1.0"},e));case 2:case"end":return t.stop()}},t,this)}))}},{key:"updatePeer",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(vt.UPDATE_PEER_METADATA,Q({version:"1.0"},e));case 2:case"end":return t.stop()}},t,this)}))}},{key:"setSessionMetadata",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(vt.SET_METADATA,Q({version:"1.0"},e));case 2:case"end":return t.stop()}},t,this)}))}},{key:"getSessionMetadata",value:function(){return this.call(vt.GET_METADATA,{version:"1.0"})}},{key:"onMessageHandler",value:function(e){var t=e.data,n=JSON.parse(t);if(n.id)this.handleResponseWithId(n);else{if(!n.method)throw Error("WebSocket message has no 'method' or 'id' field, message=".concat(n));this.handleResponseWithMethod(n)}}},{key:"handleResponseWithId",value:function(e){var t=e,n=t.id;if(this.callbacks.has(n)){var r=this.callbacks.get(n);this.callbacks.delete(n),t.result?r.resolve(t.result):r.reject(t.error)}else this.observer.onNotification(t)}},{key:"handleResponseWithMethod",value:function(e){switch(e.method){case vt.OFFER:this.observer.onOffer(e.params);break;case vt.TRICKLE:this.observer.onTrickle(e.params);break;case vt.SERVER_ERROR:this.observer.onServerError(Pe.WebsocketMethodErrors.ServerErrors(Number(e.params.code),Ae.NONE,e.params.message));break;case vt.SERVER_WARNING:ye.w(this.TAG,e.params);break;default:this.observer.onNotification(e)}}},{key:"pingPongLoop",value:function(e){return $(this,null,b().mark(function t(){var n,r,i,a,s=this;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=(null==(n=window.HMS)?void 0:n.PING_TIMEOUT)||je,!this.isConnected){t.next=6;break}return t.next=4,this.ping(i);case 4:a=t.sent,this.pongResponseTimes.enqueue(a),a>i?(ye.d(this.TAG,"Pong timeout ".concat(e,", pageHidden=").concat(ue())),this.id===e&&this.setIsConnected(!1,"ping pong failure")):setTimeout(function(){return s.pingPongLoop(e)},(null==(r=window.HMS)?void 0:r.PING_INTERVAL)||Ke);case 6:case"end":return t.stop()}},t,this)}))}},{key:"call",value:function(e,t){return $(this,null,b().mark(function n(){var r,i,a,s;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:r=3,i=Pe.WebsocketMethodErrors.ServerErrors(500,e,"Default ".concat(e," error")),a=0;case 2:if(!(a<r)){n.next=20;break}return n.prev=3,ye.d(this.TAG,"Try number ".concat(a+1," sending ").concat(e),t),n.next=7,this.internalCall(e,t);case 7:return n.abrupt("return",n.sent);case 10:if(n.prev=10,n.t0=n.catch(3),i=n.t0,ye.e(this.TAG,"Failed sending ".concat(e),{method:e,try:a+1,params:t,error:i}),5===parseInt("".concat(i.code/100))||429===i.code){n.next=14;break}return n.abrupt("break",20);case 14:return s=1e3*(2+2*Math.random()),n.next=17,bt(s);case 17:a++,n.next=2;break;case 20:throw ye.e("Sending ".concat(e," over WS failed after ").concat(r," retries"),{method:e,params:t,error:i}),i;case 21:case"end":return n.stop()}},n,this,[[3,10]])}))}}]),e}(),wt=function(){function e(){D(this,e),this._volume=1,this._codec=be.OPUS,this._maxBitrate=32,this._deviceId="default",this._advanced=[{googEchoCancellation:{exact:!0}},{googExperimentalEchoCancellation:{exact:!0}},{autoGainControl:{exact:!0}},{noiseSuppression:{exact:!0}},{googHighpassFilter:{exact:!0}},{googAudioMirroring:{exact:!0}}]}return O(e,[{key:"volume",value:function(e){if(!(0<=e&&e<=1))throw Error("volume can only be in range [0.0, 1.0]");return this._volume=e,this}},{key:"codec",value:function(e){return this._codec=e,this}},{key:"maxBitrate",value:function(e){if(e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,this}},{key:"deviceId",value:function(e){return this._deviceId=e,this}},{key:"advanced",value:function(e){return this._advanced=e,this}},{key:"build",value:function(){return new At(this._volume,this._codec,this._maxBitrate,this._deviceId,this._advanced)}}]),e}(),At=function(){function e(t,n,r,i,a){D(this,e),this.volume=t,this.codec=n,this.maxBitrate=r,this.deviceId=i,this.advanced=a}return O(e,[{key:"toConstraints",value:function(){return{deviceId:this.deviceId,advanced:this.advanced}}},{key:"toAnalyticsProperties",value:function(){return{audio_bitrate:this.maxBitrate,audio_codec:this.codec}}}]),e}(),xt=function(){function e(){D(this,e),this._width=320,this._height=180,this._codec=Te.VP8,this._maxFramerate=30,this._maxBitrate=150,this._advanced=[]}return O(e,[{key:"setWidth",value:function(e){return this._width=e,this}},{key:"setHeight",value:function(e){return this._height=e,this}},{key:"codec",value:function(e){return this._codec=e,this}},{key:"maxFramerate",value:function(e){if(e&&e<=0)throw Error("maxFramerate should be >= 1");return this._maxFramerate=e,this}},{key:"maxBitrate",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("number"==typeof e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,!this._maxBitrate&&t&&(this._maxBitrate=15e4),this}},{key:"deviceId",value:function(e){return this._deviceId=e,this}},{key:"advanced",value:function(e){return this._advanced=e,this}},{key:"build",value:function(){return new It(this._width,this._height,this._codec,this._maxFramerate,this._deviceId,this._advanced,this._maxBitrate)}}]),e}(),It=function(){function e(t,n,r,i,a,s,o){D(this,e),this.width=t,this.height=n,this.codec=r,this.maxFramerate=i,this.maxBitrate=o,this.deviceId=a,this.advanced=s}return O(e,[{key:"toConstraints",value:function(){return{width:this.width,height:this.height,frameRate:this.maxFramerate,deviceId:this.deviceId}}},{key:"toAnalyticsProperties",value:function(){return{width:this.width,height:this.height,video_bitrate:this.maxBitrate,framerate:this.maxFramerate,video_codec:this.codec}}}]),e}(),Pt=function(){function e(){D(this,e),this._video=(new xt).build(),this._audio=(new wt).build(),this._screen=(new xt).build(),this._simulcast=!1}return O(e,[{key:"video",value:function(e){return this._video=e,this}},{key:"audio",value:function(e){return this._audio=e,this}},{key:"screen",value:function(e){return this._screen=e,this}},{key:"simulcast",value:function(e){return this._simulcast=e,this}},{key:"build",value:function(){if(null===this._audio&&null===this._video)throw Pe.TracksErrors.NothingToReturn(Ae.TRACK);if(null===this._video&&this._simulcast)throw Pe.TracksErrors.InvalidVideoSettings(Ae.TRACK,"Cannot enable simulcast when no video settings are provided");return new Ct(this._video,this._audio,this._simulcast,this._screen||void 0)}}]),e}(),Ct=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;D(this,e),this.video=t,this.audio=n,this.simulcast=r,this.screen=i}return O(e,[{key:"toAnalyticsProperties",value:function(){var e={audio_enabled:null!==this.audio,video_enabled:null!==this.video};return this.audio&&(e=Q(Q({},this.audio.toAnalyticsProperties()),e)),this.video&&(e=Q(Q({},this.video.toAnalyticsProperties()),e)),e}}]),e}();!function(e){e.ROOM_STATE="room-state",e.PEER_JOIN="on-peer-join",e.PEER_LEAVE="on-peer-leave",e.PEER_LIST="peer-list",e.TRACK_METADATA_ADD="on-track-add",e.TRACK_UPDATE="on-track-update",e.CHANGE_TRACK_MUTE_STATE_UPDATE="on-change-track-mute-state-request",e.ACTIVE_SPEAKERS="active-speakers",e.CONNECTION_QUALITY="on-connection-quality-update",e.SFU_STATS="sfu-stats",e.ON_SFU_TRACK_LAYER_UPDATE="on-track-layer-update",e.BROADCAST="on-broadcast",e.ROLE_CHANGE="on-role-change",e.POLICY_CHANGE="on-policy-change",e.ROLE_CHANGE_REQUEST="on-role-change-request",e.TRACK_UPDATE_REQUEST="on-track-update-request",e.PEER_UPDATE="on-peer-update",e.PEER_LEAVE_REQUEST="on-peer-leave-request",e.UNSUPPORTED="unsupported",e.RTMP_START="on-rtmp-start",e.RTMP_STOP="on-rtmp-stop",e.RECORDING_START="on-record-start",e.RECORDING_STOP="on-record-stop",e.HLS_START="on-hls-start",e.HLS_STOP="on-hls-stop"}(Et||(Et={}));var Rt=function(){function e(t,n,r){D(this,e),this.store=t,this.listener=n,this.audioListener=r}return O(e,[{key:"handleActiveSpeakers",value:function(e){var t,n,r,i=this,a=e["speaker-list"],s=a.map(function(e){return{audioLevel:e.level,peer:i.store.getPeerById(e.peer_id),track:i.store.getTrackById(e.track_id)}});null==(t=this.audioListener)||t.onAudioLevelUpdate(s),this.store.updateSpeakers(s);var o=a[0];if(o){var c=this.store.getPeerById(o.peer_id);null==(n=this.listener)||n.onPeerUpdate(pe.BECAME_DOMINANT_SPEAKER,c)}else null==(r=this.listener)||r.onPeerUpdate(pe.RESIGNED_DOMINANT_SPEAKER,null)}}]),e}(),_t=function(){function e(t){var n=t.sender,r=t.message,i=t.type,a=void 0===i?"chat":i,s=t.recipientPeer,o=t.recipientRoles,c=t.time;D(this,e),this.sender=n,this.message=r,this.type=a,this.recipientPeer=s,this.recipientRoles=o,this.time=c}return O(e,[{key:"toSignalParams",value:function(){var e,t,n=null==(e=this.recipientRoles)?void 0:e.map(function(e){return e.name}),r=null==(t=this.recipientPeer)?void 0:t.peerId,i={info:{message:this.message,type:this.type}};return(null==n?void 0:n.length)&&(i.roles=n),r&&(i.peer_id=r),i}},{key:"toString",value:function(){var e;return"{\n      sender: ".concat(this.sender,";\n      recipientPeer: ").concat(this.recipientPeer,";\n      recipientRoles: ").concat(null==(e=this.recipientRoles)?void 0:e.map(function(e){return e.name}),";\n      message: ").concat(this.message,";\n      time: ").concat(this.time,";\n      type: ").concat(this.type,";\n    }")}}]),e}(),Dt=function(){function e(t){var n=t.peerId,r=t.name,i=t.isLocal,a=t.customerUserId,s=t.metadata,o=t.role,c=t.joinedAt;D(this,e),this.customerUserId="",this.metadata="",this.auxiliaryTracks=[],this.name=r,this.peerId=n,this.isLocal=i,this.customerUserId=a,this.metadata=s,this.joinedAt=c,o&&(this.role=o)}return O(e,[{key:"updateRole",value:function(e){this.role=e}},{key:"updateName",value:function(e){this.name=e}},{key:"updateMetadata",value:function(e){this.metadata=e}},{key:"toString",value:function(){var e;return"{\n      name: ".concat(this.name,";\n      role: ").concat(null==(e=this.role)?void 0:e.name,";\n      peerId: ").concat(this.peerId,";\n      customerUserId: ").concat(this.customerUserId,";\n    }")}}]),e}(),Nt=O(function e(){D(this,e)});Nt.makePeerId=function(){return(0,a.v4)()};var Ot,Mt=function(e){E(n,Dt);var t=S(n);function n(e){var r;return D(this,n),(r=t.call(this,z(Q({},e),{peerId:Nt.makePeerId(),isLocal:!0}))).isLocal=!0,r.auxiliaryTracks=[],r}return O(n)}(),Lt=function(e){E(n,Dt);var t=S(n);function n(e){var r;return D(this,n),(r=t.call(this,z(Q({},e),{isLocal:!1}))).isLocal=!1,r.auxiliaryTracks=[],r.fromRoomState=!1,r.fromRoomState=!!e.fromRoomState,r}return O(n)}(),Ut=function(){function e(t,n){D(this,e),this.store=t,this.listener=n}return O(e,[{key:"TAG",get:function(){return"[".concat(this.constructor.name,"]")}},{key:"handleNotification",value:function(e,t){e===Et.BROADCAST&&this.handleBroadcast(t)}},{key:"handleBroadcast",value:function(e){var t,n=e.peer,r=e.info,i=e.roles,a=this.getSender(n),s=e.private?this.store.getLocalPeer():void 0,o=[];if(null==i?void 0:i.length){var c,u=this.store.getKnownRoles(),l=U(i);try{for(l.s();!(c=l.n()).done;){var d=c.value;u[d]&&o.push(u[d])}}catch(v){l.e(v)}finally{l.f()}}var h=new _t(z(Q({},r),{sender:a,recipientRoles:o,recipientPeer:s,time:new Date(e.timestamp)}));ye.d(this.TAG,"Received Message from sender=".concat(null==n?void 0:n.peer_id,": ").concat(h)),null==(t=this.listener)||t.onMessageReceived(h)}},{key:"getSender",value:function(e){var t=e?this.store.getPeerById(e.peer_id):void 0;return!t&&e&&(t=new Dt({peerId:e.peer_id,name:e.info.name,isLocal:!1,customerUserId:e.info.user_id,metadata:e.info.data})),t}}]),e}(),Gt=function(){function e(t,n,r,i){var a=this;D(this,e),this.store=t,this.peerManager=n,this.trackManager=r,this.listener=i,this.handleInitialPeerList=function(e){var t=Object.values(e.peers);a.peerManager.handlePeerList(t)},this.handleReconnectPeerList=function(e){a.handleRepeatedPeerList(e.peers)},this.handlePreviewRoomState=function(e){if(a.store.hasRoleDetailsArrived()){var t=e.peers;null!=t?(Object.keys(t).forEach(function(e){t[e].tracks={},t[e].is_from_room_state=!0}),a.handleRepeatedPeerList(t)):0===e.peer_count&&a.handleRepeatedPeerList({})}},this.handleRepeatedPeerList=function(e){var t=a.store.getRemotePeers(),n=Object.values(e),r=t.filter(function(t){return!e[t.peerId]});ye.d(a.TAG,"".concat(r)),r.forEach(function(e){var t,n={peer_id:e.peerId,role:(null==(t=e.role)?void 0:t.name)||"",info:{name:e.name,data:e.metadata||"",user_id:e.customerUserId||""},tracks:{}};a.peerManager.handlePeerLeave(n)}),n.forEach(function(e){var t=a.store.getPeerById(e.peer_id),n=Object.values(e.tracks);t?(a.store.getPeerTracks(t.peerId).forEach(function(n){var r;e.tracks[n.trackId]||(a.removePeerTrack(t,n.trackId),null==(r=a.listener)||r.onTrackUpdate(fe.TRACK_REMOVED,n,t))}),n.forEach(function(e){a.store.getTrackById(e.track_id)||a.store.setTrackState({peerId:t.peerId,trackInfo:e})}),a.trackManager.handleTrackUpdate({peer:{info:e.info,peer_id:e.peer_id},tracks:e.tracks}),a.peerManager.handlePeerUpdate(e)):a.peerManager.handlePeerJoin(e)})}}return O(e,[{key:"TAG",get:function(){return"[".concat(this.constructor.name,"]")}},{key:"handleNotification",value:function(e,t,n){if(e===Et.PEER_LIST){var r=t;n?(ye.d(this.TAG,"RECONNECT_PEER_LIST event",JSON.stringify(r,null,2)),this.handleReconnectPeerList(r)):(ye.d(this.TAG,"PEER_LIST event",JSON.stringify(r,null,2)),this.handleInitialPeerList(r))}else if(e===Et.ROOM_STATE){var i=t;this.handlePreviewRoomState(i)}}},{key:"removePeerTrack",value:function(e,t){var n,r;if((null==(n=e.audioTrack)?void 0:n.trackId)===t)e.audioTrack=void 0;else if((null==(r=e.videoTrack)?void 0:r.trackId)===t)e.videoTrack=void 0;else{var i=e.auxiliaryTracks.findIndex(function(e){return e.trackId===t});i>=0&&e.auxiliaryTracks.splice(i,1)}}}]),e}(),Ft=function(e){return e?new Date(e):void 0},Bt=function(){function e(t,n,r){var i=this;D(this,e),this.store=t,this.trackManager=n,this.listener=r,this.handlePeerList=function(e){var t,n;if(0!==e.length){var r=[],a=new Set(e.map(function(e){return e.peer_id}));i.store.getRemotePeers().forEach(function(e){var t=e.peerId,n=e.fromRoomState;!a.has(t)&&n&&i.store.removePeer(t)});var s,o=U(e);try{for(o.s();!(s=o.n()).done;){var c=s.value;r.push(i.makePeer(c))}}catch(u){o.e(u)}finally{o.f()}null==(n=i.listener)||n.onPeerUpdate(pe.PEER_LIST,r),i.trackManager.processPendingTracks()}else null==(t=i.listener)||t.onPeerUpdate(pe.PEER_LIST,[])},this.handlePeerJoin=function(e){var t,n=i.makePeer(e);null==(t=i.listener)||t.onPeerUpdate(pe.PEER_JOINED,n),i.trackManager.processPendingTracks()},this.handlePeerLeave=function(e){var t,n,r,a,s=i.store.getPeerById(e.peer_id);i.store.removePeer(e.peer_id),ye.d(i.TAG,"PEER_LEAVE",e.peer_id,"remainingPeers=".concat(i.store.getPeers().length)),s&&(s.audioTrack&&(null==(t=i.listener)||t.onTrackUpdate(fe.TRACK_REMOVED,s.audioTrack,s)),s.videoTrack&&(null==(n=i.listener)||n.onTrackUpdate(fe.TRACK_REMOVED,s.videoTrack,s)),null==(r=s.auxiliaryTracks)||r.forEach(function(e){var t;null==(t=i.listener)||t.onTrackUpdate(fe.TRACK_REMOVED,e,s)}),null==(a=i.listener)||a.onPeerUpdate(pe.PEER_LEFT,s))}}return O(e,[{key:"TAG",get:function(){return"[".concat(this.constructor.name,"]")}},{key:"handleNotification",value:function(e,t){switch(e){case Et.PEER_JOIN:var n=t;this.handlePeerJoin(n);break;case Et.PEER_LEAVE:var r=t;this.handlePeerLeave(r);break;case Et.PEER_UPDATE:this.handlePeerUpdate(t)}}},{key:"handlePeerUpdate",value:function(e){var t,n=this.store.getPeerById(e.peer_id);if(n){if(n.role&&n.role.name!==e.role){var r=this.store.getPolicyForRole(e.role);n.updateRole(r),null==(t=this.listener)||t.onPeerUpdate(pe.ROLE_UPDATED,n)}this.handlePeerInfoUpdate(Q({peer:n},e.info))}}},{key:"handlePeerInfoUpdate",value:function(e){var t,n,r=e.peer,i=e.name,a=e.data;!r||(i&&r.name!==i&&(r.updateName(i),null==(t=this.listener)||t.onPeerUpdate(pe.NAME_UPDATED,r)),a&&r.metadata!==a&&(r.updateMetadata(a),null==(n=this.listener)||n.onPeerUpdate(pe.METADATA_UPDATED,r)))}},{key:"makePeer",value:function(e){var t=new Lt({peerId:e.peer_id,name:e.info.name,customerUserId:e.info.user_id,metadata:e.info.data,role:this.store.getPolicyForRole(e.role),joinedAt:Ft(e.joined_at),fromRoomState:!!e.is_from_room_state});for(var n in this.store.addPeer(t),ye.d(this.TAG,"adding to the peerList",t.toString()),e.tracks)this.store.setTrackState({peerId:e.peer_id,trackInfo:e.tracks[n]});return t}}]),e}(),Vt=function(){function e(t,n){D(this,e),this.store=t,this.eventBus=n}return O(e,[{key:"handlePolicyChange",value:function(e){var t,n=this.store.getLocalPeer();if(n&&!n.role){var r=e.known_roles[e.name];n.updateRole(r)}this.store.setKnownRoles(e.known_roles),this.store.getRoom().templateId=e.template_id;var i=null==(t=e.known_roles[e.name])?void 0:t.publishParams;if(this.store.setPublishParams(i),this.setSimulcastLayers(i),(null==n?void 0:n.role)&&n.role.name!==e.name){var a=this.store.getPolicyForRole(e.name),s=n.role;n.updateRole(a),this.eventBus.localRoleUpdate.publish({oldRole:s,newRole:a})}this.eventBus.policyChange.publish(e)}},{key:"setSimulcastLayers",value:function(e){if(e&&Object.keys(e).length>0){var t=e.videoSimulcastLayers,n=e.screenSimulcastLayers;this.store.setVideoSimulcastLayers(t),this.store.setScreenshareSimulcastLayers(n)}}}]),e}(),Ht=function(){function e(t,n){D(this,e),this.store=t,this.listener=n}return O(e,[{key:"handleNotification",value:function(e,t){switch(e){case Et.ROLE_CHANGE_REQUEST:this.handleRoleChangeRequest(t);break;case Et.TRACK_UPDATE_REQUEST:this.handleTrackUpdateRequest(t);break;case Et.CHANGE_TRACK_MUTE_STATE_UPDATE:this.handleChangeTrackStateRequest(t);break;default:return}}},{key:"handleRoleChangeRequest",value:function(e){var t,n={requestedBy:e.requested_by?this.store.getPeerById(e.requested_by):void 0,role:this.store.getPolicyForRole(e.role),token:e.token};null==(t=this.listener)||t.onRoleChangeRequest(n)}},{key:"handleTrackUpdateRequest",value:function(e){var t=this,n=e.requested_by,r=e.track_id,i=e.mute,a=n?this.store.getPeerById(n):void 0,s=this.store.getLocalPeerTracks().find(function(e){return e.publishedTrackId===r});if(s){var o=function(){var e;null==(e=t.listener)||e.onChangeTrackStateRequest({requestedBy:a,track:s,enabled:!i})};if(i){if(s.enabled===!i)return;s.setEnabled(!i).then(o)}else o()}}},{key:"handleChangeTrackStateRequest",value:function(e){var t,n=this,r=e.type,i=e.source,a=e.value,s=e.requested_by,o=s?this.store.getPeerById(s):void 0,c=!a,u=this.getTracksToBeUpdated({type:r,source:i,enabled:c});if(0!==u.length)if(c)null==(t=this.listener)||t.onChangeMultiTrackStateRequest({requestedBy:o,tracks:u,type:r,source:i,enabled:!0});else{var l,d=[],h=U(u);try{for(h.s();!(l=h.n()).done;){var v=l.value;d.push(v.setEnabled(!1))}}catch(p){h.e(p)}finally{h.f()}Promise.all(d).then(function(){var e;null==(e=n.listener)||e.onChangeMultiTrackStateRequest({requestedBy:o,tracks:u,enabled:!1})})}}},{key:"getTracksToBeUpdated",value:function(e){var t=e.type,n=e.source,r=e.enabled,i=this.store.getLocalPeerTracks();return t&&(i=i.filter(function(e){return e.type===t})),n&&(i=i.filter(function(e){return e.source===n})),i.filter(function(e){return e.enabled!==r})}}]),e}(),Wt=function(){function e(t,n){D(this,e),this.store=t,this.listener=n,this.TAG="RoomUpdateManager"}return O(e,[{key:"handleNotification",value:function(e,t){switch(e){case Et.PEER_LIST:this.onRoomState(t.room);break;case Et.RTMP_START:this.onRTMPStart(t);break;case Et.RTMP_STOP:this.onRTMPStop(t);break;case Et.RECORDING_START:this.onRecordingStart(t);break;case Et.RECORDING_STOP:this.onRecordingStop(t);break;case Et.ROOM_STATE:this.handlePreviewRoomState(t);break;default:this.onHLS(e,t)}}},{key:"handlePreviewRoomState",value:function(e){var t=e.room;this.onRoomState(t,e.peer_count)}},{key:"onRoomState",value:function(e,t){var n,r,i,a=e.recording,s=e.streaming,o=e.session_id,c=e.started_at,u=e.name,l=this.store.getRoom();l.peerCount=t,l.name=u,l.recording.server.running=!!(null==a?void 0:a.sfu.enabled),l.recording.browser.running=!!(null==a?void 0:a.browser.enabled),l.rtmp.running=!!(null==(n=null==s?void 0:s.rtmp)?void 0:n.enabled),l.rtmp.startedAt=Ft(null==(r=null==s?void 0:s.rtmp)?void 0:r.started_at),l.recording.server.startedAt=Ft(null==a?void 0:a.sfu.started_at),l.recording.browser.startedAt=Ft(null==a?void 0:a.browser.started_at),l.recording.hls=this.getPeerListHLSRecording(a),l.hls=this.convertHls(null==s?void 0:s.hls),l.sessionId=o,l.startedAt=Ft(c),null==(i=this.listener)||i.onRoomUpdate(ve.RECORDING_STATE_UPDATED,l)}},{key:"onRTMPStart",value:function(e){var t;this.setRTMPStatus(!(null==(t=e.error)?void 0:t.code),e)}},{key:"onRTMPStop",value:function(e){this.setRTMPStatus(!1,e)}},{key:"onRecordingStart",value:function(e){var t;this.setRecordingStatus(!(null==(t=e.error)?void 0:t.code),e)}},{key:"onRecordingStop",value:function(e){this.setRecordingStatus(!1,e)}},{key:"onHLS",value:function(e,t){var n,r;if([Et.HLS_START,Et.HLS_STOP].includes(e)){var i=this.store.getRoom();t.enabled=e===Et.HLS_START&&!(null==(n=t.error)?void 0:n.code),i.hls=this.convertHls(t),i.recording.hls=this.getHLSRecording(t),null==(r=this.listener)||r.onRoomUpdate(ve.HLS_STREAMING_STATE_UPDATED,i)}}},{key:"convertHls",value:function(e){var t,n={running:!!(null==e?void 0:e.enabled),variants:[],error:this.toSdkError(null==e?void 0:e.error)};return null==(t=null==e?void 0:e.variants)||t.forEach(function(e){n.variants.push({meetingURL:e.meeting_url,url:e.url,metadata:e.metadata,startedAt:Ft(e.started_at)})}),n}},{key:"getHLSRecording",value:function(e){var t,n,r,i={running:!1};return(null==e?void 0:e.hls_recording)&&(i={running:!!(null==e?void 0:e.enabled),singleFilePerLayer:!!(null==(t=e.hls_recording)?void 0:t.single_file_per_layer),hlsVod:!!(null==(n=e.hls_recording)?void 0:n.hls_vod),startedAt:Ft(null==(r=null==e?void 0:e.variants)?void 0:r[0].started_at),error:this.toSdkError(e.error)}),i}},{key:"getPeerListHLSRecording",value:function(e){var t,n,r=null==e?void 0:e.hls;return{running:!!(null==r?void 0:r.enabled),startedAt:Ft(null==r?void 0:r.started_at),singleFilePerLayer:!!(null==(t=null==r?void 0:r.config)?void 0:t.single_file_per_layer),hlsVod:!!(null==(n=null==r?void 0:r.config)?void 0:n.hls_vod)}}},{key:"setRecordingStatus",value:function(e,t){var n,r,i=this.store.getRoom();"sfu"===t.type?(i.recording.server={running:e,startedAt:e?Ft(t.started_at):void 0,error:this.toSdkError(t.error)},r=ve.SERVER_RECORDING_STATE_UPDATED):(i.recording.browser={running:e,startedAt:e?Ft(t.started_at):void 0,error:this.toSdkError(t.error)},r=ve.BROWSER_RECORDING_STATE_UPDATED),null==(n=this.listener)||n.onRoomUpdate(r,i)}},{key:"setRTMPStatus",value:function(e,t){var n,r=this.store.getRoom();r.rtmp={running:e,startedAt:e?Ft(t.started_at):void 0,error:this.toSdkError(t.error)},null==(n=this.listener)||n.onRoomUpdate(ve.RTMP_STREAMING_STATE_UPDATED,r)}},{key:"toSdkError",value:function(e){if(null==e?void 0:e.code){var t=e.message||"error in streaming/recording",n=new Ie(e.code,"ServerErrors",Ae.NONE,t,t);return ye.e(this.TAG,"error in streaming/recording",n),n}}}]),e}();function jt(e,t){var n=e.toLowerCase();return n.includes("device not found")?Pe.TracksErrors.DeviceNotAvailable(Ae.TRACK,t,e):n.includes("permission denied")?Pe.TracksErrors.CantAccessCaptureDevice(Ae.TRACK,t,e):Pe.TracksErrors.GenericTrack(Ae.TRACK,e)}function Kt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if("chrome"===r.default.browserDetails.browser&&"NotAllowedError"===e.name&&e.message.includes("denied by system"))return Pe.TracksErrors.SystemDeniedPermission(Ae.TRACK,t,e.message);if("firefox"===r.default.browserDetails.browser&&"NotFoundError"===e.name){var n=Pe.TracksErrors.SystemDeniedPermission(Ae.TRACK,t,e.message);return n.description="Capture device is either blocked at Operating System level or not available - ".concat(t),n}switch(e.name){case"OverconstrainedError":return Pe.TracksErrors.OverConstrained(Ae.TRACK,t,e.constraint);case"NotAllowedError":return Pe.TracksErrors.CantAccessCaptureDevice(Ae.TRACK,t,e.message);case"NotFoundError":return Pe.TracksErrors.DeviceNotAvailable(Ae.TRACK,t,e.message);case"NotReadableError":return Pe.TracksErrors.DeviceInUse(Ae.TRACK,t,e.message);case"TypeError":return Pe.TracksErrors.NothingToReturn(Ae.TRACK,e.message);default:return jt(e.message,t)}}function Jt(e,t){var n=Kt(e,t);return n.addNativeError(e),n}function qt(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia({audio:!!e&&e.toConstraints()});case 3:return t.abrupt("return",t.sent.getAudioTracks()[0]);case 6:throw t.prev=6,t.t0=t.catch(0),Jt(t.t0,Ot.AUDIO);case 9:case"end":return t.stop()}},t,null,[[0,6]])}))}function Yt(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia({video:!!e&&e.toConstraints()});case 3:return t.abrupt("return",t.sent.getVideoTracks()[0]);case 6:throw t.prev=6,t.t0=t.catch(0),Jt(t.t0,Ot.VIDEO);case 9:case"end":return t.stop()}},t,null,[[0,6]])}))}function Qt(e){return"canvas"in e||"MediaStreamAudioDestinationNode"===e.label||""===e.label}!function(e){e.UNKNOWN="unknown(video or audio)",e.AUDIO="audio",e.VIDEO="video",e.AV="audio, video",e.SCREEN="screen"}(Ot||(Ot={}));var zt,Zt,Xt,$t=35,en=5,tn=function(){function e(t,n,r){var i=this;D(this,e),this.track=t,this.audioLevelEvent=n,this.silenceEvent=r,this.TAG="[TrackAudioLevelMonitor]",this.audioLevel=0,this.isMonitored=!1,this.interval=100,this.historyInterval=700,this.history=new Tt(this.historyInterval/this.interval),this.detectSilence=function(){return $(i,null,b().mark(function e(){var t,n,r;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=30,n=10,r=0;case 1:if(!this.isMonitored){e.next=14;break}if(!this.track.enabled){e.next=10;break}if(!this.isSilentThisInstant()){e.next=9;break}if(!(++r>n)){e.next=7;break}return this.silenceEvent.publish({track:this.track}),e.abrupt("break",14);case 7:e.next=10;break;case 9:return e.abrupt("break",14);case 10:return e.next=12,bt(t);case 12:e.next=1;break;case 14:case"end":return e.stop()}},e,this)}))};try{var a=new MediaStream([this.track.nativeTrack]);this.analyserNode=this.createAnalyserNodeForStream(a)}catch(a){ye.w(this.TAG,"Unable to initialize AudioContext",a)}}return O(e,[{key:"start",value:function(){var e=this;this.stop(),this.isMonitored=!0,ye.d(this.TAG,"Starting track Monitor","".concat(this.track)),this.loop().then(function(){return ye.d(e.TAG,"Stopping track Monitor","".concat(e.track))})}},{key:"stop",value:function(){this.analyserNode?(this.sendAudioLevel(0),this.isMonitored=!1):ye.d(this.TAG,"AudioContext not initialized")}},{key:"loop",value:function(){return $(this,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMonitored){e.next=6;break}return this.sendAudioLevel(this.getMaxAudioLevelOverPeriod()),e.next=4,bt(this.interval);case 4:e.next=0;break;case 6:case"end":return e.stop()}},e,this)}))}},{key:"sendAudioLevel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e=e>$t?e:0,Math.abs(this.audioLevel-e)>en){this.audioLevel=e;var t={track:this.track,audioLevel:this.audioLevel};this.audioLevelEvent.publish(t)}}},{key:"getMaxAudioLevelOverPeriod",value:function(){if(this.analyserNode){var e=this.calculateAudioLevel();return void 0!==e&&this.history.enqueue(e),this.history.aggregate(function(e){return Math.max.apply(Math,f(e))})}ye.d(this.TAG,"AudioContext not initialized")}},{key:"calculateAudioLevel",value:function(){if(this.analyserNode){var e=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(e);var t,n=.009,r=n,i=U(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;r=Math.max(r,(a-128)/128)}}catch(o){i.e(o)}finally{i.f()}var s=(Math.log(n)-Math.log(r))/Math.log(n);return Math.ceil(Math.min(Math.max(100*s,0),100))}ye.d(this.TAG,"AudioContext not initialized")}},{key:"isSilentThisInstant",value:function(){if(this.analyserNode){var e=new Uint8Array(this.analyserNode.fftSize);return this.analyserNode.getByteTimeDomainData(e),!e.some(function(e){return 128!==e&&0!==e})}ye.d(this.TAG,"AudioContext not initialized")}},{key:"createAnalyserNodeForStream",value:function(e){var t=new AudioContext,n=t.createAnalyser();return t.createMediaStreamSource(e).connect(n),n}}]),e}();function nn(){if(ie&&window){var e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?Xt.LOCAL:e.includes("app.100ms.live")?Xt.HMS:Xt.CUSTOM}return Xt.CUSTOM}exports.HMSAudioPluginType=zt,function(e){e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE"}(zt||(exports.HMSAudioPluginType=zt={})),exports.HMSPluginUnsupportedTypes=Zt,function(e){e.PLATFORM_NOT_SUPPORTED="PLATFORM_NOT_SUPPORTED",e.DEVICE_NOT_SUPPORTED="DEVICE_NOT_SUPPORTED"}(Zt||(exports.HMSPluginUnsupportedTypes=Zt={})),function(e){e.CUSTOM="CUSTOM",e.LOCAL="LOCAL",e.HMS="HMS"}(Xt||(Xt={}));var rn=nn(),an=ee().version;function sn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V.PROD,n=arguments.length>1?arguments[1]:void 0,r=rn!==Xt.LOCAL&&e===V.PROD?"prod":"debug";if(re)return ln({os:"web_nodejs",os_version:t.version,sdk:"web",sdk_version:an,env:r,domain:rn,framework:"node",framework_version:t.version,framework_sdk_version:null==n?void 0:n.sdkVersion});var i=ne.getOS(),a=ne.getDevice(),s=ne.getBrowser(),o=on("web_".concat(i.name)),c=i.version||"",u=on("".concat(s.name,"_").concat(s.version)),l=u;return a.type&&(l="".concat(on("".concat(a.vendor,"_").concat(a.type)),"/").concat(u)),ln({os:o,os_version:c,sdk:"web",sdk_version:an,device_model:l,env:r,domain:rn,framework:null==n?void 0:n.type,framework_version:null==n?void 0:n.version,framework_sdk_version:null==n?void 0:n.sdkVersion})}function on(e){return e.replace(/ /g,"_")}var cn,un,ln=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return Object.keys(e).filter(function(t){return!!e[t]}).map(function(t){return"".concat(t,":").concat(e[t])}).join(t)},dn=function(){function e(t){var n=t.name,r=t.level,i=t.properties,s=t.includesPII,o=t.timestamp;D(this,e),this.metadata={peer:{},userAgent:sn()},this.name=n,this.level=r,this.includesPII=s||!1,this.properties=i||{},this.timestamp=o||(new Date).getTime(),this.event_id=(0,a.v4)(),this.device_id=ce()}return O(e,[{key:"toSignalParams",value:function(){return{name:this.name,info:z(Q({},this.properties),{timestamp:this.timestamp,domain:rn}),timestamp:(new Date).getTime()}}}]),e}();!function(e){e[e.VERBOSE=0]="VERBOSE",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.OFF=3]="OFF"}(cn||(cn={})),function(e){e[e.VERBOSE=0]="VERBOSE",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.OFF=3]="OFF"}(un||(un={}));var hn=function(){function e(){D(this,e)}return O(e,null,[{key:"failure",value:function(e,t){var n=un.ERROR,r=Q({plugin_name:e},t.toAnalyticsProperties());return new dn({name:"mediaPlugin.failed",level:n,properties:r})}},{key:"audioPluginFailure",value:function(e,t,n){var r=un.ERROR,i=Q({plugin_name:e,sampleRate:t},n.toAnalyticsProperties());return new dn({name:"mediaPlugin.failed",level:r,properties:i})}},{key:"audioPluginStats",value:function(e){var t=e.pluginName,n=e.duration,r=e.loadTime,i=e.sampleRate,a=un.INFO;return new dn({name:"mediaPlugin.stats",level:a,properties:{plugin_name:t,duration:n,load_time:r,sampleRate:i}})}},{key:"stats",value:function(e){var t=e.pluginName,n=e.duration,r=e.loadTime,i=e.avgPreProcessingTime,a=e.avgProcessingTime,s=e.inputFrameRate,o=e.pluginFrameRate,c=un.INFO;return new dn({name:"mediaPlugin.stats",level:c,properties:{plugin_name:t,duration:n,load_time:r,avg_preprocessing_time:i,avg_processing_time:a,input_frame_rate:s,plugin_frame_rate:o}})}}]),e}(),vn="AudioPluginsAnalytics",pn=function(){function e(t){D(this,e),this.eventBus=t,this.initTime={},this.addedTimestamps={},this.pluginAdded={},this.pluginSampleRate={}}return O(e,[{key:"added",value:function(e,t){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.pluginSampleRate[e]=t}},{key:"removed",value:function(e){if(this.pluginAdded[e]){var t={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],sampleRate:this.pluginSampleRate[e]};this.eventBus.analytics.publish(hn.audioPluginStats(t)),this.clean(e)}}},{key:"failure",value:function(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(hn.audioPluginFailure(e,this.pluginSampleRate[e],t)),this.clean(e))}},{key:"initWithTime",value:function(e,t){return $(this,null,b().mark(function n(){var r,i;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.initTime[e]){n.next=3;break}return ye.i(vn,"Plugin Already loaded ".concat(e,", time it took: ").concat(this.initTime[e])),n.abrupt("return");case 3:return n.prev=3,n.next=6,this.timeInMs(t);case 6:r=n.sent,ye.i(vn,"Time taken for Plugin ".concat(e," initialization : ").concat(r)),n.next=14;break;case 10:throw n.prev=10,n.t0=n.catch(3),i=Pe.MediaPluginErrors.InitFailed(Ae.AUDIO_PLUGINS,"failed during initialization of plugin".concat(n.t0.message||n.t0)),ye.e(vn,i),this.failure(e,i),i;case 14:r&&(this.initTime[e]=r);case 15:case"end":return n.stop()}},n,this,[[3,10]])}))}},{key:"timeInMs",value:function(e){return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),t.next=3,e();case 3:return t.abrupt("return",Math.floor(Date.now()-n));case 4:case"end":return t.stop()}},t)}))}},{key:"clean",value:function(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.pluginAdded[e],delete this.pluginSampleRate[e]}}]),e}(),fn="AudioPluginsManager",kn=48e3,gn=function(){return-1!==navigator.userAgent.indexOf("Firefox")},mn=function(){function e(t,n){D(this,e),this.pluginAddInProgress=!1,this.hmsTrack=t,this.pluginsMap=new Map,this.analytics=new pn(n),this.createAudioContext()}return O(e,[{key:"getPlugins",value:function(){return Array.from(this.pluginsMap.keys())}},{key:"addPlugin",value:function(e){return $(this,null,b().mark(function t(){var n,r,i;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null==(n=e.getName)?void 0:n.call(e)){t.next=4;break}return ye.w("no name provided by the plugin"),t.abrupt("return");case 4:if(!this.pluginAddInProgress){t.next=7;break}throw i=Pe.MediaPluginErrors.AddAlreadyInProgress(Ae.AUDIO_PLUGINS,"Add Plugin is already in Progress"),this.analytics.added(r,this.audioContext.sampleRate),this.analytics.failure(r,i),ye.w("can't add another plugin when previous add is in progress"),i;case 7:return this.pluginAddInProgress=!0,t.prev=8,t.next=11,this.addPluginInternal(e);case 11:return t.prev=11,this.pluginAddInProgress=!1,t.finish(11);case 14:case"end":return t.stop()}},t,this,[[8,,11,14]])}))}},{key:"addPluginInternal",value:function(e){return $(this,null,b().mark(function t(){var n,r,i=this;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null==(n=e.getName)?void 0:n.call(e),!this.pluginsMap.get(r)){t.next=4;break}return ye.w(fn,"plugin - ".concat(r," already added.")),t.abrupt("return");case 4:return t.next=6,this.validateAndThrow(r,e);case 6:if(t.prev=6,0!==this.pluginsMap.size){t.next=12;break}return t.next=10,this.initAudioNodes();case 10:t.next=13;break;case 12:this.prevAudioNode&&this.prevAudioNode.disconnect();case 13:return this.analytics.added(r,this.audioContext.sampleRate),t.next=16,this.analytics.initWithTime(r,function(){return $(i,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.init());case 1:case"end":return t.stop()}},t)}))});case 16:return this.pluginsMap.set(r,e),t.next=19,this.processPlugin(e);case 19:return t.next=21,this.connectToDestination();case 21:t.next=26;break;case 23:throw t.prev=23,t.t0=t.catch(6),ye.e(fn,"failed to add plugin",t.t0),t.t0;case 26:case"end":return t.stop()}},t,this,[[6,23]])}))}},{key:"validatePlugin",value:function(e){return e.checkSupport(this.audioContext)}},{key:"validateAndThrow",value:function(e,t){return $(this,null,b().mark(function n(){var r,i,a;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=this.validatePlugin(t)).isSupported){n.next=5;break}ye.i(fn,"plugin is supported,- ".concat(t.getName())),n.next=19;break;case 5:if(this.analytics.added(e,this.audioContext.sampleRate),r.errType!==Zt.PLATFORM_NOT_SUPPORTED){n.next=13;break}return i=Pe.MediaPluginErrors.PlatformNotSupported(Ae.AUDIO_PLUGINS,"platform not supported, see docs"),this.analytics.failure(e,i),n.next=10,this.cleanup();case 10:throw i;case 13:if(r.errType!==Zt.DEVICE_NOT_SUPPORTED){n.next=19;break}return a=Pe.MediaPluginErrors.DeviceNotSupported(Ae.AUDIO_PLUGINS,"audio device not supported, see docs"),this.analytics.failure(e,a),n.next=18,this.cleanup();case 18:throw a;case 19:case"end":return n.stop()}},n,this)}))}},{key:"removePlugin",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.removePluginInternal(e);case 2:if(0!==this.pluginsMap.size){t.next=10;break}return t.next=5,this.cleanup();case 5:return ye.i(fn,"No plugins left, stopping plugins loop"),t.next=8,this.hmsTrack.setProcessedTrack(void 0);case 8:t.next=12;break;case 10:return t.next=12,this.reprocessPlugins();case 12:case"end":return t.stop()}},t,this)}))}},{key:"cleanup",value:function(){return $(this,null,b().mark(function e(){var t,n,r,i,a,s;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=U(this.pluginsMap.values()),e.prev=1,i.s();case 3:if((a=i.n()).done){e.next=9;break}return s=a.value,e.next=7,this.removePluginInternal(s);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),i.e(e.t0);case 14:return e.prev=14,i.f(),e.finish(14);case 17:return e.next=19,this.hmsTrack.setProcessedTrack(void 0);case 19:null==(t=this.sourceNode)||t.disconnect(),null==(n=this.prevAudioNode)||n.disconnect(),null==(r=this.outputTrack)||r.stop(),this.sourceNode=void 0,this.destinationNode=void 0,this.prevAudioNode=void 0,this.outputTrack=void 0;case 26:case"end":return e.stop()}},e,this,[[1,11,14,17]])}))}},{key:"closeContext",value:function(){return $(this,null,b().mark(function e(){var t;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:null==(t=this.audioContext)||t.close(),this.audioContext=void 0;case 1:case"end":return e.stop()}},e,this)}))}},{key:"reprocessPlugins",value:function(){return $(this,null,b().mark(function e(){var t,n,r,i;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.pluginsMap.size&&this.sourceNode){e.next=2;break}return e.abrupt("return");case 2:return t=Array.from(this.pluginsMap.values()),e.next=5,this.cleanup();case 5:return e.next=7,this.initAudioNodes();case 7:n=0,r=t;case 8:if(!(n<r.length)){e.next=15;break}return i=r[n],e.next=12,this.addPlugin(i);case 12:n++,e.next=8;break;case 15:case"end":return e.stop()}},e,this)}))}},{key:"initAudioNodes",value:function(){return $(this,null,b().mark(function e(){var t;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.audioContext){e.next=12;break}if(this.sourceNode||(t=new MediaStream([this.hmsTrack.nativeTrack]),this.sourceNode=this.audioContext.createMediaStreamSource(t)),this.destinationNode){e.next=12;break}return this.destinationNode=this.audioContext.createMediaStreamDestination(),this.outputTrack=this.destinationNode.stream.getAudioTracks()[0],e.prev=4,e.next=7,this.hmsTrack.setProcessedTrack(this.outputTrack);case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(4),ye.e(fn,"error in setting processed track",e.t0),e.t0;case 12:case"end":return e.stop()}},e,this,[[4,9]])}))}},{key:"processPlugin",value:function(e){return $(this,null,b().mark(function t(){var n,r;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.processAudioTrack(this.audioContext,this.prevAudioNode||this.sourceNode);case 3:n=t.sent,this.prevAudioNode&&this.prevAudioNode.connect(n),this.prevAudioNode=n,t.next=13;break;case 7:return t.prev=7,t.t0=t.catch(0),r=e.getName(),ye.e(fn,"error in processing plugin ".concat(r),t.t0),t.next=13,this.removePluginInternal(e);case 13:case"end":return t.stop()}},t,this,[[0,7]])}))}},{key:"connectToDestination",value:function(){return $(this,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{this.prevAudioNode&&this.destinationNode&&this.prevAudioNode.context===this.destinationNode.context&&this.prevAudioNode.connect(this.destinationNode)}catch(t){ye.e(fn,"error in connecting to destination node",t)}case 1:case"end":return e.stop()}},e,this)}))}},{key:"removePluginInternal",value:function(e){return $(this,null,b().mark(function t(){var n,r;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null==(n=e.getName)?void 0:n.call(e),this.pluginsMap.get(r)){t.next=4;break}return ye.w(fn,"plugin - ".concat(r," not found to remove.")),t.abrupt("return");case 4:ye.i(fn,"removing plugin ".concat(r)),this.pluginsMap.delete(r),e.stop(),this.analytics.removed(r);case 5:case"end":return t.stop()}},t,this)}))}},{key:"createAudioContext",value:function(){this.audioContext||(gn()?this.audioContext=new AudioContext:this.audioContext=new AudioContext({sampleRate:kn}))}}]),e}();exports.HMSAudioPluginsManager=mn;var yn=function(){function e(){D(this,e),this.storage=new te("hms-device-selection"),this.remember=!1,this.TAG="HMSDeviceStorage"}return O(e,[{key:"setDevices",value:function(e){this.devices=e}},{key:"rememberDevices",value:function(e){this.remember=e}},{key:"updateSelection",value:function(e,t){var n=this,r=t.deviceId,i=t.groupId;if(this.devices&&this.remember){var a=this.devices[e].find(function(e){return n.isSame({deviceId:r,groupId:i},e)});if(a){var s=this.storage.get()||{};s[e]=a,this.storage.set(s)}else ye.w(this.TAG,"Could not find device with deviceId: ".concat(r,", groupId: ").concat(i))}}},{key:"getSelection",value:function(){if(this.remember)return this.storage.get()}},{key:"cleanup",value:function(){this.remember=!1,this.devices=void 0}},{key:"isSame",value:function(e,t){return e.deviceId===t.deviceId&&(e.groupId===t.groupId||!e.groupId)}}]),e}(),Tn=new yn;function bn(e,t){return function(n){return n in e&&e[n]!==t[n]}}var En,Sn,wn="HMSLocalAudioTrack",An=function(e){E(n,ct);var t=S(n);function n(e,r,i,a){var s,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(new wt).build();return D(this,n),(s=t.call(this,e,r,i)).eventBus=a,s.handleSettingsChange=function(e){return $(A(s),null,b().mark(function t(){var n,r;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.stream,r=bn(e,this.settings),t.t0=r("maxBitrate")&&e.maxBitrate,!t.t0){t.next=5;break}return t.next=5,n.setMaxBitrate(e.maxBitrate,this);case 5:if(t.t1=r("advanced"),!t.t1){t.next=9;break}return t.next=9,this.nativeTrack.applyConstraints(e.toConstraints());case 9:case"end":return t.stop()}},t,this)}))},s.handleDeviceChange=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return $(A(s),null,b().mark(function n(){return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=bn(e,this.settings)("deviceId"),!n.t0){n.next=5;break}return n.next=4,this.replaceTrackWith(e);case 4:t||Tn.updateSelection("audioInput",{deviceId:e.deviceId,groupId:this.nativeTrack.getSettings().groupId});case 5:case"end":return n.stop()}},n,this)}))},e.tracks.push(A(s)),s.settings=o,"default"===o.deviceId&&!Qt(r)&&(s.settings=s.buildNewSettings({deviceId:r.getSettings().deviceId})),s.pluginsManager=new mn(A(s),a),s.setFirstTrackId(r.id),s}return O(n,[{key:"replaceTrackWith",value:function(e){return $(this,null,b().mark(function t(){var n,r,i,a,s;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.nativeTrack,r=this.enabled,i=Boolean(this.audioLevelMonitor),null==n||n.stop(),t.next=4,qt(e);case 4:return(a=t.sent).enabled=r,s=this.stream,t.next=9,s.replaceSenderTrack(n,this.processedTrack||a);case 9:return t.next=11,s.replaceStreamTrack(n,a);case 11:return this.nativeTrack=a,i&&this.initAudioLevelMonitor(),t.prev=13,t.next=16,this.pluginsManager.reprocessPlugins();case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(13),this.eventBus.audioPluginFailed.publish(t.t0);case 21:case"end":return t.stop()}},t,this,[[13,18]])}))}},{key:"setEnabled",value:function(e){var t=this;return $(this,null,b().mark(function r(){return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=e!==this.enabled,!r.t0){r.next=11;break}if(r.t1=e&&Qt(this.nativeTrack),!r.t1){r.next=6;break}return r.next=6,this.replaceTrackWith(this.settings);case 6:return r.next=8,(i="setEnabled",y(_(n.prototype),i,t)).call(this,e);case 8:e&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),this.eventBus.localAudioEnabled.publish({enabled:e,track:this}),this.stream.trackUpdate(this);case 11:case"end":return r.stop()}var i},r,this)}))}},{key:"isPublishedTrackId",value:function(e){return this.publishedTrackId===e}},{key:"setSettings",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return $(this,null,b().mark(function n(){var r;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=this.buildNewSettings(e),n.next=3,this.handleDeviceChange(r,t);case 3:if(!Qt(this.nativeTrack)){n.next=6;break}return this.settings=r,n.abrupt("return");case 6:return n.next=8,this.handleSettingsChange(r);case 8:this.settings=r;case 9:case"end":return n.stop()}},n,this)}))}},{key:"getPlugins",value:function(){return this.pluginsManager.getPlugins()}},{key:"addPlugin",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.pluginsManager.addPlugin(e));case 1:case"end":return t.stop()}},t,this)}))}},{key:"removePlugin",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.pluginsManager.removePlugin(e));case 1:case"end":return t.stop()}},t,this)}))}},{key:"validatePlugin",value:function(e){return this.pluginsManager.validatePlugin(e)}},{key:"setProcessedTrack",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=7;break}if(t.t0=this.processedTrack,!t.t0){t.next=5;break}return t.next=5,this.stream.replaceSenderTrack(this.processedTrack,this.nativeTrack);case 5:return this.processedTrack=void 0,t.abrupt("return");case 7:if(t.t1=e!==this.processedTrack,!t.t1){t.next=17;break}if(!this.processedTrack){t.next=14;break}return t.next=12,this.stream.replaceSenderTrack(this.processedTrack,e);case 12:t.next=16;break;case 14:return t.next=16,this.stream.replaceSenderTrack(this.nativeTrack,e);case 16:this.processedTrack=e;case 17:case"end":return t.stop()}},t,this)}))}},{key:"initAudioLevelMonitor",value:function(){this.audioLevelMonitor&&this.destroyAudioLevelMonitor(),ye.d(wn,"Monitor Audio Level for",this,this.getMediaTrackSettings().deviceId),this.audioLevelMonitor=new tn(this,this.eventBus.trackAudioLevelUpdate,this.eventBus.localAudioSilence),this.audioLevelMonitor.start(),this.audioLevelMonitor.detectSilence()}},{key:"destroyAudioLevelMonitor",value:function(){var e;null==(e=this.audioLevelMonitor)||e.stop(),this.audioLevelMonitor=void 0}},{key:"cleanup",value:function(){var e=this;return $(this,null,b().mark(function t(){var r;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(i="cleanup",y(_(n.prototype),i,e)).call(this),t.next=3,this.pluginsManager.cleanup();case 3:return t.next=5,this.pluginsManager.closeContext();case 5:null==(r=this.processedTrack)||r.stop(),this.destroyAudioLevelMonitor();case 7:case"end":return t.stop()}var i},t,this)}))}},{key:"getTrackIDBeingSent",value:function(){return this.processedTrack?this.processedTrack.id:this.nativeTrack.id}},{key:"getTrackBeingSent",value:function(){return this.processedTrack||this.nativeTrack}},{key:"buildNewSettings",value:function(e){var t=Q(Q({},this.settings),e),n=t.volume,r=t.codec,i=t.maxBitrate,a=t.deviceId,s=t.advanced;return new At(n,r,i,a,s)}}]),n}();exports.HMSLocalAudioTrack=An,exports.HMSVideoPluginType=En,function(e){e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE"}(En||(exports.HMSVideoPluginType=En={})),exports.HMSVideoPluginCanvasContextType=Sn,function(e){e["2D"]="2d",e.WEBGL="webgl",e.WEBGL2="webgl2"}(Sn||(exports.HMSVideoPluginCanvasContextType=Sn={}));var xn=function(){function e(){D(this,e),this.total=0,this.count=0}return O(e,[{key:"add",value:function(e){this.count++,this.total+=e}},{key:"getAvg",value:function(){return Math.floor(this.total/this.count)}},{key:"reset",value:function(){this.total=0,this.count=0}}]),e}(),In="VideoPluginsAnalytics",Pn=function(){function e(t){D(this,e),this.eventBus=t,this.initTime={},this.preProcessingAvgs=new xn,this.addedTimestamps={},this.processingAvgs={},this.pluginAdded={},this.pluginInputFrameRate={},this.pluginFrameRate={}}return O(e,[{key:"added",value:function(e,t,n){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.processingAvgs[e]=new xn,this.pluginInputFrameRate[e]=t,this.pluginFrameRate[e]=n||t}},{key:"removed",value:function(e){var t;if(this.pluginAdded[e]){var n={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],avgPreProcessingTime:this.preProcessingAvgs.getAvg(),avgProcessingTime:null==(t=this.processingAvgs[e])?void 0:t.getAvg(),inputFrameRate:this.pluginInputFrameRate[e],pluginFrameRate:this.pluginFrameRate[e]};this.eventBus.analytics.publish(hn.stats(n)),this.clean(e)}}},{key:"failure",value:function(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(hn.failure(e,t)),this.clean(e))}},{key:"initWithTime",value:function(e,t){return $(this,null,b().mark(function n(){var r,i;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.initTime[e]){n.next=3;break}return ye.i(In,"Plugin Already loaded ".concat(e,", time it took: ").concat(this.initTime[e])),n.abrupt("return");case 3:return n.prev=3,n.next=6,this.timeInMs(t);case 6:r=n.sent,ye.i(In,"Time taken for Plugin ".concat(e," initialization : ").concat(r)),n.next=14;break;case 10:throw n.prev=10,n.t0=n.catch(3),i=Pe.MediaPluginErrors.InitFailed(Ae.VIDEO_PLUGINS,"failed during initialization of plugin".concat(n.t0.message||n.t0)),ye.e(In,i),this.failure(e,i),i;case 14:r&&(this.initTime[e]=r);case 15:case"end":return n.stop()}},n,this,[[3,10]])}))}},{key:"preProcessWithTime",value:function(e){return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.timeInMs(e);case 2:n=t.sent,this.preProcessingAvgs.add(n);case 4:case"end":return t.stop()}},t,this)}))}},{key:"processWithTime",value:function(e,t){return $(this,null,b().mark(function n(){var r,i,a;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.timeInMs(t);case 3:i=n.sent,n.next=10;break;case 6:throw n.prev=6,n.t0=n.catch(0),a=Pe.MediaPluginErrors.ProcessingFailed(Ae.VIDEO_PLUGINS,"Failed during processing of plugin".concat(n.t0.message||n.t0)),ye.e(In,a),this.failure(e,a),a;case 10:i&&(null==(r=this.processingAvgs[e])||r.add(i));case 11:case"end":return n.stop()}},n,this,[[0,6]])}))}},{key:"timeInMs",value:function(e){return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),t.next=3,e();case 3:return t.abrupt("return",Math.floor(Date.now()-n));case 4:case"end":return t.stop()}},t)}))}},{key:"clean",value:function(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.processingAvgs[e],delete this.pluginAdded[e],delete this.pluginInputFrameRate[e],delete this.pluginFrameRate[e]}}]),e}(),Cn=24,Rn=320,_n=240,Dn="VideoPluginsManager",Nn=function(){function e(t,n){D(this,e),this.pluginsLoopRunning=!1,this.pluginsLoopState="paused",this.pluginAddInProgress=!1,this.hmsTrack=t,this.pluginsMap=new Map,this.pluginNumFramesToSkip={},this.pluginNumFramesSkipped={},this.analytics=new Pn(n),this.canvases=new Array}return O(e,[{key:"getPlugins",value:function(){return Array.from(this.pluginsMap.keys())}},{key:"addPlugin",value:function(e,t){return $(this,null,b().mark(function n(){var r,i,a;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.pluginAddInProgress){n.next=7;break}if((i=null==(r=e.getName)?void 0:r.call(e))&&""!==i){n.next=5;break}return ye.w("no name provided by the plugin"),n.abrupt("return");case 5:throw a=Pe.MediaPluginErrors.AddAlreadyInProgress(Ae.VIDEO_PLUGINS,"Add Plugin is already in Progress"),this.analytics.failure(i,a),ye.w("can't add another plugin when previous add is in progress"),a;case 7:return this.pluginAddInProgress=!0,n.prev=8,n.next=11,this.addPluginInternal(e,t);case 11:return n.prev=11,this.pluginAddInProgress=!1,n.finish(11);case 14:case"end":return n.stop()}},n,this,[[8,,11,14]])}))}},{key:"addPluginInternal",value:function(e,t){return $(this,null,b().mark(function n(){var r,i,a,s,o,c,u=this;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if((a=null==(r=e.getName)?void 0:r.call(e))&&""!==a){n.next=4;break}return ye.w("no name provided by the plugin"),n.abrupt("return");case 4:if(!this.pluginsMap.has(a)){n.next=7;break}return ye.w(Dn,"plugin - ".concat(e.getName()," already added.")),n.abrupt("return");case 7:return s=this.hmsTrack.getMediaTrackSettings().frameRate||Cn,o=0,t&&t>0?(ye.i(Dn,"adding plugin ".concat(e.getName()," with framerate ").concat(t)),t<s&&(o=Math.ceil(s/t)-1),this.analytics.added(a,s,t)):(ye.i(Dn,"adding plugin ".concat(e.getName())),this.analytics.added(a,s)),ye.i(Dn,"numFrames to skip processing",o),this.pluginNumFramesToSkip[a]=o,this.pluginNumFramesSkipped[a]=o,this.validateAndThrow(a,e),n.prev=9,n.next=12,this.analytics.initWithTime(a,function(){return $(u,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.init();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}))});case 12:if(this.pluginsMap.set(a,e),!(this.pluginsMap.size+1>this.canvases.length)){n.next=15;break}for(c=this.canvases.length;c<=this.pluginsMap.size;c++)this.canvases[c]=document.createElement("canvas");case 15:return n.next=17,this.startPluginsLoop(null==(i=e.getContextType)?void 0:i.call(e));case 17:n.next=25;break;case 19:return n.prev=19,n.t0=n.catch(9),ye.e(Dn,"failed to add plugin",n.t0),n.next=24,this.removePlugin(e);case 24:throw n.t0;case 25:case"end":return n.stop()}},n,this,[[9,19]])}))}},{key:"validatePlugin",value:function(e){return e.checkSupport()}},{key:"validateAndThrow",value:function(e,t){var n,r=this.validatePlugin(t);if(r.isSupported)ye.i(Dn,"plugin is supported,- ".concat(t.getName()));else switch(r.errType){case Zt.PLATFORM_NOT_SUPPORTED:throw n=Pe.MediaPluginErrors.PlatformNotSupported(Ae.VIDEO_PLUGINS,"platform not supported, see docs"),this.analytics.failure(e,n),n;case Zt.DEVICE_NOT_SUPPORTED:throw n=Pe.MediaPluginErrors.DeviceNotSupported(Ae.VIDEO_PLUGINS,"video device not supported, see docs"),this.analytics.failure(e,n),n}}},{key:"removePlugin",value:function(e){return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.getName(),this.pluginsMap.get(n)){t.next=4;break}return ye.w(Dn,"plugin - ".concat(n," not found to remove.")),t.abrupt("return");case 4:if(ye.i(Dn,"removing plugin ".concat(n)),this.removePluginEntry(n),t.t0=0===this.pluginsMap.size,!t.t0){t.next=11;break}return ye.i(Dn,"No plugins left, stopping plugins loop"),t.next=11,this.stopPluginsLoop();case 11:e.stop(),this.analytics.removed(n);case 13:case"end":return t.stop()}},t,this)}))}},{key:"removePluginEntry",value:function(e){this.pluginsMap.delete(e),this.pluginNumFramesToSkip[e]&&delete this.pluginNumFramesToSkip[e],this.pluginNumFramesSkipped[e]&&delete this.pluginNumFramesSkipped[e]}},{key:"waitForRestart",value:function(){return $(this,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pluginsLoopRunning||"running"===this.pluginsLoopState){e.next=6;break}case 1:if("paused"!==this.pluginsLoopState){e.next=6;break}return e.next=4,bt(100);case 4:e.next=1;break;case 6:case"end":return e.stop()}},e,this)}))}},{key:"cleanup",value:function(){return $(this,null,b().mark(function e(){var t,n,r,i;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=U(this.pluginsMap.values()),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,this.removePlugin(i);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:null==(t=this.outputTrack)||t.stop();case 18:case"end":return e.stop()}},e,this,[[1,11,14,17]])}))}},{key:"initElementsAndStream",value:function(e){this.inputCanvas||(this.inputCanvas=document.createElement("canvas")),this.outputCanvas=document.createElement("canvas"),this.inputVideo||(this.inputVideo=document.createElement("video")),this.inputCanvas.getContext("2d"),this.outputCanvas.getContext(e||Sn["2D"]);var t=this.outputCanvas.captureStream();this.outputTrack=t.getVideoTracks()[0]}},{key:"startPluginsLoop",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.pluginsLoopRunning){t.next=11;break}return this.initElementsAndStream(e),this.pluginsLoopRunning=!0,t.prev=2,t.next=5,this.hmsTrack.setProcessedTrack(this.outputTrack);case 5:t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(2),this.pluginsLoopRunning=!1,ye.e(Dn,"error in setting processed track",t.t0),t.t0;case 10:this.pluginsLoop().then(function(){ye.d(Dn,"processLoop stopped")});case 11:case"end":return t.stop()}},t,this,[[2,7]])}))}},{key:"stopPluginsLoop",value:function(){return $(this,null,b().mark(function e(){var t;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.pluginsLoopRunning=!1,e.next=3,this.hmsTrack.setProcessedTrack(void 0);case 3:this.resetCanvases(),null==(t=this.outputTrack)||t.stop(),this.inputVideo&&(this.inputVideo.srcObject=null,this.inputVideo=void 0);case 6:case"end":return e.stop()}},e,this)}))}},{key:"pluginsLoop",value:function(){return $(this,null,b().mark(function e(){var t,n,r,i,a=this;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pluginsLoopRunning){e.next=27;break}if(t=this.hmsTrack.getMediaTrackSettings().frameRate||Cn,n=Math.floor(1e3/t),this.hmsTrack.enabled&&"ended"!==this.hmsTrack.nativeTrack.readyState){e.next=8;break}return"running"===this.pluginsLoopState&&this.resetCanvases(),this.pluginsLoopState="paused",e.next=7,bt(n);case 7:return e.abrupt("continue",25);case 8:return r=0,e.prev=9,e.next=12,this.analytics.preProcessWithTime(function(){return $(a,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.doPreProcessing();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))});case 12:return i=Date.now(),e.next=15,this.processFramesThroughPlugins();case 15:(r=Math.floor(Date.now()-i))>n&&(r=n),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(9),ye.e(Dn,"error in plugins loop",e.t0);case 22:return this.pluginsLoopState="running",e.next=25,bt(n-r);case 25:e.next=0;break;case 27:case"end":return e.stop()}},e,this,[[9,19]])}))}},{key:"doPreProcessing",value:function(){return $(this,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.addTrackToVideo();case 2:return e.next=4,this.updateInputCanvas();case 4:case"end":return e.stop()}},e,this)}))}},{key:"processFramesThroughPlugins",value:function(){return $(this,null,b().mark(function e(){var t,n,r,i,a=this;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.canvases[0]=this.inputCanvas,t=0,n=U(this.pluginsMap.values()),e.prev=3,i=b().mark(function e(){var n,i,s,o,c,u;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.value,i=n.getName(),!n){e.next=39;break}if(e.prev=3,s=a.checkIfSkipRequired(i),n.getPluginType()!==En.TRANSFORM){e.next=27;break}if(o=function(e,t){return $(a,null,b().mark(function r(){return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,n.processVideoFrame(e,t,s);case 3:r.next=8;break;case 5:r.prev=5,r.t0=r.catch(0),ye.e(Dn,"error in processing plugin ".concat(i),r.t0);case 8:case"end":return r.stop()}},r,null,[[0,5]])}))},!s){e.next=17;break}if(t!==a.pluginsMap.size-1){e.next=13;break}return e.next=11,o(a.canvases[t],a.outputCanvas);case 11:e.next=15;break;case 13:return e.next=15,o(a.canvases[t],a.canvases[t+1]);case 15:e.next=25;break;case 17:if(c=a.canvases[t],u=a.canvases[t+1],t!==a.pluginsMap.size-1){e.next=23;break}return e.next=21,a.analytics.processWithTime(i,function(){return $(a,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o(c,this.outputCanvas));case 1:case"end":return e.stop()}},e,this)}))});case 21:e.next=25;break;case 23:return e.next=25,a.analytics.processWithTime(i,function(){return $(a,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o(c,u));case 1:case"end":return e.stop()}},e)}))});case 25:e.next=31;break;case 27:if(e.t0=n.getPluginType()===En.ANALYZE&&!s,!e.t0){e.next=31;break}return e.next=31,a.analytics.processWithTime(i,function(){return $(a,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.processVideoFrame(this.inputCanvas);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))});case 31:e.next=38;break;case 33:return e.prev=33,e.t1=e.catch(3),ye.e(Dn,"error in processing plugin ".concat(i),e.t1),e.next=38,a.removePlugin(n);case 38:t++;case 39:case"end":return e.stop()}},e,null,[[3,33]])}),n.s();case 6:if((r=n.n()).done){e.next=10;break}return e.delegateYield(i(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),n.e(e.t1);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}},e,this,[[3,12,15,18]])}))}},{key:"addTrackToVideo",value:function(){return $(this,null,b().mark(function e(){var t,n;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.inputVideo){e.next=2;break}return e.abrupt("return");case 2:if(n=this.inputVideo.srcObject,e.t0=null!==n&&n instanceof MediaStream&&(null==(t=n.getVideoTracks()[0])?void 0:t.id)===this.hmsTrack.nativeTrack.id,e.t0){e.next=11;break}return this.inputVideo.pause(),this.inputVideo.srcObject=new MediaStream([this.hmsTrack.nativeTrack]),this.inputVideo.muted=!0,this.inputVideo.playsInline=!0,e.next=11,this.inputVideo.play();case 11:case"end":return e.stop()}},e,this)}))}},{key:"updateInputCanvas",value:function(){return $(this,null,b().mark(function e(){var t,n,r,i,a;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.inputCanvas&&this.inputVideo){e.next=2;break}return e.abrupt("return");case 2:t=this.hmsTrack.getMediaTrackSettings(),n=t.width,r=void 0===n?Rn:n,i=t.height,a=void 0===i?_n:i,this.inputCanvas.height!==a&&(this.inputCanvas.height=a),this.inputCanvas.width!==r&&(this.inputCanvas.width=r),this.inputCanvas.getContext("2d").drawImage(this.inputVideo,0,0,r,a);case 4:case"end":return e.stop()}},e,this)}))}},{key:"resetCanvases",value:function(){if(this.outputCanvas&&this.inputCanvas){var e=this.inputCanvas.getContext("2d");e&&(e.fillStyle="rgb(0, 0, 0)",e.fillRect(0,0,this.outputCanvas.width,this.outputCanvas.height)),this.canvases=[]}}},{key:"checkIfSkipRequired",value:function(e){var t=!1;return this.pluginNumFramesSkipped[e]<this.pluginNumFramesToSkip[e]?(this.pluginNumFramesSkipped[e]++,t=!0):(t=!1,this.pluginNumFramesSkipped[e]=0),t}}]),e}();exports.HMSVideoPluginsManager=Nn;var On="HMSLocalStream",Mn=function(e){E(n,rt);var t=S(n);function n(){var e;return D(this,n),(e=t.apply(this,arguments)).connection=null,e}return O(n,[{key:"setConnection",value:function(e){this.connection=e}},{key:"addTransceiver",value:function(e,t){var n=[];if(e instanceof qn)if(t.length>0)ye.v(On,"Simulcast enabled with layers",t),n.push.apply(n,f(t));else{var r={active:this.nativeStream.active};e.settings.maxBitrate&&!re&&(r.maxBitrate=e.settings.maxBitrate),n.push(r)}var i=this.connection.addTransceiver(e.getTrackBeingSent(),{streams:[this.nativeStream],direction:"sendonly",sendEncodings:n});return this.setPreferredCodec(i,e.nativeTrack.kind),i}},{key:"setMaxBitrate",value:function(e,t){return $(this,null,b().mark(function n(){var r;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,null==(r=this.connection)?void 0:r.setMaxBitrate(e,t);case 2:case"end":return n.stop()}},n,this)}))}},{key:"setPreferredCodec",value:function(e,t){}},{key:"replaceTrack",value:function(e,t){return $(this,null,b().mark(function n(){return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.replaceSenderTrack(e,t);case 2:e.stop(),this.replaceStreamTrack(e,t);case 4:case"end":return n.stop()}},n,this)}))}},{key:"replaceStreamTrack",value:function(e,t){this.nativeStream.addTrack(t),this.nativeStream.removeTrack(e)}},{key:"replaceSenderTrack",value:function(e,t){return $(this,null,b().mark(function n(){var r,i;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==(i=null==(r=this.connection)?void 0:r.getSenders().find(function(t){return t.track&&t.track.id===e.id}))){n.next=4;break}return ye.w(On,"No sender found for trackId=".concat(e.id)),n.abrupt("return");case 4:return n.next=6,i.replaceTrack(t);case 6:case"end":return n.stop()}},n,this)}))}},{key:"removeSender",value:function(e){var t=this,n=0;this.connection.getSenders().forEach(function(r){var i,a;if((null==(i=r.track)?void 0:i.id)===e.trackId||(null==(a=r.track)?void 0:a.id)===e.getTrackIDBeingSent()){t.connection.removeTrack(r),n+=1;var s=t.tracks.indexOf(e);-1!==s?t.tracks.splice(s,1):ye.e(On,"Cannot find ".concat(e.trackId," in locally stored tracks"))}}),1!==n&&ye.e(On,"Removed ".concat(n," sender's, expected to remove 1"))}},{key:"trackUpdate",value:function(e){var t;null==(t=this.connection)||t.trackUpdate(e)}}]),n}(),Ln=function(){function e(){D(this,e)}return O(e,null,[{key:"connect",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Date,a=arguments.length>4?arguments[4]:void 0,s=this.eventNameFor("connect",void 0===e),o=e?un.ERROR:un.INFO,c=this.getPropertiesWithError(z(Q({},t),(p(n={},this.KEY_REQUESTED_AT,null==r?void 0:r.getTime()),p(n,this.KEY_RESPONDED_AT,null==i?void 0:i.getTime()),p(n,"endpoint",a),n)),e);return new dn({name:s,level:o,properties:c})}},{key:"disconnect",value:function(e,t){var n=e?un.ERROR:un.INFO,r=this.getPropertiesWithError(t,e);return new dn({name:"disconnected",level:n,properties:r})}},{key:"preview",value:function(e){var t=e,n=t.error,r=Z(t,["error"]),i=this.eventNameFor("preview",void 0===n),a=n?un.ERROR:un.INFO,s=this.getPropertiesWithError(r,n);return new dn({name:i,level:a,properties:s})}},{key:"join",value:function(e){var t=e,n=t.error,r=Z(t,["error"]),i=this.eventNameFor("join",void 0===n),a=n?un.ERROR:un.INFO,s=this.getPropertiesWithError(z(Q({},r),{is_preview_called:!!r.is_preview_called}),n);return new dn({name:i,level:a,properties:s})}},{key:"publish",value:function(e){var t=e.devices,n=e.settings,r=e.error,i=this.eventNameFor("publish",void 0===r),a=r?un.ERROR:un.INFO,s=this.getPropertiesWithError({devices:t,audio:null==n?void 0:n.audio,video:null==n?void 0:n.video},r);return new dn({name:i,level:a,properties:s})}},{key:"subscribeFail",value:function(e){var t=this.eventNameFor("subscribe",!1),n=un.ERROR,r=this.getErrorProperties(e);return new dn({name:t,level:n,properties:r})}},{key:"leave",value:function(){return new dn({name:"leave",level:un.INFO})}},{key:"autoplayError",value:function(){return new dn({name:"autoplayError",level:un.ERROR})}},{key:"deviceChange",value:function(e){var t=e.selection,n=e.type,r=e.devices,i=e.error,a=this.eventNameFor(i?"publish":"device.".concat(n),void 0===i),s=i?un.ERROR:un.INFO,o=this.getPropertiesWithError({selection:t,devices:r},i);return new dn({name:a,level:s,properties:o})}},{key:"performance",value:function(e){var t=un.INFO,n=e.toAnalyticsProperties();return new dn({name:"perf.stats",level:t,properties:n})}},{key:"rtcStats",value:function(e){var t=un.INFO,n=e.toAnalyticsProperties();return new dn({name:"rtc.stats",level:t,properties:n})}},{key:"degradationStats",value:function(e,t){var n=un.INFO,r={degradedAt:e.degradedAt,trackId:e.trackId};if(!t&&e.degradedAt instanceof Date){var i=new Date,a=i.valueOf()-e.degradedAt.valueOf();r=z(Q({},r),{duration:a,restoredAt:i})}return new dn({name:"video.degradation.stats",level:n,properties:r})}},{key:"audioDetectionFail",value:function(e,t){var n=this.getPropertiesWithError({device:t},e),r=un.ERROR;return new dn({name:"audiopresence.failed",level:r,properties:n})}},{key:"previewNetworkQuality",value:function(e){return new dn({name:"perf.networkquality.preview",level:e.error?un.ERROR:un.INFO,properties:e})}},{key:"HLSError",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new dn({name:"hls.".concat(t?"start":"stop",".failed"),level:un.ERROR,properties:this.getPropertiesWithError(e)})}},{key:"RTMPError",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new dn({name:"rtmp.".concat(t?"start":"stop",".failed"),level:un.ERROR,properties:this.getPropertiesWithError(e)})}},{key:"eventNameFor",value:function(e,t){return"".concat(e,".").concat(t?"success":"failed")}},{key:"getPropertiesWithError",value:function(e,t){var n=this.getErrorProperties(t);return e=Q(Q({},n),e)}},{key:"getErrorProperties",value:function(e){return e?e instanceof Ie?e.toAnalyticsProperties():{error_name:e.name,error_message:e.message,error_description:e.cause}:{}}}]),e}();function Un(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia(e);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),Jt(t.t0,Ot.AV);case 9:case"end":return t.stop()}},t,null,[[0,6]])}))}function Gn(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getDisplayMedia({video:e,audio:!1});case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),Jt(t.t0,Ot.SCREEN);case 9:case"end":return t.stop()}},t,null,[[0,6]])}))}function Fn(){return $(this,null,b().mark(function e(){var t,n;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:return t=e.sent,n={audioinput:[],audiooutput:[],videoinput:[]},e.abrupt("return",(t.forEach(function(e){return n[e.kind].push(e)}),n));case 8:throw e.prev=8,e.t0=e.catch(0),Jt(e.t0,Ot.AV);case 11:case"end":return e.stop()}},e,null,[[0,8]])}))}Ln.KEY_REQUESTED_AT="requested_at",Ln.KEY_RESPONDED_AT="responded_at";var Bn,Vn={audioContext:null,getAudioContext:function(){return this.audioContext||(this.audioContext=new AudioContext),this.audioContext},resumeContext:function(){this.getAudioContext().resume().catch(function(e){ye.e("AudioContext",e)})}};exports.HMSAudioContextHandler=Vn,function(e){e.INIT="init_response_time",e.WEBSOCKET_CONNECT="ws_connect_time",e.ON_POLICY_CHANGE="on_policy_change_time",e.LOCAL_TRACKS="local_tracks_time",e.JOIN="join_time",e.PREVIEW="preview_time"}(Bn||(Bn={}));var Hn,Wn=function(){function e(){D(this,e),this.eventPerformanceMeasures={}}return O(e,[{key:"start",value:function(e){performance.mark(e)}},{key:"end",value:function(e){var t;try{this.eventPerformanceMeasures[e]=performance.measure(e,e),ye.d("[HMSPerformanceTiming]",e,null==(t=this.eventPerformanceMeasures[e])?void 0:t.duration)}catch(n){ye.w("[AnalyticsTimer]","Error in measuring performance for event ".concat(e),{error:n})}}},{key:"getTimeTaken",value:function(e){var t;return null==(t=this.eventPerformanceMeasures[e])?void 0:t.duration}},{key:"getTimes",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.reduce(function(t,n){return z(Q({},t),p({},n,e.getTimeTaken(n)))},{})}},{key:"cleanUp",value:function(){this.eventPerformanceMeasures={}}}]),e}(),jn={isAudioMuted:!1,isVideoMuted:!1,audioInputDeviceId:"default",audioOutputDeviceId:"default",videoDeviceId:"default"},Kn=function(){function e(t,n,r,i,a){D(this,e),this.store=t,this.observer=n,this.deviceManager=r,this.eventBus=i,this.analyticsTimer=a,this.TAG="[LocalTrackManager]"}return O(e,[{key:"getTracksToPublish",value:function(e){return $(this,null,b().mark(function t(){var n,r,i,a,s,o,c,u,l,d,h;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.getTrackSettings(e)){t.next=3;break}return t.abrupt("return",[]);case 3:return r=!!n.audio,i=!!n.video,a=[],t.next=8,this.updateCurrentLocalTrackSettings(n);case 8:if(s=t.sent,o=s.videoTrack,c=s.audioTrack,u=(null==o?void 0:o.stream)||(null==c?void 0:c.stream),l=Boolean(o&&this.store.getTrackById(o.trackId)),d=Boolean(c&&this.store.getTrackById(c.trackId)),!l||!d){t.next=16;break}return t.abrupt("return",[]);case 16:return h={audio:r&&!c&&(!e.isAudioMuted||"empty"),video:i&&!o&&(!e.isVideoMuted||"empty")},this.analyticsTimer.start(Bn.LOCAL_TRACKS),t.prev=18,ye.d(this.TAG,"Init Local Tracks",{fetchTrackOptions:h}),t.next=22,this.getLocalTracks(h,n,u);case 22:a=t.sent,t.next=30;break;case 25:return t.prev=25,t.t0=t.catch(18),t.next=29,this.retryGetLocalTracks(t.t0,n,h,u);case 29:a=t.sent;case 30:return t.abrupt("return",(this.analyticsTimer.end(Bn.LOCAL_TRACKS),o&&i&&!l&&a.push(o),c&&r&&!d&&a.push(c),a));case 31:case"end":return t.stop()}},t,this,[[18,25]])}))}},{key:"getLocalTracks",value:function(){return $(this,arguments,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!0},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;return b().mark(function i(){var a;return b().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,e.getNativeLocalTracks(t,n);case 3:return a=i.sent,i.abrupt("return",e.createHMSLocalTracks(a,n,r));case 7:throw i.prev=7,i.t0=i.catch(0),e.eventBus.analytics.publish(Ln.publish({devices:e.deviceManager.getDevices(),error:i.t0,settings:n})),i.t0;case 10:case"end":return i.stop()}},i,null,[[0,7]])})()})}},{key:"getNativeLocalTracks",value:function(){return $(this,arguments,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{audio:!1,video:!1},n=arguments.length>1?arguments[1]:void 0;return b().mark(function r(){var i,a;return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=new Ct(!0===t.video?n.video:null,!0===t.audio?n.audio:null,n.simulcast),a=[],r.t0=i.audio||i.video,!r.t0){r.next=11;break}return r.t1=a.push,r.t2=a,r.t3=f,r.next=8,e.getAVTracks(i);case 8:r.t4=r.sent,r.t5=(0,r.t3)(r.t4),r.t1.apply.call(r.t1,r.t2,r.t5);case 11:return a.push.apply(a,f(e.getEmptyTracks(t))),r.abrupt("return",a);case 13:case"end":return r.stop()}},r)})()})}},{key:"getLocalScreen",value:function(e,t){return $(this,null,b().mark(function n(){var r,i,a,s,o,c,u,l,d;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r={video:e.toConstraints()},t&&(delete(i=t.toConstraints()).advanced,r.audio=z(Q({},i),{autoGainControl:!1,noiseSuppression:!1,googAutoGainControl:!1,echoCancellation:!1})),n.prev=2,n.next=5,navigator.mediaDevices.getDisplayMedia(r);case 5:a=n.sent,n.next=11;break;case 8:throw n.prev=8,n.t0=n.catch(2),Jt(n.t0,Ot.SCREEN);case 11:return s=[],o=new Mn(a),c=a.getVideoTracks()[0],u=new qn(o,c,"screen",this.eventBus,e),s.push(u),(l=a.getAudioTracks()[0])&&(d=new An(o,l,"screen",this.eventBus,t),s.push(d)),n.abrupt("return",(ye.v(this.TAG,"getLocalScreen",s),s));case 16:case"end":return n.stop()}},n,this,[[2,8]])}))}},{key:"requestPermissions",value:function(){return $(this,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 3:e.sent.getTracks().forEach(function(e){return e.stop()}),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),ye.e(this.TAG,e.t0);case 9:case"end":return e.stop()}},e,this,[[0,6]])}))}},{key:"getAVTracks",value:function(e){return $(this,null,b().mark(function t(){var n,r,i,a;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia({audio:!!e.audio&&e.audio.toConstraints(),video:!!e.video&&e.video.toConstraints()});case 3:return n=t.sent,t.abrupt("return",n.getVideoTracks().concat(n.getAudioTracks()));case 7:return t.prev=7,t.t0=t.catch(0),t.next=11,this.deviceManager.init();case 11:throw r=!(this.deviceManager.hasWebcamPermission||!e.video),i=!(this.deviceManager.hasMicrophonePermission||!e.audio),a=this.getErrorType(r,i),Jt(t.t0,a);case 13:case"end":return t.stop()}},t,this,[[0,7]])}))}},{key:"getTrackSettings",value:function(e){var t=this.getAudioSettings(e),n=this.getVideoSettings(e);if(!t&&!n)return null;var r=this.getScreenSettings();return(new Pt).video(n).audio(t).screen(r).build()}},{key:"retryGetLocalTracks",value:function(e,t,n,r){return $(this,null,b().mark(function i(){var a,s,o,c,u,l,d;return b().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(e instanceof Ie&&e.action===Ae.TRACK)){i.next=37;break}if(this.observer.onFailure(e),a=e.code===xe.TracksErrors.OVER_CONSTRAINED,s=e.message.includes("audio"),o=e.message.includes("video"),!a){i.next=19;break}return c=(new Pt).video(new It).audio(new At).build(),ye.w(this.TAG,"Fetch AV Tracks failed with overconstrained error",{fetchTrackOptions:n},{error:e}),i.prev=6,i.next=9,this.getLocalTracks(n,c,r);case 9:return i.abrupt("return",i.sent);case 12:return i.prev=12,i.t0=i.catch(6),u=i.t0 instanceof Ie?i.t0.nativeError:i.t0,l=i.t0,"OverconstrainedError"===(null==u?void 0:u.name)&&((d=Pe.TracksErrors.GenericTrack(Ae.TRACK,"Overconstrained error after dropping all constraints")).addNativeError(u),l=d),i.next=18,this.retryGetLocalTracks(l,t,n,r);case 18:return i.abrupt("return",i.sent);case 19:return n.audio=s?"empty":n.audio,n.video=o?"empty":n.video,ye.w(this.TAG,"Fetch AV Tracks failed",{fetchTrackOptions:n},e),i.prev=20,i.next=23,this.getLocalTracks(n,t,r);case 23:return i.abrupt("return",i.sent);case 26:return i.prev=26,i.t1=i.catch(20),ye.w(this.TAG,"Fetch empty tacks failed",i.t1),n.audio=n.audio&&"empty",n.video=n.video&&"empty",this.observer.onFailure(i.t1),i.next=34,this.getLocalTracks(n,t,r);case 34:return i.abrupt("return",i.sent);case 35:i.next=38;break;case 37:return i.abrupt("return",(ye.w(this.TAG,"Fetch AV Tracks failed - unknown exception",e),this.observer.onFailure(e),[]));case 38:case"end":return i.stop()}},i,this,[[6,12],[20,26]])}))}},{key:"getErrorType",value:function(e,t){return e&&t?Ot.AV:e?Ot.VIDEO:t?Ot.AUDIO:Ot.UNKNOWN}},{key:"getEmptyTracks",value:function(t){var n=[];return"empty"===t.audio&&n.push(e.getEmptyAudioTrack()),"empty"===t.video&&n.push(e.getEmptyVideoTrack()),n}},{key:"updateCurrentLocalTrackSettings",value:function(e){return $(this,null,b().mark(function t(){var n,r,i,a;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.store.getLocalPeerTracks(),r=n.find(function(e){return e.type===Le.VIDEO&&"regular"===e.source}),i=n.find(function(e){return e.type===Le.AUDIO&&"regular"===e.source}),a=n.find(function(e){return e.type===Le.VIDEO&&"screen"===e.source}),t.t0=null==e?void 0:e.video,!t.t0){t.next=5;break}return t.next=5,null==r?void 0:r.setSettings(e.video);case 5:if(t.t1=null==e?void 0:e.audio,!t.t1){t.next=9;break}return t.next=9,null==i?void 0:i.setSettings(e.audio);case 9:if(t.t2=null==e?void 0:e.screen,!t.t2){t.next=13;break}return t.next=13,null==a?void 0:a.setSettings(e.screen);case 13:return t.abrupt("return",{videoTrack:r,audioTrack:i});case 14:case"end":return t.stop()}},t,this)}))}},{key:"getAudioSettings",value:function(e){var t,n=this.store.getPublishParams();if(!n||!(null==(t=n.allowed)?void 0:t.includes("audio")))return null;var r=this.store.getLocalPeer(),i=null==r?void 0:r.audioTrack,a=(null==i?void 0:i.settings.deviceId)||e.audioInputDeviceId;return(new wt).codec(n.audio.codec).maxBitrate(n.audio.bitRate).deviceId(a||jn.audioInputDeviceId).build()}},{key:"getVideoSettings",value:function(e){var t,n=this.store.getPublishParams();if(!n||!(null==(t=n.allowed)?void 0:t.includes("video")))return null;var r=this.store.getLocalPeer(),i=null==r?void 0:r.videoTrack,a=(null==i?void 0:i.settings.deviceId)||e.videoDeviceId,s=n.video,o=this.store.getSimulcastDimensions("regular")||{},c=o.width,u=void 0===c?s.width:c,l=o.height,d=void 0===l?s.height:l;return(new xt).codec(s.codec).maxBitrate(s.bitRate).maxFramerate(s.frameRate).setWidth(u).setHeight(d).deviceId(a||jn.videoDeviceId).build()}},{key:"getScreenSettings",value:function(){var e,t=this.store.getPublishParams();if(!t||!(null==(e=t.allowed)?void 0:e.includes("screen")))return null;var n=t.screen,r=this.store.getSimulcastDimensions("screen")||{},i=r.width,a=void 0===i?n.width:i,s=r.height,o=void 0===s?n.height:s;return(new xt).maxBitrate(n.bitRate,!1).codec(n.codec).maxFramerate(n.frameRate).setWidth(a).setHeight(o).build()}},{key:"createHMSLocalTracks",value:function(e,t,n){var r=e.find(function(e){return"video"===e.kind}),i=e.find(function(e){return"audio"===e.kind});n?e.forEach(function(e){return null==n?void 0:n.nativeStream.addTrack(e)}):n=new Mn(new MediaStream(e));var a=[];if(i&&(null==t?void 0:t.audio)){var s=new An(n,i,"regular",this.eventBus,t.audio);a.push(s)}if(r&&(null==t?void 0:t.video)){var o=new qn(n,r,"regular",this.eventBus,t.video);a.push(o)}return a}}],[{key:"getEmptyVideoTrack",value:function(e){var t,n,r,i=(null==(t=null==e?void 0:e.getSettings())?void 0:t.width)||320,a=(null==(n=null==e?void 0:e.getSettings())?void 0:n.height)||240;Hn||(null==(r=(Hn=Object.assign(document.createElement("canvas"),{width:i,height:a})).getContext("2d"))||r.fillRect(0,0,i,a));var s=Hn.captureStream(10).getVideoTracks()[0],o=setInterval(function(){if("ended"!==s.readyState){var e=Hn.getContext("2d");if(e){var t=0===e.getImageData(0,0,1,1).data[0]?1:0;e.fillStyle="rgb(".concat(t,", 0, 0)"),e.fillRect(0,0,1,1)}}else clearInterval(o)},100);return s.onended=function(){clearInterval(o)},s.enabled=!1,s}},{key:"getEmptyAudioTrack",value:function(){var e=Vn.getAudioContext(),t=e.createOscillator(),n=e.createMediaStreamDestination();t.connect(n),t.start();var r=n.stream.getAudioTracks()[0];return r.enabled=!1,r}}]),e}();function Jn(e,t){return function(n){return n in e&&e[n]!==t[n]}}var qn=function(e){E(n,lt);var t=S(n);function n(e,r,i,a){var s,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(new xt).build();return D(this,n),(s=t.call(this,e,r,i)).eventBus=a,s.buildNewSettings=function(e){var t=Q(Q({},s.settings),e),n=t.width,r=t.height,i=t.codec,a=t.maxFramerate,o=t.maxBitrate,c=t.deviceId,u=t.advanced;return new It(n,r,i,a,c,u,o)},s.handleSettingsChange=function(e){return $(A(s),null,b().mark(function t(){var n,r;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.stream,r=Jn(e,this.settings),t.t0=r("maxBitrate")&&e.maxBitrate,!t.t0){t.next=5;break}return t.next=5,n.setMaxBitrate(e.maxBitrate,this);case 5:if(t.t1=r("width")||r("height")||r("advanced"),!t.t1){t.next=9;break}return t.next=9,this.nativeTrack.applyConstraints(e.toConstraints());case 9:case"end":return t.stop()}},t,this)}))},s.handleDeviceChange=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return $(A(s),null,b().mark(function n(){var r;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!Jn(e,this.settings)("deviceId")||"regular"!==this.source){n.next=9;break}if(!this.enabled){n.next=8;break}return n.next=4,this.replaceTrackWith(e);case 4:return r=n.sent,n.next=7,this.replaceSender(r,this.enabled);case 7:this.nativeTrack=r;case 8:t||Tn.updateSelection("videoInput",{deviceId:e.deviceId,groupId:this.nativeTrack.getSettings().groupId});case 9:case"end":return n.stop()}},n,this)}))},e.tracks.push(A(s)),s.settings=o,"default"===o.deviceId&&r.enabled&&(s.settings=s.buildNewSettings({deviceId:r.getSettings().deviceId})),s.pluginsManager=new Nn(A(s),a),s.setFirstTrackId(s.trackId),s}return O(n,[{key:"setEnabled",value:function(e){var t=this;return $(this,null,b().mark(function r(){var i;return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e===this.enabled){r.next=23;break}if("regular"!==this.source){r.next=19;break}if(!e){r.next=8;break}return r.next=5,this.replaceTrackWith(this.settings);case 5:i=r.sent,r.next=11;break;case 8:return r.next=10,this.replaceTrackWithBlank();case 10:i=r.sent;case 11:return r.next=13,this.replaceSender(i,e);case 13:if(this.nativeTrack=i,r.t0=e,!r.t0){r.next=19;break}return r.next=18,this.pluginsManager.waitForRestart();case 18:this.settings=this.buildNewSettings({deviceId:i.getSettings().deviceId});case 19:return r.next=21,(a="setEnabled",y(_(n.prototype),a,t)).call(this,e);case 21:this.eventBus.localVideoEnabled.publish({enabled:e,track:this}),this.stream.trackUpdate(this);case 23:case"end":return r.stop()}var a},r,this)}))}},{key:"isPublishedTrackId",value:function(e){return this.publishedTrackId===e}},{key:"addSink",value:function(e){this.addSinkInternal(e,this.processedTrack||this.nativeTrack)}},{key:"setSettings",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return $(this,null,b().mark(function n(){var r;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=this.buildNewSettings(e),n.next=3,this.handleDeviceChange(r,t);case 3:if(this.enabled){n.next=6;break}return this.settings=r,n.abrupt("return");case 6:return n.next=8,this.handleSettingsChange(r);case 8:this.settings=r;case 9:case"end":return n.stop()}},n,this)}))}},{key:"getPlugins",value:function(){return this.pluginsManager.getPlugins()}},{key:"addPlugin",value:function(e,t){return $(this,null,b().mark(function n(){return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.pluginsManager.addPlugin(e,t));case 1:case"end":return n.stop()}},n,this)}))}},{key:"removePlugin",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.pluginsManager.removePlugin(e));case 1:case"end":return t.stop()}},t,this)}))}},{key:"validatePlugin",value:function(e){return this.pluginsManager.validatePlugin(e)}},{key:"cleanup",value:function(){var e=this;return $(this,null,b().mark(function t(){var r;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(i="cleanup",y(_(n.prototype),i,e)).call(this),t.next=3,this.pluginsManager.cleanup();case 3:null==(r=this.processedTrack)||r.stop();case 4:case"end":return t.stop()}var i},t,this)}))}},{key:"setProcessedTrack",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.nativeTrack.enabled){t.next=3;break}return this.processedTrack=e,t.abrupt("return");case 3:if(e){t.next=10;break}if(t.t0=this.processedTrack,!t.t0){t.next=8;break}return t.next=8,this.stream.replaceSenderTrack(this.processedTrack,this.nativeTrack);case 8:return this.processedTrack=void 0,t.abrupt("return");case 10:if(t.t1=e!==this.processedTrack,!t.t1){t.next=20;break}if(!this.processedTrack){t.next=17;break}return t.next=15,this.stream.replaceSenderTrack(this.processedTrack,e);case 15:t.next=19;break;case 17:return t.next=19,this.stream.replaceSenderTrack(this.nativeTrack,e);case 19:this.processedTrack=e;case 20:case"end":return t.stop()}},t,this)}))}},{key:"getTrackIDBeingSent",value:function(){return this.getTrackBeingSent().id}},{key:"getTrackBeingSent",value:function(){return this.enabled&&this.processedTrack||this.nativeTrack}},{key:"replaceTrackWith",value:function(e){return $(this,null,b().mark(function t(){var n,r;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return null==(n=this.nativeTrack)||n.stop(),t.next=4,Yt(e);case 4:return r=t.sent,t.abrupt("return",("default"===this.settings.deviceId&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),r));case 6:case"end":return t.stop()}},t,this)}))}},{key:"replaceTrackWithBlank",value:function(){return $(this,null,b().mark(function e(){var t;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.nativeTrack,e.abrupt("return",(null==t||t.stop(),Kn.getEmptyVideoTrack(t)));case 2:case"end":return e.stop()}},e,this)}))}},{key:"replaceSender",value:function(e,t){return $(this,null,b().mark(function n(){var r;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.stream,!t){n.next=6;break}return n.next=4,r.replaceSenderTrack(this.nativeTrack,this.processedTrack||e);case 4:n.next=8;break;case 6:return n.next=8,r.replaceSenderTrack(this.processedTrack||this.nativeTrack,e);case 8:return n.next=10,r.replaceStreamTrack(this.nativeTrack,e);case 10:case"end":return n.stop()}},n,this)}))}}]),n}();exports.HMSLocalVideoTrack=qn;var Yn,Qn=function(){function e(t,n,r){var i=this;D(this,e),this.store=t,this.eventBus=n,this.listener=r,this.tracksToProcess=new Map,this.handleTrackAdd=function(e){ye.d(i.TAG,"ONTRACKADD","".concat(e)),i.store.addTrack(e),i.tracksToProcess.set(e.trackId,e),i.processPendingTracks()},this.handleTrackRemove=function(e){var t;ye.d(i.TAG,"ONTRACKREMOVE","".concat(e));var n=i.store.getTrackState(e.trackId);if(n){e.type===Le.AUDIO&&i.eventBus.audioTrackRemoved.publish(e);var r=i.store.getPeerById(n.peerId);!r||(i.removePeerTracks(r,e),i.store.removeTrack(e.trackId),null==(t=i.listener)||t.onTrackUpdate(fe.TRACK_REMOVED,e,r))}},this.handleTrackLayerUpdate=function(e){var t,n;for(var r in e.tracks){var a=e.tracks[r],s=i.store.getTrackById(r);if(s){var o=i.store.getPeerByTrackId(r);if(o&&s instanceof dt){var c=i.isTrackDegraded(a.expected_layer,a.current_layer);s.setLayerFromServer(a.current_layer,c),c?null==(t=i.listener)||t.onTrackUpdate(fe.TRACK_DEGRADED,s,o):null==(n=i.listener)||n.onTrackUpdate(fe.TRACK_RESTORED,s,o)}}}},this.handleTrackUpdate=function(e){var t,n,r=i.store.getPeerById(e.peer.peer_id);if(r)for(var a in e.tracks){var s=Object.assign({},null==(t=i.store.getTrackState(a))?void 0:t.trackInfo),o=e.tracks[a],c=i.store.getTrackById(a);if(i.store.setTrackState({peerId:e.peer.peer_id,trackInfo:Q(Q({},s),o)}),!c||i.tracksToProcess.has(a))i.processPendingTracks();else{c.setEnabled(!o.mute);var u=i.processTrackUpdate(c,s,o);u&&(null==(n=i.listener)||n.onTrackUpdate(u,c,r))}}}}return O(e,[{key:"TAG",get:function(){return"[".concat(this.constructor.name,"]")}},{key:"isTrackDegraded",value:function(e,t){var n=function(e){switch(e){case ge.HIGH:return 3;case ge.MEDIUM:return 2;case ge.LOW:return 1;case ge.NONE:return 0}};return n(t)<n(e)}},{key:"handleTrackMetadataAdd",value:function(e){for(var t in ye.d(this.TAG,"TRACK_METADATA_ADD",JSON.stringify(e,null,2)),e.tracks)this.store.setTrackState({peerId:e.peer.peer_id,trackInfo:e.tracks[t]});this.processPendingTracks()}},{key:"processPendingTracks",value:function(){var e=this;new Map(this.tracksToProcess).forEach(function(t){var n,r=e.store.getTrackState(t.trackId);if(r){var i=e.store.getPeerById(r.peerId);!i||(t.source=r.trackInfo.source,t.peerId=i.peerId,t.logIdentifier=i.name,t.setEnabled(!r.trackInfo.mute),e.addAudioTrack(i,t),e.addVideoTrack(i,t),t.type===Le.AUDIO?e.eventBus.audioTrackAdded.publish({track:t,peer:i}):null==(n=e.listener)||n.onTrackUpdate(fe.TRACK_ADDED,t,i),e.tracksToProcess.delete(t.trackId))}})}},{key:"removePeerTracks",value:function(e,t){var n,r,i=e.auxiliaryTracks.indexOf(t);i>-1?e.auxiliaryTracks.splice(i,1):t.type===Le.AUDIO&&(null==(n=e.audioTrack)?void 0:n.trackId)===t.trackId?e.audioTrack=void 0:t.type===Le.VIDEO&&(null==(r=e.videoTrack)?void 0:r.trackId)===t.trackId&&(e.videoTrack=void 0)}},{key:"addAudioTrack",value:function(e,t){t.type===Le.AUDIO&&(e.audioTrack||"regular"!==t.source?e.auxiliaryTracks.push(t):e.audioTrack=t)}},{key:"addVideoTrack",value:function(e,t){if(t.type===Le.VIDEO){var n=t,r=this.store.getSimulcastDefinitionsForPeer(e,n.source);n.setSimulcastDefinitons(r),e.videoTrack||"regular"!==t.source?e.auxiliaryTracks.push(n):e.videoTrack=n}}},{key:"processTrackUpdate",value:function(e,t,n){var r;return e.setEnabled(!n.mute),t.mute!==n.mute?(r=n.mute?fe.TRACK_MUTED:fe.TRACK_UNMUTED,e.type===Le.AUDIO&&this.eventBus.audioTrackUpdate.publish({track:e,enabled:!n.mute})):t.description!==n.description&&(r=fe.TRACK_DESCRIPTION_CHANGED),r}}]),e}(),zn=function(){function e(t){D(this,e),this.listener=t}return O(e,[{key:"handleQualityUpdate",value:function(e){var t,n=e.peers.map(function(e){return{peerID:e.peer_id,downlinkQuality:e.downlink_score}});null==(t=this.listener)||t.onConnectionQualityUpdate(n)}}]),e}(),Zn=function(){function e(t,n,r,i,a){var s=this;D(this,e),this.store=t,this.listener=r,this.audioListener=i,this.connectionQualityListener=a,this.TAG="[HMSNotificationManager]",this.hasConsistentRoomStateArrived=!1,this.ignoreNotification=function(e){if(e===Et.PEER_LIST)s.hasConsistentRoomStateArrived=!0;else if(e===Et.ROOM_STATE)return s.hasConsistentRoomStateArrived;return!1},this.handleTrackAdd=function(e){s.trackManager.handleTrackAdd(e)},this.handleTrackRemove=function(e){s.trackManager.handleTrackRemove(e)},this.updateLocalPeer=function(e){var t=e.name,n=e.metadata,r=s.store.getLocalPeer();s.peerManager.handlePeerInfoUpdate({peer:r,name:t,data:n})},this.trackManager=new Qn(this.store,n,this.listener),this.peerManager=new Bt(this.store,this.trackManager,this.listener),this.peerListManager=new Gt(this.store,this.peerManager,this.trackManager,this.listener),this.broadcastManager=new Ut(this.store,this.listener),this.policyChangeManager=new Vt(this.store,n),this.requestManager=new Ht(this.store,this.listener),this.activeSpeakerManager=new Rt(this.store,this.listener,this.audioListener),this.connectionQualityManager=new zn(this.connectionQualityListener),this.roomUpdateManager=new Wt(this.store,this.listener)}return O(e,[{key:"setListener",value:function(e){this.listener=e,this.trackManager.listener=e,this.peerManager.listener=e,this.peerListManager.listener=e,this.broadcastManager.listener=e,this.requestManager.listener=e,this.activeSpeakerManager.listener=e,this.roomUpdateManager.listener=e}},{key:"setAudioListener",value:function(e){this.audioListener=e,this.activeSpeakerManager.audioListener=e}},{key:"setConnectionQualityListener",value:function(e){this.connectionQualityListener=e,this.connectionQualityManager.listener=e}},{key:"handleNotification",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.method,a=e.params;[Et.ACTIVE_SPEAKERS,Et.SFU_STATS,Et.CONNECTION_QUALITY].includes(i)||ye.d(this.TAG,"Received notification - ".concat(i),{notification:a}),i===Et.SFU_STATS&&(null==(t=window.HMS)?void 0:t.ON_SFU_STATS)&&"function"==typeof(null==(n=window.HMS)?void 0:n.ON_SFU_STATS)&&window.HMS.ON_SFU_STATS(e.params),!this.ignoreNotification(i)&&(this.roomUpdateManager.handleNotification(i,a),this.peerManager.handleNotification(i,a),this.requestManager.handleNotification(i,a),this.peerListManager.handleNotification(i,a,r),this.broadcastManager.handleNotification(i,a),this.handleIsolatedMethods(i,a))}},{key:"handleIsolatedMethods",value:function(e,t){switch(e){case Et.TRACK_METADATA_ADD:this.trackManager.handleTrackMetadataAdd(t);break;case Et.TRACK_UPDATE:this.trackManager.handleTrackUpdate(t);break;case Et.ON_SFU_TRACK_LAYER_UPDATE:this.trackManager.handleTrackLayerUpdate(t);break;case Et.ACTIVE_SPEAKERS:this.activeSpeakerManager.handleActiveSpeakers(t);break;case Et.CONNECTION_QUALITY:this.connectionQualityManager.handleQualityUpdate(t);break;case Et.POLICY_CHANGE:this.policyChangeManager.handlePolicyChange(t)}}}]),e}(),Xn=O(function e(t){D(this,e),this.type=t.type,this.source=t.source||"regular",this.description="",t instanceof ot?(this.mute=!t.enabled,this.track_id=t.publishedTrackId,this.stream_id=t.stream.id):(this.mute=t.mute,this.track_id=t.track_id,this.stream_id=t.stream_id)});!function(e){e.Disconnected="Disconnected",e.Connecting="Connecting",e.Joined="Joined",e.Preview="Preview",e.Failed="Failed",e.Reconnecting="Reconnecting",e.Leaving="Leaving"}(Yn||(Yn={}));var $n,er,tr=O(function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"https://prod-init.100ms.live/init",s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];D(this,e),this.authToken=t,this.peerId=n,this.peerName=r,this.data=i,this.endpoint=a,this.autoSubscribeVideo=s});!function(e){e.FLAG_SERVER_SUB_DEGRADATION="subscribeDegradation",e.FLAG_SERVER_SIMULCAST="simulcast",e.FLAG_NON_WEBRTC_DISABLE_OFFER="nonWebRTCDisableOffer"}($n||($n={})),function(e){e[e.ConnectFailed=0]="ConnectFailed",e[e.SignalDisconnect=1]="SignalDisconnect",e[e.JoinWSMessageFailed=2]="JoinWSMessageFailed",e[e.PublishIceConnectionFailed=3]="PublishIceConnectionFailed",e[e.SubscribeIceConnectionFailed=4]="SubscribeIceConnectionFailed"}(er||(er={}));var nr=(p(n={},0,[]),p(n,1,[]),p(n,2,[1]),p(n,3,[1]),p(n,4,[1]),n),rr=O(function e(t){var n=this;D(this,e),this.promise=new Promise(function(e,r){n.resolve=e,n.reject=r,t(e,r)})}),ir="[RetryScheduler]",ar=function(){function e(t,n){D(this,e),this.onStateChange=t,this.sendEvent=n,this.inProgress=new Map,this.retryTaskIds=[]}return O(e,[{key:"schedule",value:function(e){return $(this,arguments,function(e){var t=this,n=e.category,r=e.error,i=e.task,a=e.originalState,s=e.maxFailedRetries,o=void 0===s?He:s,c=e.changeState,u=void 0===c||c;return b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.scheduleTask({category:n,error:r,changeState:u,task:i,originalState:a,maxFailedRetries:o});case 2:case"end":return e.stop()}},e)})()})}},{key:"reset",value:function(){this.retryTaskIds.forEach(function(e){return clearTimeout(e)}),this.retryTaskIds=[],this.inProgress.clear()}},{key:"scheduleTask",value:function(e){return $(this,arguments,function(e){var t=this,n=e.category,r=e.error,i=e.changeState,a=e.task,s=e.originalState,o=e.maxFailedRetries,c=void 0===o?He:o,u=e.failedRetryCount,l=void 0===u?0:u;return b().mark(function e(){var o,u,d,h,v,p,f,k,g,m;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(ye.d(ir,"schedule: ",{category:er[n],error:r}),0!==l){e.next=9;break}if(!(o=t.inProgress.get(n))){e.next=7;break}return ye.d(ir,"schedule: Already a task for ".concat(er[n]," scheduled, waiting for its completion")),e.next=6,o.promise;case 6:return e.abrupt("return");case 7:u=new rr(function(e,t){}),t.inProgress.set(n,u),t.sendEvent(r,n);case 9:d=!1,h=nr[n],e.t0=b().keys(h);case 11:if((e.t1=e.t0()).done){e.next=30;break}if(v=e.t1.value,p=h[parseInt(v)],e.prev=14,f=t.inProgress.get(p),e.t2=f,!e.t2){e.next=22;break}return ye.d(ir,"schedule: Suspending retry task of ".concat(er[n],", waiting for ").concat(er[p]," to recover")),e.next=21,f.promise;case 21:ye.d(ir,"schedule: Resuming retry task ".concat(er[n]," as it's dependency ").concat(er[p]," is recovered"));case 22:e.next=28;break;case 24:return e.prev=24,e.t3=e.catch(14),ye.d(ir,"schedule: Stopping retry task of ".concat(er[n]," as it's dependency ").concat(er[p]," failed to recover")),d=!0,e.abrupt("break",30);case 28:e.next=11;break;case 30:if(!(l>=c||d)){e.next=37;break}if(r.description+=". [".concat(er[n],"] Could not recover after ").concat(l," tries"),d&&(r.description+=" Could not recover all of it's required dependencies - [".concat(h.map(function(e){return er[e]}).toString(),"]")),r.isTerminal=!0,t.inProgress.delete(n),t.sendEvent(r,n),t.reset(),!i){e.next=35;break}t.onStateChange(Yn.Failed,r),e.next=36;break;case 35:throw r;case 36:return e.abrupt("return");case 37:return i&&t.onStateChange(Yn.Reconnecting,r),k=t.getDelayForRetryCount(n,l),ye.i(ir,"schedule: [".concat(er[n],"] [failedRetryCount=").concat(l,"] Scheduling retry task in ").concat(k,"ms")),e.prev=40,e.next=43,t.setTimeoutPromise(a,k);case 43:g=e.sent,e.next=49;break;case 46:e.prev=46,e.t4=e.catch(40),g=!1,ye.w(ir,"[".concat(er[n],"] Un-caught exception ").concat(e.t4.name," in retry-task, initiating retry"),e.t4);case 49:if(!g){e.next=54;break}m=t.inProgress.get(n),t.inProgress.delete(n),null==m||m.resolve(l),i&&0===t.inProgress.size&&t.onStateChange(s),ye.i(ir,"schedule: [".concat(er[n],"] [failedRetryCount=").concat(l,"] Recovered ♻️")),e.next=56;break;case 54:return e.next=56,t.scheduleTask({category:n,error:r,changeState:i,task:a,originalState:s,maxFailedRetries:c,failedRetryCount:l+1});case 56:case"end":return e.stop()}},e,null,[[14,24],[40,46]])})()})}},{key:"getBaseDelayForTask",value:function(e,t){return e===er.JoinWSMessageFailed?2:Math.pow(2,t)}},{key:"getDelayForRetryCount",value:function(e,t){var n=this.getBaseDelayForTask(e,t),r=e===er.JoinWSMessageFailed?2*Math.random():Math.random();return Math.round(1e3*Math.min(n+r,We))}},{key:"setTimeoutPromise",value:function(e,t){return $(this,null,b().mark(function n(){var r=this;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise(function(n,i){var a=window.setTimeout(function(){return $(r,null,b().mark(function t(){var r;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:(r=t.sent)&&this.retryTaskIds.splice(this.retryTaskIds.indexOf(a),1),n(r),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),i(t.t0);case 10:case"end":return t.stop()}},t,this,[[0,7]])}))},t);r.retryTaskIds.push(a)}));case 1:case"end":return n.stop()}},n)}))}}]),e}(),sr=function(){function e(){D(this,e),this.TAG="[HTTPAnalyticsTransport]",this.failedEvents=new te("client-events"),this.isConnected=!0,this.env=null}return O(e,[{key:"setEnv",value:function(e){this.env=e,this.flushFailedEvents()}},{key:"sendEvent",value:function(e){var t=this;if(this.env){var n={event:e.name,payload:e.properties,event_id:String(e.timestamp),peer:e.metadata.peer,timestamp:e.timestamp,device_id:e.device_id},r=this.env===V.PROD?Ze:Xe;fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.metadata.token),user_agent_v2:e.metadata.userAgent},body:JSON.stringify(n)}).then(function(n){if(401!==n.status){if(200!==n.status)throw Error(n.statusText);t.removeFromStorage(e)}else t.removeFromStorage(e)}).catch(function(n){ye.v(t.TAG,"Failed to send event",n,e),t.addEventToStorage(e)})}else this.addEventToStorage(e)}},{key:"flushFailedEvents",value:function(){var e=this,t=this.failedEvents.get();null==t||t.forEach(function(t){return e.sendEvent(t)})}},{key:"addEventToStorage",value:function(e){var t=this.failedEvents.get()||[];t.find(function(t){return t.timestamp===e.timestamp})||(t.length===$e&&t.shift(),t.push(e),this.failedEvents.set(t))}},{key:"removeFromStorage",value:function(e){var t=this.failedEvents.get()||[],n=t.findIndex(function(t){return t.timestamp===e.timestamp});n>-1&&(t.splice(n,1),this.failedEvents.set(t))}}]),e}(),or=new sr,cr=function(){function e(){D(this,e),this.TAG="AnalyticsTransport"}return O(e,[{key:"sendEvent",value:function(e){try{this.sendSingleEvent(e),this.flushFailedEvents()}catch(t){ye.w(this.TAG,"sendEvent failed",t)}}},{key:"flushFailedEvents",value:function(e){var t;try{for(ye.d(this.TAG,"Flushing failed events",this.failedEvents);this.failedEvents.size()>0;){var n=this.failedEvents.dequeue();n&&((null==(t=n.metadata)?void 0:t.peer.peer_id)!==e&&n.metadata.peer.peer_id?or.sendEvent(n):this.sendSingleEvent(n))}}catch(r){ye.w(this.TAG,"flushFailedEvents failed",r)}}},{key:"sendSingleEvent",value:function(e){try{this.transportProvider.sendEvent(e),ye.d(this.TAG,"Sent event",e.name,e)}catch(t){throw ye.w(this.TAG,"".concat(this.transportProvider.TAG,".sendEvent failed, adding to local storage events"),{event:e,error:t}),this.failedEvents.enqueue(e),t}}}]),e}(),ur=function(e){E(n,Tt);var t=S(n);function n(){var e;return D(this,n),(e=t.call(this,Ve)).localStorage=new te("hms-analytics"),e.localStorage.clear(),e.initLocalStorageQueue(),e}return O(n,[{key:"enqueue",value:function(e){y(_(n.prototype),"enqueue",this).call(this,e),this.localStorage.set(this.storage)}},{key:"dequeue",value:function(){var e=y(_(n.prototype),"dequeue",this).call(this);return this.localStorage.set(this.storage),e}},{key:"initLocalStorageQueue",value:function(){var e,t=this;null==(e=this.localStorage.get())||e.forEach(function(e){var r=new dn(e);y(_(n.prototype),"enqueue",t).call(t,r)})}}]),n}(),lr=function(e){E(n,cr);var t=S(n);function n(e){var r;return D(this,n),(r=t.call(this)).transportProvider=e,r.failedEvents=new ur,r}return O(n)}(),dr=function(){function e(t,n){D(this,e),this.store=t,this.eventBus=n,this.TAG="[TrackDegradationController]",this.MAX_RECOVER_GRACE_PERIOD=120,this.recoverAttemptCount=0,this.packetsLost=0;var r=this.store.getSubscribeDegradationParams();this.PACKETS_LOST_THRESHOLD=r.packetLossThreshold,this.MIN_DEGRADE_GRACE_PERIOD=r.degradeGracePeriodSeconds,this.MIN_RECOVER_GRACE_PERIOD=r.recoverGracePeriodSeconds,this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,this.recoverGracePeriod=this.MIN_RECOVER_GRACE_PERIOD}return O(e,[{key:"isAttemptingRecover",get:function(){return Boolean(this.recoveringTrack)}},{key:"handleRtcStatsChange",value:function(e){var t=e>this.packetsLost+this.PACKETS_LOST_THRESHOLD;this.packetsLost=e,t?this.degrade():this.recover()}},{key:"degrade",value:function(){if(!(this.degradeGracePeriod>0))return this.isAttemptingRecover?this.cancelRecovery():(ye.d(this.TAG,"Packet loss increased, Degrading",{packetsLost:this.packetsLost}),this.degradeActiveTracksByHalf(),this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,void(this.recoverGracePeriod=this.MIN_RECOVER_GRACE_PERIOD));this.degradeGracePeriod--}},{key:"recover",value:function(){this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,this.recoverGracePeriod>0?this.recoverGracePeriod--:(this.recoveringTrack=this.getActiveTracks(!0).find(function(e){return e.degraded}),this.recoveringTrack&&(ye.d(this.TAG,"Packet lost stable, recovering track",this.recoveringTrack),this.recoveringTrack.setDegradedFromSdk(!1),this.eventBus.trackRestored.publish(this.recoveringTrack),this.recoverGracePeriod=this.MIN_RECOVER_GRACE_PERIOD))}},{key:"cleanUp",value:function(){this.eventBus.trackDegraded.removeAllListeners(),this.eventBus.trackRestored.removeAllListeners()}},{key:"degradeActiveTracksByHalf",value:function(){var e=this.getActiveTracks(!1);if(e.length){ye.d(this.TAG,{activeTracks:f(e)});for(var t=Math.ceil(e.length/2);t--;){var n=e.pop();n.setDegradedFromSdk(!0),this.eventBus.trackDegraded.publish(n)}}}},{key:"getActiveTracks",value:function(e){var t=this;return this.store.getRemoteVideoTracks().filter(function(t){return t.hasSinks()&&(!t.degraded||e)}).sort(function(e,n){var r=t.store.getComparator().getTrackComparators();return-1*(r.screenShare(e,n)||r.rolePriority(e,n)||r.peerAudioLevel(e,n)||t.store.getComparator().stringComparator(e.trackId,n.trackId))}).slice(0)}},{key:"cancelRecovery",value:function(){this.recoveringTrack&&(this.recoveringTrack.setDegradedFromSdk(!0),this.eventBus.trackDegraded.publish(this.recoveringTrack)),this.recoveringTrack=void 0,this.recoverAttemptCount++,this.recoverGracePeriod=this.getDelayForRecoverCount(this.recoverAttemptCount),this.degradeGracePeriod=this.MIN_DEGRADE_GRACE_PERIOD,ye.d(this.TAG,"Recover Attempt Failed",{count:this.recoverAttemptCount,delay:this.recoverGracePeriod})}},{key:"getDelayForRecoverCount",value:function(e){var t=this.MIN_RECOVER_GRACE_PERIOD+this.MIN_RECOVER_GRACE_PERIOD*e;return Math.min(t,this.MAX_RECOVER_GRACE_PERIOD)}}]),e}(),hr=function(e){var t=e.stream instanceof Mn;return{peerConnectionType:t?"publish":"subscribe",nativeTrack:t?e.getTrackBeingSent():e.nativeTrack}},vr=function(e,t,n,r){return $(void 0,null,b().mark(function i(){var a,s,o,c,u,l,d,h;return b().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return s=hr(t),o=s.peerConnectionType,c=s.nativeTrack,i.prev=1,i.next=4,null==(a=e[o])?void 0:a.call(e,c);case 4:u=i.sent,i.next=10;break;case 7:i.prev=7,i.t0=i.catch(1),ye.w("[HMSWebrtcStats]","Error in getting track stats",t,c,i.t0);case 10:return l=pr(u),d=yr("publish"===o?"bytesSent":"bytesReceived",l,r),h=Tr("packetsLost",l,r),i.abrupt("return",((null==l?void 0:l.remote)&&Object.assign(l.remote,{packetsLostRate:Tr("packetsLost",l.remote,null==r?void 0:r.remote)}),l&&Object.assign(l,{bitrate:d,packetsLostRate:h,peerId:t.peerId,peerName:n,codec:l.codec})));case 12:case"end":return i.stop()}},i,null,[[1,7]])}))},pr=function(e){var t,n,r={};null==e||e.forEach(function(e){switch(e.type){case"inbound-rtp":case"outbound-rtp":t=e;break;case"remote-inbound-rtp":n=e;break;case"codec":r[e.id]=e.mimeType}});var i,a=(null==t?void 0:t.codecId)?r[t.codecId]:void 0;return a&&(i=a.substring(a.indexOf("/")+1)),t&&Object.assign(t,{remote:n,codec:i})},fr=function(e,t,n){var r=kr(t),i=yr("publish"===e?"bytesSent":"bytesReceived",r,n&&n[e]);return r&&Object.assign(r,{bitrate:i})},kr=function(e){var t;return e.forEach(function(n){"transport"===n.type&&(t=e.get(n.selectedCandidatePairId))}),t||e.forEach(function(e){"candidate-pair"===e.type&&e.selected&&(t=e)}),t},gr=function(e){var t={packetsLost:0,jitter:0};return null==e||e.forEach(function(e){e.packetsLost&&(t.packetsLost+=e.packetsLost),e.jitter>t.jitter&&(t.jitter=e.jitter)}),t},mr=function(e,t){return Array.from(new Set(e.concat(t)))},yr=function(e,t,n){return 8*Tr(e,t,n)},Tr=function(e,t,n){var r=t&&t[e],i=n?n[e]:null;return[t,n,Re(r),Re(i)].every(function(e){return!!e})?1e3*br(r,i,null==t?void 0:t.timestamp,null==n?void 0:n.timestamp):0},br=function(e,t,n,r){return Re(e)&&Re(t)&&n&&r?(e-t)/(n-r):0},Er=function(){function e(t,n){var r;D(this,e),this.getStats=t,this.store=n,this.TAG="[HMSWebrtcStats]",this.peerStats={},this.trackStats={},this.localPeerID=null==(r=this.store.getLocalPeer())?void 0:r.peerId}return O(e,[{key:"getLocalPeerStats",value:function(){return this.peerStats[this.localPeerID]}},{key:"getTrackStats",value:function(e){return this.trackStats[e]}},{key:"updateStats",value:function(){return $(this,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateLocalPeerStats();case 2:return e.next=4,this.updateTrackStats();case 4:case"end":return e.stop()}},e,this)}))}},{key:"updateLocalPeerStats",value:function(){return $(this,null,b().mark(function e(){var t,n,r,i,a,s,o,c,u,l,d,h,v,p,f,k;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.getLocalPeerStats(),e.prev=1,e.next=4,null==(n=(t=this.getStats).publish)?void 0:n.call(t);case 4:c=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),ye.w(this.TAG,"Error in getting publish stats",e.t0);case 10:return u=c&&fr("publish",c,o),e.prev=11,e.next=14,null==(i=(r=this.getStats).subscribe)?void 0:i.call(r);case 14:l=e.sent,e.next=20;break;case 17:e.prev=17,e.t1=e.catch(11),ye.w(this.TAG,"Error in getting subscribe stats",e.t1);case 20:d=l&&fr("subscribe",l,o),h=gr(l),v=h.packetsLost,p=h.jitter,f=br(v,null==(a=null==o?void 0:o.subscribe)?void 0:a.packetsLost,null==d?void 0:d.timestamp,null==(s=null==o?void 0:o.subscribe)?void 0:s.timestamp),k=d&&Object.assign(d,{packetsLostRate:f,jitter:p,packetsLost:v}),this.peerStats[this.localPeerID]={publish:u,subscribe:k};case 22:case"end":return e.stop()}},e,this,[[1,7],[11,17]])}))}},{key:"updateTrackStats",value:function(){return $(this,null,b().mark(function e(){var t,n,r,i,a,s,o,c,u,l;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=this.store.getTracksMap(),r=mr(Object.keys(this.trackStats),Object.keys(n)),i=U(r),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=19;break}if(s=a.value,!(o=n[s])){e.next=16;break}return c=o.peerId&&(null==(t=this.store.getPeerById(o.peerId))?void 0:t.name),u=this.getTrackStats(o.trackId),e.next=12,vr(this.getStats,o,c,u);case 12:(l=e.sent)&&(this.trackStats[s]=l),e.next=17;break;case 16:delete this.trackStats[s];case 17:e.next=4;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(2),i.e(e.t0);case 24:return e.prev=24,i.f(),e.finish(24);case 27:case"end":return e.stop()}},e,this,[[2,21,24,27]])}))}}]),e}();exports.HMSWebrtcStats=Er;var Sr=function(){function e(t,n,r,i){var a=this;D(this,e),this.store=t,this.eventBus=n,this.publishConnection=r,this.subscribeConnection=i,this.TAG="[HMSWebrtcInternals]",this.interval=Qe,this.isMonitored=!1,this.handleStatsUpdate=function(){return $(a,null,b().mark(function e(){var t;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(t=this.hmsStats)?void 0:t.updateStats();case 2:this.eventBus.statsUpdate.publish(this.hmsStats);case 3:case"end":return e.stop()}},e,this)}))}}return O(e,[{key:"getPublishPeerConnection",value:function(){return this.publishConnection}},{key:"getSubscribePeerConnection",value:function(){return this.subscribeConnection}},{key:"getCurrentStats",value:function(){return this.hmsStats}},{key:"onStatsChange",value:function(e){var t=this;return this.eventBus.statsUpdate.subscribe(e),function(){t.eventBus.statsUpdate.unsubscribe(e)}}},{key:"setPeerConnections",value:function(e){var t,n,r=e.publish,i=e.subscribe;this.publishConnection=r,this.subscribeConnection=i,this.hmsStats=new Er({publish:null==(t=this.publishConnection)?void 0:t.getStats.bind(this.publishConnection),subscribe:null==(n=this.subscribeConnection)?void 0:n.getStats.bind(this.subscribeConnection)},this.store)}},{key:"start",value:function(){return $(this,null,b().mark(function e(){var t=this;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMonitored){e.next=3;break}return ye.d(this.TAG,"Already started"),e.abrupt("return");case 3:this.stop(),this.isMonitored=!0,ye.d(this.TAG,"Starting Webrtc Stats Monitor"),this.startLoop().then(function(){return ye.d(t.TAG,"Stopping Webrtc Stats Monitor")}).catch(function(e){return ye.e(t.TAG,e.message)});case 4:case"end":return e.stop()}},e,this)}))}},{key:"stop",value:function(){this.isMonitored=!1}},{key:"startLoop",value:function(){return $(this,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMonitored){e.next=7;break}return e.next=3,this.handleStatsUpdate();case 3:return e.next=5,bt(this.interval);case 5:e.next=0;break;case 7:case"end":return e.stop()}},e,this)}))}},{key:"cleanUp",value:function(){this.stop(),this.eventBus.statsUpdate.removeAllListeners()}}]),e}();exports.HMSWebrtcInternals=Sr;var wr=function(){if(ie&&void 0!==navigator.connection){var e=navigator.connection;return{downlink:e.downlink,downlinkMax:e.downlinkMax,effectiveType:e.effectiveType,rtt:e.rtt,saveData:e.saveData,type:e.type}}},Ar="[HMSTransport]:",xr=function(){function e(t,n,r,i,a,s,o){var c,u,l=this;D(this,e),this.observer=t,this.deviceManager=n,this.store=r,this.localTrackManager=i,this.eventBus=a,this.analyticsEventsService=s,this.analyticsTimer=o,this.state=Yn.Disconnected,this.trackStates=new Map,this.publishConnection=null,this.subscribeConnection=null,this.maxSubscribeBitrate=0,this.joinRetryCount=0,this.callbacks=new Map,this.signalObserver={onOffer:function(e){return $(l,null,b().mark(function t(){var n,r,i,a,s;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.subscribeConnection){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,this.subscribeConnection.setRemoteDescription(e);case 5:ye.d(Ar,"[SUBSCRIBE] Adding ".concat(this.subscribeConnection.candidates.length," ice-candidates"),this.subscribeConnection.candidates),n=U(this.subscribeConnection.candidates),t.prev=7,n.s();case 9:if((r=n.n()).done){t.next=15;break}return i=r.value,t.next=13,this.subscribeConnection.addIceCandidate(i);case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),n.e(t.t0);case 20:return t.prev=20,n.f(),t.finish(20);case 23:return this.subscribeConnection.candidates.length=0,t.next=26,this.subscribeConnection.createAnswer();case 26:return a=t.sent,t.next=29,this.subscribeConnection.setLocalDescription(a);case 29:this.signal.answer(a),ye.d(Ar,"[role=SUBSCRIBE] onOffer renegotiation DONE ✅"),t.next=37;break;case 33:throw t.prev=33,t.t1=t.catch(0),ye.d(Ar,"[role=SUBSCRIBE] onOffer renegotiation FAILED ❌"),this.state=Yn.Failed,s=t.t1 instanceof Ie?t.t1:Pe.GenericErrors.Unknown(Ae.PUBLISH,t.t1.message),this.eventBus.analytics.publish(Ln.subscribeFail(s)),s;case 37:case"end":return t.stop()}},t,this,[[0,33],[7,17,20,23]])}))},onTrickle:function(e){return $(l,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null==(n=e.target===Se.Publish?this.publishConnection:this.subscribeConnection)?void 0:n.remoteDescription)){t.next=6;break}return t.next=4,n.addIceCandidate(e.candidate);case 4:t.next=7;break;case 6:null==n||n.candidates.push(e.candidate);case 7:case"end":return t.stop()}},t,this)}))},onNotification:function(e){return l.observer.onNotification(e)},onServerError:function(e){return $(l,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.observer.onStateChange(Yn.Failed,e);case 2:case"end":return t.stop()}},t,this)}))},onFailure:function(e){l.joinParameters&&l.retryScheduler.schedule({category:er.SignalDisconnect,error:e,task:l.retrySignalDisconnectTask,originalState:l.state})},onOffline:function(e){return $(l,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:ye.d(Ar,"socket offline",Yn[this.state]);try{this.state!==Yn.Leaving&&this.joinParameters&&this.retryScheduler.schedule({category:er.SignalDisconnect,error:Pe.WebSocketConnectionErrors.WebSocketConnectionLost(Ae.RECONNECT_SIGNAL,e),task:this.retrySignalDisconnectTask,originalState:this.state})}catch(n){console.error(n)}case 2:case"end":return t.stop()}},t,this)}))},onOnline:function(){var e;ye.d(Ar,"socket online",Yn[l.state]),l.analyticsSignalTransport.flushFailedEvents(null==(e=l.store.getLocalPeer())?void 0:e.peerId)},onNetworkOnline:function(){l.analyticsEventsService.flushFailedClientEvents()}},this.signal=new St(this.signalObserver),this.analyticsSignalTransport=new lr(this.signal),this.publishConnectionObserver={onRenegotiationNeeded:function(){return $(l,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.performPublishRenegotiation();case 2:case"end":return e.stop()}},e,this)}))},onIceConnectionChange:function(e){return $(l,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:("disconnected"===e?ye.w.bind(ye):ye.d.bind(ye))(Ar,"Publish ice connection state change: ".concat(e));case 1:case"end":return t.stop()}},t)}))},onConnectionStateChange:function(e){return $(l,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(("disconnected"===e?ye.w.bind(ye):ye.d.bind(ye))(Ar,"Publish connection state change: ".concat(e)),"connected"===e&&(null==(n=this.publishConnection)||n.logSelectedIceCandidatePairs()),t.t0="failed"===e,!t.t0){t.next=6;break}return t.next=6,this.handleIceConnectionFailure(Se.Publish);case 6:case"end":return t.stop()}},t,this)}))}},this.subscribeConnectionObserver={onApiChannelMessage:function(e){l.observer.onNotification(JSON.parse(e))},onTrackAdd:function(e){ye.d(Ar,"[Subscribe] onTrackAdd",st(e.nativeTrack)),l.observer.onTrackAdd(e)},onTrackRemove:function(e){ye.d(Ar,"[Subscribe] onTrackRemove",st(e.nativeTrack)),l.observer.onTrackRemove(e)},onIceConnectionChange:function(e){return $(l,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:("disconnected"===e?ye.w.bind(ye):ye.d.bind(ye))(Ar,"Subscribe ice connection state change: ".concat(e)),"connected"===e&&(n=this.callbacks.get(qe),this.callbacks.delete(qe),n&&n.promise.resolve(!0));case 1:case"end":return t.stop()}},t,this)}))},onConnectionStateChange:function(e){return $(l,null,b().mark(function t(){var n,r;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(("disconnected"===e?ye.w.bind(ye):ye.d.bind(ye))(Ar,"Subscribe connection state change: ".concat(e)),t.t0="failed"===e,!t.t0){t.next=5;break}return t.next=5,this.handleIceConnectionFailure(Se.Subscribe);case 5:if("connected"!==e){t.next=9;break}null==(n=this.subscribeConnection)||n.logSelectedIceCandidatePairs(),r=this.callbacks.get(qe),this.callbacks.delete(qe),r&&r.promise.resolve(!0);case 9:case"end":return t.stop()}},t,this)}))}},this.handleLocalRoleUpdate=function(e){return $(l,[e],function(e){var t=this,n=e.oldRole,r=e.newRole;return b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=!(!t.doesRoleNeedWebRTC(n)&&t.doesRoleNeedWebRTC(r)),e.t0){e.next=6;break}return ye.i(Ar,"Local peer role updated to webrtc role, creating PeerConnections and performing inital publish negotiation ⏳"),t.createPeerConnections(),e.next=6,t.negotiateOnFirstPublish();case 6:case"end":return e.stop()}},e)})()})},this.retryPublishIceFailedTask=function(){return $(l,null,b().mark(function e(){var t,n=this;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.publishConnection||"connected"===this.publishConnection.iceConnectionState&&"connected"===this.publishConnection.connectionState){e.next=6;break}return t=new Promise(function(e,t){n.callbacks.set(Fe,{promise:{resolve:e,reject:t},action:Ae.RESTART_ICE,extra:{}})}),e.next=4,this.performPublishRenegotiation({iceRestart:!0});case 4:return e.next=6,t;case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}},e,this)}))},this.retrySubscribeIceFailedTask=function(){return $(l,null,b().mark(function e(){var t,n,r=this;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.subscribeConnection||"connected"===this.subscribeConnection.iceConnectionState&&"connected"===this.subscribeConnection.connectionState){e.next=3;break}return t=new Promise(function(e,t){r.callbacks.set(qe,{promise:{resolve:e,reject:t},action:Ae.RESTART_ICE,extra:{}})}),n=new Promise(function(e){setTimeout(e,Ye,!1)}),e.abrupt("return",Promise.race([t,n]));case 3:return e.abrupt("return",!0);case 4:case"end":return e.stop()}},e,this)}))},this.retrySignalDisconnectTask=function(){return $(l,null,b().mark(function e(){var t;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(ye.d(Ar,"retrySignalDisconnectTask",{signalConnected:this.signal.isConnected}),this.signal.isConnected){e.next=8;break}return e.prev=1,e.next=4,this.internalConnect(this.joinParameters.authToken,this.joinParameters.endpoint,this.joinParameters.peerId);case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:if(!this.store.getRoom().joinedAt){e.next=17;break}if(e.t2=this.signal.isConnected,!e.t2){e.next=14;break}return e.next=13,this.retryPublishIceFailedTask();case 13:e.t2=e.sent;case 14:e.t1=e.t2,e.next=18;break;case 17:e.t1=this.signal.isConnected;case 18:return t=e.t1,e.abrupt("return",(this.signal.trackUpdate(this.trackStates),t));case 20:case"end":return e.stop()}},e,this,[[1,6]])}))},this.webrtcInternals=new Sr(this.store,this.eventBus,null==(c=this.publishConnection)?void 0:c.nativeConnection,null==(u=this.subscribeConnection)?void 0:u.nativeConnection);this.retryScheduler=new ar(function(e,t){return $(l,null,b().mark(function n(){return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=e!==this.state,!n.t0){n.next=5;break}return this.state=e,n.next=5,this.observer.onStateChange(this.state,t);case 5:case"end":return n.stop()}},n,this)}))},this.sendErrorAnalyticsEvent.bind(this)),this.eventBus.statsUpdate.subscribe(function(e){var t,n,r=(null==(n=null==(t=e.getLocalPeerStats())?void 0:t.subscribe)?void 0:n.bitrate)||0;l.maxSubscribeBitrate=Math.max(l.maxSubscribeBitrate,r)})}return O(e,[{key:"getLocalScreen",value:function(e,t){return $(this,null,b().mark(function n(){return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.localTrackManager.getLocalScreen(e,t);case 3:return n.abrupt("return",n.sent);case 6:throw n.prev=6,n.t0=n.catch(0),this.eventBus.analytics.publish(Ln.publish({error:n.t0,devices:this.deviceManager.getDevices(),settings:new Ct(e,t,!1)})),n.t0;case 9:case"end":return n.stop()}},n,this,[[0,6]])}))}},{key:"getWebrtcInternals",value:function(){return this.webrtcInternals}},{key:"isFlagEnabled",value:function(e){var t,n=null==(t=this.initConfig)?void 0:t.config;return((null==n?void 0:n.enabledFlags)||[]).includes(e)}},{key:"preview",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return $(this,null,b().mark(function a(){var s;return b().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.connect(e,t,n,r,i);case 2:return s=a.sent,a.abrupt("return",(this.state=Yn.Preview,this.observer.onStateChange(this.state),s));case 4:case"end":return a.stop()}},a,this)}))}},{key:"join",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return $(this,null,b().mark(function a(){var s,o;return b().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(ye.d(Ar,"join: started ⏰"),a.prev=1,a.t0=!this.signal.isConnected||!this.initConfig,!a.t0){a.next=6;break}return a.next=6,this.connect(e,r,t,n,i);case 6:if(this.validateNotDisconnected("connect"),s=this.isFlagEnabled($n.FLAG_SERVER_SUB_DEGRADATION),a.t1=this.initConfig,!a.t1){a.next=17;break}return a.next=12,this.waitForLocalRoleAvailability();case 12:return a.next=14,this.createConnectionsAndNegotiateJoin(n,i,s);case 14:return a.next=16,this.initRtcStatsMonitor();case 16:ye.d(Ar,"✅ join: Negotiated over PUBLISH connection");case 17:a.next=27;break;case 19:return a.prev=19,a.t2=a.catch(1),ye.e(Ar,"join: failed ❌ [token=".concat(e,"]"),a.t2),this.state=Yn.Failed,(o=a.t2).isTerminal=o.isTerminal||500===o.code,a.next=26,this.observer.onStateChange(this.state,o);case 26:throw o;case 27:ye.i(Ar,"✅ join: successful"),this.state=Yn.Joined,this.observer.onStateChange(this.state);case 28:case"end":return a.stop()}},a,this,[[1,19]])}))}},{key:"connect",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return $(this,null,b().mark(function a(){var s,o=this;return b().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.setTransportStateForConnect(),this.joinParameters=new tr(e,n,r.name,r.metaData,t,i),a.prev=1,a.next=4,this.internalConnect(e,t,n);case 4:return a.abrupt("return",a.sent);case 7:if(a.prev=7,a.t0=a.catch(1),!(a.t0 instanceof Ie&&([xe.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,xe.WebSocketConnectionErrors.FAILED_TO_CONNECT,xe.WebSocketConnectionErrors.ABNORMAL_CLOSE,xe.InitAPIErrors.ENDPOINT_UNREACHABLE].includes(a.t0.code)||a.t0.code.toString().startsWith("5")||a.t0.code.toString().startsWith("429")))){a.next=15;break}return s=function(){return $(o,null,b().mark(function r(){return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.internalConnect(e,t,n);case 2:return r.abrupt("return",Boolean(this.initConfig&&this.initConfig.endpoint));case 3:case"end":return r.stop()}},r,this)}))},a.next=13,this.retryScheduler.schedule({category:er.ConnectFailed,error:a.t0,task:s,originalState:this.state,maxFailedRetries:He,changeState:!1});case 13:a.next=16;break;case 15:throw a.t0;case 16:case"end":return a.stop()}},a,this,[[1,7]])}))}},{key:"leave",value:function(e){return $(this,null,b().mark(function t(){var n,r,i,a;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.retryScheduler.reset(),this.joinParameters=void 0,ye.d(Ar,"leaving in transport"),t.prev=1,this.state=Yn.Leaving,null==(n=this.webrtcInternals)||n.cleanUp(),null==(r=this.trackDegradationController)||r.cleanUp(),t.next=7,null==(i=this.publishConnection)?void 0:i.close();case 7:return t.next=9,null==(a=this.subscribeConnection)?void 0:a.close();case 9:if(!e){t.next=11;break}try{this.signal.leave(),ye.d(Ar,"signal leave done")}catch(s){ye.w(Ar,"failed to send leave on websocket to server",s)}case 11:return this.analyticsEventsService.flushFailedClientEvents(),this.analyticsEventsService.reset(),t.next=15,this.signal.close();case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(1),this.eventBus.analytics.publish(Ln.disconnect(t.t0)),ye.e(Ar,"leave: FAILED ❌",t.t0);case 20:return t.prev=20,this.state=Yn.Disconnected,this.observer.onStateChange(this.state),t.finish(20);case 23:case"end":return t.stop()}},t,this,[[1,17,20,23]])}))}},{key:"publish",value:function(e){return $(this,null,b().mark(function t(){var n,r,i;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=U(e),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=15;break}return i=r.value,t.prev=5,t.next=8,this.publishTrack(i);case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(5),this.eventBus.analytics.publish(Ln.publish({devices:this.deviceManager.getDevices(),error:t.t0}));case 13:t.next=3;break;case 15:t.next=20;break;case 17:t.prev=17,t.t1=t.catch(1),n.e(t.t1);case 20:return t.prev=20,n.f(),t.finish(20);case 23:case"end":return t.stop()}},t,this,[[1,17,20,23],[5,10]])}))}},{key:"unpublish",value:function(e){return $(this,null,b().mark(function t(){var n,r,i;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=U(e),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=9;break}return i=r.value,t.next=7,this.unpublishTrack(i);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),n.e(t.t0);case 14:return t.prev=14,n.f(),t.finish(14);case 17:case"end":return t.stop()}},t,this,[[1,11,14,17]])}))}},{key:"sendMessage",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.broadcast(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"trackUpdate",value:function(e){var t=Array.from(this.trackStates.values()).find(function(t){return e.type===t.type&&e.source===t.source});if(t){var n=new Xn(z(Q({},t),{mute:!e.enabled}));this.trackStates.set(t.track_id,n),ye.d(Ar,"Track Update",this.trackStates,e),this.signal.trackUpdate(new Map([[t.track_id,n]]))}}},{key:"changeRole",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return $(this,null,b().mark(function r(){return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.signal.requestRoleChange({requested_for:e.peerId,role:t,force:n});case 2:case"end":return r.stop()}},r,this)}))}},{key:"acceptRoleChange",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.acceptRoleChangeRequest({role:e.role.name,token:e.token});case 2:case"end":return t.stop()}},t,this)}))}},{key:"endRoom",value:function(e,t){return $(this,null,b().mark(function n(){return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.signal.endRoom(e,t);case 2:case"end":return n.stop()}},n,this)}))}},{key:"removePeer",value:function(e,t){return $(this,null,b().mark(function n(){return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.signal.removePeer({requested_for:e,reason:t});case 2:case"end":return n.stop()}},n,this)}))}},{key:"startRTMPOrRecording",value:function(e){return $(this,null,b().mark(function t(){var n,r;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={meeting_url:e.meetingURL,record:e.record},(null==(n=e.rtmpURLs)?void 0:n.length)&&(r.rtmp_urls=e.rtmpURLs),e.resolution&&(r.resolution=e.resolution),t.next=5,this.signal.startRTMPOrRecording(r);case 5:case"end":return t.stop()}},t,this)}))}},{key:"stopRTMPOrRecording",value:function(){return $(this,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.stopRTMPAndRecording();case 2:case"end":return e.stop()}},e,this)}))}},{key:"startHLSStreaming",value:function(e){return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={},e&&e.variants&&e.variants.length>0&&(n.variants=e.variants.map(function(e){var t={meeting_url:e.meetingURL};return e.metadata&&(t.metadata=e.metadata),t})),(null==e?void 0:e.recording)&&(n.hls_recording={single_file_per_layer:e.recording.singleFilePerLayer,hls_vod:e.recording.hlsVod}),t.next=5,this.signal.startHLSStreaming(n);case 5:case"end":return t.stop()}},t,this)}))}},{key:"stopHLSStreaming",value:function(e){return $(this,null,b().mark(function t(){var n,r;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=4;break}return r={variants:null==(n=null==e?void 0:e.variants)?void 0:n.map(function(e){var t={meeting_url:e.meetingURL};return e.metadata&&(t.metadata=e.metadata),t})},t.next=4,this.signal.stopHLSStreaming(r);case 4:return t.next=6,this.signal.stopHLSStreaming();case 6:case"end":return t.stop()}},t,this)}))}},{key:"sendHLSTimedMetadata",value:function(e){return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.length>0)){t.next=4;break}return n={metadata_objs:e},t.next=4,this.signal.sendHLSTimedMetadata(n);case 4:case"end":return t.stop()}},t,this)}))}},{key:"changeName",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.updatePeer({name:e});case 2:case"end":return t.stop()}},t,this)}))}},{key:"changeMetadata",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.updatePeer({data:e});case 2:case"end":return t.stop()}},t,this)}))}},{key:"getSessionMetadata",value:function(){return this.signal.getSessionMetadata()}},{key:"setSessionMetadata",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.setSessionMetadata({data:e});case 2:case"end":return t.stop()}},t,this)}))}},{key:"changeTrackState",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.requestTrackStateChange(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"changeMultiTrackState",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.requestMultiTrackStateChange(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"publishTrack",value:function(e){return $(this,null,b().mark(function t(){var n,r,i,a,s=this;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.publishedTrackId=e.getTrackIDBeingSent(),ye.d(Ar,"⏳ publishTrack: trackId=".concat(e.trackId,", toPublishTrackId=").concat(e.publishedTrackId),"".concat(e)),this.trackStates.set(e.publishedTrackId,new Xn(e)),n=new Promise(function(e,t){s.callbacks.set(Fe,{promise:{resolve:e,reject:t},action:Ae.PUBLISH,extra:{}})}),(r=e.stream).setConnection(this.publishConnection),i=this.store.getSimulcastLayers(e.source),r.addTransceiver(e,i),ye.time("publish-".concat(e.trackId,"-").concat(e.type)),t.next=8,n;case 8:if(ye.timeEnd("publish-".concat(e.trackId,"-").concat(e.type)),this.store.addTrack(e),a=e.settings.maxBitrate,t.t0=a,!t.t0){t.next=15;break}return t.next=15,r.setMaxBitrate(a,e).then(function(){ye.d(Ar,"Setting maxBitrate for ".concat(e.source," ").concat(e.type," to ").concat(a," kpbs"))}).catch(function(e){return ye.w(Ar,"Failed setting maxBitrate",e)});case 15:ye.d(Ar,"✅ publishTrack: trackId=".concat(e.trackId),"".concat(e),this.callbacks);case 16:case"end":return t.stop()}},t,this)}))}},{key:"unpublishTrack",value:function(e){return $(this,null,b().mark(function t(){var n,r,i=this;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return ye.d(Ar,"⏳ unpublishTrack: trackId=".concat(e.trackId),"".concat(e)),e.publishedTrackId&&this.trackStates.has(e.publishedTrackId)?this.trackStates.delete(e.publishedTrackId):(n=Array.from(this.trackStates.values()).find(function(t){return e.type===t.type&&e.source===t.source}))&&this.trackStates.delete(n.track_id),r=new Promise(function(e,t){i.callbacks.set(Fe,{promise:{resolve:e,reject:t},action:Ae.UNPUBLISH,extra:{}})}),e.stream.removeSender(e),t.next=5,r;case 5:return t.next=7,e.cleanup();case 7:this.store.removeTrack(e.trackId),ye.d(Ar,"✅ unpublishTrack: trackId=".concat(e.trackId),this.callbacks);case 9:case"end":return t.stop()}},t,this)}))}},{key:"waitForLocalRoleAvailability",value:function(){var e=this;if(!this.store.hasRoleDetailsArrived())return new Promise(function(t){e.eventBus.policyChange.subscribeOnce(function(){return t()})})}},{key:"createConnectionsAndNegotiateJoin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return $(this,null,b().mark(function r(){var i;return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return(i=this.doesLocalPeerNeedWebRTC())&&this.createPeerConnections(),r.next=4,this.negotiateJoinWithRetry({name:e.name,data:e.metaData,autoSubscribeVideo:t,serverSubDegrade:n,isWebRTC:i});case 4:case"end":return r.stop()}},r,this)}))}},{key:"createPeerConnections",value:function(){this.initConfig&&(this.publishConnection||(this.publishConnection=new nt(this.signal,this.initConfig.rtcConfiguration,this.publishConnectionObserver,this)),this.subscribeConnection||(this.subscribeConnection=new pt(this.signal,this.initConfig.rtcConfiguration,this.subscribeConnectionObserver)))}},{key:"negotiateJoinWithRetry",value:function(e){return $(this,arguments,function(e){var t=this,n=e.name,r=e.data,i=e.autoSubscribeVideo,a=e.serverSubDegrade,s=e.isWebRTC,o=void 0===s||s;return b().mark(function e(){var s,c;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.negotiateJoin({name:n,data:r,autoSubscribeVideo:i,serverSubDegrade:a,isWebRTC:o});case 3:e.next=17;break;case 5:if(e.prev=5,e.t0=e.catch(0),ye.e(Ar,"Join negotiation failed ❌",e.t0),s=e.t0 instanceof Ie?e.t0:Pe.WebsocketMethodErrors.ServerErrors(500,Ae.JOIN,"Websocket join error - ".concat(e.t0.message)),5!==parseInt("".concat(s.code/100))&&429!==s.code){e.next=16;break}return t.joinRetryCount=0,s.isTerminal=!1,c=function(){return $(t,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.joinRetryCount++,e.next=3,this.negotiateJoin({name:n,data:r,autoSubscribeVideo:i,serverSubDegrade:a,isWebRTC:o});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}))},e.next=14,t.retryScheduler.schedule({category:er.JoinWSMessageFailed,error:s,task:c,originalState:Yn.Joined,maxFailedRetries:3,changeState:!1});case 14:e.next=17;break;case 16:throw e.t0;case 17:case"end":return e.stop()}},e,null,[[0,5]])})()})}},{key:"negotiateJoin",value:function(e){return $(this,arguments,function(e){var t=this,n=e.name,r=e.data,i=e.autoSubscribeVideo,a=e.serverSubDegrade,s=e.isWebRTC,o=void 0===s||s;return b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=6;break}return e.next=3,t.negotiateJoinWebRTC({name:n,data:r,autoSubscribeVideo:i,serverSubDegrade:a});case 3:e.t0=e.sent,e.next=9;break;case 6:return e.next=8,t.negotiateJoinNonWebRTC({name:n,data:r,autoSubscribeVideo:i,serverSubDegrade:a});case 8:e.t0=e.sent;case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}},e)})()})}},{key:"negotiateJoinWebRTC",value:function(e){return $(this,arguments,function(e){var t=this,n=e.name,r=e.data,i=e.autoSubscribeVideo,a=e.serverSubDegrade;return b().mark(function e(){var s,o,c,u,l;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(ye.d(Ar,"⏳ join: Negotiating over PUBLISH connection"),t.publishConnection){e.next=2;break}return e.abrupt("return",(ye.e(Ar,"Publish peer connection not found, cannot negotiate"),!1));case 2:return e.next=4,t.publishConnection.createOffer();case 4:return s=e.sent,e.next=7,t.publishConnection.setLocalDescription(s);case 7:return e.next=9,t.signal.join(n,r,!i,a,s);case 9:return o=e.sent,e.next=12,t.publishConnection.setRemoteDescription(o);case 12:c=U(t.publishConnection.candidates),e.prev=13,c.s();case 15:if((u=c.n()).done){e.next=21;break}return l=u.value,e.next=19,t.publishConnection.addIceCandidate(l);case 19:e.next=15;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(13),c.e(e.t0);case 26:return e.prev=26,c.f(),e.finish(26);case 29:return e.abrupt("return",(t.publishConnection.initAfterJoin(),!!o));case 30:case"end":return e.stop()}},e,null,[[13,23,26,29]])})()})}},{key:"negotiateJoinNonWebRTC",value:function(e){return $(this,arguments,function(e){var t=this,n=e.name,r=e.data,i=e.autoSubscribeVideo,a=e.serverSubDegrade;return b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return ye.d(Ar,"⏳ join: Negotiating Non-WebRTC"),e.next=3,t.signal.join(n,r,!i,a);case 3:return e.abrupt("return",!!e.sent);case 4:case"end":return e.stop()}},e)})()})}},{key:"negotiateOnFirstPublish",value:function(){return $(this,null,b().mark(function e(){var t,n,r,i,a;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(ye.d(Ar,"⏳ Negotiating offer over PUBLISH connection"),this.publishConnection){e.next=2;break}return e.abrupt("return",(ye.e(Ar,"Publish peer connection not found, cannot negotiate"),!1));case 2:return e.next=4,this.publishConnection.createOffer(this.trackStates);case 4:return t=e.sent,e.next=7,this.publishConnection.setLocalDescription(t);case 7:return e.next=9,this.signal.offer(t,this.trackStates);case 9:return n=e.sent,e.next=12,this.publishConnection.setRemoteDescription(n);case 12:r=U(this.publishConnection.candidates),e.prev=13,r.s();case 15:if((i=r.n()).done){e.next=21;break}return a=i.value,e.next=19,this.publishConnection.addIceCandidate(a);case 19:e.next=15;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(13),r.e(e.t0);case 26:return e.prev=26,r.f(),e.finish(26);case 29:return e.abrupt("return",(this.publishConnection.initAfterJoin(),!!n));case 30:case"end":return e.stop()}},e,this,[[13,23,26,29]])}))}},{key:"performPublishRenegotiation",value:function(e){return $(this,null,b().mark(function t(){var n,r,i,a;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(ye.d(Ar,"⏳ [role=PUBLISH] onRenegotiationNeeded START",this.trackStates),!(n=this.callbacks.get(Fe))){t.next=27;break}if(this.publishConnection){t.next=6;break}return ye.e(Ar,"Publish peer connection not found, cannot renegotiate"),t.abrupt("return");case 6:return t.prev=6,t.next=9,this.publishConnection.createOffer(this.trackStates,e);case 9:return r=t.sent,t.next=12,this.publishConnection.setLocalDescription(r);case 12:return ye.time("renegotiation-offer-exchange"),t.next=15,this.signal.offer(r,this.trackStates);case 15:return i=t.sent,this.callbacks.delete(Fe),ye.timeEnd("renegotiation-offer-exchange"),t.next=20,this.publishConnection.setRemoteDescription(i);case 20:n.promise.resolve(!0),ye.d(Ar,"[role=PUBLISH] onRenegotiationNeeded DONE ✅"),t.next=27;break;case 24:t.prev=24,t.t0=t.catch(6),a=t.t0 instanceof Ie?t.t0:Pe.GenericErrors.Unknown(Ae.PUBLISH,t.t0.message),n.promise.reject(a),ye.d(Ar,"[role=PUBLISH] onRenegotiationNeeded FAILED ❌");case 27:case"end":return t.stop()}},t,this,[[6,24]])}))}},{key:"handleIceConnectionFailure",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e===Se.Publish?this.retryScheduler.schedule({category:er.PublishIceConnectionFailed,error:Pe.WebrtcErrors.ICEFailure(Ae.PUBLISH),task:this.retryPublishIceFailedTask,originalState:Yn.Joined}):this.retryScheduler.schedule({category:er.SubscribeIceConnectionFailed,error:Pe.WebrtcErrors.ICEFailure(Ae.SUBSCRIBE),task:this.retrySubscribeIceFailedTask,originalState:Yn.Joined,maxFailedRetries:1});case 1:case"end":return t.stop()}},t,this)}))}},{key:"internalConnect",value:function(e,t,n){return $(this,null,b().mark(function r(){var i;return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return ye.d(Ar,"connect: started ⏰"),i=new Date,r.prev=2,this.analyticsTimer.start(Bn.INIT),r.next=6,kt.fetchInitConfig({token:e,peerId:n,userAgent:this.store.getUserAgent(),initEndpoint:t});case 6:return this.initConfig=r.sent,this.analyticsTimer.end(Bn.INIT),this.validateNotDisconnected("post init"),r.next=11,this.openSignal(e,n);case 11:return ye.d(Ar,"Adding Analytics Transport: JsonRpcSignal"),this.analyticsEventsService.setTransport(this.analyticsSignalTransport),this.analyticsEventsService.flush(),r.abrupt("return",this.initConfig);case 17:throw r.prev=17,r.t0=r.catch(2),this.state!==Yn.Reconnecting&&this.eventBus.analytics.publish(Ln.connect(r.t0,this.getAdditionalAnalyticsProperties(),i,new Date,t)),ye.d(Ar,"❌ internal connect: failed",r.t0),r.t0;case 20:case"end":return r.stop()}},r,this,[[2,17]])}))}},{key:"validateNotDisconnected",value:function(e){if(this.state===Yn.Disconnected)throw ye.w(Ar,"aborting join as transport state is disconnected"),Pe.GenericErrors.ValidationFailed("leave called before join could complete - stage=".concat(e))}},{key:"openSignal",value:function(e,t){return $(this,null,b().mark(function n(){var r;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.initConfig){n.next=2;break}throw Pe.InitAPIErrors.InitConfigNotAvailable(Ae.INIT,"Init Config not found");case 2:return ye.d(Ar,"⏳ internal connect: connecting to ws endpoint",this.initConfig.endpoint),(r=new URL(this.initConfig.endpoint)).searchParams.set("peer",t),r.searchParams.set("token",e),r.searchParams.set("user_agent_v2",this.store.getUserAgent()),this.endpoint=r.toString(),this.analyticsTimer.start(Bn.WEBSOCKET_CONNECT),n.next=11,this.signal.open(this.endpoint);case 11:this.analyticsTimer.end(Bn.WEBSOCKET_CONNECT),this.analyticsTimer.start(Bn.ON_POLICY_CHANGE),ye.d(Ar,"✅ internal connect: connected to ws endpoint");case 14:case"end":return n.stop()}},n,this)}))}},{key:"initRtcStatsMonitor",value:function(){return $(this,null,b().mark(function e(){var t,n,r,i,a=this;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(r=this.webrtcInternals)||r.setPeerConnections({publish:null==(t=this.publishConnection)?void 0:t.nativeConnection,subscribe:null==(n=this.subscribeConnection)?void 0:n.nativeConnection}),e.t0=this.store.getSubscribeDegradationParams(),!e.t0){e.next=11;break}if(e.t1=this.isFlagEnabled($n.FLAG_SERVER_SUB_DEGRADATION),e.t1){e.next=9;break}return e.next=7,null==(i=this.webrtcInternals)?void 0:i.start();case 7:this.trackDegradationController=new dr(this.store,this.eventBus),this.eventBus.statsUpdate.subscribe(function(e){var t,n,r;null==(r=a.trackDegradationController)||r.handleRtcStatsChange((null==(n=null==(t=e.getLocalPeerStats())?void 0:t.subscribe)?void 0:n.packetsLost)||0)});case 9:this.eventBus.trackDegraded.subscribe(function(e){a.eventBus.analytics.publish(Ln.degradationStats(e,!0)),a.observer.onTrackDegrade(e)}),this.eventBus.trackRestored.subscribe(function(e){a.eventBus.analytics.publish(Ln.degradationStats(e,!1)),a.observer.onTrackRestore(e)});case 11:case"end":return e.stop()}},e,this)}))}},{key:"doesRoleNeedWebRTC",value:function(e){var t,n;if(!this.isFlagEnabled($n.FLAG_NON_WEBRTC_DISABLE_OFFER))return!0;var r=Boolean(e.publishParams.allowed&&(null==(t=e.publishParams.allowed)?void 0:t.length)>0),i=Boolean(e.subscribeParams.subscribeToRoles&&(null==(n=e.subscribeParams.subscribeToRoles)?void 0:n.length)>0);return r||i}},{key:"doesLocalPeerNeedWebRTC",value:function(){var e,t=null==(e=this.store.getLocalPeer())?void 0:e.role;return!t||this.doesRoleNeedWebRTC(t)}},{key:"setTransportStateForConnect",value:function(){if(this.state===Yn.Failed&&(this.state=Yn.Disconnected),this.state!==Yn.Disconnected&&this.state!==Yn.Reconnecting)throw Pe.WebsocketMethodErrors.AlreadyJoined(Ae.JOIN,"Cannot join a meeting in ".concat(this.state," state"));this.state===Yn.Disconnected&&(this.state=Yn.Connecting,this.observer.onStateChange(this.state))}},{key:"sendErrorAnalyticsEvent",value:function(e,t){var n,r=this.getAdditionalAnalyticsProperties();switch(t){case er.ConnectFailed:n=Ln.connect(e,r);break;case er.SignalDisconnect:n=Ln.disconnect(e,r);break;case er.JoinWSMessageFailed:n=Ln.join({error:e,time:this.analyticsTimer.getTimeTaken(Bn.JOIN),init_response_time:this.analyticsTimer.getTimeTaken(Bn.INIT),ws_connect_time:this.analyticsTimer.getTimeTaken(Bn.WEBSOCKET_CONNECT),on_policy_change_time:this.analyticsTimer.getTimeTaken(Bn.ON_POLICY_CHANGE),local_tracks_time:this.analyticsTimer.getTimeTaken(Bn.LOCAL_TRACKS),retries_join:this.joinRetryCount});break;case er.PublishIceConnectionFailed:n=Ln.publish({error:e});break;case er.SubscribeIceConnectionFailed:n=Ln.subscribeFail(e)}this.eventBus.analytics.publish(n)}},{key:"getAdditionalAnalyticsProperties",value:function(){var e,t,n,r,i,a,s,o;return{network_info:wr(),document_hidden:"undefined"!=typeof document&&document.hidden,num_degraded_tracks:this.store.getRemoteVideoTracks().filter(function(e){return e.degraded}).length,bitrate:{publish:null==(r=null==(n=null==(t=null==(e=this.getWebrtcInternals())?void 0:e.getCurrentStats())?void 0:t.getLocalPeerStats())?void 0:n.publish)?void 0:r.bitrate,subscribe:null==(o=null==(s=null==(a=null==(i=this.getWebrtcInternals())?void 0:i.getCurrentStats())?void 0:a.getLocalPeerStats())?void 0:s.subscribe)?void 0:o.bitrate},max_sub_bitrate:this.maxSubscribeBitrate,recent_pong_response_times:this.signal.getPongResponseTimes(),transport_state:this.state}}}]),e}();function Ir(e){if(!e||0===e.length)throw Pe.InitAPIErrors.InvalidTokenFormat(Ae.INIT,"Token cannot be an empty string or undefined or null");var t=e.split(".");if(3!==t.length)throw Pe.InitAPIErrors.InvalidTokenFormat(Ae.INIT,"Expected 3 '.' separate fields - header, payload and signature respectively");var n=atob(t[1]);try{var r=JSON.parse(n);return{roomId:r.room_id,userId:r.user_id,role:r.role}}catch(i){throw Pe.InitAPIErrors.InvalidTokenFormat(Ae.INIT,"couldn't parse to json - ".concat(i.message))}}var Pr=function(){function e(t,n){D(this,e),this.id=t,this.store=n,this.recording={server:{running:!1},browser:{running:!1},hls:{running:!1}},this.rtmp={running:!1},this.hls={running:!1,variants:[]}}return O(e,[{key:"localPeer",get:function(){return this.store.getLocalPeer()}},{key:"peers",get:function(){return this.store.getPeers()}}]),e}(),Cr={autoplayFailed:void 0,initialized:!1,autoplayCheckPromise:void 0},Rr=function(){function e(t,n,r){var i=this;D(this,e),this.store=t,this.deviceManager=n,this.eventBus=r,this.autoPausedTracks=new Set,this.TAG="[AudioSinkManager]:",this.volume=100,this.state=Q({},Cr),this.handleAudioPaused=function(e){var t,n=null==(t=e.target.srcObject)?void 0:t.getAudioTracks()[0];if(null==n?void 0:n.enabled){ye.d(i.TAG,"Audio Paused",e.target.id);var r=i.store.getTrackById(e.target.id);r&&(oe()?setTimeout(function(){return $(i,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=r,!e.t0){e.next=4;break}return e.next=4,this.playAudioFor(r);case 4:case"end":return e.stop()}},e,this)}))},500):i.autoPausedTracks.add(r))}},this.handleTrackUpdate=function(e){var t,n=e.track,r=e.enabled;(null==(t=window.HMS)?void 0:t.AUDIO_SINK)&&(r?(n.addSink(),i.playAudioFor(n)):n.removeSink()),ye.d(i.TAG,"Track updated","".concat(n))},this.handleTrackAdd=function(e){return $(i,[e],function(e){var t=this,n=e.track,r=e.peer;return b().mark(function e(){var i,a,s,o;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((o=document.createElement("audio")).style.display="none",o.id=n.trackId,o.addEventListener("pause",t.handleAudioPaused),n.setAudioElement(o),n.setVolume(t.volume),ye.d(t.TAG,"Audio track added","".concat(n)),null==(i=t.audioSink)||i.append(o),e.t0=t.outputDevice,!e.t0){e.next=12;break}return e.next=12,n.setOutputDevice(t.outputDevice);case 12:return(null==(a=window.HMS)?void 0:a.AUDIO_SINK)?n.enabled?n.addSink():n.removeSink():o.srcObject=new MediaStream([n.nativeTrack]),null==(s=t.listener)||s.onTrackUpdate(fe.TRACK_ADDED,n,r),e.next=16,t.handleAutoplayError(n);case 16:case"end":return e.stop()}},e)})()})},this.handleAutoplayError=function(e){return $(i,null,b().mark(function t(){var n=this;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=void 0===this.state.autoplayFailed,!t.t0){t.next=5;break}return this.state.autoplayCheckPromise||(this.state.autoplayCheckPromise=new Promise(function(t){n.playAudioFor(e).then(t)})),t.next=5,this.state.autoplayCheckPromise;case 5:if(!this.state.autoplayFailed){t.next=8;break}return this.autoPausedTracks.add(e),t.abrupt("return");case 8:return t.next=10,this.playAudioFor(e);case 10:case"end":return t.stop()}},t,this)}))},this.handleAudioDeviceChange=function(e){e.error||!e.selection||"video"===e.type||i.unpauseAudioTracks()},this.handleTrackRemove=function(e){i.autoPausedTracks.delete(e);var t=document.getElementById(e.trackId);t&&(t.removeEventListener("pause",i.handleAudioPaused),t.srcObject=null,t.remove(),e.setAudioElement(null)),i.audioSink&&0===i.audioSink.childElementCount&&(i.state.autoplayCheckPromise=void 0,i.state.autoplayFailed=void 0),ye.d(i.TAG,"Audio track removed","".concat(e))},this.unpauseAudioTracks=function(){return $(i,null,b().mark(function e(){var t,n=this;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],this.autoPausedTracks.forEach(function(e){t.push(n.playAudioFor(e))}),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}},e,this)}))},this.eventBus.audioTrackAdded.subscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.subscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.subscribe(this.handleTrackUpdate),this.eventBus.deviceChange.subscribe(this.handleAudioDeviceChange)}return O(e,[{key:"setListener",value:function(e){this.listener=e}},{key:"outputDevice",get:function(){return this.deviceManager.outputDevice}},{key:"getVolume",value:function(){return this.volume}},{key:"setVolume",value:function(e){this.store.updateAudioOutputVolume(e),this.volume=e}},{key:"unblockAutoplay",value:function(){return $(this,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.autoPausedTracks.size>0&&this.unpauseAudioTracks();case 1:case"end":return e.stop()}},e,this)}))}},{key:"init",value:function(e){if(!this.state.initialized){this.state.initialized=!0;var t=document.createElement("div");t.id="HMS-SDK-audio-sink-".concat((0,a.v4)()),(e&&document.getElementById(e)||document.body).append(t),this.audioSink=t}}},{key:"cleanUp",value:function(){var e;null==(e=this.audioSink)||e.remove(),this.audioSink=void 0,this.eventBus.audioTrackAdded.unsubscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.unsubscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.unsubscribe(this.handleTrackUpdate),this.eventBus.deviceChange.unsubscribe(this.handleAudioDeviceChange),this.autoPausedTracks=new Set,this.state=Q({},Cr)}},{key:"playAudioFor",value:function(e){return $(this,null,b().mark(function t(){var n,r,i;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.getAudioElement()){t.next=4;break}return ye.w(this.TAG,"No audio element found on track",e.trackId),t.abrupt("return");case 4:return t.prev=4,t.next=7,n.play();case 7:this.state.autoplayFailed=!1,this.autoPausedTracks.delete(e),ye.d(this.TAG,"Played track","".concat(e)),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(4),this.autoPausedTracks.add(e),ye.e(this.TAG,"Failed to play track","".concat(e),t.t0),r=t.t0,this.state.autoplayFailed||"NotAllowedError"!==r.name||(this.state.autoplayFailed=!0,(i=Pe.TracksErrors.AutoplayBlocked(Ae.AUTOPLAY,"")).addNativeError(r),this.eventBus.analytics.publish(Ln.autoplayError()),this.eventBus.autoplayError.publish(i));case 17:case"end":return t.stop()}},t,this,[[4,12]])}))}}]),e}(),_r=function(){function e(t,n){var r=this;D(this,e),this.store=t,this.eventBus=n,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.hasWebcamPermission=!1,this.hasMicrophonePermission=!1,this.TAG="[Device Manager]:",this.initialized=!1,this.videoInputChanged=!1,this.audioInputChanged=!1,this.updateOutputDevice=function(e){return $(r,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.audioOutput.find(function(t){return t.deviceId===e}),t.t0=n,!t.t0){t.next=7;break}return this.outputDevice=n,t.next=6,this.store.updateAudioOutputDevice(n);case 6:Tn.updateSelection("audioOutput",{deviceId:n.deviceId,groupId:n.groupId});case 7:return t.abrupt("return",n);case 8:case"end":return t.stop()}},t,this)}))},this.getCurrentSelection=function(){var e,t,n=r.store.getLocalPeer(),i=r.createIdentifier(null==(e=null==n?void 0:n.audioTrack)?void 0:e.getMediaTrackSettings()),a=r.createIdentifier(null==(t=null==n?void 0:n.videoTrack)?void 0:t.getMediaTrackSettings());return{audioInput:r.audioInput.find(function(e){return r.createIdentifier(e)===i}),videoInput:r.videoInput.find(function(e){return r.createIdentifier(e)===a}),audioOutput:r.outputDevice}},this.computeChange=function(e,t){return e.length!==t.length||t.some(function(t){return!e.includes(r.createIdentifier(t))})},this.enumerateDevices=function(){return $(r,null,b().mark(function e(){var t,n,r,i=this;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:t=e.sent,n=this.videoInput.map(this.createIdentifier),r=this.audioInput.map(this.createIdentifier),this.audioInput=[],this.audioOutput=[],this.videoInput=[],t.forEach(function(e){"audioinput"===e.kind&&e.label?(i.hasMicrophonePermission=!0,i.audioInput.push(e)):"audiooutput"===e.kind?i.audioOutput.push(e):"videoinput"===e.kind&&e.label&&(i.hasWebcamPermission=!0,i.videoInput.push(e))}),this.videoInputChanged=this.computeChange(n,this.videoInput),this.audioInputChanged=this.computeChange(r,this.audioInput),Tn.setDevices({videoInput:f(this.videoInput),audioInput:f(this.audioInput),audioOutput:f(this.audioOutput)}),this.logDevices("Enumerate Devices"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),ye.e(this.TAG,"Failed enumerating devices",e.t0);case 12:case"end":return e.stop()}},e,this,[[0,9]])}))},this.handleDeviceChange=function(){return $(r,null,b().mark(function e(){var t;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices();case 2:return this.eventBus.analytics.publish(Ln.deviceChange({selection:this.getCurrentSelection(),type:"list",devices:this.getDevices()})),this.logDevices("After Device Change"),t=this.store.getLocalPeer(),e.next=7,this.setOutputDevice(!0);case 7:return e.next=9,this.handleAudioInputDeviceChange(null==t?void 0:t.audioTrack);case 9:return e.next=11,this.handleVideoInputDeviceChange(null==t?void 0:t.videoTrack);case 11:case"end":return e.stop()}},e,this)}))},this.handleAudioInputDeviceChange=function(e){return $(r,null,b().mark(function t(){var n,r,i;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}return ye.d(this.TAG,"No Audio track on local peer"),t.abrupt("return");case 3:if(this.audioInputChanged){t.next=6;break}return ye.d(this.TAG,"No Change in AudioInput Device"),t.abrupt("return");case 6:if((n=this.getNewAudioInputDevice())&&n.deviceId){t.next=10;break}return ye.w(this.TAG,"Audio device not found"),t.abrupt("return");case 10:return r=e.settings,i=(new wt).codec(r.codec).maxBitrate(r.maxBitrate).deviceId(n.deviceId).build(),t.prev=11,t.next=14,e.setSettings(i,!0);case 14:this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:n,type:"audioInput"}),this.logDevices("Audio Device Change Success"),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),ye.e(this.TAG,"[Audio Device Change]",t.t0),this.eventBus.analytics.publish(Ln.deviceChange({selection:{audioInput:n},devices:this.getDevices(),error:t.t0})),this.eventBus.deviceChange.publish({error:t.t0,selection:n,type:"audioInput",devices:this.getDevices()});case 21:case"end":return t.stop()}},t,this,[[11,18]])}))},this.handleVideoInputDeviceChange=function(e){return $(r,null,b().mark(function t(){var n,r,i;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}return ye.d(this.TAG,"No video track on local peer"),t.abrupt("return");case 3:if(this.videoInputChanged){t.next=6;break}return ye.d(this.TAG,"No Change in VideoInput Device"),t.abrupt("return");case 6:if((n=this.videoInput[0])&&n.deviceId){t.next=10;break}return ye.w(this.TAG,"Video device not found"),t.abrupt("return");case 10:return r=e.settings,i=(new xt).codec(r.codec).maxBitrate(r.maxBitrate).maxFramerate(r.maxFramerate).setWidth(r.width).setHeight(r.height).deviceId(n.deviceId).build(),t.prev=11,t.next=14,e.setSettings(i,!0);case 14:this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:n,type:"video"}),this.logDevices("Video Device Change Success"),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),ye.e(this.TAG,"[Video Device Change]",t.t0),this.eventBus.analytics.publish(Ln.deviceChange({selection:{videoInput:n},devices:this.getDevices(),error:t.t0})),this.eventBus.deviceChange.publish({error:t.t0,type:"video",selection:n,devices:this.getDevices()});case 21:case"end":return t.stop()}},t,this,[[11,18]])}))};var i=function(e){var t=e.enabled,n=e.track;return t&&"regular"===n.source};this.eventBus.localVideoEnabled.waitFor(i).then(function(){return $(r,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices();case 2:this.videoInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()});case 3:case"end":return e.stop()}},e,this)}))}),this.eventBus.localAudioEnabled.waitFor(i).then(function(){return $(r,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices();case 2:this.audioInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()});case 3:case"end":return e.stop()}},e,this)}))})}return O(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.initialized&&!e,t.t0){t.next=11;break}return!this.initialized&&navigator.mediaDevices.addEventListener("devicechange",this.handleDeviceChange),this.initialized=!0,t.next=6,this.enumerateDevices();case 6:return this.logDevices("Init"),t.next=9,this.setOutputDevice();case 9:this.eventBus.deviceChange.publish({devices:this.getDevices()}),this.eventBus.analytics.publish(Ln.deviceChange({selection:this.getCurrentSelection(),type:"list",devices:this.getDevices()}));case 11:case"end":return t.stop()}},t,this)}))}},{key:"getDevices",value:function(){return{audioInput:this.audioInput,audioOutput:this.audioOutput,videoInput:this.videoInput}}},{key:"cleanUp",value:function(){this.initialized=!1,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.outputDevice=void 0,navigator.mediaDevices.removeEventListener("devicechange",this.handleDeviceChange)}},{key:"createIdentifier",value:function(e){return e?"".concat(e.deviceId).concat(e.groupId):""}},{key:"getNewAudioInputDevice",value:function(){var e=this.audioInput.find(function(e){return"default"===e.deviceId});return e?this.audioInput.find(function(t){return t.label!==e.label&&e.label.includes(t.label)}):this.audioInput[0]}},{key:"setOutputDevice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return $(this,null,b().mark(function t(){var n,r,i=this;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.getNewAudioInputDevice(),r=this.createIdentifier(this.outputDevice),this.outputDevice=this.getAudioOutputDeviceMatchingInput(n),this.outputDevice||(this.outputDevice=this.audioOutput.find(function(e){return i.createIdentifier(e)===r}),this.outputDevice||(this.outputDevice=this.audioOutput.find(function(e){return"default"===e.deviceId})||this.audioOutput[0])),t.next=5,this.store.updateAudioOutputDevice(this.outputDevice);case 5:e&&r!==this.createIdentifier(this.outputDevice)&&this.eventBus.deviceChange.publish({selection:this.outputDevice,type:"audioOutput",devices:this.getDevices()});case 6:case"end":return t.stop()}},t,this)}))}},{key:"getAudioOutputDeviceMatchingInput",value:function(e){var t,n,r=(null==(n=null==(t=this.store.getConfig())?void 0:t.settings)?void 0:n.speakerAutoSelectionBlacklist)||[];if("all"!==r){var i=(null==e?void 0:e.label.toLowerCase())||"";return!r.some(function(e){return i.includes(e.toLowerCase())})&&(null==e?void 0:e.groupId)?this.audioOutput.find(function(t){return"default"!==e.deviceId&&t.label===e.label}):void 0}}},{key:"logDevices",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";ye.d(this.TAG,e,JSON.stringify({videoInput:f(this.videoInput),audioInput:f(this.audioInput),audioOutput:f(this.audioOutput),selected:this.getCurrentSelection()},null,4))}}]),e}(),Dr=function(){function e(t,n){D(this,e),this.deviceManager=t,this.audioSinkManager=n}return O(e,[{key:"getVolume",value:function(){return this.audioSinkManager.getVolume()}},{key:"setVolume",value:function(e){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");this.audioSinkManager.setVolume(e)}},{key:"getDevice",value:function(){return this.deviceManager.outputDevice}},{key:"setDevice",value:function(e){return this.deviceManager.updateOutputDevice(e)}},{key:"unblockAutoplay",value:function(){return $(this,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.audioSinkManager.unblockAutoplay();case 2:case"end":return e.stop()}},e,this)}))}}]),e}(),Nr="AnalyticsEventsService",Or=function(){function e(t){D(this,e),this.store=t,this.bufferSize=Ve,this.transport=null,this.pendingEvents=[],this.level=cn.INFO}return O(e,[{key:"setTransport",value:function(e){this.transport=e}},{key:"reset",value:function(){this.transport=null,this.pendingEvents=[]}},{key:"queue",value:function(e){if(e.level>=this.level&&(this.pendingEvents.push(e),this.pendingEvents.length>this.bufferSize)){var t=this.pendingEvents.shift();ye.d(Nr,"Max buffer size reached","Removed event to accommodate new events",t)}return this}},{key:"flushFailedClientEvents",value:function(){or.flushFailedEvents()}},{key:"flush",value:function(){var e;try{for(;this.pendingEvents.length>0;){var t=this.pendingEvents.shift();t&&(t.metadata.peer.peer_id=null==(e=this.store.getLocalPeer())?void 0:e.peerId,t.metadata.userAgent=this.store.getUserAgent(),this.transport&&this.transport.transportProvider.isConnected?this.transport.sendEvent(t):this.sendClientEventOnHTTP(t))}}catch(n){ye.w(Nr,"Flush Failed",n)}}},{key:"sendClientEventOnHTTP",value:function(e){var t,n,r,i,a=this.store.getRoom(),s=this.store.getLocalPeer();e.metadata.token=null==(t=this.store.getConfig())?void 0:t.authToken,e.metadata.peer={session_id:a.sessionId,room_id:a.id,room_name:a.name,template_id:a.templateId,joined_at:null==(n=a.joinedAt)?void 0:n.getTime(),session_started_at:null==(r=a.startedAt)?void 0:r.getTime(),role:null==(i=null==s?void 0:s.role)?void 0:i.name,user_name:null==s?void 0:s.name,user_data:null==s?void 0:s.metadata},or.sendEvent(e)}}]),e}(),Mr=function(){function e(t){D(this,e),this.store=t,this.primitiveComparator=function(e,t){return e===t?0:Number(e)-Number(t)},this.stringComparator=function(e,t){return e===t?0:e<t?-1:1}}return O(e,[{key:"getPeerComparators",value:function(){var e=this;return{videoEnabled:function(t,n){var r,i;return e.primitiveComparator(Boolean(null==(r=t.videoTrack)?void 0:r.enabled),Boolean(null==(i=n.videoTrack)?void 0:i.enabled))},audioEnabled:function(t,n){var r,i;return e.primitiveComparator(Boolean(null==(r=t.audioTrack)?void 0:r.enabled),Boolean(null==(i=n.audioTrack)?void 0:i.enabled))},screenShare:function(t,n){return e.primitiveComparator(t.auxiliaryTracks.some(function(e){return"screen"===e.source}),n.auxiliaryTracks.some(function(e){return"screen"===e.source}))},audioLevel:function(t,n){var r,i;return e.primitiveComparator((null==(r=e.store.getSpeakers().find(function(e){return e.peer&&e.peer.peerId===(null==t?void 0:t.peerId)}))?void 0:r.audioLevel)||-1,(null==(i=e.store.getSpeakers().find(function(e){return e.peer&&e.peer.peerId===(null==n?void 0:n.peerId)}))?void 0:i.audioLevel)||-1)},rolePriority:function(t,n){var r,i;return e.primitiveComparator((null==(r=n.role)?void 0:r.priority)||0,(null==(i=t.role)?void 0:i.priority)||0)}}}},{key:"getTrackComparators",value:function(){var e=this;return{video:function(t,n){return e.primitiveComparator(t.type===Le.VIDEO,n.type===Le.VIDEO)},audio:function(t,n){return e.primitiveComparator(t.type===Le.AUDIO,n.type===Le.AUDIO)},enabled:function(t,n){return e.primitiveComparator(Boolean(t.enabled),Boolean(n.enabled))},peerAudioLevel:function(t,n){var r=e.store.getPeerByTrackId(t.trackId),i=e.store.getPeerByTrackId(n.trackId);return e.getPeerComparators().audioLevel(r,i)},audioLevel:function(t,n){var r,i;return e.primitiveComparator((null==(r=e.store.getSpeakers().find(function(e){return e.track.trackId===t.trackId}))?void 0:r.audioLevel)||0,(null==(i=e.store.getSpeakers().find(function(e){return e.track.trackId===n.trackId}))?void 0:i.audioLevel)||0)},screenShare:function(t,n){return e.primitiveComparator("screen"===t.source,"screen"===n.source)},rolePriority:function(t,n){var r,i,a,s;return e.primitiveComparator((null==(i=null==(r=e.store.getPeerByTrackId(n.trackId))?void 0:r.role)?void 0:i.priority)||0,(null==(s=null==(a=e.store.getPeerByTrackId(t.trackId))?void 0:a.role)?void 0:s.priority)||0)}}}}]),e}(),Lr=function(){function e(){D(this,e),this.comparator=new Mr(this),this.knownRoles={},this.peers={},this.tracks={},this.peerTrackStates={},this.speakers=[],this.videoLayers=null,this.screenshareLayers=null,this.roleDetailsArrived=!1,this.env=V.PROD,this.userAgent=sn(this.env)}return O(e,[{key:"getConfig",value:function(){return this.config}},{key:"getEnv",value:function(){return this.env}},{key:"getPublishParams",value:function(){return this.publishParams}},{key:"getComparator",value:function(){return this.comparator}},{key:"getRoom",value:function(){return this.room}},{key:"getPolicyForRole",value:function(e){return this.knownRoles[e]}},{key:"getKnownRoles",value:function(){return this.knownRoles}},{key:"getLocalPeer",value:function(){if(this.localPeerId&&this.peers[this.localPeerId])return this.peers[this.localPeerId]}},{key:"getRemotePeers",value:function(){return Object.values(this.peers).filter(function(e){return!e.isLocal})}},{key:"getPeers",value:function(){return Object.values(this.peers)}},{key:"getPeerById",value:function(e){if(this.peers[e])return this.peers[e]}},{key:"getTracksMap",value:function(){return this.tracks}},{key:"getTracks",value:function(){return Object.values(this.tracks)}},{key:"getVideoTracks",value:function(){return this.getTracks().filter(function(e){return e.type===Le.VIDEO})}},{key:"getRemoteVideoTracks",value:function(){return this.getTracks().filter(function(e){return e instanceof dt})}},{key:"getAudioTracks",value:function(){return this.getTracks().filter(function(e){return e.type===Le.AUDIO})}},{key:"getPeerTracks",value:function(e){var t=e?this.peers[e]:void 0,n=[];return(null==t?void 0:t.videoTrack)&&n.push(t.videoTrack),(null==t?void 0:t.audioTrack)&&n.push(t.audioTrack),n.concat((null==t?void 0:t.auxiliaryTracks)||[])}},{key:"getLocalPeerTracks",value:function(){return this.getPeerTracks(this.localPeerId)}},{key:"getTrackById",value:function(e){var t,n,r=this.tracks[e];if(r)return r;var i=this.getLocalPeer();if(i){if(null==(t=i.audioTrack)?void 0:t.isPublishedTrackId(e))return i.audioTrack;if(null==(n=i.videoTrack)?void 0:n.isPublishedTrackId(e))return i.videoTrack}}},{key:"getPeerByTrackId",value:function(e){var t=this.tracks[e];return t.peerId?this.peers[t.peerId]:void 0}},{key:"getSpeakers",value:function(){return this.speakers}},{key:"getSpeakerPeers",value:function(){return this.speakers.map(function(e){return e.peer})}},{key:"getUserAgent",value:function(){return this.userAgent}},{key:"createAndSetUserAgent",value:function(e){this.userAgent=sn(this.env,e)}},{key:"setRoom",value:function(e){this.room=e}},{key:"setKnownRoles",value:function(e){this.knownRoles=e,this.roleDetailsArrived=!0,this.updatePeersPolicy()}},{key:"hasRoleDetailsArrived",value:function(){return this.roleDetailsArrived}},{key:"setConfig",value:function(e){var t,n,r;if(Tn.rememberDevices(Boolean(e.rememberDeviceSelection)),e.rememberDeviceSelection){var i=Tn.getSelection();i&&(e.settings||(e.settings={}),(null==(t=i.audioInput)?void 0:t.deviceId)&&(e.settings.audioInputDeviceId=e.settings.audioInputDeviceId||i.audioInput.deviceId),(null==(n=i.audioOutput)?void 0:n.deviceId)&&(e.settings.audioOutputDeviceId=e.settings.audioOutputDeviceId||i.audioOutput.deviceId),(null==(r=i.videoInput)?void 0:r.deviceId)&&(e.settings.videoDeviceId=e.settings.videoDeviceId||i.videoInput.deviceId))}this.config=e,this.setEnv()}},{key:"setPublishParams",value:function(e){this.publishParams=e}},{key:"addPeer",value:function(e){this.peers[e.peerId]=e,e.isLocal&&(this.localPeerId=e.peerId)}},{key:"addTrack",value:function(e){this.tracks[e.trackId]=e}},{key:"getTrackState",value:function(e){return this.peerTrackStates[e]}},{key:"setTrackState",value:function(e){this.peerTrackStates[e.trackInfo.track_id]=e}},{key:"removePeer",value:function(e){this.localPeerId===e&&(this.localPeerId=void 0),delete this.peers[e]}},{key:"removeTrack",value:function(e){delete this.tracks[e]}},{key:"updateSpeakers",value:function(e){this.speakers=e}},{key:"updateAudioOutputVolume",value:function(e){this.getAudioTracks().forEach(function(t){return t.setVolume(e)})}},{key:"updateAudioOutputDevice",value:function(e){return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],this.getAudioTracks().forEach(function(t){n.push(t.setOutputDevice(e))}),t.next=4,Promise.all(n);case 4:case"end":return t.stop()}},t,this)}))}},{key:"getSubscribeDegradationParams",value:function(){var e,t,n=null==(t=null==(e=this.getLocalPeer())?void 0:e.role)?void 0:t.subscribeParams.subscribeDegradation;if(n&&Object.keys(n).length>0)return n}},{key:"getSimulcastLayers",value:function(e){var t,n;return"screen"===e?(null==(t=this.screenshareLayers)?void 0:t.layers)||[]:(null==(n=this.videoLayers)?void 0:n.layers)||[]}},{key:"getSimulcastDimensions",value:function(e){var t="screen"===e?this.screenshareLayers:this.videoLayers;return{width:null==t?void 0:t.width,height:null==t?void 0:t.height}}},{key:"convertSimulcastLayers",value:function(e){return z(Q({},e),{layers:(e.layers||[]).map(function(e){return z(Q({},e),{maxBitrate:1e3*e.maxBitrate})})})}},{key:"setVideoSimulcastLayers",value:function(e){this.videoLayers=this.convertSimulcastLayers(e)}},{key:"setScreenshareSimulcastLayers",value:function(e){this.screenshareLayers=this.convertSimulcastLayers(e)}},{key:"getSimulcastDefinitionsForPeer",value:function(e,t){var n;if(!e.role)return[];var r,i=this.getPolicyForRole(e.role.name).publishParams;"regular"===t?r=i.videoSimulcastLayers:"screen"===t&&(r=i.screenSimulcastLayers);var a=null==r?void 0:r.width,s=null==r?void 0:r.height;return(null==(n=null==r?void 0:r.layers)?void 0:n.map(function(e){return{layer:we[e.rid],resolution:{width:a&&e.scaleResolutionDownBy?a/e.scaleResolutionDownBy:void 0,height:s&&e.scaleResolutionDownBy?s/e.scaleResolutionDownBy:void 0}}}))||[]}},{key:"cleanUp",value:function(){var e,t=U(this.getTracks());try{for(t.s();!(e=t.n()).done;){e.value.cleanup()}}catch(n){t.e(n)}finally{t.f()}this.room=void 0,this.config=void 0,this.localPeerId=void 0,this.roleDetailsArrived=!1}},{key:"setErrorListener",value:function(e){this.errorListener=e}},{key:"updatePeersPolicy",value:function(){var e=this;this.getPeers().forEach(function(t){var n;t.role?t.role=e.getPolicyForRole(t.role.name):null==(n=e.errorListener)||n.onError(Pe.GenericErrors.InvalidRole(Ae.VALIDATION,""))})}},{key:"setEnv",value:function(){var e,t=(null==(e=this.config)?void 0:e.initEndpoint).split("https://")[1],n=V.PROD;t.startsWith(V.PROD)?n=V.PROD:t.startsWith(V.QA)?n=V.QA:t.startsWith(V.DEV)&&(n=V.DEV),this.env=n,or.setEnv(n)}}]),e}(),Ur=function(){function e(t,n,r,i,a){var s=this;D(this,e),this.store=t,this.transport=n,this.publish=r,this.removeAuxiliaryTrack=i,this.listener=a,this.handleLocalPeerRoleUpdate=function(e){return $(s,[e],function(e){var t=this,n=e.oldRole,r=e.newRole;return b().mark(function e(){var i,a,s,o,c,u,l,d,h;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.store.getLocalPeer()){e.next=3;break}return e.abrupt("return");case 3:return o=new Set(n.publishParams.allowed||[]),c=new Set(r.publishParams.allowed||[]),u=t.removeTrack(o,c,"video"),l=t.removeTrack(o,c,"audio"),d=t.removeTrack(o,c,"screen"),e.next=6,t.removeVideoTracks(u);case 6:return e.next=8,t.removeAudioTrack(l);case 8:return e.next=10,t.removeScreenTracks(d);case 10:return t.store.setPublishParams(r.publishParams),h=(null==(i=t.store.getConfig())?void 0:i.settings)||{isAudioMuted:!0,isVideoMuted:!0,audioInputDeviceId:"default",videoDeviceId:"default",audioOutputDeviceId:"default"},e.next=14,t.publish(z(Q({},h),{isAudioMuted:!0,isVideoMuted:!0}));case 14:null==(a=t.listener)||a.onPeerUpdate(pe.ROLE_UPDATED,s);case 15:case"end":return e.stop()}},e)})()})}}return O(e,[{key:"removeVideoTracks",value:function(e){return $(this,null,b().mark(function t(){var n,r;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(r=this.store.getLocalPeer(),t.t0=null==r?void 0:r.videoTrack,!t.t0){t.next=9;break}return t.next=7,this.transport.unpublish([r.videoTrack]);case 7:null==(n=this.listener)||n.onTrackUpdate(fe.TRACK_REMOVED,r.videoTrack,r),r.videoTrack=void 0;case 9:return t.next=11,this.removeAuxTracks(function(e){return"screen"!==e.source&&"video"===e.type});case 11:case"end":return t.stop()}},t,this)}))}},{key:"removeAudioTrack",value:function(e){return $(this,null,b().mark(function t(){var n,r;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(r=this.store.getLocalPeer(),t.t0=null==r?void 0:r.audioTrack,!t.t0){t.next=9;break}return t.next=7,this.transport.unpublish([r.audioTrack]);case 7:null==(n=this.listener)||n.onTrackUpdate(fe.TRACK_REMOVED,r.audioTrack,r),r.audioTrack=void 0;case 9:return t.next=11,this.removeAuxTracks(function(e){return"screen"!==e.source&&"audio"===e.type});case 11:case"end":return t.stop()}},t,this)}))}},{key:"removeScreenTracks",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=!e,t.t0){t.next=4;break}return t.next=4,this.removeAuxTracks(function(e){return"screen"===e.source});case 4:case"end":return t.stop()}},t,this)}))}},{key:"removeAuxTracks",value:function(e){return $(this,null,b().mark(function t(){var n,r,i,a,s;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null==(n=this.store.getLocalPeer())?void 0:n.auxiliaryTracks)){t.next=22;break}r=f(n.auxiliaryTracks),i=U(r),t.prev=4,i.s();case 6:if((a=i.n()).done){t.next=14;break}if(s=a.value,t.t0=e(s),!t.t0){t.next=12;break}return t.next=12,this.removeAuxiliaryTrack(s.trackId);case 12:t.next=6;break;case 14:t.next=19;break;case 16:t.prev=16,t.t1=t.catch(4),i.e(t.t1);case 19:return t.prev=19,i.f(),t.finish(19);case 22:case"end":return t.stop()}},t,this,[[4,16,19,22]])}))}},{key:"removeTrack",value:function(e,t,n){return e.has(n)&&!t.has(n)}}]),e}(),Gr=function(e){E(n,o.EventEmitter2);var t=S(n);function n(){return D(this,n),t.apply(this,arguments)}return O(n,[{key:"on",value:function(e,t){return y(_(n.prototype),"on",this).call(this,e,t)}},{key:"off",value:function(e,t){return y(_(n.prototype),"off",this).call(this,e,t)}},{key:"emit",value:function(e,t){return y(_(n.prototype),"emit",this).call(this,e,t)}},{key:"listeners",value:function(e){return y(_(n.prototype),"listeners",this).call(this,e)}}]),n}(),Fr=function(){function e(t){D(this,e),this.audioContext=new AudioContext,this.source=this.audioContext.createMediaElementSource(t),this.source.connect(this.audioContext.destination)}return O(e,[{key:"resumeContext",value:function(){"suspended"===this.audioContext.state&&(ye.d(this.TAG,"AudioContext is resumed"),this.audioContext.resume())}},{key:"getAudioTrack",value:function(){return this.destinationNode&&this.source.disconnect(this.destinationNode),this.destinationNode=this.audioContext.createMediaStreamDestination(),this.source.connect(this.destinationNode),this.destinationNode.stream.getAudioTracks()[0]}},{key:"cleanup",value:function(){"closed"!==this.audioContext.state&&this.audioContext.close()}},{key:"TAG",get:function(){return"AudioContextManager"}}]),e}(),Br=function(e){E(n,Gr);var t=S(n);function n(){var e;return D(this,n),(e=t.apply(this,arguments)).audioElement=null,e.seeked=!1,e}return O(n,[{key:"play",value:function(e){return $(this,null,b().mark(function t(){var n=this;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(this.audioElement=this.getAudioElement(),new Promise(function(t,r){n.audioElement=n.getAudioElement(),n.audioElement.src=e,n.seeked=!1,n.audioElement.onerror=function(){var t="Error loading ".concat(e);ye.e(n.TAG,t),n.stop(),r(t)},n.audioElement.oncanplaythrough=function(){return $(n,null,b().mark(function n(){var i;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,this.audioElement){n.next=3;break}return n.abrupt("return");case 3:if(this.audioContextManager.resumeContext(),!this.track){n.next=13;break}if(!this.seeked){n.next=8;break}this.seeked=!1,n.next=11;break;case 8:return n.next=10,this.audioElement.play();case 10:t([this.track]);case 11:n.next=17;break;case 13:return n.next=15,this.audioElement.play();case 15:i=this.audioContextManager.getAudioTrack(),this.track=i,t([i]);case 17:n.next=22;break;case 19:n.prev=19,n.t0=n.catch(0),ye.e(this.TAG,"Error playing audio",e,n.t0.message),r(n.t0);case 22:case"end":return n.stop()}},n,this,[[0,19]])}))},n.audioElement.onseeked=function(){n.seeked=!0}})));case 1:case"end":return t.stop()}},t,this)}))}},{key:"getTracks",value:function(){return this.track?[this.track.id]:[]}},{key:"getElement",value:function(){return this.audioElement}},{key:"stop",value:function(){var e,t,n;null==(e=this.audioElement)||e.pause(),null==(t=this.audioElement)||t.removeAttribute("src"),this.audioElement=null,null==(n=this.audioContextManager)||n.cleanup(),this.track=void 0}},{key:"getAudioElement",value:function(){var e=this;if(this.audioElement)return this.audioElement;var t=document.createElement("audio");return t.crossOrigin="anonymous",t.addEventListener("timeupdate",function(t){return e.emit("progress",t)}),t.addEventListener("ended",function(){e.emit("ended",null)}),this.audioContextManager=new Fr(t),t}},{key:"TAG",get:function(){return"PlaylistAudioManager"}}]),n}(),Vr=function(e){E(n,Gr);var t=S(n);function n(){var e;return D(this,n),(e=t.apply(this,arguments)).videoElement=null,e.canvasContext=null,e.tracks=[],e.DEFAUL_FPS=24,e.seeked=!1,e.drawImage=function(){var t,n,r;e.videoElement&&!e.videoElement.paused&&!e.videoElement.ended&&(null==(r=e.canvasContext)||r.drawImage(e.videoElement,0,0,null==(t=e.canvas)?void 0:t.width,null==(n=e.canvas)?void 0:n.height),e.timer=setTimeout(function(){e.drawImage()},1e3/e.DEFAUL_FPS))},e}return O(n,[{key:"play",value:function(e){var t=this;return this.videoElement=this.getVideoElement(),this.createCanvas(),new Promise(function(n,r){t.videoElement=t.getVideoElement(),t.videoElement.src=e,t.seeked=!1,t.videoElement.onerror=function(){var n="Error loading ".concat(e);ye.e(t.TAG,n),t.stop(),r(n)},t.videoElement.oncanplaythrough=function(){return $(t,null,b().mark(function t(){var i,a,s,o,c,u=this;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.videoElement){t.next=3;break}return t.abrupt("return");case 3:if(this.canvas.width=this.videoElement.videoWidth,this.canvas.height=this.videoElement.videoHeight,0!==this.tracks.length){t.next=17;break}if(this.clearCanvasAndTracks(),o=this.canvas.captureStream()){t.next=9;break}return ye.e(this.TAG,"Browser does not support captureStream"),t.abrupt("return");case 9:return this.videoElement.onplay=this.drawImage,this.audioContextManager.resumeContext(),t.next=13,this.videoElement.play();case 13:c=this.audioContextManager.getAudioTrack(),o.addTrack(c),o.getTracks().forEach(function(e){u.tracks.push(e)}),n(this.tracks),t.next=24;break;case 17:if(!this.seeked){t.next=21;break}this.seeked=!1,null==(s=this.canvasContext)||s.drawImage(this.videoElement,0,0,null==(i=this.canvas)?void 0:i.width,null==(a=this.canvas)?void 0:a.height),t.next=24;break;case 21:return t.next=23,this.videoElement.play();case 23:n(this.tracks);case 24:t.next=29;break;case 26:t.prev=26,t.t0=t.catch(0),ye.e(this.TAG,"Error playing video",e,t.t0.message),r(t.t0);case 29:case"end":return t.stop()}},t,this,[[0,26]])}))},t.videoElement.onseeked=function(){t.seeked=!0}})}},{key:"getTracks",value:function(){return this.tracks.map(function(e){return e.id})}},{key:"getElement",value:function(){return this.videoElement}},{key:"stop",value:function(){var e,t,n;null==(e=this.videoElement)||e.pause(),null==(t=this.videoElement)||t.removeAttribute("src"),this.videoElement=null,null==(n=this.audioContextManager)||n.cleanup(),this.clearCanvasAndTracks()}},{key:"clearCanvasAndTracks",value:function(){var e;this.tracks=[],null==(e=this.canvasContext)||e.clearRect(0,0,this.canvas.width,this.canvas.height),clearTimeout(this.timer)}},{key:"getVideoElement",value:function(){var e=this;if(this.videoElement)return this.videoElement;var t=document.createElement("video");return t.crossOrigin="anonymous",t.addEventListener("timeupdate",function(t){return e.emit("progress",t)}),t.addEventListener("ended",function(){e.emit("ended",null)}),this.audioContextManager=new Fr(t),t}},{key:"createCanvas",value:function(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d"))}},{key:"TAG",get:function(){return"PlaylistVideoManager"}}]),n}(),Hr={audio:{list:[],currentIndex:-1,isAutoplayOn:!0},video:{list:[],currentIndex:-1,isAutoplayOn:!0}},Wr=function(e){E(n,Gr);var t=S(n);function n(e,r){var i;return D(this,n),(i=t.call(this)).sdk=e,i.eventBus=r,i.state={audio:Q({},Hr.audio),video:Q({},Hr.video)},i.TAG="[PlaylistManager]",i.handlePausePlaylist=function(e){return $(A(i),[e],function(e){var t=this,n=e.enabled,r=e.track;return b().mark(function e(){var i,a;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=2;break}return e.abrupt("return");case 2:"audioplaylist"===r.source&&(a=Ee.audio),"videoplaylist"===r.source&&(a=Ee.video),a&&(null==(i=t.getElement(a))||i.pause());case 3:case"end":return e.stop()}},e)})()})},i.addTrack=function(e,t){return $(A(i),null,b().mark(function n(){return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.sdk.addTrack(e,t);case 2:ye.d(this.TAG,"Playlist track added",st(e));case 3:case"end":return n.stop()}},n,this)}))},i.removeTrack=function(e){return $(A(i),null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.removeTrack(e);case 2:ye.d(this.TAG,"Playlist track removed",e);case 3:case"end":return t.stop()}},t,this)}))},i.audioManager=new Br,i.videoManager=new Vr,i.addListeners(),i}return O(n,[{key:"getList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio;return this.state[e].list}},{key:"setList",value:function(e){var t=this;e&&0!==e.length?e.forEach(function(e){t.state[e.type].list.includes(e)||t.state[e.type].list.push(e)}):ye.w(this.TAG,"Please pass in a list of HMSPlaylistItem's")}},{key:"clearList",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.isPlaying(e),!t.t0){t.next=4;break}return t.next=4,this.stop(e);case 4:this.state[e].list=[];case 5:case"end":return t.stop()}},t,this)}))}},{key:"removeItem",value:function(e,t){return $(this,null,b().mark(function n(){var r,i,a,s;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.state[t],i=r.list,a=r.currentIndex,!((s=i.findIndex(function(t){return e===t.id}))>-1)){n.next=10;break}if(n.t1=a===s&&this.isPlaying(t),!n.t1){n.next=6;break}return n.next=6,this.stop(t);case 6:i.splice(s,1),n.t0=!0,n.next=11;break;case 10:n.t0=!1;case 11:return n.abrupt("return",n.t0);case 12:case"end":return n.stop()}},n,this)}))}},{key:"seek",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ee.audio;if(-1===this.state[t].currentIndex)throw Pe.PlaylistErrors.NoEntryToPlay(Ae.PLAYLIST,"No item is currently playing");var n=this.getElement(t);if(n){var r=Math.max(n.currentTime+e,0);n.currentTime=Math.min(r,n.duration)}}},{key:"seekTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ee.audio;if(-1===this.state[t].currentIndex)throw Pe.PlaylistErrors.NoEntryToPlay(Ae.PLAYLIST,"No item is currently playing");if(e<0)throw Error("value cannot be negative");var n=this.getElement(t);n&&(n.currentTime=Math.min(e,n.duration))}},{key:"setVolume",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ee.audio;if(e<0||e>100)throw Error("Please pass a valid number between 0-100");var n=this.getElement(t);n&&(n.volume=.01*e)}},{key:"getVolume",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio,t=this.getElement(e);return t?100*t.volume:0}},{key:"getCurrentTime",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio,t=this.getElement(e);return(null==t?void 0:t.currentTime)||0}},{key:"getCurrentIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio;return this.state[e].currentIndex}},{key:"getCurrentProgress",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio,n=this.state[t],r=null==(e=n.list[n.currentIndex])?void 0:e.url,i=this.getElement(t);return r&&i?Math.floor(i.currentTime/i.duration*100):0}},{key:"getCurrentSelection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio,t=this.state[e],n=t.list,r=t.currentIndex;if(-1!==r)return n[r]}},{key:"isPlaying",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio,t=this.getElement(e);return!!t&&!t.paused}},{key:"setIsAutoplayOn",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio,t=arguments.length>1?arguments[1]:void 0;this.state[e].isAutoplayOn=t}},{key:"getPlaybackRate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio,t=this.getElement(e);return t?t.playbackRate:1}},{key:"setPlaybackRate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio,t=arguments.length>1?arguments[1]:void 0;if(t<.25||t>2)throw Error("Please pass a value between 0.25 and 2.0");var n=this.getElement(e);n&&(n.playbackRate=t)}},{key:"setEnabled",value:function(e,t){return $(this,arguments,function(e,t){var n=this,r=t.id,i=t.type,a=void 0===i?Ee.audio:i;return b().mark(function t(){var i,s;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n.state[a].list.findIndex(function(e){return e.id===r}),r&&-1!==i){t.next=4;break}return ye.w(n.TAG,"Pass a valid id"),t.abrupt("return");case 4:if(s=n.state[a].list[i].url,!e){t.next=10;break}return t.next=8,n.play(s,a);case 8:t.next=12;break;case 10:return t.next=12,n.pause(s,a);case 12:n.state[a].currentIndex=i,n.setDuration(a);case 14:case"end":return t.stop()}},t)})()})}},{key:"playNext",value:function(){return $(this,arguments,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio;return b().mark(function n(){var r,i,a;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.state[t],i=r.list,!((a=r.currentIndex)>=i.length-1)){n.next=3;break}throw Pe.PlaylistErrors.NoEntryToPlay(Ae.PLAYLIST,"Reached end of playlist");case 3:return n.next=5,e.play(i[a+1].url,t);case 5:e.state[t].currentIndex=a+1,e.setDuration(t);case 7:case"end":return n.stop()}},n)})()})}},{key:"playPrevious",value:function(){return $(this,arguments,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio;return b().mark(function n(){var r,i,a;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.state[t],i=r.list,!((a=r.currentIndex)<=0)){n.next=3;break}throw Pe.PlaylistErrors.NoEntryToPlay(Ae.PLAYLIST,"Reached start of playlist");case 3:return n.next=5,e.play(i[a-1].url,t);case 5:e.state[t].currentIndex=a-1,e.setDuration(t);case 7:case"end":return n.stop()}},n)})()})}},{key:"stop",value:function(){return $(this,arguments,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio;return b().mark(function n(){var r,i;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=t===Ee.audio?e.audioManager:e.videoManager,null==(r=i.getElement())||r.pause(),n.next=4,e.removeTracks(t);case 4:i.stop(),e.state[t].currentIndex=-1;case 6:case"end":return n.stop()}},n)})()})}},{key:"cleanup",value:function(){this.state={audio:Q({},Hr.audio),video:Q({},Hr.video)},this.eventBus.localAudioEnabled.unsubscribe(this.handlePausePlaylist),this.eventBus.localVideoEnabled.unsubscribe(this.handlePausePlaylist),this.audioManager.stop(),this.videoManager.stop()}},{key:"onProgress",value:function(e){var t=this;this.videoManager.on("progress",function(){try{e({type:Ee.video,progress:t.getCurrentProgress(Ee.video)})}catch(n){ye.e(t.TAG,"Error in onProgress callback")}}),this.audioManager.on("progress",function(){try{e({type:Ee.audio,progress:t.getCurrentProgress(Ee.audio)})}catch(n){ye.e(t.TAG,"Error in onProgress callback")}})}},{key:"onNewTrackStart",value:function(e){this.on("newTrackStart",e)}},{key:"onPlaylistEnded",value:function(e){this.on("playlistEnded",e)}},{key:"onCurrentTrackEnded",value:function(e){this.on("currentTrackEnded",e)}},{key:"getElement",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio)===Ee.audio?this.audioManager.getElement():this.videoManager.getElement()}},{key:"removeTracks",value:function(){return $(this,arguments,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio;return b().mark(function n(){var r,i,a,s;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:r=(t===Ee.audio?e.audioManager:e.videoManager).getTracks(),i=U(r),n.prev=2,i.s();case 4:if((a=i.n()).done){n.next=10;break}return s=a.value,n.next=8,e.removeTrack(s);case 8:n.next=4;break;case 10:n.next=15;break;case 12:n.prev=12,n.t0=n.catch(2),i.e(n.t0);case 15:return n.prev=15,i.f(),n.finish(15);case 18:case"end":return n.stop()}},n,null,[[2,12,15,18]])})()})}},{key:"play",value:function(e){return $(this,arguments,function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ee.audio;return b().mark(function r(){var i,a,s,o,c,u;return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=n===Ee.audio?t.audioManager:t.videoManager,a=i.getElement(),!t.isItemCurrentlyPlaying(e,n)){r.next=4;break}return ye.w(t.TAG,"The ".concat(n," is currently playing")),r.abrupt("return");case 4:if(!(null==a?void 0:a.src.includes(e))){r.next=9;break}return r.next=7,a.play();case 7:r.next=30;break;case 9:return null==a||a.pause(),r.next=12,i.play(e);case 12:s=r.sent,o=U(s),r.prev=14,o.s();case 16:if((c=o.n()).done){r.next=22;break}return u=c.value,r.next=20,t.addTrack(u,n===Ee.audio?"audioplaylist":"videoplaylist");case 20:r.next=16;break;case 22:r.next=27;break;case 24:r.prev=24,r.t0=r.catch(14),o.e(r.t0);case 27:return r.prev=27,o.f(),r.finish(27);case 30:case"end":return r.stop()}},r,null,[[14,24,27,30]])})()})}},{key:"isItemCurrentlyPlaying",value:function(e,t){var n=this.getElement(t);return!(!n||n.paused||!n.src.includes(e))}},{key:"setDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio,t=this.getElement(e),n=this.state[e],r=n.list,i=n.currentIndex;r[i]&&(r[i].duration=(null==t?void 0:t.duration)||0),this.emit("newTrackStart",r[i])}},{key:"pause",value:function(e){return $(this,arguments,function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ee.audio;return b().mark(function r(){var i;return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:(i=t.getElement(n))&&!i.paused&&i.src.includes(e)?(i.pause(),ye.d(t.TAG,"paused url",e)):ye.w(t.TAG,"The passed in url is not currently playing");case 2:case"end":return r.stop()}},r)})()})}},{key:"addListeners",value:function(){var e=this;this.audioManager.on("ended",function(){return e.handleEnded(Ee.audio)}),this.videoManager.on("ended",function(){return e.handleEnded(Ee.video)}),this.eventBus.localAudioEnabled.subscribe(this.handlePausePlaylist),this.eventBus.localAudioEnabled.subscribe(this.handlePausePlaylist)}},{key:"handleEnded",value:function(){return $(this,arguments,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee.audio;return b().mark(function n(){var r,i,a,s;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.state[t],i=r.list,a=r.currentIndex,s=r.isAutoplayOn,a!==i.length-1){n.next=7;break}return n.next=4,e.stop(t);case 4:e.emit("playlistEnded",t),n.next=13;break;case 7:if(!s){n.next=11;break}e.playNext(t),n.next=13;break;case 11:return n.next=13,e.pause(i[a].url,t);case 13:e.emit("currentTrackEnded",i[a]);case 14:case"end":return n.stop()}},n)})()})}}]),n}(),jr=O(function e(t,n){var r=this;D(this,e),this.eventName=t,this.eventEmitter=n,this.publish=function(e){r.eventEmitter.emit(r.eventName,e)},this.subscribe=function(e){r.eventEmitter.on(r.eventName,e)},this.subscribeOnce=function(e){r.eventEmitter.once(r.eventName,e)},this.unsubscribe=function(e){r.eventEmitter.off(r.eventName,e)},this.waitFor=function(e){return r.eventEmitter.waitFor(r.eventName,{filter:e})},this.removeAllListeners=function(){r.eventEmitter.removeAllListeners(r.eventName)}}),Kr=O(function e(){D(this,e),this.eventEmitter=new o.EventEmitter2,this.deviceChange=new jr(et.DEVICE_CHANGE,this.eventEmitter),this.localAudioEnabled=new jr(et.LOCAL_AUDIO_ENABLED,this.eventEmitter),this.localVideoEnabled=new jr(et.LOCAL_VIDEO_ENABLED,this.eventEmitter),this.statsUpdate=new jr(et.STATS_UPDATE,this.eventEmitter),this.trackDegraded=new jr(et.TRACK_DEGRADED,this.eventEmitter),this.trackRestored=new jr(et.TRACK_RESTORED,this.eventEmitter),this.trackAudioLevelUpdate=new jr(et.TRACK_AUDIO_LEVEL_UPDATE,this.eventEmitter),this.audioPluginFailed=new jr(et.AUDIO_PLUGIN_FAILED,this.eventEmitter),this.localAudioSilence=new jr(et.LOCAL_AUDIO_SILENCE,this.eventEmitter),this.analytics=new jr(et.ANALYTICS,this.eventEmitter),this.policyChange=new jr(et.POLICY_CHANGE,this.eventEmitter),this.localRoleUpdate=new jr(et.LOCAL_ROLE_UPDATE,this.eventEmitter),this.audioTrackUpdate=new jr(et.AUDIO_TRACK_UPDATE,this.eventEmitter),this.audioTrackAdded=new jr(et.AUDIO_TRACK_ADDED,this.eventEmitter),this.audioTrackRemoved=new jr(et.AUDIO_TRACK_REMOVED,this.eventEmitter),this.autoplayError=new jr(et.AUTOPLAY_ERROR,this.eventEmitter)}),Jr=function(){function e(t,n){var r=this;D(this,e),this.eventBus=t,this.listener=n,this.TAG="NetworkTestManager",this.controller=new AbortController,this.start=function(e){return $(r,null,b().mark(function t(){var n,r,i,a,s,o,c,u,l,d,h=this;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return r=e.url,i=e.timeout,a=e.scoreMap,s=this.controller.signal,o=Date.now(),c=0,u=bt(i).then(function(){h.controller.abort()}),t.prev=3,t.next=6,fetch("".concat(r,"?").concat(Date.now()),{signal:s});case 6:if(t.t0=n=t.sent.body,null!=t.t0){t.next=11;break}t.t1=void 0,t.next=12;break;case 11:t.t1=n.getReader();case 12:if(l=t.t1){t.next=15;break}throw Error("unable to process request");case 15:return d=function(){return $(h,null,b().mark(function e(){var t,n,r,i;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!l){e.next=17;break}e.prev=1,t=!1;case 3:if(t){e.next=12;break}return e.next=6,l.read();case 6:n=e.sent,r=n.value,i=n.done,t=i,r&&(c+=r.byteLength,this.sendScore({scoreMap:a,downloadedSize:c,startTime:o}));case 10:e.next=3;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),ye.e(this.TAG,e.t0);case 17:case"end":return e.stop()}},e,this,[[1,14]])}))},t.abrupt("return",Promise.race([d(),u]).then(function(){h.sendScore({scoreMap:a,downloadedSize:c,startTime:o,finished:!0})}).catch(function(e){ye.e(h.TAG,e),h.updateScoreToListener(0),h.eventBus.analytics.publish(Ln.previewNetworkQuality({error:e.message}))}));case 19:t.prev=19,t.t2=t.catch(3),ye.e(this.TAG,t.t2),"AbortError"!==t.t2.name&&(this.updateScoreToListener(0),this.eventBus.analytics.publish(Ln.previewNetworkQuality({error:t.t2.message})));case 22:case"end":return t.stop()}},t,this,[[3,19]])}))},this.stop=function(){r.controller.signal.aborted||r.controller.abort()},this.sendScore=function(e){var t=e.scoreMap,n=e.downloadedSize,i=e.startTime,a=e.finished,s=void 0!==a&&a,o=n/1024/((Date.now()-i)/1e3)*8,c=-1;for(var u in t){var l=t[u];o>=l.low&&(!l.high||o<=l.high)&&(c=Number(u))}r.updateScoreToListener(c),s&&r.eventBus.analytics.publish(Ln.previewNetworkQuality({score:c,downLink:o.toFixed(2)}))}}return O(e,[{key:"updateScoreToListener",value:function(e){var t,n;e!==this.score&&(this.score=e,null==(n=null==(t=this.listener)?void 0:t.onNetworkQuality)||n.call(t,e))}}]),e}(),qr={isAudioMuted:!1,isVideoMuted:!1,audioInputDeviceId:"default",audioOutputDeviceId:"default",videoDeviceId:"default"},Yr={published:!1,isInitialised:!1,isReconnecting:!1,isPreviewInProgress:!1,deviceManagersInitialised:!1},Qr=function(){function e(){var t=this;D(this,e),this.TAG="[HMSSdk]:",this.transportState=Yn.Disconnected,this.analyticsTimer=new Wn,this.sdkState=Q({},Yr),this.handleAutoplayError=function(e){var n,r;null==(r=null==(n=t.errorListener)?void 0:n.onError)||r.call(n,e)},this.observer={onNotification:function(e){e.method!==Et.PEER_LEAVE_REQUEST?(e.method===Et.POLICY_CHANGE&&t.analyticsTimer.end(Bn.ON_POLICY_CHANGE),t.notificationManager.handleNotification(e,t.sdkState.isReconnecting)):t.handlePeerLeaveRequest(e.params)},onTrackAdd:function(e){t.notificationManager.handleTrackAdd(e)},onTrackRemove:function(e){t.notificationManager.handleTrackRemove(e)},onTrackDegrade:function(e){var n,r;ye.d(t.TAG,"Sending Track Update Track Degraded",e),null==(r=t.listener)||r.onTrackUpdate(fe.TRACK_DEGRADED,e,null==(n=t.store)?void 0:n.getPeerByTrackId(e.trackId))},onTrackRestore:function(e){var n,r;ye.d(t.TAG,"Sending Track Update Track Restored",e),null==(r=t.listener)||r.onTrackUpdate(fe.TRACK_RESTORED,e,null==(n=t.store)?void 0:n.getPeerByTrackId(e.trackId))},onFailure:function(e){var n;null==(n=t.errorListener)||n.onError(e)},onStateChange:function(e,n){return $(t,null,b().mark(function t(){var r,i,a,s;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e,t.next=t.t0===Yn.Preview?3:t.t0===Yn.Joined?3:t.t0===Yn.Failed?5:t.t0===Yn.Reconnecting?10:12;break;case 3:return this.transportState===Yn.Reconnecting&&(null==(r=this.listener)||r.onReconnected()),t.abrupt("break",12);case 5:return t.next=7,this.leave();case 7:return null==(a=null==(i=this.errorListener)?void 0:i.onError)||a.call(i,n),this.sdkState.isReconnecting=!1,t.abrupt("break",12);case 10:return this.sdkState.isReconnecting=!0,null==(s=this.listener)||s.onReconnecting(n),t.abrupt("break",12);case 12:this.transportState=e,ye.d(this.TAG,"Transport State Change",this.transportState);case 13:case"end":return t.stop()}},t,this)}))}},this.handlePeerLeaveRequest=function(e){var n,r=e.requested_by?t.store.getPeerById(e.requested_by):void 0,i={roomEnded:e.room_end,reason:e.reason,requestedBy:r};null==(n=t.listener)||n.onRemovedFromRoom(i),t.internalLeave(!1)},this.handleDeviceChange=function(e){var n,r,i,a,s,o;if(ye.d(t.TAG,"Device Change event",e),null==(r=null==(n=t.deviceChangeListener)?void 0:n.onDeviceChange)||r.call(n,e),e.error&&e.type){var c=e.type.includes("audio")?null==(i=t.localPeer)?void 0:i.audioTrack:null==(a=t.localPeer)?void 0:a.videoTrack;null==(s=t.errorListener)||s.onError(e.error),[xe.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,xe.TracksErrors.DEVICE_IN_USE,xe.TracksErrors.DEVICE_NOT_AVAILABLE].includes(e.error.code)&&c&&(c.setEnabled(!1),null==(o=t.listener)||o.onTrackUpdate(fe.TRACK_MUTED,c,t.localPeer))}},this.handleAudioPluginError=function(e){var n;ye.e(t.TAG,"Audio Plugin Error event",e),null==(n=t.errorListener)||n.onError(e)},this.handleLocalRoleUpdate=function(e){return $(t,[e],function(e){var t=this,n=e.oldRole,r=e.newRole;return b().mark(function e(){var i;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.transport.handleLocalRoleUpdate({oldRole:n,newRole:r});case 2:return e.next=4,null==(i=t.roleChangeManager)?void 0:i.handleLocalPeerRoleUpdate({oldRole:n,newRole:r});case 4:case"end":return e.stop()}},e)})()})},this.getScreenshareSettings=function(e){var n=t.store.getPublishParams().screen,r=t.store.getSimulcastDimensions("screen");return{video:(new xt).maxBitrate(n.bitRate,!1).codec(n.codec).maxFramerate(n.frameRate).setWidth((null==r?void 0:r.width)||n.width).setHeight((null==r?void 0:r.height)||n.height).build(),audio:e?void 0:(new wt).build()}},this.sendAudioPresenceFailed=function(){var e=Pe.TracksErrors.NoAudioDetected(Ae.PREVIEW);t.sendAnalyticsEvent(Ln.audioDetectionFail(e,t.deviceManager.getCurrentSelection().audioInput))},this.sendJoinAnalyticsEvent=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0;t.eventBus.analytics.publish(Ln.join(z(Q({error:n},t.analyticsTimer.getTimes(Bn.INIT,Bn.WEBSOCKET_CONNECT,Bn.ON_POLICY_CHANGE,Bn.LOCAL_TRACKS)),{time:t.analyticsTimer.getTimeTaken(Bn.JOIN),is_preview_called:e})))},this.sendPreviewAnalyticsEvent=function(e){t.eventBus.analytics.publish(Ln.preview(z(Q({error:e},t.analyticsTimer.getTimes(Bn.INIT,Bn.WEBSOCKET_CONNECT,Bn.ON_POLICY_CHANGE,Bn.LOCAL_TRACKS)),{time:t.analyticsTimer.getTimeTaken(Bn.PREVIEW)})))},this.sendAnalyticsEvent=function(e){t.analyticsEventsService.queue(e).flush()}}return O(e,[{key:"initStoreAndManagers",value:function(){if(this.sdkState.isInitialised)return this.notificationManager.setListener(this.listener),void this.audioSinkManager.setListener(this.listener);this.sdkState.isInitialised=!0,this.store=new Lr,this.eventBus=new Kr,this.networkTestManager=new Jr(this.eventBus,this.listener),this.playlistManager=new Wr(this,this.eventBus),this.notificationManager=new Zn(this.store,this.eventBus,this.listener,this.audioListener),this.deviceManager=new _r(this.store,this.eventBus),this.audioSinkManager=new Rr(this.store,this.deviceManager,this.eventBus),this.audioOutput=new Dr(this.deviceManager,this.audioSinkManager),this.audioSinkManager.setListener(this.listener),this.eventBus.autoplayError.subscribe(this.handleAutoplayError),this.localTrackManager=new Kn(this.store,this.observer,this.deviceManager,this.eventBus,this.analyticsTimer),this.analyticsEventsService=new Or(this.store),this.transport=new xr(this.observer,this.deviceManager,this.store,this.localTrackManager,this.eventBus,this.analyticsEventsService,this.analyticsTimer),this.eventBus.analytics.subscribe(this.sendAnalyticsEvent),this.eventBus.deviceChange.subscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.subscribe(this.handleAudioPluginError)}},{key:"validateJoined",value:function(e){if(!this.localPeer)throw Pe.GenericErrors.NotConnected(Ae.VALIDATION,"Not connected - ".concat(e))}},{key:"refreshDevices",value:function(){return $(this,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateJoined("refreshDevices"),e.next=3,this.deviceManager.init(!0);case 3:case"end":return e.stop()}},e,this)}))}},{key:"getWebrtcInternals",value:function(){var e;return null==(e=this.transport)?void 0:e.getWebrtcInternals()}},{key:"getPlaylistManager",value:function(){return this.playlistManager}},{key:"getRecordingState",value:function(){var e;return null==(e=this.store.getRoom())?void 0:e.recording}},{key:"getRTMPState",value:function(){var e;return null==(e=this.store.getRoom())?void 0:e.rtmp}},{key:"getHLSState",value:function(){var e;return null==(e=this.store.getRoom())?void 0:e.hls}},{key:"localPeer",get:function(){var e;return null==(e=this.store)?void 0:e.getLocalPeer()}},{key:"preview",value:function(e,t){return $(this,null,b().mark(function n(){var r,i,a,s=this;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(De(),_e(),!this.sdkState.isPreviewInProgress){n.next=2;break}return n.abrupt("return",Promise.reject(Pe.GenericErrors.PreviewAlreadyInProgress(Ae.PREVIEW,"Preview already called")));case 2:return this.analyticsTimer.start(Bn.PREVIEW),this.setUpPreview(e,t),e.alwaysRequestPermissions&&this.localTrackManager.requestPermissions().then(function(){return $(s,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initDeviceManagers();case 2:case"end":return e.stop()}},e,this)}))}),r=!1,i=!1,a=setTimeout(function(){var e,t;(!r||!i)&&(null==(t=null==(e=s.listener)?void 0:e.onNetworkQuality)||t.call(e,-1))},3e3),n.abrupt("return",new Promise(function(n,o){s.eventBus.policyChange.subscribeOnce(function(){return $(s,null,b().mark(function r(){var i,a,s=this;return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.localTrackManager.getTracksToPublish(e.settings||qr);case 2:return(a=r.sent).forEach(function(e){return s.setLocalPeerTrack(e)}),(null==(i=this.localPeer)?void 0:i.audioTrack)&&this.initPreviewTrackAudioLevelMonitor(),r.next=7,this.initDeviceManagers();case 7:this.sdkState.isPreviewInProgress=!1,this.analyticsTimer.end(Bn.PREVIEW),t.onPreview(this.store.getRoom(),a),this.sendPreviewAnalyticsEvent(),n();case 12:case"end":return r.stop()}},r,this)}))}),s.transport.preview(e.authToken,e.initEndpoint,s.localPeer.peerId,{name:e.userName,metaData:e.metaData||""},e.autoVideoSubscribe).then(function(t){var n;r=!0,clearTimeout(a),t&&e.captureNetworkQualityInPreview&&s.networkTestManager.start(null==(n=t.config)?void 0:n.networkHealth).then(function(){i=!0})}).catch(function(e){var t;s.analyticsTimer.end(Bn.PREVIEW),null==(t=s.errorListener)||t.onError(e),s.sendPreviewAnalyticsEvent(e),s.sdkState.isPreviewInProgress=!1,o(e)})}));case 5:case"end":return n.stop()}},n,this)}))}},{key:"join",value:function(e,t){return $(this,null,b().mark(function n(){var r,i,a,s,o,c,u,l,d,h=this;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(De(),_e(),!this.sdkState.isPreviewInProgress){n.next=2;break}throw Pe.GenericErrors.NotReady(Ae.JOIN,"Preview is in progress, can't join");case 2:return this.analyticsTimer.start(Bn.JOIN),o=this.transportState===Yn.Preview,c=Ir(e.authToken),u=c.roomId,l=c.userId,d=c.role,null==(r=this.networkTestManager)||r.stop(),null==(a=null==(i=this.localPeer)?void 0:i.audioTrack)||a.destroyAudioLevelMonitor(),this.listener=t,this.commonSetup(e,u,t),this.removeDevicesFromConfig(e),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),this.localPeer?(this.localPeer.name=e.userName,this.localPeer.role=this.store.getPolicyForRole(d),this.localPeer.customerUserId=l,this.localPeer.metadata=e.metaData):this.createAndAddLocalPeerToStore(e,d,l),this.roleChangeManager=new Ur(this.store,this.transport,this.publish.bind(this),this.removeTrack.bind(this),this.listener),this.eventBus.localRoleUpdate.subscribe(this.handleLocalRoleUpdate),ye.d(this.TAG,"SDK Store",this.store),ye.d(this.TAG,"⏳ Joining room ".concat(u)),ye.time("join-room-".concat(u)),n.prev=5,n.next=8,this.transport.join(e.authToken,this.localPeer.peerId,{name:e.userName,metaData:e.metaData},e.initEndpoint,e.autoVideoSubscribe);case 8:return ye.d(this.TAG,"✅ Joined room ".concat(u)),Vn.resumeContext(),n.next=12,this.notifyJoin();case 12:this.sendJoinAnalyticsEvent(o),[this.store.getPublishParams(),!this.sdkState.published,!re].every(function(e){return!!e})&&this.publish(e.settings||qr).catch(function(e){var t;ye.e(h.TAG,"Error in publish",e),null==(t=h.listener)||t.onError(e)}),n.next=19;break;case 16:throw n.prev=16,n.t0=n.catch(5),this.analyticsTimer.end(Bn.JOIN),null==(s=this.listener)||s.onError(n.t0),this.sendJoinAnalyticsEvent(o,n.t0),ye.e(this.TAG,"Unable to join room",n.t0),n.t0;case 19:ye.timeEnd("join-room-".concat(u));case 20:case"end":return n.stop()}},n,this,[[5,16]])}))}},{key:"stringifyMetadata",value:function(e){e.metaData&&"string"!=typeof e.metaData?e.metaData=JSON.stringify(e.metaData):e.metaData||(e.metaData="")}},{key:"cleanUp",value:function(){var e,t;this.cleanDeviceManagers(),this.eventBus.analytics.unsubscribe(this.sendAnalyticsEvent),this.analyticsTimer.cleanUp(),Tn.cleanup(),this.playlistManager.cleanup(),ye.cleanUp(),this.sdkState=Q({},Yr),this.localPeer&&(null==(e=this.localPeer.audioTrack)||e.cleanup(),this.localPeer.audioTrack=void 0,null==(t=this.localPeer.videoTrack)||t.cleanup(),this.localPeer.videoTrack=void 0),this.store.cleanUp(),this.listener=void 0,this.roleChangeManager&&this.eventBus.localRoleUpdate.unsubscribe(this.roleChangeManager.handleLocalPeerRoleUpdate)}},{key:"leave",value:function(){return this.internalLeave()}},{key:"internalLeave",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return $(this,null,b().mark(function t(){var n,r,i,a;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(i=this.store.getRoom())){t.next=9;break}return a=i.id,null==(n=this.networkTestManager)||n.stop(),ye.d(this.TAG,"⏳ Leaving room ".concat(a)),t.next=7,null==(r=this.transport)?void 0:r.leave(e);case 7:this.cleanUp(),ye.d(this.TAG,"✅ Left room ".concat(a));case 9:case"end":return t.stop()}},t,this)}))}},{key:"getLocalPeer",value:function(){return this.store.getLocalPeer()}},{key:"getPeers",value:function(){var e=this.store.getPeers();return e.length<50&&ye.d(this.TAG,"Got peers(".concat(e.length,")"),e.toString()),e}},{key:"getAudioOutput",value:function(){return this.audioOutput}},{key:"sendMessage",value:function(e,t){this.sendMessageInternal({message:t,type:e})}},{key:"sendBroadcastMessage",value:function(e,t){return $(this,null,b().mark(function n(){return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.sendMessageInternal({message:e,type:t});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"sendGroupMessage",value:function(e,t,n){return $(this,null,b().mark(function r(){var i;return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=this.store.getKnownRoles(),0!==(t.filter(function(e){return i[e.name]})||[]).length){r.next=3;break}throw Pe.GenericErrors.ValidationFailed("No valid role is present",t);case 3:return r.next=5,this.sendMessageInternal({message:e,recipientRoles:t,type:n});case 5:return r.abrupt("return",r.sent);case 6:case"end":return r.stop()}},r,this)}))}},{key:"sendDirectMessage",value:function(e,t,n){return $(this,null,b().mark(function r(){var i;return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(this.store.getPeerById(t.peerId)){r.next=2;break}throw Pe.GenericErrors.ValidationFailed("Invalid peer - peer not present in the room",t);case 2:if((null==(i=this.localPeer)?void 0:i.peerId)!==t.peerId){r.next=4;break}throw Pe.GenericErrors.ValidationFailed("Cannot send message to self");case 4:return r.next=6,this.sendMessageInternal({message:e,recipientPeer:t,type:n});case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}},r,this)}))}},{key:"sendMessageInternal",value:function(e){return $(this,arguments,function(e){var t=this,n=e.recipientRoles,r=e.recipientPeer,i=e.type,a=void 0===i?"chat":i,s=e.message;return b().mark(function e(){var i,o;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==s.replace(/\u200b/g," ").trim()){e.next=2;break}throw ye.w(t.TAG,"sendMessage","Ignoring empty message send"),Pe.GenericErrors.ValidationFailed("Empty message not allowed");case 2:return i=new _t({sender:t.localPeer,type:a,message:s,recipientPeer:r,recipientRoles:n,time:new Date}),ye.d(t.TAG,"Sending Message: ",i),e.next=6,t.transport.sendMessage(i);case 6:return o=e.sent,e.abrupt("return",(i.time=new Date(o.timestamp),i));case 8:case"end":return e.stop()}},e)})()})}},{key:"startScreenShare",value:function(e){return $(this,arguments,function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{audioOnly:!1,videoOnly:!1};return b().mark(function r(){var i,a,s,o,c,u;return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(o=t.store.getPublishParams()){r.next=3;break}return r.abrupt("return");case 3:if((c=o.allowed)&&c.includes("screen")){r.next=7;break}return ye.e(t.TAG,"Role ".concat(null==(i=t.localPeer)?void 0:i.role," cannot share screen")),r.abrupt("return");case 7:if(!(null==(s=null==(a=t.localPeer)?void 0:a.auxiliaryTracks)?void 0:s.find(function(e){return"screen"===e.source}))){r.next=9;break}throw Error("Cannot share multiple screens");case 9:return r.next=11,t.getScreenshareTracks(e,n);case 11:if(u=r.sent,t.localPeer){r.next=15;break}return ye.d(t.TAG,"Screenshared when not connected"),u.forEach(function(e){e.cleanup()}),r.abrupt("return");case 15:return r.next=17,t.transport.publish(u);case 17:u.forEach(function(e){var n,r,i;e.peerId=null==(n=t.localPeer)?void 0:n.peerId,null==(r=t.localPeer)||r.auxiliaryTracks.push(e),null==(i=t.listener)||i.onTrackUpdate(fe.TRACK_ADDED,e,t.localPeer)});case 18:case"end":return r.stop()}},r)})()})}},{key:"stopEndedScreenshare",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return ye.d(this.TAG,"✅ Screenshare ended natively"),t.next=3,this.stopScreenShare();case 3:e();case 4:case"end":return t.stop()}},t,this)}))}},{key:"stopScreenShare",value:function(){return $(this,null,b().mark(function e(){var t,n,r,i,a;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(ye.d(this.TAG,"✅ Screenshare ended from app"),!(n=null==(t=this.localPeer)?void 0:t.auxiliaryTracks.filter(function(e){return"screen"===e.source}))){e.next=20;break}r=U(n),e.prev=4,r.s();case 6:if((i=r.n()).done){e.next=12;break}return a=i.value,e.next=10,this.removeTrack(a.trackId);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:case"end":return e.stop()}},e,this,[[4,14,17,20]])}))}},{key:"addTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"regular";return $(this,null,b().mark(function n(){var r,i,a,s,o,c,u,l;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=3;break}return ye.w(this.TAG,"Please pass a valid MediaStreamTrack"),n.abrupt("return");case 3:if(this.localPeer){n.next=5;break}throw Pe.GenericErrors.NotConnected(Ae.VALIDATION,"No local peer present, cannot addTrack");case 5:if(!this.localPeer.auxiliaryTracks.find(function(t){return t.trackId===e.id})){n.next=7;break}return n.abrupt("return");case 7:return o=e.kind,c=new MediaStream([e]),u=new Mn(c),l=new("audio"===o?An:qn)(u,e,t,this.eventBus),this.setPlaylistSettings({track:e,hmsTrack:l,source:t}),n.next=11,null==(r=this.transport)?void 0:r.publish([l]);case 11:l.peerId=null==(i=this.localPeer)?void 0:i.peerId,null==(a=this.localPeer)||a.auxiliaryTracks.push(l),null==(s=this.listener)||s.onTrackUpdate(fe.TRACK_ADDED,l,this.localPeer);case 14:case"end":return n.stop()}},n,this)}))}},{key:"removeTrack",value:function(e){return $(this,null,b().mark(function t(){var n,r,i;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.localPeer){t.next=2;break}throw Pe.GenericErrors.NotConnected(Ae.VALIDATION,"No local peer present, cannot removeTrack");case 2:if(!((r=this.localPeer.auxiliaryTracks.findIndex(function(t){return t.trackId===e}))>-1)){t.next=12;break}return i=this.localPeer.auxiliaryTracks[r],t.next=7,this.transport.unpublish([i]);case 7:"audioplaylist"===i.source?this.playlistManager.stop(Ee.audio):"videoplaylist"===i.source&&this.playlistManager.stop(Ee.video),this.localPeer.auxiliaryTracks.splice(r,1),null==(n=this.listener)||n.onTrackUpdate(fe.TRACK_REMOVED,i,this.localPeer),t.next=13;break;case 12:ye.w(this.TAG,"No track found for ".concat(e));case 13:case"end":return t.stop()}},t,this)}))}},{key:"setAnalyticsLevel",value:function(e){this.analyticsEventsService.level=e}},{key:"setLogLevel",value:function(e){ye.level=e}},{key:"addAudioListener",value:function(e){this.audioListener=e,this.notificationManager.setAudioListener(e)}},{key:"addConnectionQualityListener",value:function(e){this.notificationManager.setConnectionQualityListener(e)}},{key:"changeRole",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return $(this,null,b().mark(function r(){var i;return b().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=!e.role||e.role.name===t,r.t0){r.next=4;break}return r.next=4,null==(i=this.transport)?void 0:i.changeRole(e,t,n);case 4:case"end":return r.stop()}},r,this)}))}},{key:"acceptChangeRole",value:function(e){return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null==(n=this.transport)?void 0:n.acceptRoleChange(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"endRoom",value:function(e,t){return $(this,null,b().mark(function n(){var r;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.localPeer){n.next=2;break}throw Pe.GenericErrors.NotConnected(Ae.VALIDATION,"No local peer present, cannot end room");case 2:return n.next=4,null==(r=this.transport)?void 0:r.endRoom(e,t);case 4:return n.next=6,this.leave();case 6:case"end":return n.stop()}},n,this)}))}},{key:"removePeer",value:function(e,t){return $(this,null,b().mark(function n(){var r;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.localPeer){n.next=2;break}throw Pe.GenericErrors.NotConnected(Ae.VALIDATION,"No local peer present, cannot remove peer");case 2:if(this.store.getPeerById(e.peerId)){n.next=4;break}throw Pe.GenericErrors.ValidationFailed("Invalid peer, given peer not present in room",e);case 4:return n.next=6,null==(r=this.transport)?void 0:r.removePeer(e.peerId,t);case 6:case"end":return n.stop()}},n,this)}))}},{key:"startRTMPOrRecording",value:function(e){return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.localPeer){t.next=2;break}throw Pe.GenericErrors.NotConnected(Ae.VALIDATION,"No local peer present, cannot start streaming or recording");case 2:return t.prev=2,t.next=5,null==(n=this.transport)?void 0:n.startRTMPOrRecording(e);case 5:t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(2),this.sendAnalyticsEvent(Ln.RTMPError(t.t0)),t.t0;case 10:case"end":return t.stop()}},t,this,[[2,7]])}))}},{key:"stopRTMPAndRecording",value:function(){return $(this,null,b().mark(function e(){var t;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.localPeer){e.next=2;break}throw Pe.GenericErrors.NotConnected(Ae.VALIDATION,"No local peer present, cannot stop streaming or recording");case 2:return e.prev=2,e.next=5,null==(t=this.transport)?void 0:t.stopRTMPOrRecording();case 5:e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(2),this.sendAnalyticsEvent(Ln.RTMPError(e.t0,!1)),e.t0;case 10:case"end":return e.stop()}},e,this,[[2,7]])}))}},{key:"startHLSStreaming",value:function(e){return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.localPeer){t.next=2;break}throw Pe.GenericErrors.NotConnected(Ae.VALIDATION,"No local peer present, cannot start HLS streaming");case 2:return t.prev=2,t.next=5,null==(n=this.transport)?void 0:n.startHLSStreaming(e);case 5:t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(2),this.sendAnalyticsEvent(Ln.HLSError(t.t0)),t.t0;case 10:case"end":return t.stop()}},t,this,[[2,7]])}))}},{key:"stopHLSStreaming",value:function(e){return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.localPeer){t.next=2;break}throw Pe.GenericErrors.NotConnected(Ae.VALIDATION,"No local peer present, cannot stop HLS streaming");case 2:return t.prev=2,t.next=5,null==(n=this.transport)?void 0:n.stopHLSStreaming(e);case 5:t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(2),this.sendAnalyticsEvent(Ln.HLSError(t.t0,!1)),t.t0;case 10:case"end":return t.stop()}},t,this,[[2,7]])}))}},{key:"sendHLSTimedMetadata",value:function(e){return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.validateJoined("sendHLSTimedMetadata"),t.next=3,null==(n=this.transport)?void 0:n.sendHLSTimedMetadata(e);case 3:case"end":return t.stop()}},t,this)}))}},{key:"changeName",value:function(e){return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.validateJoined("changeName"),t.next=3,null==(n=this.transport)?void 0:n.changeName(e);case 3:this.notificationManager.updateLocalPeer({name:e});case 4:case"end":return t.stop()}},t,this)}))}},{key:"changeMetadata",value:function(e){return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.validateJoined("changeMetadata"),t.next=3,null==(n=this.transport)?void 0:n.changeMetadata(e);case 3:this.notificationManager.updateLocalPeer({metadata:e});case 4:case"end":return t.stop()}},t,this)}))}},{key:"setSessionMetadata",value:function(e){return $(this,null,b().mark(function t(){return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.transport.setSessionMetadata(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"getSessionMetadata",value:function(){return $(this,null,b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.transport.getSessionMetadata();case 2:return e.abrupt("return",e.sent.data);case 3:case"end":return e.stop()}},e,this)}))}},{key:"getRoles",value:function(){return Object.values(this.store.getKnownRoles())}},{key:"changeTrackState",value:function(e,t){return $(this,null,b().mark(function n(){var r,i;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e.type!==Le.VIDEO||"regular"===e.source){n.next=3;break}return ye.w(this.TAG,"Muting non-regular video tracks is currently not supported"),n.abrupt("return");case 3:if(e.enabled!==t){n.next=6;break}return ye.w(this.TAG,"Aborting change track state, track already has enabled - ".concat(t),e),n.abrupt("return");case 6:if(this.store.getTrackById(e.trackId)){n.next=8;break}throw Pe.GenericErrors.ValidationFailed("No track found for change track state",e);case 8:if(i=this.store.getPeerByTrackId(e.trackId)){n.next=11;break}throw Pe.GenericErrors.ValidationFailed("No peer found for change track state",e);case 11:return n.next=13,null==(r=this.transport)?void 0:r.changeTrackState({requested_for:i.peerId,track_id:e.trackId,stream_id:e.stream.id,mute:!t});case 13:case"end":return n.stop()}},n,this)}))}},{key:"changeMultiTrackState",value:function(e){return $(this,null,b().mark(function t(){var n,r,i,a,s;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("boolean"==typeof e.enabled){t.next=2;break}throw Pe.GenericErrors.ValidationFailed("Pass a boolean for enabled");case 2:return r=e.enabled,i=e.roles,a=e.type,s=e.source,t.next=5,null==(n=this.transport)?void 0:n.changeMultiTrackState({value:!r,type:a,source:s,roles:null==i?void 0:i.map(function(e){return null==e?void 0:e.name})});case 5:case"end":return t.stop()}},t,this)}))}},{key:"setFrameworkInfo",value:function(e){this.frameworkInfo=e}},{key:"publish",value:function(e){return $(this,null,b().mark(function t(){var n;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.localTrackManager.getTracksToPublish(e);case 2:return n=t.sent,t.next=5,this.setAndPublishTracks(n);case 5:this.sdkState.published=!0;case 6:case"end":return t.stop()}},t,this)}))}},{key:"setAndPublishTracks",value:function(e){return $(this,null,b().mark(function t(){var n,r,i,a;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=U(e),t.prev=1,r.s();case 3:if((i=r.n()).done){t.next=11;break}return a=i.value,t.next=7,this.transport.publish([a]);case 7:this.setLocalPeerTrack(a),null==(n=this.listener)||n.onTrackUpdate(fe.TRACK_ADDED,a,this.localPeer);case 9:t.next=3;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),r.e(t.t0);case 16:return t.prev=16,r.f(),t.finish(16);case 19:return t.next=21,this.initDeviceManagers();case 21:case"end":return t.stop()}},t,this,[[1,13,16,19]])}))}},{key:"setLocalPeerTrack",value:function(e){var t;switch(e.peerId=null==(t=this.localPeer)?void 0:t.peerId,e.type){case Le.AUDIO:this.localPeer.audioTrack=e;break;case Le.VIDEO:this.localPeer.videoTrack=e}}},{key:"initDeviceManagers",value:function(){return $(this,null,b().mark(function e(){var t,n,r,i,a;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.sdkState.deviceManagersInitialised,e.t0){e.next=12;break}return this.sdkState.deviceManagersInitialised=!0,e.next=5,this.deviceManager.init();case 5:return e.next=7,this.deviceManager.updateOutputDevice(null==(n=null==(t=this.store.getConfig())?void 0:t.settings)?void 0:n.audioOutputDeviceId);case 7:if(e.t1=e.sent,e.t1){e.next=11;break}return e.next=11,this.deviceManager.updateOutputDevice(null==(i=null==(r=Tn.getSelection())?void 0:r.audioOutput)?void 0:i.deviceId);case 11:this.audioSinkManager.init(null==(a=this.store.getConfig())?void 0:a.audioSinkElementId);case 12:case"end":return e.stop()}},e,this)}))}},{key:"cleanDeviceManagers",value:function(){this.eventBus.deviceChange.unsubscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.unsubscribe(this.handleAudioPluginError),this.eventBus.autoplayError.unsubscribe(this.handleAutoplayError),this.deviceManager.cleanUp(),this.audioSinkManager.cleanUp()}},{key:"initPreviewTrackAudioLevelMonitor",value:function(){var e,t=this,n=null==(e=this.localPeer)?void 0:e.audioTrack;null==n||n.initAudioLevelMonitor(),this.eventBus.trackAudioLevelUpdate.subscribe(function(e){var r,i=e&&e.track.trackId===(null==n?void 0:n.trackId)?[{audioLevel:e.audioLevel,peer:t.localPeer,track:n}]:[];t.store.updateSpeakers(i),null==(r=t.audioListener)||r.onAudioLevelUpdate(i)}),this.eventBus.localAudioSilence.subscribe(this.sendAudioPresenceFailed)}},{key:"notifyJoin",value:function(){var e,t=this,n=this.store.getLocalPeer(),r=this.store.getRoom();return r.joinedAt=new Date,n&&(n.joinedAt=r.joinedAt),(null==n?void 0:n.role)?(this.analyticsTimer.end(Bn.JOIN),void(null==(e=this.listener)||e.onJoin(r))):new Promise(function(e){t.eventBus.policyChange.subscribeOnce(function(){var n;t.analyticsTimer.end(Bn.JOIN),null==(n=t.listener)||n.onJoin(r),e()})})}},{key:"setUpPreview",value:function(e,t){this.listener=t,this.sdkState.isPreviewInProgress=!0;var n=Ir(e.authToken),r=n.roomId,i=n.userId,a=n.role;this.commonSetup(e,r,t),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),this.createAndAddLocalPeerToStore(e,a,i),ye.d(this.TAG,"SDK Store",this.store)}},{key:"setPlaylistSettings",value:function(e){return $(this,arguments,function(e){var t=e.track,n=e.hmsTrack,r=e.source;return b().mark(function e(){var i,a,s,o;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("videoplaylist"!==r){e.next=7;break}return i={},"audio"===t.kind?i.maxBitrate=64:(i.maxBitrate=1e3,a=t.getSettings(),s=a.width,o=a.height,i.width=s,i.height=o),e.next=5,n.setSettings(i);case 5:e.next=11;break;case 7:if(e.t0="audioplaylist"===r,!e.t0){e.next=11;break}return e.next=11,n.setSettings({maxBitrate:64});case 11:case"end":return e.stop()}},e)})()})}},{key:"createAndAddLocalPeerToStore",value:function(e,t,n){var r=this.store.getPolicyForRole(t),i=new Mt({name:e.userName||"",customerUserId:n,metadata:e.metaData||"",role:r});this.store.addPeer(i)}},{key:"commonSetup",value:function(e,t,n){this.stringifyMetadata(e),e.initEndpoint||(e.initEndpoint="https://prod-init.100ms.live"),this.errorListener=n,this.deviceChangeListener=n,this.initStoreAndManagers(),this.store.setErrorListener(this.errorListener),this.store.getRoom()||this.store.setRoom(new Pr(t,this.store))}},{key:"removeDevicesFromConfig",value:function(e){this.store.getConfig()&&e.settings&&(delete e.settings.audioOutputDeviceId,delete e.settings.videoDeviceId,delete e.settings.audioInputDeviceId)}},{key:"getScreenshareTracks",value:function(e,t){return $(this,null,b().mark(function n(){var r,i,a,s,o,c,u,d,h,v=this;return b().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=this.getScreenshareSettings(t.videoOnly),i=r.video,a=r.audio,n.next=5,this.transport.getLocalScreen(i,a);case 5:if(s=n.sent,o=l(s,2),c=o[0],u=o[1],d=function(){v.stopEndedScreenshare(e)},h=[],!t.audioOnly){n.next=17;break}if(c.nativeTrack.stop(),u){n.next=14;break}throw Error("Select share audio when sharing screen");case 14:h.push(u),u.nativeTrack.onended=d,n.next=18;break;case 17:h.push(c),c.nativeTrack.onended=d,u&&h.push(u);case 18:return n.abrupt("return",h);case 19:case"end":return n.stop()}},n,this)}))}}]),e}();function zr(){return $(this,null,b().mark(function e(){var t,n;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(new xt).build(),n=(new wt).build(),e.prev=1,e.next=4,qt(n);case 4:e.sent.stop(),e.next=14;break;case 7:if(e.prev=7,e.t0=e.catch(1),!Zr(e.t0)){e.next=14;break}return e.next=12,Un({audio:!1,video:!0});case 12:throw e.sent.getTracks().forEach(function(e){return e.stop()}),e.t0;case 14:return e.next=16,Yt(t);case 16:return e.sent.stop(),e.abrupt("return",!1);case 18:case"end":return e.stop()}},e,null,[[1,7]])}))}function Zr(e){return e instanceof Ie&&e.action===Ae.TRACK}exports.HMSSdk=Qr,ye.i("adapter","".concat(r.default.browserDetails.browser," v").concat(r.default.browserDetails.version));
},{"webrtc-adapter":"WzOL","ua-parser-js":"Godu","uuid":"UeUD","sdp-transform":"CfIM","eventemitter2":"x3aR","process":"g5IB"}],"K9HF":[function(require,module,exports) {
"use strict";function e(e,r){return e===r}function r(e,r,t){if(null===r||null===t||r.length!==t.length)return!1;for(var n=r.length,o=0;o<n;o++)if(!e(r[o],t[o]))return!1;return!0}function t(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,o=null,u=null;return function(){return r(n,o,arguments)||(u=t.apply(null,arguments)),o=arguments,u}}function n(e){var r=Array.isArray(e[0])?e[0]:e;if(!r.every(function(e){return"function"==typeof e})){var t=r.map(function(e){return typeof e}).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+t+"]")}return r}function o(e){for(var r=arguments.length,t=Array(r>1?r-1:0),o=1;o<r;o++)t[o-1]=arguments[o];return function(){for(var r=arguments.length,o=Array(r),u=0;u<r;u++)o[u]=arguments[u];var c=0,l=o.pop(),a=n(o),i=e.apply(void 0,[function(){return c++,l.apply(null,arguments)}].concat(t)),f=e(function(){for(var e=[],r=a.length,t=0;t<r;t++)e.push(a[t].apply(null,arguments));return i.apply(null,e)});return f.resultFunc=l,f.dependencies=a,f.recomputations=function(){return c},f.resetRecomputations=function(){return c=0},f}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createSelector=void 0,exports.createSelectorCreator=o,exports.createStructuredSelector=c,exports.defaultMemoize=t;var u=o(t);function c(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;if("object"!=typeof e)throw new Error("createStructuredSelector expects first argument to be an object where each property is a selector, instead received a "+typeof e);var t=Object.keys(e);return r(t.map(function(r){return e[r]}),function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.reduce(function(e,r,n){return e[t[n]]=r,e},{})})}exports.createSelector=u;
},{}],"j5Na":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"HMSAudioPluginType",{enumerable:!0,get:function(){return i.HMSAudioPluginType}}),Object.defineProperty(exports,"HMSLogLevel",{enumerable:!0,get:function(){return i.HMSLogLevel}}),exports.HMSStats=exports.HMSRoomState=exports.HMSReactiveStore=exports.HMSPlaylistType=exports.HMSNotificationTypes=exports.HMSNotificationSeverity=exports.HMSMessageType=void 0,Object.defineProperty(exports,"HMSVideoPluginCanvasContextType",{enumerable:!0,get:function(){return i.HMSVideoPluginCanvasContextType}}),Object.defineProperty(exports,"HMSVideoPluginType",{enumerable:!0,get:function(){return i.HMSVideoPluginType}}),exports.createDefaultStoreState=exports.createDefaultStatsStore=void 0,Object.defineProperty(exports,"parsedUserAgent",{enumerable:!0,get:function(){return i.parsedUserAgent}}),exports.selectScreenAudioTrackByID=exports.selectRoomState=exports.selectRoomStarted=exports.selectRoomStartTime=exports.selectRoomID=exports.selectRoom=exports.selectRolesMap=exports.selectRoleChangeRequest=exports.selectRoleByRoleName=exports.selectRemotePeers=exports.selectRecordingState=exports.selectRTMPState=exports.selectPermissions=exports.selectPeersWithAudioStatus=exports.selectPeersScreenSharing=exports.selectPeersMap=exports.selectPeersByRole=exports.selectPeersByCondition=exports.selectPeers=exports.selectPeerSharingVideoPlaylist=exports.selectPeerSharingAudioPlaylist=exports.selectPeerSharingAudio=exports.selectPeerScreenSharing=exports.selectPeerNameByID=exports.selectPeerName=exports.selectPeerMetadata=exports.selectPeerCount=exports.selectPeerByID=exports.selectPeerByCondition=exports.selectPeerAudioByID=exports.selectMessagesUnreadCountByRole=exports.selectMessagesUnreadCountByPeerID=exports.selectMessagesMap=exports.selectMessagesByRole=exports.selectMessagesByPeerID=exports.selectMessageIDsInOrder=exports.selectLocalVideoTrackID=exports.selectLocalTrackIDs=exports.selectLocalPeerRoleName=exports.selectLocalPeerRole=exports.selectLocalPeerName=exports.selectLocalPeerID=exports.selectLocalPeer=exports.selectLocalMediaSettings=exports.selectLocalAudioTrackID=exports.selectIsSomeoneScreenSharing=exports.selectIsScreenShareLocallyMutedByPeerID=exports.selectIsPeerVideoEnabled=exports.selectIsPeerAudioEnabled=exports.selectIsLocallyMutedByPeerID=exports.selectIsLocalVideoPluginPresent=exports.selectIsLocalVideoEnabled=exports.selectIsLocalVideoDisplayEnabled=exports.selectIsLocalScreenShared=exports.selectIsLocalAudioPluginPresent=exports.selectIsLocalAudioEnabled=exports.selectIsInPreview=exports.selectIsConnectedToRoom=exports.selectIsAudioLocallyMuted=exports.selectIsAllowedToSubscribe=exports.selectIsAllowedToPublish=exports.selectHMSStats=exports.selectHMSMessagesCount=exports.selectHMSMessages=exports.selectHLSState=exports.selectFullAppData=exports.selectDominantSpeaker=exports.selectDidIJoinWithin=exports.selectDevices=exports.selectDegradedTracks=exports.selectConnectionQualityByPeerID=exports.selectConnectionQualities=exports.selectCameraStreamByPeerID=exports.selectBroadcastMessagesUnreadCount=exports.selectBroadcastMessages=exports.selectAvailableRoleNames=exports.selectAuxiliaryTracksByPeerID=exports.selectAuxiliaryAudioByPeerID=exports.selectAudioVolumeByPeerID=exports.selectAudioTrackVolume=exports.selectAudioTrackByPeerID=exports.selectAudioTrackByID=exports.selectAudioPlaylistTrackByPeerID=exports.selectAudioPlaylist=exports.selectAppDataByPath=exports.selectAppData=void 0,exports.selectVideoTrackByPeerID=exports.selectVideoTrackByID=exports.selectVideoPlaylistVideoTrackByPeerID=exports.selectVideoPlaylistAudioTrackByPeerID=exports.selectVideoPlaylist=exports.selectUnreadHMSMessagesCount=exports.selectTracksMap=exports.selectTrackByID=exports.selectTrackAudioByID=exports.selectSpeakers=exports.selectSimulcastLayerByTrack=exports.selectSessionMetadata=exports.selectSessionId=exports.selectScreenshareAudioVolumeByPeerID=exports.selectScreenVideoTrackByID=exports.selectScreenSharesByPeerId=exports.selectScreenShareByPeerID=exports.selectScreenShareAudioByPeerID=void 0;var e,t,r=c(require("immer")),n=c(require("zustand/vanilla")),o=c(require("zustand/shallow")),i=require("@100mslive/hms-video"),a=require("reselect"),s=require("eventemitter2");function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t){return f(e)||d(e,t)||D(e,t)||l()}function l(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(l){u=!0,o=l}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}function f(e){if(Array.isArray(e))return e}function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t,r){return(t=T(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(){h=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(M){c=function(e,t,r){return e[t]=r}}function u(e,t,r,o){var i=t&&t.prototype instanceof f?t:f,a=Object.create(i.prototype),s=new E(o||[]);return n(a,"_invoke",{value:T(e,r,s)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(M){return{type:"throw",arg:M}}}e.wrap=u;var d={};function f(){}function v(){}function y(){}var S={};c(S,i,function(){return this});var g=Object.getPrototypeOf,k=g&&g(g(I([])));k&&k!==t&&r.call(k,i)&&(S=k);var m=y.prototype=f.prototype=Object.create(S);function b(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function x(e,t){var o;n(this,"_invoke",{value:function(n,i){function a(){return new t(function(o,a){!function n(o,i,a,s){var c=l(e[o],e,i);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==p(d)&&r.call(d,"__await")?t.resolve(d.__await).then(function(e){n("next",e,a,s)},function(e){n("throw",e,a,s)}):t.resolve(d).then(function(e){u.value=e,a(u)},function(e){return n("throw",e,a,s)})}s(c.arg)}(n,i,o,a)})}return o=o?o.then(a,a):a()}})}function T(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return w()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=P(a,r);if(s){if(s===d)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=l(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function P(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,P(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var o=l(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,d;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function I(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:w}}function w(){return{value:void 0,done:!0}}return v.prototype=y,n(m,"constructor",{value:y,configurable:!0}),n(y,"constructor",{value:v,configurable:!0}),v.displayName=c(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,s,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},b(x.prototype),c(x.prototype,a,function(){return this}),e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})},b(m),c(m,s,"Generator"),c(m,i,function(){return this}),c(m,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=I,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(D),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),D(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;D(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:I(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function y(e){return k(e)||g(e)||D(e)||S()}function S(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function g(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function k(e){if(Array.isArray(e))return E(e)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,T(n.key),n)}}function x(e,t,r){return t&&b(e.prototype,t),r&&b(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function T(e){var t=P(e,"string");return"symbol"===p(t)?t:String(t)}function P(e,t){if("object"!==p(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function R(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=D(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function D(e,t){if(e){if("string"==typeof e)return E(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(e,t):void 0}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var I,w=Object.defineProperty,M=Object.defineProperties,A=Object.getOwnPropertyDescriptors,L=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,N=function(e,t,r){return t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},_=function(e,t){for(var r in t||(t={}))C.call(t,r)&&N(e,r,t[r]);if(L){var n,o=R(L(t));try{for(o.s();!(n=o.n()).done;){r=n.value;O.call(t,r)&&N(e,r,t[r])}}catch(i){o.e(i)}finally{o.f()}}return e},B=function(e,t){return M(e,A(t))},U=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},H=function(e,t,r){return new Promise(function(n,o){var i=function(e){try{s(r.next(e))}catch(t){o(t)}},a=function(e){try{s(r.throw(e))}catch(t){o(t)}},s=function(e){return e.done?n(e.value):Promise.resolve(e.value).then(i,a)};s((r=r.apply(e,t)).next())})},j=U(function(e,t){t.exports={version:"0.6.4",license:"MIT",main:"dist/index.cjs.js",module:"dist/index.js",typings:"dist/index.d.ts",files:["dist","src"],engines:{node:">=12"},exports:{".":{require:"./dist/index.cjs.js",import:"./dist/index.js",default:"./dist/index.js"}},scripts:{prestart:"rm -rf dist && yarn types:build",start:'concurrently "yarn dev" "yarn types"',dev:"node ../../scripts/dev","build:only":"node ../../scripts/build",build:"yarn build:only && yarn types:build",types:"tsc -w","types:build":"tsc -p tsconfig.json",format:"prettier --write src/**/*.ts",test:"jest --maxWorkers=1","test:watch":"jest --watch","test:coverage":"jest --coverage",lint:"eslint -c ../../.eslintrc .","lint:fix":"yarn lint --fix",prepare:"yarn build",size:"size-limit",analyze:"size-limit --why",docs:"rm -rf ./docs && typedoc && rm -f ./docs/README.md && mkdir ./docs/home &&mv ./docs/modules.md ./docs/home/content.md && node ../../scripts/docs-store && npx prettier --write './docs/**/*'"},name:"@100mslive/hms-video-store",author:"100ms",sideEffects:!1,dependencies:{"@100mslive/hms-video":"0.5.4",eventemitter2:"^6.4.7",immer:"^9.0.6",reselect:"4.0.0",zustand:"3.5.7"},devDependencies:{"ts-node":"^10.4.0",tslib:"^2.2.0"},description:"This is an addon to the core sdk provided by 100ms. It abstracts away the intricacies of data management and provides a flux based reactive data store where data flows in only one direction.",repository:{type:"git",url:"git+https://github.com/100mslive/hms-video-store.git"},keywords:["video","webrtc","conferencing","100ms"],bugs:{url:"https://github.com/100mslive/hms-video-store/issues"},homepage:"https://github.com/100mslive/hms-video-store#readme",gitHead:"fe00f2f7a62e19cb86e9d7bd8a80bc921909a2bb"}});exports.HMSRoomState=I,function(e){e.Disconnected="Disconnected",e.Preview="Preview",e.Connecting="Connecting",e.Connected="Connected",e.Reconnecting="Reconnecting",e.Disconnecting="Disconnecting",e.Failed="Failed"}(I||(exports.HMSRoomState=I={}));var V,K,q,F,G=function(){return{room:{id:"",isConnected:!1,name:"",peers:[],shareableLink:"",localPeer:"",hasWaitingRoom:!1,roomState:I.Disconnected,recording:{browser:{running:!1},server:{running:!1},hls:{running:!1}},rtmp:{running:!1},hls:{running:!1,variants:[]},sessionId:""},peers:{},tracks:{},playlist:{audio:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1},video:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1}},messages:{byID:{},allIDs:[]},speakers:{},connectionQualities:{},settings:{audioInputDeviceId:"",audioOutputDeviceId:"",videoInputDeviceId:""},devices:{audioInput:[],audioOutput:[],videoInput:[]},roles:{},roleChangeRequests:[],errors:[]}},Q=function(){return{peerStats:{},trackStats:{},localPeer:{id:""}}};exports.createDefaultStatsStore=Q,exports.createDefaultStoreState=G,exports.HMSMessageType=V,(V||(exports.HMSMessageType=V={})).CHAT="chat",exports.HMSNotificationSeverity=K,function(e){e.INFO="info",e.ERROR="error"}(K||(exports.HMSNotificationSeverity=K={})),exports.HMSNotificationTypes=q,function(e){e.PEER_JOINED="PEER_JOINED",e.PEER_LEFT="PEER_LEFT",e.PEER_LIST="PEER_LIST",e.NEW_MESSAGE="NEW_MESSAGE",e.ERROR="ERROR",e.RECONNECTING="RECONNECTING",e.RECONNECTED="RECONNECTED",e.TRACK_ADDED="TRACK_ADDED",e.TRACK_REMOVED="TRACK_REMOVED",e.TRACK_MUTED="TRACK_MUTED",e.TRACK_UNMUTED="TRACK_UNMUTED",e.TRACK_DEGRADED="TRACK_DEGRADED",e.TRACK_RESTORED="TRACK_RESTORED",e.TRACK_DESCRIPTION_CHANGED="TRACK_DESCRIPTION_CHANGED",e.ROLE_UPDATED="ROLE_UPDATED",e.CHANGE_TRACK_STATE_REQUEST="CHANGE_TRACK_STATE_REQUEST",e.CHANGE_MULTI_TRACK_STATE_REQUEST="CHANGE_MULTI_TRACK_STATE_REQUEST",e.ROOM_ENDED="ROOM_ENDED",e.REMOVED_FROM_ROOM="REMOVED_FROM_ROOM",e.DEVICE_CHANGE_UPDATE="DEVICE_CHANGE_UPDATE",e.PLAYLIST_TRACK_ENDED="PLAYLIST_TRACK_ENDED",e.NAME_UPDATED="NAME_UPDATED",e.METADATA_UPDATED="METADATA_UPDATED"}(q||(exports.HMSNotificationTypes=q={})),exports.HMSPlaylistType=F,function(e){e.audio="audio",e.video="video"}(F||(exports.HMSPlaylistType=F={}));var J=function(e,t){var r,n=R(te(Object.keys(e),Object.keys(t)));try{for(n.s();!(r=n.n()).done;){var o=r.value,i=e[o],a=t[o];X(i,a)?(ee(i.auxiliaryTracks,a.auxiliaryTracks)&&(a.auxiliaryTracks=i.auxiliaryTracks),Object.assign(i,a)):$(i,a)?delete e[o]:Z(i,a)&&(e[o]=a)}}catch(s){n.e(s)}finally{n.f()}},W=function(e,t){var r,n=R(te(Object.keys(e),Object.keys(t)));try{for(n.s();!(r=n.n()).done;){var o=r.value,i=e[o],a=t[o];X(i,a)?(Y(i,a),Object.assign(i,a)):$(i,a)?delete e[o]:Z(i,a)&&(e[o]=a)}}catch(s){n.e(s)}finally{n.f()}},z=function(e,t){var r,n=R(te(Object.keys(e),Object.keys(t)));try{for(n.s();!(r=n.n()).done;){var o=r.value,i=e[o],a=t[o];X(i,a)?Object.assign(i,a):$(i,a)?delete e[o]:Z(i,a)&&(e[o]=a)}}catch(s){n.e(s)}finally{n.f()}},Y=function(e,t){e.plugins&&ee(e.plugins,t.plugins)&&(t.plugins=e.plugins),"video"===e.type&&e.layerDefinitions&&ee(e.layerDefinitions,t.layerDefinitions)&&(t.layerDefinitions=e.layerDefinitions)},X=function(e,t){return e&&t},$=function(e,t){return e&&!t},Z=function(e,t){return!e&&t},ee=function(e,t){if(e===t||0===e.length&&0===(null==t?void 0:t.length))return!0;if(!e||!t||e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0},te=function(e,t){var r,n=new Set,o=R(e);try{for(o.s();!(r=o.n()).done;){var i=r.value;n.add(i)}}catch(u){o.e(u)}finally{o.f()}var a,s=R(t);try{for(s.s();!(a=s.n()).done;){var c=a.value;n.add(c)}}catch(u){s.e(u)}finally{s.f()}return Array.from(n)},re=function(){function e(){m(this,e)}return x(e,null,[{key:"convertPeer",value:function(e){var t,r,n;return{id:e.peerId,name:e.name,roleName:null==(t=e.role)?void 0:t.name,isLocal:e.isLocal,videoTrack:null==(r=e.videoTrack)?void 0:r.trackId,audioTrack:null==(n=e.audioTrack)?void 0:n.trackId,auxiliaryTracks:e.auxiliaryTracks.map(function(e){return e.trackId}),customerUserId:e.customerUserId,customerDescription:e.metadata,metadata:e.metadata,joinedAt:e.joinedAt}}},{key:"convertTrack",value:function(e,t){var r={id:e.trackId,source:e.source,type:e.type,enabled:e.enabled,displayEnabled:e.enabled,peerId:e.peerId||t};return this.enrichTrack(r,e),r}},{key:"enrichTrack",value:function(t,r){var n=r.getMediaTrackSettings();r instanceof i.HMSRemoteAudioTrack&&(t.volume=r.getVolume()||0),e.updateDeviceID(t,r),"video"===t.type&&("screen"===t.source?t.displaySurface=n.displaySurface:"regular"===t.source&&(t.facingMode=n.facingMode),t.height=n.height,t.width=n.width,e.enrichVideoTrack(t,r)),e.enrichPluginsDetails(t,r)}},{key:"updateDeviceID",value:function(e,t){var r;t instanceof i.HMSLocalVideoTrack||t instanceof i.HMSLocalAudioTrack?e.deviceID=t.settings.deviceId:e.deviceID=null==(r=t.getMediaTrackSettings())?void 0:r.deviceId}},{key:"enrichVideoTrack",value:function(e,t){t instanceof i.HMSRemoteVideoTrack&&(e.layer=t.getSimulcastLayer(),e.degraded=t.degraded,ee(t.getSimulcastDefinitions(),e.layerDefinitions)||(e.layerDefinitions=t.getSimulcastDefinitions()))}},{key:"enrichPluginsDetails",value:function(e,t){(t instanceof i.HMSLocalVideoTrack||t instanceof i.HMSLocalAudioTrack)&&(ee(t.getPlugins(),e.plugins)||(e.plugins=t.getPlugins()))}},{key:"convertRoom",value:function(t){var r,n,o=e.convertRecordingStreamingState(null==t?void 0:t.recording,null==t?void 0:t.rtmp,null==t?void 0:t.hls),i=o.recording,a=o.rtmp,s=o.hls;return{id:t.id,name:t.name,localPeer:null!=(n=null==(r=t.localPeer)?void 0:r.peerId)?n:"",hasWaitingRoom:t.hasWaitingRoom,shareableLink:t.shareableLink,recording:i,rtmp:a,hls:s,sessionId:t.sessionId,startedAt:t.startedAt,joinedAt:t.joinedAt,peerCount:t.peerCount}}},{key:"convertMessage",value:function(e){var t,r,n,o,i,a,s;return{sender:null==(t=e.sender)?void 0:t.peerId,senderName:null==(r=e.sender)?void 0:r.name,senderRole:null==(o=null==(n=e.sender)?void 0:n.role)?void 0:o.name,senderUserId:null==(i=e.sender)?void 0:i.customerUserId,recipientPeer:null==(a=e.recipientPeer)?void 0:a.peerId,recipientRoles:null==(s=e.recipientRoles)?void 0:s.map(function(e){return e.name}),time:e.time,type:e.type,message:e.message}}},{key:"convertRoles",value:function(e){var t={};return e&&e.forEach(function(e){t[e.name]=e}),t}},{key:"convertRoleChangeRequest",value:function(e){var t;return{requestedBy:null==(t=e.requestedBy)?void 0:t.peerId,roleName:e.role.name,token:e.token}}},{key:"convertException",value:function(e){return{code:e.code,action:e.action,name:e.name,message:e.message,description:e.description,isTerminal:e.isTerminal,nativeError:e.nativeError,timestamp:new Date}}},{key:"convertDeviceChangeUpdate",value:function(e){var t={devices:e.devices,selection:e.selection,type:e.type};return e.error&&(t.error=this.convertException(e.error)),t}},{key:"convertPlaylist",value:function(e){return{audio:this.getConvertedPlaylistType(e,F.audio),video:this.getConvertedPlaylistType(e,F.video)}}},{key:"convertPlaylistItem",value:function(e,t){var r=t.type,n=e.getCurrentSelection(r),o=e.isPlaying(r),i=t.url===(null==n?void 0:n.url);return B(_({},t),{type:t.type,selected:i,playing:i&&o})}},{key:"getConvertedPlaylistType",value:function(t,r){var n={},o=t.getCurrentSelection(r),i=t.getCurrentProgress(r),a=t.getVolume(r),s=t.getList(r),c=t.getCurrentIndex(r);return t.getList(r).forEach(function(r){n[r.id]=e.convertPlaylistItem(t,r)}),{list:n,selection:{id:null==o?void 0:o.id,hasPrevious:c>0,hasNext:c<s.length-1},progress:i,volume:a,currentTime:t.getCurrentTime(r),playbackRate:t.getPlaybackRate(r)}}},{key:"convertRecordingStreamingState",value:function(e,t,r){var n;return{recording:{browser:_({running:!1},null==e?void 0:e.browser),server:_({running:!1},null==e?void 0:e.server),hls:_({running:!1},null==e?void 0:e.hls)},rtmp:_({running:!1},t),hls:{variants:(null==(n=null==r?void 0:r.variants)?void 0:n.map(function(e){return e}))||[],running:!!(null==r?void 0:r.running),error:null==r?void 0:r.error}}}}]),e}();function ne(e,t){var r,n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ae;if(t){var i,a=R(t.auxiliaryTracks);try{for(a.s();!(i=a.n()).done;){var s=e[i.value];o(s)&&(n=oe(s)?s:n,r=ie(s)?s:r)}}catch(c){a.e(c)}finally{a.f()}}return{video:r,audio:n}}function oe(e){return e&&"audio"===e.type}function ie(e){return e&&"video"===e.type}function ae(e){return e&&"screen"===e.source}function se(e){return e&&"audioplaylist"===e.source}function ce(e){return e&&"videoplaylist"===e.source}function ue(e){return!!e&&Boolean(null==e?void 0:e.degraded)}function le(e,t){return!(!t||!e.tracks[t])&&e.tracks[t].enabled}function de(e,t){return!(!t||!e.tracks[t])&&e.tracks[t].displayEnabled}var fe=function(e){return e.room},pe=(0,a.createSelector)(fe,function(e){return e.id}),ve=function(e){return e.peers},he=function(e){return e.messages.byID},ye=function(e){return e.messages.allIDs},Se=function(e){return e.tracks},ge=function(e){return e.settings},ke=function(e){return e.appData},me=function(e){return e.devices},be=function(e){return e.speakers},xe=function(e){return e.connectionQualities},Te=(0,a.createSelector)([fe],function(e){return e&&e.isConnected}),Pe=(0,a.createSelector)([Te,fe],function(e,t){return e?void 0!==t.peerCount?t.peerCount||1:t.peers.length:Math.max(void 0!==t.peerCount?t.peerCount:t.peers.length-1,0)}),Re=(0,a.createSelector)([fe,ve],function(e,t){return e.peers.map(function(e){return t[e]})}),De=(0,a.createSelector)(Se,function(e){return Object.values(e)}),Ee=(0,a.createSelector)(fe,ve,function(e,t){return t[e.localPeer]}),Ie=(0,a.createSelector)(fe,function(e){return e.localPeer}),we=(0,a.createSelector)(Ee,function(e){return null==e?void 0:e.name}),Me=(0,a.createSelector)(Ee,function(e){return null==e?void 0:e.roleName}),Ae=(0,a.createSelector)(Ee,function(e){return null==e?void 0:e.audioTrack}),Le=(0,a.createSelector)(Ee,function(e){return null==e?void 0:e.videoTrack}),Ce=(0,a.createSelector)(Ee,function(e){return null==e?void 0:e.auxiliaryTracks}),Oe=(0,a.createSelector)([Ae,Le,Ce],function(e,t,r){var n=y(r);return e&&n.unshift(e),t&&n.unshift(t),n}),Ne=(0,a.createSelector)(Re,function(e){return e.filter(function(e){return!e.isLocal})}),_e=(0,a.createSelector)(ve,be,function(e,t){var r=Object.entries(t).sort(function(e,t){var r,n,o=(null==(r=e[1])?void 0:r.audioLevel)||0;return((null==(n=t[1])?void 0:n.audioLevel)||0)>o?1:-1});if(r.length>0&&r[0][1].audioLevel&&r[0][1].audioLevel>0){var n=r[0][1].peerID;if(n in e)return e[n]}return null}),Be=function(e){var t=Ee(e);return le(e,null==t?void 0:t.audioTrack)},Ue=function(e){var t=Ee(e);return le(e,null==t?void 0:t.videoTrack)},He=function(e){var t=Ee(e);return de(e,null==t?void 0:t.videoTrack)},je=(0,a.createSelector)(Ee,Se,function(e,t){var r=ne(t,e),n=r.video,o=r.audio;return!(!n&&!o)}),Ve=(0,a.createSelector)(ve,Se,function(e,t){var r;for(var n in e){var o=e[n],i=ne(t,o),a=i.video,s=i.audio;if(a)return o;s&&!r&&(r=o)}return r}),Ke=(0,a.createSelector)(Ve,function(e){return!!e}),qe=(0,a.createSelector)(ve,Se,function(e,t){for(var r in e){var n=e[r],o=ne(t,n),i=o.audio;if(!o.video&&i)return n}}),Fe=(0,a.createSelector)(ve,Se,function(e,t){var r=[],n=[];for(var o in e){var i=e[o],a=ne(t,i),s=a.video,c=a.audio;s?r.push(i):c&&n.push(i)}return r.concat(n)}),Ge=(0,a.createSelector)(ve,Se,function(e,t){for(var r in t){var n=t[r];if(ce(n)&&ie(n)&&n.peerId)return e[n.peerId]}}),Qe=(0,a.createSelector)(ve,Se,function(e,t){for(var r in t){var n=t[r];if(se(n)&&n.peerId)return e[n.peerId]}}),Je=(0,a.createSelector)(De,function(e){return e.filter(ue)}),We=(0,a.createSelector)(ye,function(e){return e.length}),ze=(0,a.createSelector)(he,function(e){return Object.values(e).filter(function(e){return!e.read}).length}),Ye=(0,a.createSelector)(ye,he,function(e,t){var r=[];return e.forEach(function(e){r.push(t[e])}),r}),Xe=(0,a.createSelector)([fe],function(e){return e&&e.roomState}),$e=(0,a.createSelector)(Xe,function(e){return e===I.Preview}),Ze=(0,a.createSelector)(fe,function(e){return e.roomState!==I.Disconnected}),et=function(e){return e.roles},tt=(0,a.createSelector)([et],function(e){return Object.keys(e)}),rt=(0,a.createSelector)([Ee,et],function(e,t){return(null==e?void 0:e.roleName)?t[e.roleName]:null}),nt=(0,a.createSelector)([rt],function(e){var t;return!(null==(t=null==e?void 0:e.subscribeParams)||!t.subscribeToRoles)&&e.subscribeParams.subscribeToRoles.length>0}),ot=(0,a.createSelector)(rt,function(e){return null==e?void 0:e.permissions}),it=(0,a.createSelector)(fe,function(e){return e.recording}),at=(0,a.createSelector)(fe,function(e){return e.rtmp}),st=(0,a.createSelector)(fe,function(e){return e.hls}),ct=(0,a.createSelector)(fe,function(e){return e.sessionId}),ut=(0,a.createSelector)(fe,function(e){return e.startedAt}),lt=function(e){return e.sessionMetadata};exports.selectSessionMetadata=lt,exports.selectRoomStartTime=ut,exports.selectSessionId=ct,exports.selectHLSState=st,exports.selectRTMPState=at,exports.selectRecordingState=it,exports.selectPermissions=ot,exports.selectIsAllowedToSubscribe=nt,exports.selectLocalPeerRole=rt,exports.selectAvailableRoleNames=tt,exports.selectRolesMap=et,exports.selectRoomStarted=Ze,exports.selectIsInPreview=$e,exports.selectRoomState=Xe,exports.selectHMSMessages=Ye,exports.selectUnreadHMSMessagesCount=ze,exports.selectHMSMessagesCount=We,exports.selectDegradedTracks=Je,exports.selectPeerSharingAudioPlaylist=Qe,exports.selectPeerSharingVideoPlaylist=Ge,exports.selectPeersScreenSharing=Fe,exports.selectPeerSharingAudio=qe,exports.selectIsSomeoneScreenSharing=Ke,exports.selectPeerScreenSharing=Ve,exports.selectIsLocalScreenShared=je,exports.selectIsLocalVideoDisplayEnabled=He,exports.selectIsLocalVideoEnabled=Ue,exports.selectIsLocalAudioEnabled=Be,exports.selectDominantSpeaker=_e,exports.selectRemotePeers=Ne,exports.selectLocalTrackIDs=Oe,exports.selectLocalVideoTrackID=Le,exports.selectLocalAudioTrackID=Ae,exports.selectLocalPeerRoleName=Me,exports.selectLocalPeerName=we,exports.selectLocalPeerID=Ie,exports.selectLocalPeer=Ee,exports.selectPeers=Re,exports.selectPeerCount=Pe,exports.selectIsConnectedToRoom=Te,exports.selectConnectionQualities=xe,exports.selectSpeakers=be,exports.selectDevices=me,exports.selectFullAppData=ke,exports.selectLocalMediaSettings=ge,exports.selectTracksMap=Se,exports.selectMessageIDsInOrder=ye,exports.selectMessagesMap=he,exports.selectPeersMap=ve,exports.selectRoomID=pe,exports.selectRoom=fe;var dt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.audio;return function(t){return t.playlist[e].list}},ft=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.audio;return function(t){return t.playlist[e].selection}},pt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.audio;return function(t){return t.playlist[e].progress}},vt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.audio;return function(t){return t.playlist[e].currentTime}},ht=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.audio;return function(t){return t.playlist[e].playbackRate}},yt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.audio;return function(t){return t.playlist[e].volume}},St=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.audio;return(0,a.createSelector)(dt(e),function(e){return Object.values(e)})},gt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.audio;return(0,a.createSelector)(dt(e),ft(e),function(e,t){if(t.id)return e[t.id]})},kt={selection:ft(F.audio),progress:pt(F.audio),currentTime:vt(F.audio),playbackRate:ht(F.audio),volume:yt(F.audio),list:St(F.audio),selectedItem:gt(F.audio)},mt={selection:ft(F.video),progress:pt(F.video),currentTime:vt(F.video),playbackRate:ht(F.video),volume:yt(F.video),list:St(F.video),selectedItem:gt(F.video)};function bt(e){return function(t){return function(r){return e(r,t)}}}exports.selectVideoPlaylist=mt,exports.selectAudioPlaylist=kt;var xt="HMS-Store:",Tt=function(){function e(){m(this,e)}return x(e,null,[{key:"v",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.log.apply(this,[i.HMSLogLevel.VERBOSE,e].concat(r))}},{key:"d",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,[i.HMSLogLevel.DEBUG].concat(t))}},{key:"i",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,[i.HMSLogLevel.INFO].concat(t))}},{key:"w",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,[i.HMSLogLevel.WARN].concat(t))}},{key:"e",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,[i.HMSLogLevel.ERROR].concat(t))}},{key:"time",value:function(e){this.log(i.HMSLogLevel.TIME,"[HMSPerformanceTiming]",e)}},{key:"timeEnd",value:function(e){this.log(i.HMSLogLevel.TIMEEND,"[HMSPerformanceTiming]",e,e)}},{key:"cleanUp",value:function(){performance.clearMarks(),performance.clearMeasures()}},{key:"log",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(!(this.level.valueOf()>e.valueOf()))switch(e){case i.HMSLogLevel.VERBOSE:var o;(o=console).log.apply(o,[xt].concat(r));break;case i.HMSLogLevel.DEBUG:var a;(a=console).debug.apply(a,[xt].concat(r));break;case i.HMSLogLevel.INFO:var s;(s=console).info.apply(s,[xt].concat(r));break;case i.HMSLogLevel.WARN:var c;(c=console).warn.apply(c,[xt].concat(r));break;case i.HMSLogLevel.ERROR:var u;(u=console).error.apply(u,[xt].concat(r));break;case i.HMSLogLevel.TIME:performance.mark(r[1]);break;case i.HMSLogLevel.TIMEEND:var l=r[0],d=r[1];try{var f=performance.measure(d,d);this.log(i.HMSLogLevel.DEBUG,l,d,null==f?void 0:f.duration),performance.clearMarks(d),performance.clearMeasures(d)}catch(f){this.log(i.HMSLogLevel.DEBUG,l,d,f)}}}}]),e}();Tt.level=i.HMSLogLevel.VERBOSE;var Pt=function(e,t){return t},Rt=function(e,t){return t},Dt=function(e,t){return t},Et=function(e,t){return t},It=(0,a.createSelector)([ve,Pt],function(e,t){return t?e[t]:null}),wt=(0,a.createSelector)([Se,Rt],function(e,t){return t?e[t]:null}),Mt=(0,a.createSelector)([Se,Rt],function(e,t){if(!t)return null;var r=e[t];return"video"===(null==r?void 0:r.type)?r:null}),At=(0,a.createSelector)([Se,Rt],function(e,t){if(!t)return null;var r=e[t];return"audio"===(null==r?void 0:r.type)?r:null}),Lt=(0,a.createSelector)([Se,Rt],function(e,t){if(!t)return null;var r=e[t];return"audio"===(null==r?void 0:r.type)&&"screen"===(null==r?void 0:r.source)?r:null}),Ct=(0,a.createSelector)([Se,Rt],function(e,t){if(!t)return null;var r=e[t];return"video"===(null==r?void 0:r.type)&&"screen"===(null==r?void 0:r.source)?r:null}),Ot=bt(It),Nt=bt((0,a.createSelector)([ke,Et],function(e,t){if(e)return t?e[t]:e})),_t=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.createSelector)([ke],function(e){if(e){if(t&&t.length>0){for(var r=e,n=0,o=t;n<o.length;n++){var i=o[n];if(!i)return r;r=null==r?void 0:r[i]}return r}return e}})},Bt=bt((0,a.createSelector)(It,function(e){return null==e?void 0:e.name})),Ut=bt(wt),Ht=bt(Mt),jt=bt(At),Vt=bt(Lt),Kt=bt(Ct),qt=bt(function(e,t){var r=It(e,t);if(r&&r.videoTrack&&""!==r.videoTrack)return e.tracks[r.videoTrack]}),Ft=bt(function(e,t){var r=It(e,t);if(r&&r.audioTrack&&""!==r.audioTrack)return e.tracks[r.audioTrack]}),Gt=qt,Qt=bt(function(e,t){var r=It(e,t);return(null==r?void 0:r.auxiliaryTracks.map(function(t){return e.tracks[t]}))||[]}),Jt=function(e,t){return t?e.speakers[t]:null},Wt=bt((0,a.createSelector)(Jt,function(e){return(null==e?void 0:e.audioLevel)||0})),zt=function(e,t){var r=Ft(t)(e);return Jt(e,null==r?void 0:r.id)},Yt=bt((0,a.createSelector)(zt,function(e){return(null==e?void 0:e.audioLevel)||0})),Xt=bt(function(e,t){if(t)return e.connectionQualities[t]}),$t=bt(function(e,t){var r=It(e,t);if(r){var n=null==r?void 0:r.auxiliaryTracks.find(function(t){return oe(e.tracks[t])});return n?e.tracks[n]:void 0}}),Zt=bt((0,a.createSelector)(Se,It,function(e,t){var r=null==t?void 0:t.auxiliaryTracks.find(function(t){var r=e[t];return ce(r)&&ie(r)});return r?e[r]:void 0})),er=bt((0,a.createSelector)(Se,It,function(e,t){var r=null==t?void 0:t.auxiliaryTracks.find(function(t){var r=e[t];return ce(r)&&oe(r)});return r?e[r]:void 0})),tr=bt((0,a.createSelector)(Se,It,function(e,t){var r=null==t?void 0:t.auxiliaryTracks.find(function(t){var r=e[t];return se(r)&&oe(r)});return r?e[r]:void 0})),rr=bt((0,a.createSelector)(Se,It,function(e,t){return ne(e,t)})),nr=function(e){return(0,a.createSelector)(rr(e),function(e){return e.video})},or=function(e){return(0,a.createSelector)(rr(e),function(e){return e.audio})},ir=bt(function(e,t){var r=It(e,t);return le(e,null==r?void 0:r.audioTrack)}),ar=bt(function(e,t){var r=It(e,t);return le(e,null==r?void 0:r.videoTrack)}),sr=bt(function(e,t){if(t&&e.tracks[t])return 0===e.tracks[t].volume}),cr=bt(function(e,t){var r=It(e,t);return sr(null==r?void 0:r.audioTrack)(e)}),ur=bt(function(e,t){var r=or(t)(e);return sr(null==r?void 0:r.id)(e)}),lr=bt(function(e,t){var r=wt(e,t);if(r)return"audio"!==r.type?void Tt.w("Please pass audio track here"):r.volume}),dr=bt(function(e,t){var r=It(e,t);return lr(null==r?void 0:r.audioTrack)(e)}),fr=bt(function(e,t){var r=or(t)(e);return lr(null==r?void 0:r.id)(e)}),pr=bt(function(e,t){var r=wt(e,t);if(r)return"video"!==r.type?void Tt.w("Please pass video track here"):r.layer}),vr=(0,a.createSelector)([Ye,Ie,Pt],function(e,t,r){if(r)return e.filter(function(e){var n;return!(!(e.recipientPeer||(null==(n=e.recipientRoles)?void 0:n.length))||e.sender&&![t,r].includes(e.sender))&&[t,r].includes(e.recipientPeer)})}),hr=(0,a.createSelector)([Ye,Dt],function(e,t){if(t)return e.filter(function(e){var r,n;return!(null==(r=e.recipientRoles)||!r.length)&&(null==(n=e.recipientRoles)?void 0:n.includes(t))})}),yr=(0,a.createSelector)(Ye,function(e){return e.filter(function(e){var t;return!e.recipientPeer&&!(null==(t=e.recipientRoles)?void 0:t.length)})}),Sr=(0,a.createSelector)([hr,Dt],function(e){return e?e.filter(function(e){return!e.read}).length:0}),gr=(0,a.createSelector)([vr,Pt],function(e){return e?e.filter(function(e){return!e.read}).length:0}),kr=(0,a.createSelector)(yr,function(e){return e.filter(function(e){return!e.read}).length}),mr=bt(vr),br=bt(hr),xr=bt(Sr),Tr=bt(gr),Pr=function(e){return(0,a.createSelector)([Re],function(t){return t.filter(function(t){return t.roleName===e})})},Rr=function(e){return(0,a.createSelector)(Ot(e),function(e){try{return(null==e?void 0:e.metadata)&&""!==e.metadata?JSON.parse(e.metadata):{}}catch(t){return console.error("cannot parse peer metadata",t),{}}})},Dr=function(e){return(0,a.createSelector)(Ot(e),function(e){return null==e?void 0:e.name})};exports.selectPeerName=Dr,exports.selectPeerMetadata=Rr,exports.selectPeersByRole=Pr,exports.selectMessagesUnreadCountByPeerID=Tr,exports.selectMessagesUnreadCountByRole=xr,exports.selectMessagesByRole=br,exports.selectMessagesByPeerID=mr,exports.selectBroadcastMessagesUnreadCount=kr,exports.selectBroadcastMessages=yr,exports.selectSimulcastLayerByTrack=pr,exports.selectScreenshareAudioVolumeByPeerID=fr,exports.selectAudioVolumeByPeerID=dr,exports.selectAudioTrackVolume=lr,exports.selectIsScreenShareLocallyMutedByPeerID=ur,exports.selectIsLocallyMutedByPeerID=cr,exports.selectIsAudioLocallyMuted=sr,exports.selectIsPeerVideoEnabled=ar,exports.selectIsPeerAudioEnabled=ir,exports.selectScreenShareAudioByPeerID=or,exports.selectScreenShareByPeerID=nr,exports.selectScreenSharesByPeerId=rr,exports.selectAudioPlaylistTrackByPeerID=tr,exports.selectVideoPlaylistAudioTrackByPeerID=er,exports.selectVideoPlaylistVideoTrackByPeerID=Zt,exports.selectAuxiliaryAudioByPeerID=$t,exports.selectConnectionQualityByPeerID=Xt,exports.selectPeerAudioByID=Yt,exports.selectTrackAudioByID=Wt,exports.selectAuxiliaryTracksByPeerID=Qt,exports.selectCameraStreamByPeerID=Gt,exports.selectAudioTrackByPeerID=Ft,exports.selectVideoTrackByPeerID=qt,exports.selectScreenVideoTrackByID=Kt,exports.selectScreenAudioTrackByID=Vt,exports.selectAudioTrackByID=jt,exports.selectVideoTrackByID=Ht,exports.selectTrackByID=Ut,exports.selectPeerNameByID=Bt,exports.selectAppDataByPath=_t,exports.selectAppData=Nt,exports.selectPeerByID=Ot;var Er=(0,a.createSelector)([ve,Se],function(e,t){return Object.values(e).map(function(e){var r;return{peer:e,isAudioEnabled:!!e.audioTrack&&(null==(r=t[e.audioTrack])?void 0:r.enabled)}})}),Ir=function(e){return e.roleChangeRequests[0]||null},wr=(0,a.createSelector)([Ir,ve,et],function(e,t,r){return e?{requestedBy:e.requestedBy?t[e.requestedBy]:void 0,role:r[e.roleName],token:e.token}:null}),Mr=(0,a.createSelector)([rt],function(e){var t,r=!1,n=!1,o=!1;return(null==(t=null==e?void 0:e.publishParams)?void 0:t.allowed)&&(r=e.publishParams.allowed.includes("video"),n=e.publishParams.allowed.includes("audio"),o=e.publishParams.allowed.includes("screen")),{video:r,audio:n,screen:o}});exports.selectIsAllowedToPublish=Mr,exports.selectRoleChangeRequest=wr,exports.selectPeersWithAudioStatus=Er;var Ar=function(e){return(0,a.createSelector)([et],function(t){return t[e]})},Lr=(0,a.createSelector)([Le,Se],function(e,t){var r=null;return e&&(r=t[e]),(null==r?void 0:r.plugins)||[]}),Cr=(0,a.createSelector)([Ae,Se],function(e,t){var r=null;return e&&(r=t[e]),(null==r?void 0:r.plugins)||[]}),Or=function(e){return(0,a.createSelector)([Lr],function(t){return t.includes(e)})},Nr=function(e){return(0,a.createSelector)([Cr],function(t){return t.includes(e)})},_r=function(e){return(0,a.createSelector)(Re,function(t){return t.find(e)})},Br=function(e){return(0,a.createSelector)(Re,function(t){return t.filter(e)})},Ur=function(e){return(0,a.createSelector)(fe,function(t){return t.joinedAt&&Date.now()-t.joinedAt.getTime()<=e})};function Hr(e){return e instanceof i.HMSRemoteAudioTrack||e instanceof i.HMSRemoteVideoTrack}exports.selectDidIJoinWithin=Ur,exports.selectPeersByCondition=Br,exports.selectPeerByCondition=_r,exports.selectIsLocalAudioPluginPresent=Nr,exports.selectIsLocalVideoPluginPresent=Or,exports.selectRoleByRoleName=Ar;var jr=function(){function e(t,r,n,o){m(this,e),this.playlistManager=t,this.syncPlaylistState=n,this.store=o,this.type=r}return x(e,[{key:"play",value:function(e){return H(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}return Tt.w("Please pass id to play"),t.abrupt("return");case 3:return t.next=5,this.playlistManager.setEnabled(!0,{id:e,type:this.type});case 5:case"end":return t.stop()}},t,this)}))}},{key:"pause",value:function(){return H(this,null,h().mark(function e(){var t,r;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.type===F.audio?kt:mt,(r=this.store.getState(t.selection)).id){e.next=4;break}return Tt.w("No item is currently playing to pause"),e.abrupt("return");case 4:return e.next=6,this.playlistManager.setEnabled(!1,{id:r.id,type:this.type});case 6:case"end":return e.stop()}},e,this)}))}},{key:"playNext",value:function(){return H(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.playlistManager.playNext(this.type);case 2:case"end":return e.stop()}},e,this)}))}},{key:"playPrevious",value:function(){return H(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.playlistManager.playPrevious(this.type);case 2:case"end":return e.stop()}},e,this)}))}},{key:"seek",value:function(e){this.playlistManager.seek(e,this.type),this.syncPlaylistState("seekOn".concat(this.type,"Playlist"))}},{key:"seekTo",value:function(e){this.playlistManager.seekTo(e,this.type),this.syncPlaylistState("seekToOn".concat(this.type,"Playlist"))}},{key:"setVolume",value:function(e){this.playlistManager.setVolume(e,this.type),this.syncPlaylistState("setVolumeOn".concat(this.type,"Playlist"))}},{key:"setList",value:function(e){this.playlistManager.setList(e),this.syncPlaylistState("setListOn".concat(this.type,"Playlist"))}},{key:"stop",value:function(){return H(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.playlistManager.stop(this.type);case 2:this.syncPlaylistState("stop".concat(this.type,"Playlist"));case 3:case"end":return e.stop()}},e,this)}))}},{key:"setIsAutoplayOn",value:function(e){this.playlistManager.setIsAutoplayOn(this.type,e)}},{key:"setPlaybackRate",value:function(e){this.playlistManager.setPlaybackRate(this.type,e),this.syncPlaylistState("set".concat(this.type,"PlaybackRate"))}},{key:"removeItem",value:function(e){return H(this,null,h().mark(function t(){var r;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.playlistManager.removeItem(e,this.type);case 2:return r=t.sent,t.abrupt("return",(r&&this.syncPlaylistState("remove".concat(this.type,"PlaylistItem")),r));case 4:case"end":return t.stop()}},t,this)}))}},{key:"clearList",value:function(){return H(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.playlistManager.clearList(this.type);case 2:this.syncPlaylistState("clear".concat(this.type,"Playlist"));case 3:case"end":return e.stop()}},e,this)}))}}]),e}(),Vr=(v(e={},i.HMSPeerUpdate.PEER_JOINED,q.PEER_JOINED),v(e,i.HMSPeerUpdate.PEER_LEFT,q.PEER_LEFT),v(e,i.HMSPeerUpdate.ROLE_UPDATED,q.ROLE_UPDATED),v(e,i.HMSPeerUpdate.NAME_UPDATED,q.NAME_UPDATED),v(e,i.HMSPeerUpdate.METADATA_UPDATED,q.METADATA_UPDATED),e),Kr=(v(t={},i.HMSTrackUpdate.TRACK_ADDED,q.TRACK_ADDED),v(t,i.HMSTrackUpdate.TRACK_REMOVED,q.TRACK_REMOVED),v(t,i.HMSTrackUpdate.TRACK_MUTED,q.TRACK_MUTED),v(t,i.HMSTrackUpdate.TRACK_UNMUTED,q.TRACK_UNMUTED),v(t,i.HMSTrackUpdate.TRACK_DEGRADED,q.TRACK_DEGRADED),v(t,i.HMSTrackUpdate.TRACK_RESTORED,q.TRACK_RESTORED),v(t,i.HMSTrackUpdate.TRACK_DESCRIPTION_CHANGED,q.TRACK_DESCRIPTION_CHANGED),t),qr=function(){function e(t,r,n){var o=this;m(this,e),this.hmsSDKTracks={},this.hmsSDKPeers={},this.isRoomJoinCalled=!1,this.ignoredMessageTypes=[],this.setProgress=function(e){var t=e.type,r=e.progress;o.setState(function(e){e.playlist[t].progress=r,e.playlist[t].currentTime=o.sdk.getPlaylistManager().getCurrentTime(t)},"playlistProgress")},this.syncPlaylistState=function(e){o.setState(function(e){Object.assign(e.playlist,re.convertPlaylist(o.sdk.getPlaylistManager()))},e)},this.sendPeerUpdateNotification=function(e,t){var r=o.store.getState(Ot(t.peerId)),n=Vr[e]||"peerUpdate";o.syncRoomState(n),r||(r=o.store.getState(Ot(t.peerId))),o.hmsNotifications.sendPeerUpdate(e,r)},this.setState=function(e,t){return o.store.namedSetState(e,t)},this.store=t,this.sdk=r,this.hmsNotifications=n}return x(e,[{key:"refreshDevices",value:function(){return H(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sdk.refreshDevices();case 2:case"end":return e.stop()}},e,this)}))}},{key:"unblockAudio",value:function(){return H(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sdk.getAudioOutput().unblockAutoplay();case 2:case"end":return e.stop()}},e,this)}))}},{key:"setVolume",value:function(e,t){t?this.setTrackVolume(e,t):(this.sdk.getAudioOutput().setVolume(e),this.syncRoomState("setOutputVolume"))}},{key:"setAudioOutputDevice",value:function(e){return H(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.getAudioOutput().setDevice(e);case 2:if(t.t0=t.sent,!t.t0){t.next=5;break}this.setState(function(t){t.settings.audioOutputDeviceId=e},"setAudioOutputDevice");case 5:case"end":return t.stop()}},t,this)}))}},{key:"setPreferredLayer",value:function(e,t){var r=this.hmsSDKTracks[e];r?r instanceof i.HMSRemoteVideoTrack?(r.preferLayer(t),this.updateVideoLayer(e,"setPreferredLayer")):Tt.w("track ".concat(e," is not an video track")):this.logPossibleInconsistency("track ".concat(e," not present, unable to set preffer layer"))}},{key:"preview",value:function(e){return H(this,null,h().mark(function t(){var r;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isRoomJoinCalled){t.next=3;break}return this.logPossibleInconsistency("attempting to call preview after join was called"),t.abrupt("return");case 3:if((r=this.store.getState(Xe))!==I.Preview&&r!==I.Connecting){t.next=7;break}return this.logPossibleInconsistency("attempting to call preview while room is in preview/connecting"),t.abrupt("return");case 7:return t.prev=7,this.setState(function(e){e.room.roomState=I.Connecting},"connecting"),t.next=11,this.sdkPreviewWithListeners(e);case 11:t.next=16;break;case 13:throw t.prev=13,t.t0=t.catch(7),Tt.e("Cannot show preview. Failed to connect to room - ",t.t0),t.t0;case 16:case"end":return t.stop()}},t,this,[[7,13]])}))}},{key:"join",value:function(e){return H(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isRoomJoinCalled){t.next=3;break}return this.logPossibleInconsistency("room join is called again"),t.abrupt("return");case 3:return t.prev=3,this.isRoomJoinCalled=!0,this.setState(function(e){e.room.roomState=I.Connecting},"join"),t.next=8,this.sdkJoinWithListeners(e);case 8:t.next=13;break;case 10:throw t.prev=10,t.t0=t.catch(3),this.isRoomJoinCalled=!1,Tt.e("Failed to connect to room - ",t.t0),t.t0;case 13:case"end":return t.stop()}},t,this,[[3,10]])}))}},{key:"leave",value:function(){return H(this,null,h().mark(function e(){var t,r=this;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.store.getState(Ze)){e.next=3;break}return this.logPossibleInconsistency("room leave is called when no room is connected"),e.abrupt("return");case 3:return t=this.store.getState(Xe),e.abrupt("return",(this.setState(function(e){e.room.roomState=I.Disconnecting},"leaving"),this.sdk.leave().then(function(){r.resetState("leave"),Tt.i("left room")}).catch(function(e){Tt.e("error in leaving room - ",e),r.setState(function(e){e.room.roomState=t},"revertLeave")})));case 5:case"end":return e.stop()}},e,this)}))}},{key:"setScreenShareEnabled",value:function(e,t){return H(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n={audioOnly:!1,videoOnly:!1},"object"==p(t)?Object.assign(n,t):"boolean"==typeof t&&(n.audioOnly=t),r.prev=2,!e){r.next=8;break}return r.next=6,this.startScreenShare(n);case 6:r.next=10;break;case 8:return r.next=10,this.stopScreenShare();case 10:r.next=15;break;case 12:throw r.prev=12,r.t0=r.catch(2),this.hmsNotifications.sendError(re.convertException(r.t0)),r.t0;case 15:case"end":return r.stop()}},r,this,[[2,12]])}))}},{key:"addTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"regular";return H(this,null,h().mark(function r(){return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.sdk.addTrack(e,t);case 2:this.syncRoomState("addTrack");case 3:case"end":return r.stop()}},r,this)}))}},{key:"removeTrack",value:function(e){return H(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.removeTrack(e);case 2:this.syncRoomState("removeTrack");case 3:case"end":return t.stop()}},t,this)}))}},{key:"setLocalAudioEnabled",value:function(e){return H(this,null,h().mark(function t(){var r;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.store.getState(Ae),t.t0=r,!t.t0){t.next=5;break}return t.next=5,this.setEnabledTrack(r,e);case 5:case"end":return t.stop()}},t,this)}))}},{key:"setLocalVideoEnabled",value:function(e){return H(this,null,h().mark(function t(){var r;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.store.getState(Le),t.t0=r,!t.t0){t.next=5;break}return t.next=5,this.setEnabledTrack(r,e);case 5:case"end":return t.stop()}},t,this)}))}},{key:"setEnabledTrack",value:function(e,t){return H(this,null,h().mark(function r(){var n,o,a=this;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if((null==(n=this.store.getState().tracks[e])?void 0:n.enabled)!==t){r.next=3;break}return this.logPossibleInconsistency("local track[".concat(e,"] enabled state - ").concat(t)),r.abrupt("return");case 3:return this.setState(function(r){r.tracks[e]?r.tracks[e].displayEnabled=t:a.logPossibleInconsistency("track id not found for setEnabled")},"displayEnabled"),r.prev=4,r.next=7,this.setEnabledSDKTrack(e,t);case 7:this.syncRoomState("setEnabled"),r.next=13;break;case 10:throw r.prev=10,r.t0=r.catch(4),this.setState(function(r){r.tracks[e].displayEnabled=!t},"rollbackDisplayEnabled"),this.hmsNotifications.sendError(re.convertException(r.t0)),r.t0;case 13:o=t?i.HMSTrackUpdate.TRACK_UNMUTED:i.HMSTrackUpdate.TRACK_MUTED,this.hmsNotifications.sendTrackUpdate(o,e);case 15:case"end":return r.stop()}},r,this,[[4,10]])}))}},{key:"setAudioSettings",value:function(e){return H(this,null,h().mark(function t(){var r;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.store.getState(Ae),t.t0=r,!t.t0){t.next=6;break}return t.next=5,this.setSDKLocalAudioTrackSettings(r,e);case 5:this.syncRoomState("setAudioSettings");case 6:case"end":return t.stop()}},t,this)}))}},{key:"setVideoSettings",value:function(e){return H(this,null,h().mark(function t(){var r;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.store.getState(Le),t.t0=r,!t.t0){t.next=6;break}return t.next=5,this.setSDKLocalVideoTrackSettings(r,e);case 5:this.syncRoomState("setVideoSettings");case 6:case"end":return t.stop()}},t,this)}))}},{key:"sendMessage",value:function(e){this.sendBroadcastMessage(e)}},{key:"sendBroadcastMessage",value:function(e,t){return H(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.sdk.sendBroadcastMessage(e,t);case 2:n=r.sent,this.updateMessageInStore(n,{message:e,type:t});case 4:case"end":return r.stop()}},r,this)}))}},{key:"sendGroupMessage",value:function(e,t,r){return H(this,null,h().mark(function n(){var o,i,a;return h().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=this.store.getState(et),i=t.map(function(e){return o[e]}),n.next=4,this.sdk.sendGroupMessage(e,i,r);case 4:a=n.sent,this.updateMessageInStore(a,{message:e,recipientRoles:t,type:r});case 6:case"end":return n.stop()}},n,this)}))}},{key:"sendDirectMessage",value:function(e,t,r){return H(this,null,h().mark(function n(){var o,i;return h().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=this.hmsSDKPeers[t],n.next=3,this.sdk.sendDirectMessage(e,o,r);case 3:i=n.sent,this.updateMessageInStore(i,{message:e,recipientPeer:o.peerId,type:r});case 5:case"end":return n.stop()}},n,this)}))}},{key:"updateMessageInStore",value:function(e,t){if(!e)throw Tt.w("sendMessage","Failed to send message",t),Error("sendMessage Failed - ".concat(JSON.stringify(t)));var r=re.convertMessage(e);return r.read=!0,r.senderName="You",r.ignored=this.ignoredMessageTypes.includes(r.type),this.putMessageInStore(r),r}},{key:"setMessageRead",value:function(e,t){var r=this;this.setState(function(n){t?n.messages.byID[t]?n.messages.byID[t].read=e:r.logPossibleInconsistency("no message with id is found"):n.messages.allIDs.forEach(function(t){n.messages.byID[t].read=e})},"setMessageRead")}},{key:"attachVideo",value:function(e,t){return H(this,null,h().mark(function r(){var n=this;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!this.localAndVideoUnmuting(e)){r.next=2;break}return r.abrupt("return",new Promise(function(r){var o=n.store.subscribe(function(i){return H(n,null,h().mark(function n(){return h().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=i,!n.t0){n.next=6;break}return n.next=4,this.attachVideoInternal(e,t);case 4:o(),r();case 6:case"end":return n.stop()}},n,this)}))},Ue)}));case 2:return r.next=4,this.attachVideoInternal(e,t);case 4:case"end":return r.stop()}},r,this)}))}},{key:"detachVideo",value:function(e,t){return H(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:"video"===(null==(n=this.hmsSDKTracks[e])?void 0:n.type)?(n.removeSink(t),this.updateVideoLayer(e,"detachVideo")):(t&&(t.srcObject=null),this.logPossibleInconsistency("no video track found to remove sink"));case 2:case"end":return r.stop()}},r,this)}))}},{key:"addPluginToVideoTrack",value:function(e,t){return H(this,null,h().mark(function r(){return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.addRemoveVideoPlugin(e,"add",t));case 1:case"end":return r.stop()}},r,this)}))}},{key:"addPluginToAudioTrack",value:function(e){return H(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.addRemoveAudioPlugin(e,"add"));case 1:case"end":return t.stop()}},t,this)}))}},{key:"validateVideoPluginSupport",value:function(e){var t={isSupported:!1};if(!e)return Tt.w("no plugin passed in for checking support"),t.errMsg="no plugin passed in for checking support",t;var r=this.store.getState(Le);if(!r)return Tt.w("video Track not added to local peer yet"),t.errMsg="call this function only after local peer has video track",t;var n=this.hmsSDKTracks[r];return n?t=n.validatePlugin(e):(Tt.w("track ".concat(r," not present, unable to validate plugin")),t.errMsg="track ".concat(r," not present, unable to validate plugin")),t}},{key:"validateAudioPluginSupport",value:function(e){var t={isSupported:!1};if(!e)return Tt.w('no plugin passed in for checking support"'),t.errMsg='no plugin passed in for checking support"',t;var r=this.store.getState(Ae);if(!r)return Tt.w("audio track not added to local peer yet"),t.errMsg="call this function only after local peer has audio track",t;var n=this.hmsSDKTracks[r];return n?t=n.validatePlugin(e):(Tt.w("track ".concat(r," not present, unable to validate plugin")),t.errMsg="track ".concat(r," not present, unable to validate plugin")),t}},{key:"removePluginFromVideoTrack",value:function(e){return H(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.addRemoveVideoPlugin(e,"remove"));case 1:case"end":return t.stop()}},t,this)}))}},{key:"removePluginFromAudioTrack",value:function(e){return H(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.addRemoveAudioPlugin(e,"remove"));case 1:case"end":return t.stop()}},t,this)}))}},{key:"changeRole",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return H(this,null,h().mark(function n(){var o;return h().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(o=this.hmsSDKPeers[e]){n.next=4;break}return this.logPossibleInconsistency("Unknown peer ID given ".concat(e," for changerole")),n.abrupt("return");case 4:return n.next=6,this.sdk.changeRole(o,t,r);case 6:case"end":return n.stop()}},n,this)}))}},{key:"acceptChangeRole",value:function(e){return H(this,null,h().mark(function t(){var r,n;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(r=e.requestedBy?this.hmsSDKPeers[e.requestedBy.id]:void 0)||Tt.w("peer for which role change is requested no longer available - ".concat(e.requestedBy)),n={requestedBy:r,role:e.role,token:e.token},t.next=5,this.sdk.acceptChangeRole(n);case 5:this.removeRoleChangeRequest(e);case 6:case"end":return t.stop()}},t,this)}))}},{key:"initAppData",value:function(e){this.setState(function(t){t.appData=e},"initAppData")}},{key:"setAppData",value:function(e,t,r){var n="Object"===(null==t?void 0:t.constructor.name);this.setState(function(o){if(o.appData)r&&n?Object.assign(o.appData[e],t):o.appData[e]=t;else{var i=v({},e,t);o.appData=i}},"setAppData-".concat(e))}},{key:"rejectChangeRole",value:function(e){this.removeRoleChangeRequest(e)}},{key:"endRoom",value:function(e,t){return H(this,null,h().mark(function r(){var n,o;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null==(n=this.store.getState(ot))?void 0:n.endRoom){r.next=4;break}return Tt.w("You are not allowed to perform this action - endRoom"),r.abrupt("return");case 4:return o=this.store.getState(Xe),this.setState(function(e){e.room.roomState=I.Disconnecting},"endingRoom"),r.prev=6,r.next=9,this.sdk.endRoom(e,t);case 9:this.resetState("endRoom"),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(6),Tt.e("error in ending room - ",r.t0),this.setState(function(e){e.room.roomState=o},"revertEndRoom");case 15:case"end":return r.stop()}},r,this,[[6,12]])}))}},{key:"removePeer",value:function(e,t){return H(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n=this.hmsSDKPeers[e])||n.isLocal){r.next=6;break}return r.next=4,this.sdk.removePeer(n,t);case 4:r.next=8;break;case 6:return this.logPossibleInconsistency("No remote peer found for peerID - ".concat(e)),r.abrupt("return");case 8:case"end":return r.stop()}},r,this)}))}},{key:"startRTMPOrRecording",value:function(e){return H(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.startRTMPOrRecording(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"stopRTMPAndRecording",value:function(){return H(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sdk.stopRTMPAndRecording();case 2:case"end":return e.stop()}},e,this)}))}},{key:"startHLSStreaming",value:function(e){return H(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.startHLSStreaming(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"stopHLSStreaming",value:function(e){return H(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.stopHLSStreaming(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"sendHLSTimedMetadata",value:function(e){return H(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.sendHLSTimedMetadata(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"changeName",value:function(e){return H(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.changeName(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"changeMetadata",value:function(e){return H(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return"string"!=typeof e&&(e=JSON.stringify(e)),t.next=3,this.sdk.changeMetadata(e);case 3:case"end":return t.stop()}},t,this)}))}},{key:"setSessionMetadata",value:function(e){return H(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.setSessionMetadata(e);case 2:this.setState(function(t){t.sessionMetadata=e},"setSessionMetadata");case 3:case"end":return t.stop()}},t,this)}))}},{key:"populateSessionMetadata",value:function(){return H(this,null,h().mark(function e(){var t;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sdk.getSessionMetadata();case 2:t=e.sent,this.setState(function(e){e.sessionMetadata=t},"populateSessionMetadata");case 4:case"end":return e.stop()}},e,this)}))}},{key:"setRemoteTrackEnabled",value:function(e,t){return H(this,null,h().mark(function r(){var n,o=this;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("string"!=typeof e){r.next=10;break}if(!(n=this.hmsSDKTracks[e])||!Hr(n)){r.next=7;break}return r.next=5,this.sdk.changeTrackState(n,t);case 5:r.next=8;break;case 7:this.logPossibleInconsistency("No remote track with ID ".concat(e," found for change track state"));case 8:r.next=11;break;case 10:Array.isArray(e)&&e.forEach(function(e){return o.setRemoteTrackEnabled(e,t)});case 11:case"end":return r.stop()}},r,this)}))}},{key:"setRemoteTracksEnabled",value:function(e){return H(this,null,h().mark(function t(){var r,n;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={enabled:e.enabled,type:e.type,source:e.source},e.roles&&(n=this.store.getState(et),r.roles=e.roles.map(function(e){return n[e]})),t.next=4,this.sdk.changeMultiTrackState(r);case 4:case"end":return t.stop()}},t,this)}))}},{key:"setLogLevel",value:function(e){Tt.level=e,this.sdk.setLogLevel(e)}},{key:"setFrameworkInfo",value:function(e){this.sdk.setFrameworkInfo(e)}},{key:"ignoreMessageTypes",value:function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])this.ignoredMessageTypes=e;else{var t,r=R(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this.ignoredMessageTypes.includes(n)||this.ignoredMessageTypes.push(n)}}catch(o){r.e(o)}finally{r.f()}}}},{key:"resetState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"resetState";this.isRoomJoinCalled=!1,this.hmsSDKTracks={},Tt.cleanUp(),this.setState(function(e){Object.assign(e,G())},e)}},{key:"sdkJoinWithListeners",value:function(e){return H(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.join(e,{onJoin:this.onJoin.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this),onMessageReceived:this.onMessageReceived.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onRoleChangeRequest:this.onRoleChangeRequest.bind(this),onRoleUpdate:this.onRoleUpdate.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onChangeTrackStateRequest:this.onChangeTrackStateRequest.bind(this),onChangeMultiTrackStateRequest:this.onChangeMultiTrackStateRequest.bind(this),onRemovedFromRoom:this.onRemovedFromRoom.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this)});case 2:this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)}),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:this.onConnectionQualityUpdate.bind(this)});case 4:case"end":return t.stop()}},t,this)}))}},{key:"onRemovedFromRoom",value:function(e){var t,r=this.store.getState(Ot(null==(t=e.requestedBy)?void 0:t.peerId));this.hmsNotifications.sendLeaveRoom(B(_({},e),{requestedBy:r||void 0}));var n=e.roomEnded||!r?"roomEnded":"removedFromRoom";Tt.i("resetting state after peer removed ".concat(n),e),this.resetState(n)}},{key:"onDeviceChange",value:function(e){var t=this,r=e.devices;if(r){var n=this.store.getState(Ee);if(this.setState(function(e){ee(e.devices.audioInput,r.audioInput)||(e.devices.audioInput=r.audioInput),ee(e.devices.videoInput,r.videoInput)||(e.devices.videoInput=r.videoInput),ee(e.devices.audioOutput,r.audioOutput)||(e.devices.audioOutput=r.audioOutput),t.hmsSDKPeers[null==n?void 0:n.id]&&Object.assign(e.settings,t.getMediaSettings(t.hmsSDKPeers[null==n?void 0:n.id]))},"deviceChange"),e.selection){var o=re.convertDeviceChangeUpdate(e);this.hmsNotifications.sendDeviceChange(o)}}}},{key:"sdkPreviewWithListeners",value:function(e){return H(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.preview(e,{onPreview:this.onPreview.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this)});case 2:this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)});case 3:case"end":return t.stop()}},t,this)}))}},{key:"onNetworkQuality",value:function(e){var t=this;this.setState(function(r){var n,o=r.room.localPeer||(null==(n=t.sdk.getLocalPeer())?void 0:n.peerId);o&&(r.connectionQualities[o]={peerID:o,downlinkQuality:e})},"ConnectionQuality")}},{key:"startScreenShare",value:function(e){return H(this,null,h().mark(function t(){var r=this;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.store.getState(je)){t.next=4;break}this.logPossibleInconsistency("start screenshare is called while it's on"),t.next=7;break;case 4:return t.next=6,this.sdk.startScreenShare(function(){return r.syncRoomState("screenshareStopped")},e);case 6:this.syncRoomState("startScreenShare");case 7:case"end":return t.stop()}},t,this)}))}},{key:"stopScreenShare",value:function(){return H(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.store.getState(je)){e.next=6;break}return e.next=3,this.sdk.stopScreenShare();case 3:this.syncRoomState("stopScreenShare"),e.next=7;break;case 6:this.logPossibleInconsistency("stop screenshare is called while it's not on");case 7:case"end":return e.stop()}},e,this)}))}},{key:"attachVideoInternal",value:function(e,t){return H(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:(n=this.hmsSDKTracks[e])&&"video"===n.type?(n.addSink(t),this.updateVideoLayer(e,"attachVideo")):this.logPossibleInconsistency("no video track found to add sink");case 2:case"end":return r.stop()}},r,this)}))}},{key:"syncRoomState",value:function(e){var t=this;e="".concat(e,"_fullSync"),Tt.time("store-sync-".concat(e));var r,n={},o=[],i={},a={},s={},c=R(this.sdk.getPeers());try{for(c.s();!(r=c.n()).done;){var u=r.value,l=re.convertPeer(u);n[l.id]=l,o.push(l.id),this.hmsSDKPeers[l.id]=u;var d,f=R([u.audioTrack,u.videoTrack].concat(y(u.auxiliaryTracks)));try{for(f.s();!(d=f.n()).done;){var p=d.value;if(p){var v=re.convertTrack(p);i[v.id]=v,a[p.trackId]=p}}}catch(k){f.e(k)}finally{f.f()}l.isLocal&&Object.assign(s,this.getMediaSettings(u))}}catch(k){c.e(k)}finally{c.f()}var h=this.sdk.getRecordingState(),S=this.sdk.getRTMPState(),g=this.sdk.getHLSState();this.setState(function(e){e.room.peers=o;var r=e.peers,c=e.tracks;J(r,n),W(c,i),Object.assign(e.settings,s),t.hmsSDKTracks=a,Object.assign(e.roles,re.convertRoles(t.sdk.getRoles())),Object.assign(e.playlist,re.convertPlaylist(t.sdk.getPlaylistManager())),Object.assign(e.room,re.convertRecordingStreamingState(h,S,g))},e),Tt.timeEnd("store-sync-".concat(e))}},{key:"onPreview",value:function(e){this.setState(function(t){Object.assign(t.room,re.convertRoom(e)),t.room.roomState=I.Preview},"previewStart"),this.syncRoomState("previewSync")}},{key:"onJoin",value:function(e){var t=this,r=this.sdk.getPlaylistManager();this.audioPlaylist=new jr(r,F.audio,this.syncPlaylistState.bind(this),this.store),this.videoPlaylist=new jr(r,F.video,this.syncRoomState.bind(this),this.store),this.syncRoomState("joinSync"),this.setState(function(t){Object.assign(t.room,re.convertRoom(e)),t.room.isConnected=!0,t.room.roomState=I.Connected},"joined"),r.onProgress(this.setProgress),r.onNewTrackStart(function(e){t.syncPlaylistState("".concat(e.type,"PlaylistUpdate"))}),r.onPlaylistEnded(function(e){t.syncPlaylistState("".concat(e,"PlaylistEnded"))}),r.onCurrentTrackEnded(function(e){t.hmsNotifications.sendPlaylistTrackEnded(re.convertPlaylistItem(r,e)),t.syncPlaylistState("".concat(e.type,"PlaylistItemEnded"))})}},{key:"onRoomUpdate",value:function(e,t){this.setState(function(e){Object.assign(e.room,re.convertRoom(t))},e)}},{key:"onPeerUpdate",value:function(e,t){if(![i.HMSPeerUpdate.BECAME_DOMINANT_SPEAKER,i.HMSPeerUpdate.RESIGNED_DOMINANT_SPEAKER].includes(e)){if(Array.isArray(t)){this.syncRoomState("peersJoined");var r,n=[],o=R(t);try{for(o.s();!(r=o.n()).done;){var a=r.value,s=this.store.getState(Ot(a.peerId));s&&n.push(s)}}catch(c){o.e(c)}finally{o.f()}return void this.hmsNotifications.sendPeerList(n)}this.sendPeerUpdateNotification(e,t)}}},{key:"onTrackUpdate",value:function(e,t,r){if(e===i.HMSTrackUpdate.TRACK_REMOVED)this.hmsNotifications.sendTrackUpdate(e,t.trackId),this.handleTrackRemove(t,r);else{var n=Kr[e]||"trackUpdate";this.syncRoomState(n),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}}},{key:"onMessageReceived",value:function(e){var t=re.convertMessage(e);t.read=!1,t.ignored=this.ignoredMessageTypes.includes(t.type),this.putMessageInStore(t),this.hmsNotifications.sendMessageReceived(t)}},{key:"putMessageInStore",value:function(e){var t=this;e.ignored||this.setState(function(r){e.id=String(t.store.getState(We)+1),r.messages.byID[e.id]=e,r.messages.allIDs.push(e.id)},"newMessage")}},{key:"onAudioLevelUpdate",value:function(e){this.setState(function(t){var r={};e.forEach(function(e){if(e.track&&e.peer){var n=e.track.trackId;r[n]=e.audioLevel,t.speakers[n]||(t.speakers[n]={audioLevel:e.audioLevel,peerID:e.peer.peerId,trackID:n})}});for(var n=0,o=Object.entries(t.speakers);n<o.length;n++){var i=u(o[n],2),a=i[0],s=i[1];s.audioLevel=r[a]||0,0===s.audioLevel&&delete t.speakers[a]}},"audioLevel")}},{key:"onConnectionQualityUpdate",value:function(e){this.setState(function(t){var r=new Set;e.forEach(function(e){var n=e.peerID;!n||(r.add(n),t.connectionQualities[n]?Object.assign(t.connectionQualities[n],e):t.connectionQualities[n]=e)});for(var n=0,o=Object.keys(t.connectionQualities);n<o.length;n++){var i=o[n];r.has(i)||delete t.connectionQualities[i]}},"connectionQuality")}},{key:"onChangeTrackStateRequest",value:function(e){var t,r=this.store.getState(Ot(null==(t=e.requestedBy)?void 0:t.peerId)),n=this.getStoreLocalTrackIDfromSDKTrack(e.track),o=this.store.getState(Ut(n));if(!o)return this.logPossibleInconsistency("Not found track for which track state change was requested, ".concat(e.track));e.enabled||this.syncRoomState("changeTrackStateRequest"),this.hmsNotifications.sendChangeTrackStateRequest({requestedBy:r||void 0,track:o,enabled:e.enabled})}},{key:"onChangeMultiTrackStateRequest",value:function(e){var t,r=this.store.getState(Ot(null==(t=e.requestedBy)?void 0:t.peerId));e.enabled||this.syncRoomState("changeMultiTrackStateRequest");var n,o=[],i=this.store.getState(Se),a=R(e.tracks);try{for(a.s();!(n=a.n()).done;){var s=n.value,c=this.getStoreLocalTrackIDfromSDKTrack(s);c&&i[c]&&o.push(i[c])}}catch(u){a.e(u)}finally{a.f()}this.hmsNotifications.sendChangeMultiTrackStateRequest({requestedBy:r||void 0,tracks:o,enabled:e.enabled,type:e.type,source:e.source})}},{key:"onReconnected",value:function(){this.syncRoomState("reconnectedSync"),this.hmsNotifications.sendReconnected(),this.setState(function(e){e.room.roomState=e.room.isConnected?I.Connected:I.Preview},"reconnected")}},{key:"onReconnecting",value:function(e){var t=re.convertException(e);Tt.e("Reconnection: received error from sdk",t),this.hmsNotifications.sendReconnecting(t),this.setState(function(e){e.room.roomState=I.Reconnecting,e.errors.push(t)},"reconnecting")}},{key:"onError",value:function(e){var t=re.convertException(e);t.isTerminal?(this.leave().then(function(){return Tt.e("error from SDK, left room.")}),this.setState(function(e){e.room.roomState=I.Failed,e.errors.push(t)},"errorTerminal")):this.store.getState().errors.length<50&&this.setState(function(e){e.errors.push(t)},"error"),this.syncRoomState("errorSync"),this.hmsNotifications.sendError(t),Tt.e("received error from sdk",t instanceof i.HMSException?"".concat(t):t)}},{key:"updateVideoLayer",value:function(e,t){var r=this.hmsSDKTracks[e];if(r&&r instanceof i.HMSRemoteVideoTrack){var n=this.store.getState(Ht(e));((null==n?void 0:n.layer)!==r.getSimulcastLayer()||(null==n?void 0:n.degraded)!==r.degraded)&&this.setState(function(t){var n=t.tracks[e];n.layer=r.getSimulcastLayer(),n.degraded=r.degraded},t)}}},{key:"handleTrackRemove",value:function(e,t){var r=this;this.setState(function(n){var o=n.peers[t.peerId],i=n.tracks,a=e.trackId;if(r.isSameStoreSDKTrack(a,null==o?void 0:o.audioTrack))null==o||delete o.audioTrack;else if(r.isSameStoreSDKTrack(a,null==o?void 0:o.videoTrack))null==o||delete o.videoTrack;else{var s=null==o?void 0:o.auxiliaryTracks.indexOf(a);s>-1&&r.isSameStoreSDKTrack(a,null==o?void 0:o.auxiliaryTracks[s])&&(null==o||o.auxiliaryTracks.splice(s,1))}delete i[a],delete r.hmsSDKTracks[a]},"trackRemoved")}},{key:"setEnabledSDKTrack",value:function(e,t){return H(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n=this.hmsSDKTracks[e])){r.next=6;break}return r.next=4,n.setEnabled(t);case 4:r.next=7;break;case 6:this.logPossibleInconsistency("track ".concat(e," not present, unable to enabled/disable"));case 7:case"end":return r.stop()}},r,this)}))}},{key:"setSDKLocalVideoTrackSettings",value:function(e,t){return H(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n=this.hmsSDKTracks[e])){r.next=6;break}return r.next=4,n.setSettings(t);case 4:r.next=7;break;case 6:this.logPossibleInconsistency("local track ".concat(e," not present, unable to set settings"));case 7:case"end":return r.stop()}},r,this)}))}},{key:"setSDKLocalAudioTrackSettings",value:function(e,t){return H(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n=this.hmsSDKTracks[e])){r.next=6;break}return r.next=4,n.setSettings(t);case 4:r.next=7;break;case 6:this.logPossibleInconsistency("local track ".concat(e," not present, unable to set settings"));case 7:case"end":return r.stop()}},r,this)}))}},{key:"getMediaSettings",value:function(e){var t,r=this.store.getState(ge),n=e.audioTrack,o=e.videoTrack;return{audioInputDeviceId:(null==n?void 0:n.settings.deviceId)||r.audioInputDeviceId,videoInputDeviceId:(null==o?void 0:o.settings.deviceId)||r.videoInputDeviceId,audioOutputDeviceId:null==(t=this.sdk.getAudioOutput().getDevice())?void 0:t.deviceId}}},{key:"setTrackVolume",value:function(e,t){var r=this.hmsSDKTracks[t];r?r instanceof i.HMSAudioTrack?(r.setVolume(e),this.setState(function(r){var n=r.tracks[t];n&&"audio"===n.type&&(n.volume=e)},"trackVolume")):Tt.w("track ".concat(t," is not an audio track")):this.logPossibleInconsistency("track ".concat(t," not present, unable to set volume"))}},{key:"localAndVideoUnmuting",value:function(e){if(this.store.getState(Ee).videoTrack!==e)return!1;var t=this.store.getState(He),r=this.store.getState(Ue);return t&&!r}},{key:"logPossibleInconsistency",value:function(e){Tt.w("possible inconsistency detected - ",e)}},{key:"addRemoveVideoPlugin",value:function(e,t,r){return H(this,null,h().mark(function n(){var o,i;return h().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=3;break}return Tt.w("Invalid plugin received in store"),n.abrupt("return");case 3:if(!(o=this.store.getState(Le))){n.next=20;break}if(!(i=this.hmsSDKTracks[o])){n.next=19;break}if("add"!==t){n.next=12;break}return n.next=10,i.addPlugin(e,r);case 10:n.next=16;break;case 12:if(n.t0="remove"===t,!n.t0){n.next=16;break}return n.next=16,i.removePlugin(e);case 16:this.syncRoomState("".concat(t,"VideoPlugin")),n.next=20;break;case 19:this.logPossibleInconsistency("track ".concat(o," not present, unable to remove plugin"));case 20:case"end":return n.stop()}},n,this)}))}},{key:"addRemoveAudioPlugin",value:function(e,t){return H(this,null,h().mark(function r(){var n,o;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e){r.next=3;break}return Tt.w("Invalid plugin received in store"),r.abrupt("return");case 3:if(!(n=this.store.getState(Ae))){r.next=20;break}if(!(o=this.hmsSDKTracks[n])){r.next=19;break}if("add"!==t){r.next=12;break}return r.next=10,o.addPlugin(e);case 10:r.next=16;break;case 12:if(r.t0="remove"===t,!r.t0){r.next=16;break}return r.next=16,o.removePlugin(e);case 16:this.syncRoomState("".concat(t,"AudioPlugin")),r.next=20;break;case 19:this.logPossibleInconsistency("track ".concat(n," not present, unable to remove plugin"));case 20:case"end":return r.stop()}},r,this)}))}},{key:"isSameStoreSDKTrack",value:function(e,t){var r;return!!t&&(null==(r=this.hmsSDKTracks[t])?void 0:r.trackId)===e}},{key:"onRoleChangeRequest",value:function(e){this.setState(function(t){0===t.roleChangeRequests.length&&t.roleChangeRequests.push(re.convertRoleChangeRequest(e))},"roleChangeRequest")}},{key:"removeRoleChangeRequest",value:function(e){this.setState(function(t){var r=t.roleChangeRequests.findIndex(function(t){return t.token===e.token});-1!==r&&t.roleChangeRequests.splice(r,1)},"removeRoleChangeRequest")}},{key:"onRoleUpdate",value:function(){this.syncRoomState("roleUpdate")}},{key:"getStoreLocalTrackIDfromSDKTrack",value:function(e){var t=this;return this.store.getState(Oe).find(function(r){return t.hmsSDKTracks[r].trackId===e.trackId})}}]),e}(),Fr="hmsNotification",Gr=function(){function e(t){var r=this;m(this,e),this.id=0,this.onNotification=function(e,t){var n=function(r){if(t&&!(Array.isArray(t)?t.includes(r.type):t===r.type))return;e(r)};return r.eventEmitter.addListener(Fr,n),function(){r.eventEmitter.removeListener(Fr,n)}},this.store=t,this.eventEmitter=new s.EventEmitter2({maxListeners:Object.keys(q).length})}return x(e,[{key:"sendPlaylistTrackEnded",value:function(e){var t=this.createNotification(q.PLAYLIST_TRACK_ENDED,e,K.INFO);this.emitEvent(t)}},{key:"sendDeviceChange",value:function(e){var t,r=this.createNotification(q.DEVICE_CHANGE_UPDATE,e,e.error?K.ERROR:K.INFO,"Selected ".concat(e.type," device - ").concat(null==(t=e.selection)?void 0:t.label));this.emitEvent(r)}},{key:"sendLeaveRoom",value:function(e){var t,r=null==(t=e.requestedBy)?void 0:t.name,n=this.createNotification(e.roomEnded||!r?q.ROOM_ENDED:q.REMOVED_FROM_ROOM,e,K.INFO,"".concat(e.roomEnded?"Room ended":"Removed from room"," ").concat(r?"by ".concat(r):""));this.emitEvent(n)}},{key:"sendPeerList",value:function(e){var t=this.createNotification(q.PEER_LIST,e,K.INFO);this.emitEvent(t)}},{key:"sendPeerUpdate",value:function(e,t){var r=this.store.getState(Ot(null==t?void 0:t.id))||t,n=Vr[e];if(n){var o=this.createNotification(n,r,K.INFO);this.emitEvent(o)}}},{key:"sendTrackUpdate",value:function(e,t){var r=this.store.getState(Ut(t)),n=Kr[e];if(n){var o=this.createNotification(n,r,K.INFO);this.emitEvent(o)}}},{key:"sendMessageReceived",value:function(e){var t=this.createNotification(q.NEW_MESSAGE,e,K.INFO);this.emitEvent(t)}},{key:"sendError",value:function(e){var t=this.createNotification(q.ERROR,e,K.ERROR);this.emitEvent(t)}},{key:"sendReconnecting",value:function(e){var t=this.createNotification(q.RECONNECTING,e,K.ERROR);this.emitEvent(t)}},{key:"sendReconnected",value:function(){var e=this.createNotification(q.RECONNECTED,null,K.INFO);this.emitEvent(e)}},{key:"sendChangeTrackStateRequest",value:function(e){var t=this.createNotification(q.CHANGE_TRACK_STATE_REQUEST,e,K.INFO);this.emitEvent(t)}},{key:"sendChangeMultiTrackStateRequest",value:function(e){var t=this.createNotification(q.CHANGE_MULTI_TRACK_STATE_REQUEST,e,K.INFO);this.emitEvent(t)}},{key:"emitEvent",value:function(e){this.eventEmitter.emit(Fr,e)}},{key:"createNotification",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return this.id++,{id:this.id,type:e,message:n,data:t,severity:r}}}]),e}(),Qr=function(e){return i.isBrowser?"".concat(e," ").concat(document.title):e},Jr=function(e,t,r){var n;r.getState(Xe)===I.Connected&&(n=Wr(e,t,r)),r.subscribe(function(o){[I.Connected,I.Reconnecting].includes(o)?n||(n=Wr(e,t,r)):[I.Disconnected,I.Failed].includes(o)&&n&&(Xr(t,o),n(),n=void 0)},Xe)},Wr=function(e,t,r){var n,o,i=zr(r,t);null==(n=e.getWebrtcInternals())||n.start();var a=null==(o=e.getWebrtcInternals())?void 0:o.onStatsChange(function(e){return Yr(t,e,r)});return function(){i(),a&&a()}},zr=function(e,t){var r,n,o;return e.getState(Ie)?t.namedSetState(function(t){t.localPeer.id=e.getState(Ie)},"localpeer-id"):r=e.subscribe(function(e){e&&t.namedSetState(function(t){t.localPeer.id=e},"localpeer-id")},Ie),e.getState(Le)?t.namedSetState(function(t){t.localPeer.videoTrack=e.getState(Le)},"localpeer-videotrack-id"):n=e.subscribe(function(e){e&&t.namedSetState(function(t){t.localPeer.videoTrack=e},"localpeer-videotrack-id")},Le),e.getState(Ae)?t.namedSetState(function(t){t.localPeer.videoTrack=e.getState(Ae)},"localpeer-audiotrack-id"):o=e.subscribe(function(e){e&&t.namedSetState(function(t){t.localPeer.videoTrack=e},"localpeer-audiotrack-id")},Ae),function(){null==r||r(),null==n||n(),null==o||o()}},Yr=function(e,t,r){var n=r.getState(Se);e.namedSetState(function(e){for(var o={},i=0,a=Object.keys(n);i<a.length;i++){var s=a[i],c=t.getTrackStats(s);c&&(o[s]=c)}z(e.trackStats,o);var u=v({},r.getState(Ie),t.getLocalPeerStats());z(e.peerStats,u)},"webrtc-stats")},Xr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"resetState";e.namedSetState(function(e){Object.assign(e,Q())},t)},$r=x(function e(t,r){var n=this;m(this,e),this.hmsStore=t,this.sdk=r,this.store=On.createNewHMSStore(Qr("HMSStatsStore"),Q),this.getState=this.store.getState,this.subscribe=this.store.subscribe,this.getPublishPeerConnection=function(){return new Promise(function(e){var t,r;"Connected"===n.hmsStore.getState(Xe)?e(null==(r=null==(t=n.sdk)?void 0:t.getWebrtcInternals())?void 0:r.getPublishPeerConnection()):n.hmsStore.subscribe(function(t){var r,o;"Connected"===t&&e(null==(o=null==(r=n.sdk)?void 0:r.getWebrtcInternals())?void 0:o.getPublishPeerConnection())},Xe)})},this.getSubscribePeerConnection=function(){return new Promise(function(e){var t,r;"Connected"===n.hmsStore.getState(Xe)?e(null==(r=null==(t=n.sdk)?void 0:t.getWebrtcInternals())?void 0:r.getSubscribePeerConnection()):n.hmsStore.subscribe(function(t){var r,o;"Connected"===t&&e(null==(o=null==(r=n.sdk)?void 0:r.getWebrtcInternals())?void 0:o.getSubscribePeerConnection())},Xe)})},this.sdk&&Jr(this.sdk,this.store,this.hmsStore)});exports.HMSStats=$r;var Zr=function(e){return e.localPeer.id},en=function(e){return e.localPeer.audioTrack},tn=function(e){return e.localPeer.videoTrack},rn=function(e,t){return t},nn=function(e,t){return t},on=function(e){return e.trackStats},an=function(e){return e.peerStats},sn=(0,a.createSelector)([an,Zr],function(e,t){return e[t]}),cn=(0,a.createSelector)(sn,function(e){var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.packetsLost}),un=(0,a.createSelector)(sn,function(e){var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.jitter}),ln=(0,a.createSelector)(sn,function(e){var t;return null==(t=null==e?void 0:e.publish)?void 0:t.bitrate}),dn=(0,a.createSelector)(sn,function(e){var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.bitrate}),fn=(0,a.createSelector)(sn,function(e){var t;return null==(t=null==e?void 0:e.publish)?void 0:t.availableOutgoingBitrate}),pn=(0,a.createSelector)(sn,function(e){var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.availableIncomingBitrate}),vn=(0,a.createSelector)(sn,function(e){var t;return null==(t=null==e?void 0:e.publish)?void 0:t.bytesSent}),hn=(0,a.createSelector)(sn,function(e){var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.bytesReceived}),yn=(0,a.createSelector)([an,rn],function(e,t){return t?e[t]:void 0}),Sn=(0,a.createSelector)([on,nn],function(e,t){return t?e[t]:void 0}),gn=bt(yn),kn=bt(Sn),mn=bt((0,a.createSelector)(Sn,function(e){return null==e?void 0:e.bitrate})),bn=bt((0,a.createSelector)(Sn,function(e){return null==e?void 0:e.bytesReceived})),xn=bt((0,a.createSelector)(Sn,function(e){return null==e?void 0:e.framesPerSecond})),Tn=bt((0,a.createSelector)(Sn,function(e){return null==e?void 0:e.jitter})),Pn=bt((0,a.createSelector)(Sn,function(e){return null==e?void 0:e.packetsLost})),Rn=(0,a.createSelector)([on,en],function(e,t){return t?e[t]:void 0}),Dn=(0,a.createSelector)([on,tn],function(e,t){return t?e[t]:void 0}),En=(0,a.createSelector)(Rn,function(e){return null==e?void 0:e.bitrate}),In=(0,a.createSelector)(Dn,function(e){return null==e?void 0:e.bitrate}),wn=(0,a.createSelector)(Rn,function(e){return null==e?void 0:e.bytesSent}),Mn=(0,a.createSelector)(Dn,function(e){return null==e?void 0:e.bytesSent}),An=(0,a.createSelector)(Dn,function(e){return null==e?void 0:e.framesPerSecond}),Ln=(0,a.createSelector)(Dn,function(e){return null==e?void 0:e.qualityLimitationReason}),Cn={localPeerStats:sn,packetsLost:cn,jitter:un,publishBitrate:ln,subscribeBitrate:dn,availablePublishBitrate:fn,availableSubscribeBitrate:pn,totalBytesSent:vn,totalBytesReceived:hn,peerStatsByID:gn,trackStatsByID:kn,bitrateByTrackID:mn,bytesReceivedByTrackID:bn,framerateByTrackID:xn,jitterByTrackID:Tn,packetsLostByTrackID:Pn,localAudioTrackStats:Rn,localVideoTrackStats:Dn,localAudioTrackBitrate:En,localVideoTrackBitrate:In,localAudioTrackBytesSent:wn,localVideoTrackBytesSent:Mn,localVideoTrackFramerate:An,localVideoTrackQualityLimitationReason:Ln};exports.selectHMSStats=Cn;var On=function(){function e(t,r,n){var o=this;m(this,e),this.getStats=function(){return o.stats||(o.stats=new $r(o.store,o.sdk)),o.stats},this.store=t||e.createNewHMSStore(Qr("HMSStore"),G),this.notifications=n||new Gr(this.store),r?this.actions=r:(this.sdk=new i.HMSSdk,this.actions=new qr(this.store,this.sdk,this.notifications)),this.actions.setFrameworkInfo({type:"js",sdkVersion:j().version}),this.initialTriggerOnSubscribe=!1,i.isBrowser&&(window.__hms=this)}return x(e,[{key:"triggerOnSubscribe",value:function(){this.initialTriggerOnSubscribe||(e.makeStoreTriggerOnSubscribe(this.store),this.initialTriggerOnSubscribe=!0)}},{key:"getStore",value:function(){return this.store}},{key:"getHMSActions",value:function(){return this.actions}},{key:"getActions",value:function(){return this.actions}},{key:"getNotifications",value:function(){return{onNotification:this.notifications.onNotification}}}],[{key:"createNewHMSStore",value:function(t,o){var i=(0,n.default)(function(){return o()}),a=i.setState;i.setState=function(e){var t="function"==typeof e?(0,r.default)(e):e;a(t)};var s=i.getState;i.getState=function(e){return e?e(s()):s()},e.compareWithShallowCheckInSubscribe(i);var c=e.setUpDevtools(i,t);return B(_({},i),{namedSetState:c})}},{key:"makeStoreTriggerOnSubscribe",value:function(e){var t=e.subscribe;e.subscribe=function(r,n,o){return r(e.getState(n),void 0),t(r,n,o)}}},{key:"compareWithShallowCheckInSubscribe",value:function(e){var t=e.subscribe;e.subscribe=function(e,r,n){return r||(r=function(e){return e}),n=n||o.default,t(e,r,n)}}},{key:"setUpDevtools",value:function(t,r){var n;try{n=window.__REDUX_DEVTOOLS_EXTENSION__||window.top.__REDUX_DEVTOOLS_EXTENSION__}catch(a){}if(!n)return function(e){t.setState(e)};var o=n.connect(e.devtoolsOptions(r));o.prefix=r?"".concat(r," > "):"";var i=t.setState;return t.setState=function(e){i(e),o.send("".concat(o.prefix,"setState"),t.getState())},o.subscribe(e.devtoolsSubscribe(o,t,i)),o.send("setUpStore",t.getState()),function(e,r){i(e);var n=r||"".concat(o.prefix,"action");o.send(n,t.getState())}}},{key:"devtoolsOptions",value:function(e){return{name:e,actionsBlacklist:["audioLevel","playlistProgress","connectionQuality"]}}},{key:"devtoolsSubscribe",value:function(e,t,r){return function(n){var o,i,a,s;if("DISPATCH"===n.type&&n.state)["JUMP_TO_ACTION","JUMP_TO_STATE"].includes(n.payload.type)?r(JSON.parse(n.state)):t.setState(JSON.parse(n.state));else if("DISPATCH"===n.type&&"COMMIT"===(null==(o=n.payload)?void 0:o.type))e.init(t.getState());else if("DISPATCH"===n.type&&"IMPORT_STATE"===(null==(i=n.payload)?void 0:i.type)){var c=null==(a=n.payload.nextLiftedState)?void 0:a.actionsById;((null==(s=n.payload.nextLiftedState)?void 0:s.computedStates)||[]).forEach(function(n,o){var i=n.state,a=c[o]||"".concat(e.prefix,"setState");0===o?e.init(i):(r(i),e.send(a,t.getState()))})}}}}]),e}();exports.HMSReactiveStore=On;
},{"immer":"mkVv","zustand/vanilla":"UWKb","zustand/shallow":"J5wV","@100mslive/hms-video":"ZYu2","reselect":"K9HF","eventemitter2":"x3aR"}],"H99C":[function(require,module,exports) {
"use strict";var e=require("@100mslive/hms-video-store"),t=new e.HMSReactiveStore;t.triggerOnSubscribe();var n=t.getStore(),d=t.getActions(),o=document.getElementById("join"),i=document.getElementById("join-btn"),c=document.getElementById("conference"),a=document.getElementById("peers-container"),s=document.getElementById("leave-btn"),l=document.getElementById("mute-aud"),u=document.getElementById("mute-vid"),r=document.getElementById("controls"),m=new Set;function v(){d.leave()}function g(e,t){var n=document.createElement(e);return n.className=t,n}function b(t){var o=g("div","peer-tile"),i=g("video","peer-video"),c=g("div","peer-name");return i.autoplay=!0,i.muted=!0,i.playsinline=!0,c.textContent=t.name,n.subscribe(function(e){e&&i&&(null!=e&&e.enabled?d.attachVideo(e.id,i):d.detachVideo(e.id,i))},(0,e.selectVideoTrackByID)(t.videoTrack)),o.append(i),o.append(c),m.add(t.id),o}function E(){n.getState(e.selectPeers).forEach(function(e){!m.has(e.id)&&e.videoTrack&&a.append(b(e))})}function h(e){e?(o.classList.add("hide"),c.classList.remove("hide"),s.classList.remove("hide"),r.classList.remove("hide")):(o.classList.remove("hide"),c.classList.add("hide"),s.classList.add("hide"),r.classList.add("hide"))}i.onclick=function(){d.join({userName:document.getElementById("name").value,authToken:document.getElementById("token").value})},window.onunload=window.onbeforeunload=v,s.onclick=v,n.subscribe(E,e.selectPeers),l.onclick=function(){var t=!n.getState(e.selectIsLocalAudioEnabled);d.setLocalAudioEnabled(t),l.textContent=t?"Mute":"Unmute"},u.onclick=function(){var t=!n.getState(e.selectIsLocalVideoEnabled);d.setLocalVideoEnabled(t),u.textContent=t?"Hide":"Unhide"},n.subscribe(h,e.selectIsConnectedToRoom);
},{"@100mslive/hms-video-store":"j5Na"}]},{},["H99C"], null)
//# sourceMappingURL=/csb-6qq7fw/src.70256a40.js.map